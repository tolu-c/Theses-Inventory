(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[10],{70010:(C,E,r)=>{"use strict";r.r(E),r.d(E,{BitstreamPageModule:()=>ue});var l=r(35103),g=r(57999),m=r(67522),y=r(99805),v=r(39034),u=r(46533),f=r(10572),e=r(98678);const P=[(0,u.l)("bundle",{},(0,u.l)("primaryBitstream"),(0,u.l)("item")),(0,u.l)("format")];let c=(()=>{class n{constructor(t){this.bitstreamService=t}resolve(t,i){return this.bitstreamService.findById(t.params.id,!0,!1,...this.followLinks).pipe((0,f.hC)())}get followLinks(){return P}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275inject(v.J))},n.\u0275prov=e.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})();var h=r(48358),p=r(21160),b=r(77007),D=r(77176),d=r(45608),L=r(35794),A=r(80978),F=r(38123),$=r(53426),S=r(9237),K=r(1507),T=r(71213),z=r(78944),M=r(8842),N=r(83770),W=r(12857),H=r(69175),R=r(96342);const J=function(n){return{bitstream:n}};let U=(()=>{class n{constructor(t,i,a,s,B,I,pe,ve,fe,he,ge){this.route=t,this.router=i,this.authorizationService=a,this.auth=s,this.fileService=B,this.hardRedirectService=I,this.location=pe,this.dsoNameService=ve,this.signpostingDataService=fe,this.responseService=he,this.platformId=ge,this.initPageLinks()}back(){this.location.back()}ngOnInit(){this.bitstreamRD$=this.route.data.pipe((0,h.U)(t=>t.bitstream)),this.bitstream$=this.bitstreamRD$.pipe((0,z.Gh)(this.router,this.auth),(0,f.xe)()),this.bitstream$.pipe((0,p.w)(t=>{const i=this.authorizationService.isAuthorized(A.i.CanDownload,(0,d.UE)(t)?t.self:void 0),a=this.auth.isAuthenticated();return(0,$.a)([i,a,(0,S.of)(t)])}),(0,b.h)(([t,i,a])=>(0,d.Uh)(t)&&(0,d.Uh)(i)),(0,D.q)(1),(0,p.w)(([t,i,a])=>t&&i?this.fileService.retrieveFileDownloadLink(a._links.content.href).pipe((0,b.h)(s=>(0,d.Uh)(s)),(0,D.q)(1),(0,h.U)(s=>[t,i,a,s])):[[t,i,a,""]])).subscribe(([t,i,a,s])=>{t&&i&&(0,d.UE)(s)?this.hardRedirectService.redirect(s):t&&!i?this.hardRedirectService.redirect(a._links.content.href):!t&&i?this.router.navigateByUrl((0,T.dd)(),{skipLocationChange:!0}):!t&&!i&&(this.auth.setRedirectUrl(this.router.url),this.router.navigateByUrl("login"))})}initPageLinks(){(0,l.PM)(this.platformId)&&this.route.params.subscribe(t=>{this.signpostingDataService.getLinks(t.id).pipe((0,D.q)(1)).subscribe(i=>{let a="";i.forEach(s=>{a=a+((0,d.UE)(a)?", ":"")+`<${s.href}> ; rel="${s.rel}"`+((0,d.UE)(s.type)?` ; type="${s.type}" `:" ")}),this.responseService.setHeader("Link",a)})})}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275directiveInject(m.gz),e.\u0275\u0275directiveInject(m.F0),e.\u0275\u0275directiveInject(L._),e.\u0275\u0275directiveInject(F.e8),e.\u0275\u0275directiveInject(K.I),e.\u0275\u0275directiveInject(H.A),e.\u0275\u0275directiveInject(l.Ye),e.\u0275\u0275directiveInject(M._),e.\u0275\u0275directiveInject(N.I),e.\u0275\u0275directiveInject(W.N),e.\u0275\u0275directiveInject(e.PLATFORM_ID))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["ds-bitstream-download-page"]],decls:10,vars:11,consts:[[1,"container"],[1,"pt-3"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"]],template:function(t,i){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"h3"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",1)(6,"button",2),e.\u0275\u0275listener("click",function(){return i.back()}),e.\u0275\u0275element(7,"i",3),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()()),2&t&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(3,2,"bitstream.download.page",e.\u0275\u0275pureFunction1(9,J,i.dsoNameService.getName(e.\u0275\u0275pipeBind1(4,5,i.bitstream$))))),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(9,7,"bitstream.download.page.back")," "))},dependencies:[l.Ov,R.X$],encapsulation:2}),n})();var Y=r(84535),G=r(60740),X=r(37161),Z=r(50269),Q=r(76215),V=r(53482);const w=function(n){return["/bitstreams",n,"edit"]};let k=(()=>{class n{constructor(t){this.route=t}ngOnInit(){this.dsoRD$=this.route.data.pipe((0,Q.P)(),(0,h.U)(t=>t.bitstream))}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275directiveInject(m.gz))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["ds-collection-authorizations"]],decls:10,vars:12,consts:[[1,"container"],[3,"resourceType","resourceUUID"],[1,"button-row","bottom"],[1,"text-right"],["role","button",1,"btn","btn-outline-secondary","mr-1",3,"routerLink"],[1,"fas","fa-arrow-left"]],template:function(t,i){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"ds-resource-policies",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",2)(4,"div",3)(5,"a",4),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275element(7,"i",5),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()()()),2&t){let a,s;e.\u0275\u0275advance(1),e.\u0275\u0275property("resourceType","bitstream")("resourceUUID",null==(a=e.\u0275\u0275pipeBind1(2,4,i.dsoRD$))||null==a.payload?null:a.payload.id),e.\u0275\u0275advance(4),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(10,w,null==(s=e.\u0275\u0275pipeBind1(6,6,i.dsoRD$))||null==s.payload?null:s.payload.id)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(9,8,"bitstream.edit.return")," ")}},dependencies:[m.rH,V.F,l.Ov,R.X$],encapsulation:2}),n})(),j=(()=>{class n{constructor(t){this.bitstreamDataService=t}resolve(t,i){const a=t.params.prefix,s=t.params.suffix,B=t.params.filename;let I=t.params.sequence_id;return(0,d.xI)(I)&&(I=t.queryParams.sequenceId),this.bitstreamDataService.findByItemHandle(`${a}/${s}`,I,B).pipe((0,f.hC)())}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275inject(v.J))},n.\u0275prov=e.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var q=r(42252),_=r(17338),ee=r(30658),te=r(96509);let x=(()=>{class n extends te.B{constructor(t,i,a){super(i,a),this.bitstreamService=t,this.linkService=i,this.dsoNameService=a}getBreadcrumbs(t,i){const a=this.dsoNameService.getName(t),s=new _.a(a,i);return this.getOwningItem(t.uuid).pipe((0,p.w)(B=>{if((0,d.UE)(B)&&(0,d.Uh)(B.payload)){const I=B.payload;return super.getBreadcrumbs(I,(0,T.Y4)(I))}return(0,S.of)([])}),(0,h.U)(B=>[...B,s]))}getOwningItem(t){return this.bitstreamService.findById(t,!0,!0,...P).pipe((0,f.hC)(),(0,f.xe)(),(0,p.w)(i=>(0,d.Uh)(i)?i.bundle.pipe((0,f.hC)(),(0,f.xe)(),(0,p.w)(a=>(0,d.Uh)(a)?a.item.pipe((0,f.hC)()):(0,S.of)(void 0))):(0,S.of)(void 0)))}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275inject(v.J),e.\u0275\u0275inject(ee.M),e.\u0275\u0275inject(M._))},n.\u0275prov=e.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),O=(()=>{class n extends q.t{constructor(t,i){super(t,i),this.breadcrumbService=t,this.dataService=i}get followLinks(){return P}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275inject(x),e.\u0275\u0275inject(v.J))},n.\u0275prov=e.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var re=r(76457),ne=r(4682);function ie(n,o){}const ae=["*"];let oe=(()=>{class n extends ne.F{getComponentName(){return"EditBitstreamPageComponent"}importThemedComponent(t){return r(1166)(`./${t}/app/bitstream-page/edit-bitstream-page/edit-bitstream-page.component`)}importUnthemedComponent(){return r.e(8679).then(r.bind(r,98679))}}return n.\u0275fac=function(){let o;return function(i){return(o||(o=e.\u0275\u0275getInheritedFactory(n)))(i||n)}}(),n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["ds-themed-edit-bitstream-page"]],features:[e.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:ae,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(t,i){1&t&&(e.\u0275\u0275projectionDef(),e.\u0275\u0275template(0,ie,0,0,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(2,"div",null,1),e.\u0275\u0275projection(4),e.\u0275\u0275elementEnd())},encapsulation:2}),n})(),de=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=e.\u0275\u0275defineInjector({providers:[c,O,x],imports:[m.Bz.forChild([{path:"handle/:prefix/:suffix/:filename",component:U,resolve:{bitstream:j}},{path:":prefix/:suffix/:sequence_id/:filename",component:U,resolve:{bitstream:j}},{path:":id/download",component:U,resolve:{bitstream:c}},{path:":id/edit",component:oe,resolve:{bitstream:c,breadcrumb:O},canActivate:[y.J]},{path:":id/authorizations",children:[{path:"create",resolve:{resourcePolicyTarget:Y.a},component:G.v,data:{title:"resource-policies.create.page.title",showBreadcrumbs:!0}},{path:"edit",resolve:{breadcrumb:re.t,resourcePolicy:X.b},component:Z.x,data:{breadcrumbKey:"item.edit",title:"resource-policies.edit.page.title",showBreadcrumbs:!0}},{path:"",resolve:{bitstream:c,breadcrumb:O},component:k,data:{title:"bitstream.edit.authorizations.title",showBreadcrumbs:!0}}]}])]}),n})();var le=r(50867),me=r(54131);let ue=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=e.\u0275\u0275defineInjector({imports:[l.ez,g.m,de,le.e,me.q]}),n})()},42252:(C,E,r)=>{"use strict";r.d(E,{t:()=>f});var l=r(96509),g=r(10572),m=r(48358),y=r(45608),v=r(14246),u=r(98678);let f=(()=>{class e{constructor(c,h){this.breadcrumbService=c,this.dataService=h}resolve(c,h){const p=c.params.id;return this.dataService.findById(p,!0,!1,...this.followLinks).pipe((0,g.hC)(),(0,g.xe)(),(0,m.U)(b=>{if((0,y.Uh)(b)){const D=h.url,d=D.substr(0,D.indexOf(p))+p;return{provider:this.breadcrumbService,key:b,url:d}}}))}}return e.\u0275fac=function(c){return new(c||e)(u.\u0275\u0275inject(l.B),u.\u0275\u0275inject(v.t))},e.\u0275prov=u.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},83770:(C,E,r)=>{"use strict";r.d(E,{I:()=>f});var l=r(9249),g=r(48358),m=r(9237),y=r(16441),v=r(98678),u=r(49281);let f=(()=>{class e{constructor(c,h){this.appConfig=c,this.restService=h}getLinks(c){return this.restService.get(`${this.appConfig.rest.baseUrl}/signposting/links/${c}`).pipe((0,l.K)(p=>(0,m.of)([])),(0,g.U)(p=>200===p.statusCode?p.payload:[]))}}return e.\u0275fac=function(c){return new(c||e)(v.\u0275\u0275inject(y.q),v.\u0275\u0275inject(u.Y))},e.\u0275prov=v.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},1166:(C,E,r)=>{var l={"./custom/app/bitstream-page/edit-bitstream-page/edit-bitstream-page.component":[75458,8679,5458]};function g(m){if(!r.o(l,m))return Promise.resolve().then(()=>{var u=new Error("Cannot find module '"+m+"'");throw u.code="MODULE_NOT_FOUND",u});var y=l[m],v=y[0];return Promise.all(y.slice(1).map(r.e)).then(()=>r(v))}g.keys=()=>Object.keys(l),g.id=1166,C.exports=g}}]);