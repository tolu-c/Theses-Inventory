(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[1537,3682],{42252:(P,x,r)=>{"use strict";r.d(x,{t:()=>g});var p=r(96509),u=r(10572),f=r(48358),d=r(45608),C=r(14246),v=r(98678);let g=(()=>{class c{constructor(I,e){this.breadcrumbService=I,this.dataService=e}resolve(I,e){const b=I.params.id;return this.dataService.findById(b,!0,!1,...this.followLinks).pipe((0,u.hC)(),(0,u.xe)(),(0,f.U)(O=>{if((0,d.Uh)(O)){const S=e.url,w=S.substr(0,S.indexOf(b))+b;return{provider:this.breadcrumbService,key:O,url:w}}}))}}return c.\u0275fac=function(I){return new(I||c)(v.\u0275\u0275inject(p.B),v.\u0275\u0275inject(C.t))},c.\u0275prov=v.\u0275\u0275defineInjectable({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},66377:(P,x,r)=>{"use strict";r.d(x,{h:()=>f});var p=r(2715),u=r(48358);class f extends p.q{getFeatureIDs(C,v){return this.getFeatureID(C,v).pipe((0,u.U)(g=>[g]))}}},2715:(P,x,r)=>{"use strict";r.d(x,{q:()=>C});var p=r(10572),u=r(48358),f=r(45608),d=r(20056);class C extends d.I{constructor(g,c,h,I){super(c,h,I),this.resolver=g,this.authorizationService=c,this.router=h,this.authService=I}getObjectUrl(g,c){const h=this.getRouteWithDSOId(g);return this.resolver.resolve(h,c).pipe((0,p.mc)(),(0,u.U)(I=>I.self))}getRouteWithDSOId(g){let c=g;for(;(0,f.xI)(c.params.id)&&(0,f.Uh)(c.parent);)c=c.parent;return c}}},35945:(P,x,r)=>{"use strict";r.d(x,{m:()=>_});var T,p=r(70655),u=r(78964),f=r(89702),d=r(65384),C=r(1411),v=r(16066),g=r(55624),c=r(18005),h=r(23684),I=r(6952),e=r(204),b=r(64752),O=r(10572),S=r(48358),w=r(21160),k=r(73194),j=r(96526),q=r(56190),M=r(98678);let _=((T=class extends h.B{constructor($,F,re,ee,U,X,Q,he,_e){super("identifiers",Q,X,U,F),this.comparator=$,this.halService=F,this.http=re,this.notificationsService=ee,this.objectCache=U,this.rdbService=X,this.requestService=Q,this.store=he,this.configurationService=_e}getIdentifierDataFor($){return this.findByHref($._links.identifiers.href,!1,!0)}getIdentifierRegistrationConfiguration(){return this.configurationService.findByPropertyName("identifiers.item-status.register-doi").pipe((0,O.hC)(),(0,S.U)($=>$.hasSucceeded?$.payload.values:[]))}registerIdentifier($,F){const re=this.requestService.generateRequestId();return this.getEndpoint().pipe((0,S.U)(ee=>{const U=Object.create({});let X=new u.WM;X=X.append("Content-Type","text/uri-list"),U.headers=X;let Q=new u.LE;return Q=Q.append("type",F),U.params=Q,new j.xo(re,ee,$._links.self.href,U)}),(0,q.wG)(this.requestService),(0,w.w)(ee=>this.rdbService.buildFromRequestUUID(ee.uuid)))}}).\u0275fac=function($){return new($||T)(M.\u0275\u0275inject(e.v),M.\u0275\u0275inject(c.q),M.\u0275\u0275inject(u.eN),M.\u0275\u0275inject(d.T),M.\u0275\u0275inject(g.a),M.\u0275\u0275inject(v.Q),M.\u0275\u0275inject(I.s),M.\u0275\u0275inject(f.yh),M.\u0275\u0275inject(k.i))},T.\u0275prov=M.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac}),T);_=(0,p.__decorate)([(0,C.cQ)(b.s),(0,p.__metadata)("design:paramtypes",[e.v,c.q,u.eN,d.T,g.a,v.Q,I.s,f.yh,k.i])],_)},36376:(P,x,r)=>{"use strict";r.d(x,{w:()=>v});var p=r(4682),f=(r(61750),r(98678));function d(g,c){}const C=["*"];let v=(()=>{class g extends p.F{constructor(){super(...arguments),this.inAndOutputNames=["dso","updateDataService"]}getComponentName(){return"DsoEditMetadataComponent"}importThemedComponent(h){return r(26442)(`./${h}/app/dso-shared/dso-edit-metadata/dso-edit-metadata.component`)}importUnthemedComponent(){return r.e(2984).then(r.bind(r,32984))}}return g.\u0275fac=function(){let c;return function(I){return(c||(c=f.\u0275\u0275getInheritedFactory(g)))(I||g)}}(),g.\u0275cmp=f.\u0275\u0275defineComponent({type:g,selectors:[["ds-themed-dso-edit-metadata"]],inputs:{dso:"dso",updateDataService:"updateDataService"},features:[f.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:C,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(h,I){1&h&&(f.\u0275\u0275projectionDef(),f.\u0275\u0275template(0,d,0,0,"ng-template",null,0,f.\u0275\u0275templateRefExtractor),f.\u0275\u0275elementStart(2,"div",null,1),f.\u0275\u0275projection(4),f.\u0275\u0275elementEnd())},encapsulation:2}),g})()},1543:(P,x,r)=>{"use strict";r.d(x,{Z:()=>f});var p=r(57999),u=r(98678);let f=(()=>{class d{}return d.\u0275fac=function(v){return new(v||d)},d.\u0275mod=u.\u0275\u0275defineNgModule({type:d}),d.\u0275inj=u.\u0275\u0275defineInjector({imports:[p.m]}),d})()},76873:(P,x,r)=>{"use strict";r.r(x),r.d(x,{EditItemPageModule:()=>sa});var p=r(35103),u=r(65706),f=r(57999),d=r(67522),C=r(58106),v=r(9237),g=r(53426),c=r(48358),h=r(45608),I=r(15463),e=r(98678),b=r(96342);const O=function(i){return{active:i}},S=function(i){return[i]};function w(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"a",17),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(5,O,t.page===n.currentPage))("routerLink",e.\u0275\u0275pureFunction1(7,S,"./"+t.page)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,3,"item.edit.tabs."+t.page+".head")," ")}}function k(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"button",18),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.edit.tabs."+t.page+".head")," ")}}function j(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"li",13),e.\u0275\u0275template(1,w,3,9,"a",14),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"span",15),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275template(5,k,3,3,"button",16),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd()()),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275attribute("aria-selected",t.page===n.currentPage),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,4,t.enabled)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngbTooltip",e.\u0275\u0275pipeBind1(4,6,"item.edit.tabs.disabled.tooltip")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(6,8,t.enabled))}}let q=(()=>{class i{constructor(t,n,a){this.route=t,this.router=n,this.injector=a,this.router.events.subscribe(()=>this.initPageParamsByRoute())}ngOnInit(){this.initPageParamsByRoute(),this.pages=this.route.routeConfig.children.filter(t=>(0,h.UE)(t.path)).map(t=>{let n=(0,v.of)(!0);return(0,h.UE)(t.canActivate)&&(n=(0,g.a)(t.canActivate.map(a=>this.injector.get(a).canActivate(this.route.snapshot,this.router.routerState.snapshot))).pipe((0,c.U)(a=>a.every(o=>!0===o)))),{page:t.path,enabled:n}}),this.itemRD$=this.route.data.pipe((0,c.U)(t=>t.dso))}getItemPage(t){return(0,I.Tt)(t)}initPageParamsByRoute(){this.currentPage=this.route.snapshot.firstChild.routeConfig.path}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(e.Injector))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-edit-item-page"]],decls:19,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"border-bottom"],[1,"pt-2"],["role","tablist",1,"nav","nav-tabs","justify-content-start"],["class","nav-item","role","tab",4,"ngFor","ngForOf"],[1,"tab-pane","active"],[1,"mb-4"],[1,"button-row","bottom"],[1,"text-right"],["role","button",1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"],["role","tab",1,"nav-item"],["class","nav-link",3,"ngClass","routerLink",4,"ngIf"],[3,"ngbTooltip"],["class","nav-link disabled",4,"ngIf"],[1,"nav-link",3,"ngClass","routerLink"],[1,"nav-link","disabled"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",4)(7,"ul",5),e.\u0275\u0275template(8,j,7,10,"li",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div",7)(10,"div",8),e.\u0275\u0275element(11,"router-outlet"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",9)(13,"div",10)(14,"a",11),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275element(16,"i",12),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()()()()()()()),2&t){let a;e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,4,"item.edit.head")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",n.pages),e.\u0275\u0275advance(6),e.\u0275\u0275property("routerLink",n.getItemPage(null==(a=e.\u0275\u0275pipeBind1(15,6,n.itemRD$))?null:a.payload)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(18,8,"item.edit.return"),"")}},dependencies:[p.mk,p.sg,p.O5,u._L,d.lC,d.rH,p.Ov,b.X$],encapsulation:2,data:{animation:[C.Ji,C.Ic]},changeDetection:0}),i})();var M=r(65384),T=r(29442),_=r(10572),H=r(76215),F=r(29211);const re=function(i){return{id:i}},ee=function(i){return[i,"edit"]};let U=(()=>{class i{constructor(t,n,a,o,l){this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.translateService=l}ngOnInit(){this.itemRD$=this.route.data.pipe((0,c.U)(t=>t.dso),(0,_.xw)()),this.itemRD$.pipe((0,H.P)()).subscribe(t=>{this.item=t.payload,this.itemPageRoute=(0,I.Tt)(this.item)}),this.confirmMessage="item.edit."+this.messageKey+".confirm",this.cancelMessage="item.edit."+this.messageKey+".cancel",this.headerMessage="item.edit."+this.messageKey+".header",this.descriptionMessage="item.edit."+this.messageKey+".description"}performAction(){}processRestResponse(t){t.hasSucceeded?this.itemDataService.findById(this.item.id).pipe((i=>s=>s.pipe((0,_.g1)(),(0,H.P)(i)))(this.predicate)).subscribe(()=>{this.notificationsService.success(this.translateService.get("item.edit."+this.messageKey+".success")),this.router.navigate([(0,I.tn)(this.item)])}):(this.notificationsService.error(this.translateService.get("item.edit."+this.messageKey+".error")),this.router.navigate([(0,I.tn)(this.item)]))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(M.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-simple-action"]],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,re,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,ee,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},dependencies:[d.rH,F.E,b.X$],encapsulation:2}),i})();const X=function(i){return{id:i}},Q=function(i){return[i,"edit"]};let he=(()=>{class i extends U{constructor(t,n,a,o,l){super(t,n,a,o,l),this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.translateService=l,this.messageKey="withdraw",this.predicate=m=>m.payload.isWithdrawn}performAction(){this.itemDataService.setWithDrawn(this.item,!0).pipe((0,_.hC)()).subscribe(t=>{this.processRestResponse(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(M.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-withdraw"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,X,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,Q,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},dependencies:[d.rH,F.E,b.X$],encapsulation:2}),i})();const _e=function(i){return{id:i}},nt=function(i){return[i,"edit"]};let it=(()=>{class i extends U{constructor(t,n,a,o,l){super(t,n,a,o,l),this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.translateService=l,this.messageKey="reinstate",this.predicate=m=>!m.payload.isWithdrawn}performAction(){this.itemDataService.setWithDrawn(this.item,!1).pipe((0,_.hC)()).subscribe(t=>{this.processRestResponse(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(M.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-reinstate"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,_e,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,nt,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},dependencies:[d.rH,F.E,b.X$],encapsulation:2}),i})();const at=function(i){return{id:i}},rt=function(i){return[i,"edit"]};let ot=(()=>{class i extends U{constructor(t,n,a,o,l){super(t,n,a,o,l),this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.translateService=l,this.messageKey="private",this.predicate=m=>!m.payload.isDiscoverable}performAction(){this.itemDataService.setDiscoverable(this.item,!1).pipe((0,_.hC)()).subscribe(t=>{this.processRestResponse(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(M.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-private"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,at,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,rt,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},dependencies:[d.rH,F.E,b.X$],encapsulation:2}),i})();const st=function(i){return{id:i}},lt=function(i){return[i,"edit"]};let ct=(()=>{class i extends U{constructor(t,n,a,o,l){super(t,n,a,o,l),this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.translateService=l,this.messageKey="public",this.predicate=m=>m.payload.isDiscoverable}performAction(){this.itemDataService.setDiscoverable(this.item,!0).pipe((0,_.hC)()).subscribe(t=>{this.processRestResponse(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(M.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-public"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,st,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,lt,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},dependencies:[d.rH,F.E,b.X$],encapsulation:2}),i})();var E=r(21160),D=r(77176),ce=r(71891),J=r(77007),z=r(35841),Pe=r(41529),K=r(5453),ge=r(84332),Te=r(86435),ve=r(30658),G=r(46533),fe=r(35534),te=r(41966);function dt(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-listable-object-component-loader",24),2&i){const t=e.\u0275\u0275nextContext().ngVar,n=e.\u0275\u0275nextContext(6);e.\u0275\u0275property("object",t)("viewMode",n.viewMode)}}function pt(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-listable-object-component-loader",24),2&i){const t=e.\u0275\u0275nextContext(2).ngVar,n=e.\u0275\u0275nextContext(6);e.\u0275\u0275property("object",t)("viewMode",n.viewMode)}}function mt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"div")(2,"div",30),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()()()),2&i){const t=s.$implicit;e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",t.metadataField," "),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.metadataValue.value," ")}}function ut(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"div",25),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementStart(4,"button",26),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(7);return e.\u0275\u0275resetView(a.closeVirtualMetadataModal())}),e.\u0275\u0275elementStart(5,"span",27),e.\u0275\u0275text(6,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",28),e.\u0275\u0275template(8,pt,1,2,"ds-listable-object-component-loader",18),e.\u0275\u0275template(9,mt,6,2,"div",29),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext().ngVar,n=e.\u0275\u0275nextContext().$implicit,a=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,"virtual-metadata.delete-item.modal-head")," "),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(10,5,a.getVirtualMetadata(n)))}}function ht(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,dt,1,2,"ds-listable-object-component-loader",18),e.\u0275\u0275elementStart(2,"div",19)(3,"div",20)(4,"button",21),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275reference(7),o=e.\u0275\u0275nextContext(6);return e.\u0275\u0275resetView(o.openVirtualMetadataModal(a))}),e.\u0275\u0275element(5,"i",22),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(6,ut,11,7,"ng-template",null,23,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t)}}function _t(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",12),e.\u0275\u0275template(1,ht,8,1,"ng-container",4),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,n.getRelatedItem(t)))}}function gt(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",12)(1,"div",13),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t).ngVar,l=e.\u0275\u0275nextContext().$implicit,m=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(m.setSelected(l,!o))}),e.\u0275\u0275elementStart(2,"label"),e.\u0275\u0275element(3,"input",14),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"div",15)(5,"h5",16),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t).ngVar,l=e.\u0275\u0275nextContext().$implicit,m=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(m.setSelected(l,!o))}),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,_t,3,3,"div",17),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=s.ngVar,n=e.\u0275\u0275nextContext().$implicit,a=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(3),e.\u0275\u0275property("checked",t),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(7,3,a.getRelationshipMessageKey(e.\u0275\u0275pipeBind1(8,5,a.getLabel(n))))," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(10,7,a.getRelationships(n)))}}function vt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",9),e.\u0275\u0275template(1,gt,11,9,"div",11),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,n.isSelected(t)))}}function ft(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",9),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275template(3,vt,3,3,"div",10),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,"virtual-metadata.delete-item.info")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t)}}function bt(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ft,4,4,"div",8),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t&&t.length>0)}}const It=function(i){return{id:i}},Ct=function(i){return[i,"edit"]};let yt=(()=>{class i extends U{constructor(t,n,a,o,l,m,y,B,N,Y){super(t,n,a,o,l),this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.translateService=l,this.modalService=m,this.objectUpdatesService=y,this.relationshipService=B,this.entityTypeService=N,this.linkService=Y,this.messageKey="delete",this.viewMode=Pe.w.ListElement,this.types$=new z.X([]),this.relationships$=new Map,this.relatedItems$=new Map,this.virtualMetadata$=new Map,this.subs=[]}ngOnInit(){super.ngOnInit(),this.url=this.router.url;const t=this.item.firstMetadataValue("dspace.entity.type");(0,h.UE)(t)&&this.subs.push(this.entityTypeService.getEntityTypeByLabel(t).pipe((0,_.xw)(),(0,_.xe)(),(0,E.w)(n=>this.entityTypeService.getEntityTypeRelationships(n.id)),(0,_.xw)(),(0,_.xe)(),(0,c.U)(n=>n.page),(0,E.w)(n=>0===n.length?(0,v.of)(n):(0,g.a)(n.map(a=>this.getRelationships(a))).pipe((0,c.U)(a=>n.reduce((o,l,m)=>o.some(y=>y.id===l.id)||0===a[m].length?o:[...o,l],[]))))).subscribe(n=>this.types$.next(n))),this.subs.push(this.types$.pipe((0,D.q)(1)).subscribe(n=>this.objectUpdatesService.initialize(this.url,n,this.item.lastModified)))}openVirtualMetadataModal(t){this.modalRef=this.modalService.open(t)}closeVirtualMetadataModal(){this.modalRef.close()}getRelationshipMessageKey(t){return(0,h.Uh)(t)&&t.indexOf("Of")>-1?`relationships.${t.substring(0,t.indexOf("Of")+2)}`:t}getLabel(t){return this.getRelationships(t).pipe((0,E.w)(n=>this.isLeftItem(n[0]).pipe((0,c.U)(a=>a?t.leftwardType:t.rightwardType))))}getRelationships(t){return this.relationships$.has(t)||this.relationships$.set(t,this.relationshipService.getItemRelationshipsArray(this.item).pipe((0,E.w)(n=>(0,g.a)(n.map(a=>this.getRelationshipType(a))).pipe((0,ce.d)([]),(0,c.U)(a=>n.filter((o,l)=>t.id===a[l].id)))))),this.relationships$.get(t)}getRelationshipType(t){return this.linkService.resolveLinks(t,(0,G.l)("relationshipType"),(0,G.l)("leftItem"),(0,G.l)("rightItem")),t.relationshipType.pipe((0,_.xw)(),(0,_.xe)(),(0,J.h)(n=>(0,h.Uh)(n)&&(0,h.UE)(n.uuid)))}getRelatedItem(t){return this.relatedItems$.has(t)||this.relatedItems$.set(t,this.isLeftItem(t).pipe((0,E.w)(n=>n?t.rightItem:t.leftItem),(0,_.xw)(),(0,_.xe)())),this.relatedItems$.get(t)}getVirtualMetadata(t){return this.virtualMetadata$.has(t)||this.virtualMetadata$.set(t,this.getRelatedItem(t).pipe((0,c.U)(n=>Object.entries(n.metadata).map(([a,o])=>o.filter(l=>l.authority&&l.authority.endsWith(t.id)).map(l=>({metadataField:a,metadataValue:l}))).reduce((a,o)=>a.concat(o))))),this.virtualMetadata$.get(t)}isLeftItem(t){return t.leftItem.pipe((0,_.xw)(),(0,_.xe)(),(0,J.h)(n=>(0,h.Uh)(n)&&(0,h.UE)(n.uuid)),(0,c.U)(n=>n.uuid===this.item.uuid))}isSelected(t){return this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.item.uuid,t.uuid)}setSelected(t,n){this.objectUpdatesService.setSelectedVirtualMetadata(this.url,this.item.uuid,t.uuid,n)}performAction(){this.subs.push(this.types$.pipe((0,E.w)(t=>(0,g.a)(t.map(n=>this.isSelected(n))).pipe((0,ce.d)([]),(0,c.U)(n=>t.filter((a,o)=>n[o])),(0,c.U)(n=>n.map(a=>a.id)))),(0,E.w)(t=>this.itemDataService.delete(this.item.id,t).pipe((0,_.hC)()))).subscribe(t=>{this.notify(t.hasSucceeded)}))}notify(t){t?(this.notificationsService.success(this.translateService.get("item.edit."+this.messageKey+".success")),this.router.navigate([""])):(this.notificationsService.error(this.translateService.get("item.edit."+this.messageKey+".error")),this.router.navigate([(0,I.tn)(this.item)]))}ngOnDestroy(){this.subs.filter(t=>(0,h.Uh)(t)).forEach(t=>t.unsubscribe())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(M.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(u.FF),e.\u0275\u0275directiveInject(K.d),e.\u0275\u0275directiveInject(ge.U),e.\u0275\u0275directiveInject(Te.k),e.\u0275\u0275directiveInject(ve.M))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-delete"]],inputs:{url:"url"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:19,vars:22,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[4,"ngVar"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"],["class","mb-4",4,"ngIf"],[1,"mb-4"],["class","mb-4",4,"ngFor","ngForOf"],["class","d-flex flex-row",4,"ngVar"],[1,"d-flex","flex-row"],[1,"m-2",3,"click"],["type","checkbox",3,"checked"],[1,"flex-column","flex-grow-1"],[3,"click"],["class","d-flex flex-row",4,"ngFor","ngForOf"],[3,"object","viewMode",4,"ngIf"],[1,"ml-auto"],[1,"btn-group"],[1,"btn","btn-outline-info","btn-sm",3,"click"],[1,"fas","fa-info","fa-fw"],["virtualMetadataModal",""],[3,"object","viewMode"],[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[4,"ngFor","ngForOf"],[1,"font-weight-bold"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275template(10,bt,2,1,"ng-container",4),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275elementStart(12,"div",5)(13,"button",6),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"button",7),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,7,n.headerMessage,e.\u0275\u0275pureFunction1(18,It,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,10,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(11,12,n.types$)),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(15,14,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(20,Ct,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(18,16,n.cancelMessage)," "))},dependencies:[p.sg,p.O5,d.rH,fe.p,F.E,te.g,p.Ov,b.X$],encapsulation:2}),i})();r(13005);var De=r(27303),xt=r(90321),Et=r(76774),St=r(92127);let Be=(()=>{class i extends xt._{constructor(t,n,a,o,l,m){super(n,o,l),this.itemService=t,this.objectUpdatesService=n,this.router=a,this.notificationsService=o,this.translateService=l,this.route=m}ngOnInit(){(0,h.Uh)(this.item)?this.setItem(this.item):this.itemUpdateSubscription=(0,g.a)([this.route.data,this.route.parent.data]).pipe((0,c.U)(([t,n])=>Object.assign({},t,n)),(0,c.U)(t=>t.dso),(0,De.b)(t=>{this.item=t.payload}),(0,E.w)(t=>this.itemService.findByHref(t.payload._links.self.href,!0,!0,...St.H)),(0,_.g1)()).subscribe(t=>{this.setItem(t.payload)}),this.discardTimeOut=Et.N.item.edit.undoTimeout,this.url=this.router.url,this.url.indexOf("?")>0&&(this.url=this.url.substr(0,this.url.indexOf("?"))),this.hasChanges().pipe((0,H.P)()).subscribe(t=>{t?this.checkLastModified():this.initializeOriginalFields()}),this.initializeNotificationsPrefix(),this.initializeUpdates()}setItem(t){this.item=t,this.itemPageRoute=(0,I.Tt)(this.item),this.postItemInit(),this.initializeUpdates()}ngOnDestroy(){(0,h.Uh)(this.itemUpdateSubscription)&&this.itemUpdateSubscription.unsubscribe()}postItemInit(){}initializeUpdates(){}initializeNotificationsPrefix(){}initializeOriginalFields(){}submit(){}trackUpdate(t,n){return n&&n.field?n.field.uuid:void 0}isValid(){return this.objectUpdatesService.isValidPage(this.url)}checkLastModified(){const t=this.item.lastModified;this.objectUpdatesService.getLastModified(this.url).pipe((0,H.P)()).subscribe(n=>{n.getDate()!==t.getDate()&&(this.notificationsService.warning(this.getNotificationTitle("outdated"),this.getNotificationContent("outdated")),this.initializeOriginalFields())})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(K.d),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(M.T),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(d.gz))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-abstract-item-update"]],inputs:{item:"item"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:0,vars:0,template:function(t,n){},encapsulation:2}),i})();var oe=r(60276),Mt=r(39034),Re=r(55624),de=r(6952),be=r(8830),Ie=r(40772);class se{constructor(s,t,n,a,o){this.xs=s,this.sm=t,this.md=n,this.lg=a,this.xl=o}buildClasses(){return`col-${this.xs} col-sm-${this.sm} col-md-${this.md} col-lg-${this.lg} col-xl-${this.xl}`}}class Ot{constructor(s){this.columns=s}combineColumns(s,t){if(s<t&&(0,h.Uh)(this.columns[s])&&(0,h.Uh)(this.columns[t])){let n=this.columns[s].xs,a=this.columns[s].sm,o=this.columns[s].md,l=this.columns[s].lg,m=this.columns[s].xl;for(let y=s+1;y<t+1;y++)n+=this.columns[y].xs,a+=this.columns[y].sm,o+=this.columns[y].md,l+=this.columns[y].lg,m+=this.columns[y].xl;return new se(n,a,o,l,m)}}}var ne=r(69805),pe=r(87657),ae=(r(6013),r(8842)),we=r(45180),Pt=r(49887),le=r(68650),Ce=r(78530),Tt=r(58079),ye=r(81323),me=r(68203);let Bt=(()=>{class i{constructor(t,n,a,o){this.objectUpdatesService=t,this.elRef=n,this.objectValuesPipe=a,this.paginationService=o,this.dropObject=new e.EventEmitter,this.pageSize=10,this.options=Object.assign(new we.r,{id:"dad",currentPage:1,pageSize:this.pageSize}),this.currentPage$=new z.X(this.options),this.loading$=new z.X(!1),this.subs=[]}ngOnInit(){this.initializeObjectsRD(),this.initializeURL(),this.initializeUpdates(),this.initializePagination()}initializePagination(){this.paginationService.getCurrentPagination(this.options.id,this.options).subscribe(t=>{this.currentPage$.next(t)})}initializeUpdates(){this.objectsRD$.pipe((0,_.xw)(),(0,_.ZU)()).subscribe(t=>{this.objectUpdatesService.initialize(this.url,t,new Date)}),this.updates$=this.objectsRD$.pipe((0,_.g1)(),(0,_.ZU)(),(0,E.w)(t=>this.objectUpdatesService.getFieldUpdatesExclusive(this.url,t))),this.subs.push(this.updates$.pipe((0,c.U)(t=>this.objectValuesPipe.transform(t)),(0,Pt.x)((0,Tt.Rh)(i=>(0,h.Uh)(i)&&(0,h.Uh)(i.field)?i.field.uuid:void 0))).subscribe(t=>{this.customOrder=t.map(n=>n.field.uuid),this.loading$.next(!1)}),this.loading$.subscribe(t=>this.options.disabled=t))}drop(t){const n=t.previousIndex;let a=t.currentIndex;const o=this.currentPage$.value.currentPage-1;let l=this.currentPage$.value.currentPage-1;const m=this.elRef.nativeElement.querySelector(".page-item:hover");if((0,h.Uh)(m)&&(0,h.Uh)(m.textContent)){const ie=Number(m.textContent);(0,h.Uh)(ie)&&!Number.isNaN(ie)&&(l=ie-1,a=0)}const y=o!==l;!y&&n!==a&&(0,le.bA)(this.customOrder,n,a);const B=l+1,N=o*this.pageSize+n,Y=l*this.pageSize+a;N!==Y&&(y&&this.loading$.next(!0),this.dropObject.emit(Object.assign({fromIndex:N,toIndex:Y,finish:()=>{y&&this.paginationComponent.doPageChange(B)}})))}ngOnDestroy(){this.subs.filter(t=>(0,h.Uh)(t)).forEach(t=>t.unsubscribe()),this.paginationService.clearPagination(this.options.id)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(K.d),e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(me.g),e.\u0275\u0275directiveInject(ye.N))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-paginated-drag-drop-abstract"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(Ce.Q,5),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(n.paginationComponent=a.first)}},outputs:{dropObject:"dropObject"},decls:0,vars:0,template:function(t,n){},encapsulation:2}),i})();var Rt=r(62574),wt=r.n(Rt),jt=r(71213),Ut=r(7027);const $t=["bitstreamView"];function Ft(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"a",8),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275pipe(2,"dsBrowserOnly"),e.\u0275\u0275element(3,"i",14),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(1,3,"item.edit.bitstreams.edit.buttons.download")),e.\u0275\u0275property("routerLink",t.bitstreamDownloadUrl),e.\u0275\u0275attribute("data-test",e.\u0275\u0275pipeBind1(2,5,"download-button"))}}const Vt=function(i){return["/bitstreams/",i,"edit"]};function At(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275projection(1),e.\u0275\u0275elementStart(2,"div",1)(3,"span",2),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(5,"div")(6,"div",3)(7,"div",4),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(9,"div")(10,"div",5)(11,"span",2),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(14,"div")(15,"div",5)(16,"div",6),e.\u0275\u0275template(17,Ft,4,7,"a",7),e.\u0275\u0275elementStart(18,"button",8),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275element(20,"i",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"button",10),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.remove())}),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275element(23,"i",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.undo())}),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275element(26,"i",13),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[0].buildClasses()," row-element d-flex"),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",t.bitstreamName," "),e.\u0275\u0275advance(1),e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[1].buildClasses()," row-element d-flex align-items-center"),e.\u0275\u0275advance(2),e.\u0275\u0275property("tooltipClass","larger-tooltip")("ngbTooltip",null==t.bitstream?null:t.bitstream.firstMetadataValue("dc.description")),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",null==t.bitstream?null:t.bitstream.firstMetadataValue("dc.description")," "),e.\u0275\u0275advance(1),e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[2].buildClasses()," row-element d-flex align-items-center"),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",null==(n=e.\u0275\u0275pipeBind1(13,24,t.format$))?null:n.shortDescription," "),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[3].buildClasses()," row-element d-flex align-items-center"),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",null!=t.bitstreamDownloadUrl),e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(19,26,"item.edit.bitstreams.edit.buttons.edit")),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(32,Vt,t.bitstream.id)),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(22,28,"item.edit.bitstreams.edit.buttons.remove")),e.\u0275\u0275property("disabled",!t.canRemove()),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(25,30,"item.edit.bitstreams.edit.buttons.undo")),e.\u0275\u0275property("disabled",!t.canUndo())}}const Lt=[[["","slot","drag-handle"]]],zt=["[slot=drag-handle]"];let Kt=(()=>{class i{constructor(t,n,a){this.objectUpdatesService=t,this.dsoNameService=n,this.viewContainerRef=a}ngOnInit(){this.viewContainerRef.createEmbeddedView(this.bitstreamView)}ngOnChanges(t){this.bitstream=wt()(this.fieldUpdate.field),this.bitstreamName=this.dsoNameService.getName(this.bitstream),this.bitstreamDownloadUrl=(0,jt.gs)(this.bitstream),this.format$=this.bitstream.format.pipe((0,_.xw)(),(0,_.xe)())}remove(){this.objectUpdatesService.saveRemoveFieldUpdate(this.bundleUrl,this.bitstream)}undo(){this.objectUpdatesService.removeSingleFieldUpdate(this.bundleUrl,this.bitstream.uuid)}canRemove(){return this.fieldUpdate.changeType!==ne.m.REMOVE}canUndo(){return this.fieldUpdate.changeType>=0}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(K.d),e.\u0275\u0275directiveInject(ae._),e.\u0275\u0275directiveInject(e.ViewContainerRef))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-edit-bitstream"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery($t,7),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(n.bitstreamView=a.first)}},inputs:{fieldUpdate:"fieldUpdate",bundleUrl:"bundleUrl",columnSizes:"columnSizes"},features:[e.\u0275\u0275NgOnChangesFeature],ngContentSelectors:zt,decls:2,vars:0,consts:[["bitstreamView",""],[1,"float-left","d-flex","align-items-center","overflow-hidden"],[1,"text-truncate"],[1,"w-100"],["placement","bottom",1,"text-truncate",3,"tooltipClass","ngbTooltip"],[1,"text-center","w-100"],[1,"btn-group","relationship-action-buttons"],["class","btn btn-outline-primary btn-sm",3,"routerLink","title",4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm",3,"routerLink","title"],[1,"fas","fa-edit","fa-fw"],[1,"btn","btn-outline-danger","btn-sm",3,"disabled","title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-warning","btn-sm",3,"disabled","title","click"],[1,"fas","fa-undo-alt","fa-fw"],[1,"fas","fa-download","fa-fw"]],template:function(t,n){1&t&&(e.\u0275\u0275projectionDef(Lt),e.\u0275\u0275template(0,At,27,34,"ng-template",null,0,e.\u0275\u0275templateRefExtractor))},dependencies:[p.O5,u._L,d.rH,p.Ov,Ut.g,b.X$],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();const Wt=["handleView"];function Nt(i,s){1&i&&(e.\u0275\u0275elementStart(0,"div",1),e.\u0275\u0275element(1,"i",2),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("title",e.\u0275\u0275pipeBind1(2,1,"item.edit.bitstreams.edit.buttons.drag")))}let xe=(()=>{class i{constructor(t){this.viewContainerRef=t}ngOnInit(){this.viewContainerRef.createEmbeddedView(this.handleView)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(e.ViewContainerRef))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-edit-bitstream-drag-handle"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(Wt,7),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(n.handleView=a.first)}},decls:2,vars:0,consts:[["handleView",""],["tabindex","0",1,"drag-handle","text-muted","float-left","p-1","mr-2"],[1,"fas","fa-grip-vertical","fa-fw",3,"title"]],template:function(t,n){1&t&&e.\u0275\u0275template(0,Nt,3,3,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)},dependencies:[b.X$],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();const kt=function(i,s,t,n){return{"table-warning":i,"table-danger":s,"table-success":t,"bg-white":n}};function Gt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",7)(1,"ds-item-edit-bitstream",8)(2,"div",9),e.\u0275\u0275element(3,"ds-item-edit-bitstream-drag-handle"),e.\u0275\u0275elementEnd()()()),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(2).ngVar,a=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("id",t)("ngClass",e.\u0275\u0275pureFunction4(5,kt,0===n[t].changeType,2===n[t].changeType,1===n[t].changeType,void 0===n[t].changeType)),e.\u0275\u0275advance(1),e.\u0275\u0275property("fieldUpdate",n[t])("bundleUrl",a.bundle.self)("columnSizes",a.columnSizes)}}function Ht(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Gt,4,10,"div",6),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.customOrder)}}const Xt=function(i){return{"mb-3":i}};function Qt(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",5),e.\u0275\u0275listener("cdkDropListDropped",function(a){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(o.drop(a))}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275template(2,Ht,2,1,"ng-container",2),e.\u0275\u0275elementEnd()}if(2&i){const t=s.ngVar,n=e.\u0275\u0275nextContext(3);let a;e.\u0275\u0275property("id",n.bundle.id)("ngClass",e.\u0275\u0275pureFunction1(5,Xt,(null==(a=e.\u0275\u0275pipeBind1(1,3,n.objectsRD$))||null==a.payload?null:a.payload.totalElements)>n.pageSize)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",t)}}function Jt(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Qt,3,7,"div",4),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,t.updates$))}}function Zt(i,s){1&i&&(e.\u0275\u0275element(0,"ds-themed-loading",10),e.\u0275\u0275pipe(1,"translate")),2&i&&e.\u0275\u0275property("message",e.\u0275\u0275pipeBind1(1,1,"loading.bitstreams"))}function Yt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",1),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,Jt,3,3,"ng-container",2),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275template(5,Zt,2,3,"ds-themed-loading",3),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();let n,a;e.\u0275\u0275property("hideGear",!0)("hidePagerWhenSinglePage",!0)("hidePaginationDetail",!0)("paginationOptions",t.options)("pageInfoState",null==(n=e.\u0275\u0275pipeBind1(1,8,t.objectsRD$))?null:n.payload)("collectionSize",null==(a=e.\u0275\u0275pipeBind1(2,10,t.objectsRD$))||null==a.payload?null:a.payload.totalElements),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(4,12,t.loading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(6,14,t.loading$))}}let qt=(()=>{class i extends Bt{constructor(t,n,a,o,l,m){super(t,n,a,l),this.objectUpdatesService=t,this.elRef=n,this.objectValuesPipe=a,this.bundleService=o,this.paginationService=l,this.requestService=m}ngOnInit(){super.ngOnInit()}initializeObjectsRD(){this.objectsRD$=this.currentPage$.pipe((0,E.w)(t=>{const n=new Ie.t({pagination:Object.assign({},t)});return this.bundleService.getBitstreamsEndpoint(this.bundle.id,n).pipe((0,E.w)(a=>this.requestService.hasByHref$(a)),(0,E.w)(()=>this.bundleService.getBitstreams(this.bundle.id,n,(0,G.l)("format"))))}))}initializeURL(){this.url=this.bundle.self}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(K.d),e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(me.g),e.\u0275\u0275directiveInject(be.b),e.\u0275\u0275directiveInject(ye.N),e.\u0275\u0275directiveInject(de.s))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-paginated-drag-and-drop-bitstream-list"]],inputs:{bundle:"bundle",columnSizes:"columnSizes"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[[3,"hideGear","hidePagerWhenSinglePage","hidePaginationDetail","paginationOptions","pageInfoState","collectionSize",4,"ngIf"],[3,"hideGear","hidePagerWhenSinglePage","hidePaginationDetail","paginationOptions","pageInfoState","collectionSize"],[4,"ngIf"],[3,"message",4,"ngIf"],["class","bundle-bitstreams-list","cdkDropList","",3,"id","ngClass","cdkDropListDropped",4,"ngVar"],["cdkDropList","",1,"bundle-bitstreams-list",3,"id","ngClass","cdkDropListDropped"],["class","row bitstream-row","cdkDrag","",3,"id","ngClass",4,"ngFor","ngForOf"],["cdkDrag","",1,"row","bitstream-row",3,"id","ngClass"],[3,"fieldUpdate","bundleUrl","columnSizes"],["slot","drag-handle","cdkDragHandle","","tabindex","0",1,"d-flex","align-items-center","bitstream-row-drag-handle"],[3,"message"]],template:function(t,n){if(1&t&&(e.\u0275\u0275template(0,Yt,7,16,"ds-pagination",0),e.\u0275\u0275pipe(1,"async")),2&t){let a;e.\u0275\u0275property("ngIf",null==(a=e.\u0275\u0275pipeBind1(1,1,n.objectsRD$))?null:a.payload)}},dependencies:[p.mk,p.sg,p.O5,le.Wj,le.Zt,le.Bh,pe.Z,Ce.Q,te.g,Kt,xe,p.Ov,b.X$],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();const en=["bundleView"],tn=function(i){return{name:i}},nn=function(i){return[i,"bitstreams","new"]},an=function(i){return{bundle:i}};function rn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",1)(1,"div"),e.\u0275\u0275element(2,"ds-item-edit-bitstream-drag-handle"),e.\u0275\u0275elementStart(3,"div",2),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div")(7,"div",3)(8,"button",4),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275element(10,"i",5),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(11,"ds-paginated-drag-and-drop-bitstream-list",6),e.\u0275\u0275listener("dropObject",function(a){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.dropObject.emit(a))}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275classMapInterpolate1("",t.bundleNameColumn.buildClasses()," font-weight-bold row-element d-flex"),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(5,12,"item.edit.bitstreams.bundle.name",e.\u0275\u0275pureFunction1(17,tn,t.dsoNameService.getName(t.bundle)))," "),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[3].buildClasses()," text-center row-element"),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(9,15,"item.edit.bitstreams.bundle.edit.buttons.upload")),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(19,nn,t.itemPageRoute))("queryParams",e.\u0275\u0275pureFunction1(21,an,t.bundle.id)),e.\u0275\u0275advance(3),e.\u0275\u0275property("bundle",t.bundle)("columnSizes",t.columnSizes)}}let on=(()=>{class i{constructor(t,n){this.viewContainerRef=t,this.dsoNameService=n,this.dropObject=new e.EventEmitter}ngOnInit(){this.bundleNameColumn=this.columnSizes.combineColumns(0,2),this.viewContainerRef.createEmbeddedView(this.bundleView),this.itemPageRoute=(0,I.Tt)(this.item)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(e.ViewContainerRef),e.\u0275\u0275directiveInject(ae._))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-edit-bitstream-bundle"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(en,7),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(n.bundleView=a.first)}},inputs:{bundle:"bundle",item:"item",columnSizes:"columnSizes"},outputs:{dropObject:"dropObject"},decls:2,vars:0,consts:[["bundleView",""],[1,"row","bundle-row"],[1,"float-left","d-flex","align-items-center"],[1,"btn-group","bundle-action-buttons"],[1,"btn","btn-outline-success","btn-sm",3,"routerLink","queryParams","title"],[1,"fas","fa-upload","fa-fw"],[3,"bundle","columnSizes","dropObject"]],template:function(t,n){1&t&&e.\u0275\u0275template(0,rn,12,23,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)},dependencies:[d.rH,qt,xe,b.X$],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();function sn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",15),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.reinstate())}),e.\u0275\u0275element(1,"i",16),e.\u0275\u0275elementStart(2,"span",5),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.bitstreams.reinstate-button"),""))}function ln(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.discard())}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",18),e.\u0275\u0275elementStart(3,"span",5),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())||t.submitting),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.bitstreams.discard-button"),"")}}function cn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-item-edit-bitstream-bundle",22),e.\u0275\u0275listener("dropObject",function(a){const l=e.\u0275\u0275restoreView(t).$implicit,m=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(m.dropBitstream(l,a))}),e.\u0275\u0275elementEnd()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("bundle",t)("item",n.item)("columnSizes",n.columnSizes)}}function dn(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",19)(1,"div",20)(2,"div"),e.\u0275\u0275element(3,"ds-item-edit-bitstream-drag-handle"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div"),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(15,cn,1,3,"ds-item-edit-bitstream-bundle",21),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",n.columnSizes.columns[0].buildClasses()," row-element"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,17,"item.edit.bitstreams.headers.name")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",n.columnSizes.columns[1].buildClasses()," row-element"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,19,"item.edit.bitstreams.headers.description")),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",n.columnSizes.columns[2].buildClasses()," text-center row-element"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,21,"item.edit.bitstreams.headers.format")),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",n.columnSizes.columns[3].buildClasses()," text-center row-element"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,23,"item.edit.bitstreams.headers.actions")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t)}}function pn(i,s){1&i&&(e.\u0275\u0275elementStart(0,"div",23),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.edit.bitstreams.empty")," "))}function mn(i,s){1&i&&(e.\u0275\u0275element(0,"ds-themed-loading",24),e.\u0275\u0275pipe(1,"translate")),2&i&&e.\u0275\u0275propertyInterpolate("message",e.\u0275\u0275pipeBind1(1,1,"loading.bitstreams"))}function un(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",15),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.reinstate())}),e.\u0275\u0275element(1,"i",16),e.\u0275\u0275elementStart(2,"span",5),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.bitstreams.reinstate-button"),""))}function hn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.discard())}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",18),e.\u0275\u0275elementStart(3,"span",5),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())||t.submitting),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.bitstreams.discard-button"),"")}}const _n=function(i){return[i,"bitstreams","new"]};function gn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",1)(1,"div",2)(2,"button",3),e.\u0275\u0275element(3,"i",4),e.\u0275\u0275elementStart(4,"span",5),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(7,sn,5,3,"button",6),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementStart(9,"button",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.submit())}),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275element(11,"i",8),e.\u0275\u0275elementStart(12,"span",5),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(15,ln,6,6,"button",9),e.\u0275\u0275pipe(16,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(17,dn,16,25,"div",10),e.\u0275\u0275template(18,pn,3,3,"div",11),e.\u0275\u0275template(19,mn,2,3,"ds-themed-loading",12),e.\u0275\u0275elementStart(20,"div",13)(21,"div",14),e.\u0275\u0275template(22,un,5,3,"button",6),e.\u0275\u0275pipe(23,"async"),e.\u0275\u0275elementStart(24,"button",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.submit())}),e.\u0275\u0275pipe(25,"async"),e.\u0275\u0275element(26,"i",8),e.\u0275\u0275elementStart(27,"span",5),e.\u0275\u0275text(28),e.\u0275\u0275pipe(29,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(30,hn,6,6,"button",9),e.\u0275\u0275pipe(31,"async"),e.\u0275\u0275elementEnd()()()}if(2&i){const t=s.ngVar,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(31,_n,n.itemPageRoute)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(6,13,"item.edit.bitstreams.upload-button"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(8,15,n.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(10,17,n.hasChanges())||n.submitting),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(14,19,"item.edit.bitstreams.save-button"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(16,21,n.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.item&&(null==t?null:t.length)>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0===(null==t?null:t.length)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(23,23,n.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(25,25,n.hasChanges())||n.submitting),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(29,27,"item.edit.bitstreams.save-button"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(31,29,n.isReinstatable()))}}let vn=(()=>{class i extends Be{constructor(t,n,a,o,l,m,y,B,N,Y,ie,Oe){super(t,n,a,o,l,m),this.itemService=t,this.objectUpdatesService=n,this.router=a,this.notificationsService=o,this.translateService=l,this.route=m,this.bitstreamService=y,this.objectCache=B,this.requestService=N,this.cdRef=Y,this.bundleService=ie,this.zone=Oe,this.bundlesOptions={id:"bundles-pagination-options",currentPage:1,pageSize:9999},this.columnSizes=new Ot([new se(2,2,3,4,4),new se(2,3,3,3,3),new se(2,2,2,2,2),new se(6,5,4,3,3)]),this.submitting=!1}postItemInit(){this.bundles$=this.itemService.getBundles(this.item.id,new Ie.t({pagination:this.bundlesOptions})).pipe((0,_.xw)(),(0,_.xe)(),(0,c.U)(t=>t.page))}initializeNotificationsPrefix(){this.notificationsPrefix="item.edit.bitstreams.notifications."}submit(){this.submitting=!0,this.bundles$.pipe((0,D.q)(1)).pipe((0,E.w)(o=>(0,oe.$)(...o.map(l=>this.objectUpdatesService.getFieldUpdates(l.self,[],!0)))),(0,c.U)(o=>[].concat(...o.map(l=>Object.values(l).filter(m=>m.changeType===ne.m.REMOVE)))),(0,c.U)(o=>o.map(l=>l.field))).pipe((0,D.q)(1),(0,E.w)(o=>this.bitstreamService.removeMultiple(o))).subscribe(o=>{this.displayNotifications("item.edit.bitstreams.notifications.remove",[o]),this.submitting=!1})}dropBitstream(t,n){this.zone.runOutsideAngular(()=>{(0,h.Uh)(n)&&(0,h.Uh)(n.fromIndex)&&(0,h.Uh)(n.toIndex)&&(0,h.Uh)(n.finish)&&this.bundleService.patch(t,[{op:"move",from:`/_links/bitstreams/${n.fromIndex}/href`,path:`/_links/bitstreams/${n.toIndex}/href`}]).pipe((0,D.q)(1)).subscribe(o=>{this.zone.run(()=>{this.displayNotifications("item.edit.bitstreams.notifications.move",[o]),this.requestService.removeByHrefSubstring(t.self).pipe((0,J.h)(l=>l),(0,D.q)(1)).subscribe(()=>n.finish())})})})}displayNotifications(t,n){if((0,h.UE)(n)){const a=n.filter(l=>(0,h.Uh)(l)&&l.hasFailed),o=n.filter(l=>(0,h.Uh)(l)&&l.hasSucceeded);a.forEach(l=>{this.notificationsService.error(this.translateService.instant(`${t}.failed.title`),l.errorMessage)}),o.length>0&&this.notificationsService.success(this.translateService.instant(`${t}.saved.title`),this.translateService.instant(`${t}.saved.content`))}}discard(){const t=this.notificationsService.info(this.getNotificationTitle("discarded"),this.getNotificationContent("discarded"),{timeOut:this.discardTimeOut});this.objectUpdatesService.discardAllFieldUpdates(this.url,t)}reinstate(){this.bundles$.pipe((0,D.q)(1)).subscribe(t=>{t.forEach(n=>{this.objectUpdatesService.reinstateFieldUpdates(n.self)})})}isReinstatable(){return this.bundles$.pipe((0,E.w)(t=>(0,oe.$)(...t.map(n=>this.objectUpdatesService.isReinstatable(n.self)))),(0,c.U)(t=>t.includes(!0)))}hasChanges(){return this.bundles$.pipe((0,E.w)(t=>(0,oe.$)(...t.map(n=>this.objectUpdatesService.hasUpdates(n.self)))),(0,c.U)(t=>t.includes(!0)))}ngOnDestroy(){this.itemUpdateSubscription&&this.itemUpdateSubscription.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(K.d),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(M.T),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(Mt.J),e.\u0275\u0275directiveInject(Re.a),e.\u0275\u0275directiveInject(de.s),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(be.b),e.\u0275\u0275directiveInject(e.NgZone))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-bitstreams"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[["class","item-bitstreams",4,"ngVar"],[1,"item-bitstreams"],[1,"button-row","top","d-flex","mt-2","space-children-mr"],[1,"mr-auto","btn","btn-success",3,"routerLink"],[1,"fas","fa-upload"],[1,"d-none","d-sm-inline"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fas","fa-save"],["class","btn btn-danger",3,"disabled","click",4,"ngIf"],["class","container table-bordered mt-4",4,"ngIf"],["class","alert alert-info w-100 d-inline-block mt-4","role","alert",4,"ngIf"],[3,"message",4,"ngIf"],[1,"button-row","bottom"],[1,"mt-4","float-right","space-children-mr","ml-gap"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-undo-alt"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-times"],[1,"container","table-bordered","mt-4"],[1,"row","header-row","font-weight-bold"],[3,"bundle","item","columnSizes","dropObject",4,"ngFor","ngForOf"],[3,"bundle","item","columnSizes","dropObject"],["role","alert",1,"alert","alert-info","w-100","d-inline-block","mt-4"],[3,"message"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,gn,32,33,"div",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(1,1,n.bundles$))},dependencies:[p.sg,p.O5,d.rH,pe.Z,te.g,on,xe,p.Ov,b.X$],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();var fn=r(95445),Ee=r(9302),Se=r(37683),bn=r(27496),je=r(57066),In=r(51864),Cn=r(96);const yn=["tabs"];function xn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"ds-collection-select",11),e.\u0275\u0275listener("confirm",function(a){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.removeMappings(a))})("cancel",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.onCancel())}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275advance(1),e.\u0275\u0275property("key","browse")("dsoRD$",t.itemCollectionsRD$)("paginationOptions",null==(n=e.\u0275\u0275pipeBind1(2,6,t.searchOptions$))?null:n.pagination)("confirmButton","item.edit.item-mapper.buttons.remove")("cancelButton","item.edit.item-mapper.cancel")("dangerConfirm",!0)}}function En(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"ds-collection-select",17),e.\u0275\u0275listener("confirm",function(a){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.mapCollections(a))})("cancel",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.onCancel())}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);let n,a;e.\u0275\u0275advance(1),e.\u0275\u0275property("key","map")("dsoRD$",t.mappedCollectionsRD$)("paginationOptions",null==(n=e.\u0275\u0275pipeBind1(2,6,t.searchOptions$))?null:n.pagination)("sortOptions",null==(a=e.\u0275\u0275pipeBind1(3,8,t.searchOptions$))?null:a.sort)("confirmButton","item.edit.item-mapper.buttons.add")("cancelButton","item.edit.item-mapper.cancel")}}function Sn(i,s){1&i&&(e.\u0275\u0275elementStart(0,"div",18),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.edit.item-mapper.no-search")," "))}function Mn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",12)(1,"div",13)(2,"ds-themed-search-form",14),e.\u0275\u0275listener("submitSearch",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.performedSearch=!0)}),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(5,En,4,10,"div",15),e.\u0275\u0275template(6,Sn,3,3,"div",16)}if(2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275advance(2),e.\u0275\u0275property("query",null==(n=e.\u0275\u0275pipeBind1(3,6,t.searchOptions$))?null:n.query)("currentUrl","./")("inPlaceSearch",!0)("searchPlaceholder",e.\u0275\u0275pipeBind1(4,8,"item.edit.item-mapper.search-form.placeholder")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.performedSearch),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.performedSearch)}}const On=function(i){return{name:i}};let Ue=(()=>{class i{constructor(t,n,a,o,l,m,y,B,N){this.route=t,this.router=n,this.searchConfigService=a,this.searchService=o,this.notificationsService=l,this.itemDataService=m,this.collectionDataService=y,this.translateService=B,this.dsoNameService=N,this.performedSearch=!1}ngOnInit(){this.itemRD$=this.route.parent.data.pipe((0,D.q)(1),(0,c.U)(t=>t.dso)),this.itemName$=this.itemRD$.pipe((0,J.h)(t=>(0,h.Uh)(t)),(0,c.U)(t=>this.dsoNameService.getName(t.payload))),this.searchOptions$=this.searchConfigService.paginatedSearchOptions,this.loadCollectionLists()}loadCollectionLists(){this.shouldUpdate$=new z.X(!0),this.itemCollectionsRD$=(0,g.a)(this.itemRD$.pipe((0,_.Gp)()),this.shouldUpdate$).pipe((0,E.w)(([a,o])=>(!0===o&&this.shouldUpdate$.next(!1),this.collectionDataService.findListByHref(this.itemDataService.getMappedCollectionsEndpoint(a.id),void 0,!o,!1).pipe((0,_.g1)()))));const t=this.itemRD$.pipe((0,_.Gp)(),(0,E.w)(a=>this.collectionDataService.findOwningCollectionFor(a)),(0,_.g1)()),n=(0,g.a)(this.itemCollectionsRD$,t,this.searchOptions$);this.mappedCollectionsRD$=n.pipe((0,E.w)(([a,o,l])=>this.searchService.search(Object.assign(new Ie.t(l),{query:this.buildQuery([...a.payload.page,o.payload],l.query),dsoTypes:[Se.h.COLLECTION]}),1e4).pipe((0,_.Ie)(),(0,Ee.O)(void 0))))}mapCollections(t){const a=(0,g.a)([this.itemRD$.pipe((0,_.xw)(),(0,c.U)(o=>o.payload),(0,c.U)(o=>o.id)),this.itemCollectionsRD$.pipe((0,_.xw)(),(0,c.U)(o=>o.payload.page),(0,c.U)(o=>o.map(l=>l.id)))]).pipe((0,E.w)(([o,l])=>(0,g.a)(this.filterIds(t,l).map(m=>this.itemDataService.mapToCollection(o,m).pipe((0,_.hC)())))));this.showNotifications(a,"item.edit.item-mapper.notifications.add")}removeMappings(t){const n=this.itemRD$.pipe((0,_.xw)(),(0,c.U)(a=>a.payload.id),(0,E.w)(a=>(0,g.a)(t.map(o=>this.itemDataService.removeMappingFromCollection(a,o).pipe((0,_.hC)())))));this.showNotifications(n,"item.edit.item-mapper.notifications.remove")}filterIds(t,n){return t.filter(a=>n.indexOf(a)<0)}showNotifications(t,n){t.subscribe(a=>{const o=a.filter(m=>m.hasSucceeded),l=a.filter(m=>m.hasFailed);o.length>0&&((0,g.a)([this.translateService.get(`${n}.success.head`),this.translateService.get(`${n}.success.content`,{amount:o.length})]).subscribe(([y,B])=>{this.notificationsService.success(y,B)}),this.shouldUpdate$.next(!0)),l.length>0&&(0,g.a)([this.translateService.get(`${n}.error.head`),this.translateService.get(`${n}.error.content`,{amount:l.length})]).subscribe(([y,B])=>{this.notificationsService.error(y,B)}),this.switchToFirstTab()})}tabChange(t){this.performedSearch=!1,this.router.navigateByUrl(this.getCurrentUrl())}getCurrentUrl(){return this.router.url.indexOf("?")>-1?this.router.url.substring(0,this.router.url.indexOf("?")):this.router.url}buildQuery(t,n){let a=n;for(const o of t)a=this.addExcludeCollection(o.id,a);return a}addExcludeCollection(t,n){const a=`-search.resourceid:${t}`;return(0,h.UE)(n)?`${n} AND ${a}`:a}switchToFirstTab(){this.tabs.select("browseTab")}onCancel(){this.itemRD$.pipe((0,_.xw)(),(0,_.xe)(),(0,D.q)(1)).subscribe(t=>{this.router.navigate([(0,I.Tt)(t)])})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(bn.U),e.\u0275\u0275directiveInject(je.o),e.\u0275\u0275directiveInject(M.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(fn.W),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(ae._))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-collection-mapper"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(yn,5),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(n.tabs=a.first)}},decls:25,vars:24,consts:[[1,"container","mt-2"],[1,"row"],[1,"col-12"],["id","item-name",3,"innerHTML"],["ngbNav","",1,"nav-tabs",3,"destroyOnHide","navChange"],["tabs","ngbNav"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"mt-2"],[1,"mt-2",3,"key","dsoRD$","paginationOptions","confirmButton","cancelButton","dangerConfirm","confirm","cancel"],[1,"row","mt-2"],[1,"col-12","col-lg-6"],["id","search-form",3,"query","currentUrl","inPlaceSearch","searchPlaceholder","submitSearch"],[4,"ngIf"],["class","alert alert-info w-100","role","alert",4,"ngIf"],[1,"mt-2",3,"key","dsoRD$","paginationOptions","sortOptions","confirmButton","cancelButton","confirm","cancel"],["role","alert",1,"alert","alert-info","w-100"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(6,"p",3),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementStart(9,"p"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"ul",4,5),e.\u0275\u0275listener("navChange",function(o){return n.tabChange(o)}),e.\u0275\u0275elementStart(14,"li",6)(15,"a",7),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,xn,3,8,"ng-template",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"li",6)(20,"a",7),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(23,Mn,7,10,"ng-template",8),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(24,"div",9),e.\u0275\u0275elementEnd()()()),2&t){const a=e.\u0275\u0275reference(13);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,9,"item.edit.item-mapper.head")),e.\u0275\u0275advance(2),e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind2(7,11,"item.edit.item-mapper.item",e.\u0275\u0275pureFunction1(22,On,e.\u0275\u0275pipeBind1(8,14,n.itemName$))),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,16,"item.edit.item-mapper.description")),e.\u0275\u0275advance(2),e.\u0275\u0275property("destroyOnHide",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngbNavItem","browseTab"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,18,"item.edit.item-mapper.tabs.browse")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngbNavItem","mapTab"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(22,20,"item.edit.item-mapper.tabs.map")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngbNavOutlet",a)}},dependencies:[p.O5,u.uN,u.Pz,u.nv,u.Vx,u.tO,In.p,Cn.v,p.Ov,b.X$],data:{animation:[C.Ji,C.Ic]},changeDetection:0}),i})();var Me=r(5476),Pn=r(87478);function Tn(i,s){1&i&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&i&&e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(1,1,"item.edit.move.inheritpolicies.tooltip")," ")}function Dn(i,s){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",18),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"item.edit.move.save-button")," "))}function Bn(i,s){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",19),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"item.edit.move.processing")," "))}const Rn=function(i){return{id:i}},wn=function(){return{type:"collection"}},jn=function(i){return[i,"edit"]};let Un=(()=>{class i{constructor(t,n,a,o,l,m,y,B){this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.searchService=l,this.translateService=m,this.requestService=y,this.dsoNameService=B,this.selectorType=Se.h.COLLECTION,this.inheritPolicies=!1,this.canSubmit=!1,this.processing=!1,this.COLLECTIONS=[Se.h.COLLECTION]}ngOnInit(){this.itemRD$=this.route.data.pipe((0,c.U)(t=>t.dso),(0,_.xw)()),this.itemPageRoute$=this.itemRD$.pipe((0,_.mc)(),(0,c.U)(t=>(0,I.Tt)(t))),this.itemRD$.subscribe(t=>{this.item=t.payload}),this.itemRD$.pipe((0,_.xw)(),(0,_.xe)(),(0,E.w)(t=>t.owningCollection),(0,_.xw)(),(0,_.xe)()).subscribe(t=>{this.originalCollection=t})}selectDso(t){this.selectedCollection=t,this.selectedCollectionName=this.dsoNameService.getName(t),this.canSubmit=!0}getCurrentUrl(){return this.router.url}moveToCollection(){this.processing=!0;const t=this.itemDataService.moveToCollection(this.item.id,this.selectedCollection,this.inheritPolicies).pipe((0,_.hC)());t.subscribe(n=>{n.hasSucceeded?this.notificationsService.success(this.translateService.get("item.edit.move.success")):this.notificationsService.error(this.translateService.get("item.edit.move.error"))}),t.pipe((0,E.w)(()=>this.requestService.setStaleByHrefSubstring(this.item.id)),(0,E.w)(()=>this.itemDataService.findById(this.item.id,!1,!0,(0,G.l)("owningCollection"))),(0,_.hC)()).subscribe(()=>{this.processing=!1,this.router.navigate([(0,I.tn)(this.item)])})}discard(){this.selectedCollection=null,this.canSubmit=!1}get canMove(){return this.canSubmit&&this.selectedCollection?.id!==this.originalCollection.id}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(M.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(je.o),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(de.s),e.\u0275\u0275directiveInject(ae._))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-move"]],decls:45,vars:41,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"card","mb-3"],[1,"card-header"],[1,"card-body"],[3,"types","currentDSOId","onSelect"],["for","inheritPoliciesCheckbox"],["tooltipContent",""],["type","checkbox","name","tc","id","inheritPoliciesCheckbox",3,"ngModel","ngbTooltip","ngModelChange"],[1,"button-row","bottom"],[1,"float-right","space-children-mr"],[1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"],[1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-times"],[1,"fas","fa-save"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"p"),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"div",1)(11,"div",2)(12,"div",3)(13,"div",4),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",5)(17,"ds-authorized-collection-selector",6),e.\u0275\u0275listener("onSelect",function(o){return n.selectDso(o)}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(18,"div"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"div",1)(20,"div",2)(21,"p")(22,"label",7),e.\u0275\u0275template(23,Tn,2,3,"ng-template",null,8,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(25,"input",9),e.\u0275\u0275listener("ngModelChange",function(o){return n.inheritPolicies=o}),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(26),e.\u0275\u0275pipe(27,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(28,"p"),e.\u0275\u0275text(29),e.\u0275\u0275pipe(30,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(31,"div",10)(32,"div",11)(33,"button",12),e.\u0275\u0275pipe(34,"async"),e.\u0275\u0275element(35,"i",13),e.\u0275\u0275text(36),e.\u0275\u0275pipe(37,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(38,"button",14),e.\u0275\u0275listener("click",function(){return n.moveToCollection()}),e.\u0275\u0275template(39,Dn,4,3,"span",15),e.\u0275\u0275template(40,Bn,4,3,"span",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(41,"button",16),e.\u0275\u0275listener("click",function(){return n.discard()}),e.\u0275\u0275element(42,"i",17),e.\u0275\u0275text(43),e.\u0275\u0275pipe(44,"translate"),e.\u0275\u0275elementEnd()()()()()()),2&t){const a=e.\u0275\u0275reference(24);let o;e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,16,"item.edit.move.head",e.\u0275\u0275pureFunction1(36,Rn,null==(o=e.\u0275\u0275pipeBind1(6,19,n.itemRD$))||null==o.payload?null:o.payload.handle))),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,21,"item.edit.move.description")),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(15,23,"dso-selector.placeholder",e.\u0275\u0275pureFunction0(38,wn))),e.\u0275\u0275advance(3),e.\u0275\u0275property("types",n.COLLECTIONS)("currentDSOId",n.selectedCollection?n.selectedCollection.id:n.originalCollection.id),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngModel",n.inheritPolicies)("ngbTooltip",a),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(27,26,"item.edit.move.inheritpolicies.checkbox")," "),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(30,28,"item.edit.move.inheritpolicies.description")," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(39,jn,e.\u0275\u0275pipeBind1(34,30,n.itemPageRoute$))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(37,32,"item.edit.move.cancel")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!n.canMove),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.processing),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.processing),e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!n.canSubmit),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(44,34,"item.edit.move.discard-button")," ")}},dependencies:[p.O5,Me.Wl,Me.JJ,Me.On,u._L,d.rH,Pn.$,p.Ov,b.X$],encapsulation:2}),i})();var $e=r(35945);function $n(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"p",10),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate3("",e.\u0275\u0275pipeBind1(3,3,n.doiToUpdateMessage),": ",t.value," (",e.\u0275\u0275pipeBind1(4,5,"item.edit.identifiers.doi.status."+t.identifierStatus),") ")}}function Fn(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",8),e.\u0275\u0275template(1,$n,5,7,"div",9),e.\u0275\u0275elementEnd()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","doi"==t.identifierType)}}const Vn=function(i){return{id:i}},An=function(i){return[i,"edit"]};let Ln=(()=>{class i extends U{constructor(t,n,a,o,l,m){super(t,n,a,o,l),this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.translateService=l,this.identifierDataService=m,this.messageKey="register-doi",this.doiToUpdateMessage="item.edit."+this.messageKey+".to-update",this.processing=!1}ngOnInit(){this.itemRD$=this.route.data.pipe((0,c.U)(t=>t.dso),(0,_.xw)()),this.itemRD$.pipe((0,H.P)()).subscribe(t=>{this.item=t.payload,this.itemPageRoute=(0,I.Tt)(this.item),this.identifiers$=this.identifierDataService.getIdentifierDataFor(this.item).pipe((0,c.U)(n=>401!==n.statusCode&&(0,h.Uh)(n.payload)?n.payload.identifiers:null))}),this.confirmMessage="item.edit."+this.messageKey+".confirm",this.cancelMessage="item.edit."+this.messageKey+".cancel",this.headerMessage="item.edit."+this.messageKey+".header",this.descriptionMessage="item.edit."+this.messageKey+".description"}performAction(){this.registerDoi()}registerDoi(){this.processing=!0,this.identifierDataService.registerIdentifier(this.item,"doi").subscribe(t=>{t.hasCompleted&&(this.processing=!1,this.processRestResponse(t))})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(M.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject($e.m))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-register-doi"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:19,vars:22,consts:[[1,"container"],[1,"row"],[1,"col-12"],["class","w-100 p",4,"ngFor","ngForOf"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"],[1,"w-100","p"],[4,"ngIf"],[1,"float-left"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,Fn,2,1,"div",3),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275element(11,"ds-modify-item-overview",4),e.\u0275\u0275elementStart(12,"div",5)(13,"button",6),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"button",7),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,7,n.headerMessage,e.\u0275\u0275pureFunction1(18,Vn,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,10,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(10,12,n.identifiers$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(15,14,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(20,An,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(18,16,n.cancelMessage)," "))},dependencies:[p.sg,p.O5,d.rH,F.E,p.Ov,b.X$],encapsulation:2}),i})();var zn=r(56035),Fe=r(55491),Kn=r(14111),ue=r(69637),Wn=r(91519),Nn=(r(83297),r(37164),r(30139)),kn=r(17568),Gn=r(91416),Ve=r(16441),Hn=r(87899);function Xn(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"div",16),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()),2&i){const t=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.metadataField," "),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.metadataValue.value," ")}}function Qn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t).ngVar,l=e.\u0275\u0275nextContext().$implicit,m=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(m.setSelectedVirtualMetadataItem(l,!o))}),e.\u0275\u0275elementStart(1,"div",11)(2,"label"),e.\u0275\u0275element(3,"input",12),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"div",13),e.\u0275\u0275element(5,"ds-listable-object-component-loader",14),e.\u0275\u0275template(6,Xn,5,2,"div",15),e.\u0275\u0275elementEnd()()}if(2&i){const t=s.ngVar,n=e.\u0275\u0275nextContext().$implicit,a=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("checked",t),e.\u0275\u0275advance(2),e.\u0275\u0275property("object",n),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",a.virtualMetadata.get(n.uuid))}}function Jn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Qn,7,3,"div",9),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,n.isSelectedVirtualMetadataItem(t)))}}let Zn=(()=>{class i{constructor(t,n){this.objectUpdatesService=t,this.appConfig=n,this.close=new e.EventEmitter,this.save=new e.EventEmitter,this.virtualMetadata=new Map,this.showThumbnails=this.appConfig.browseBy.showThumbnails}get items(){return[this.leftItem,this.rightItem]}getVirtualMetadata(t){return Object.entries(t.metadata).map(([n,a])=>a.filter(o=>!n.startsWith("relation")&&o.authority&&o.authority.endsWith(this.relationshipId)).map(o=>({metadataField:n,metadataValue:o}))).reduce((n,a)=>n.concat(a),[])}setSelectedVirtualMetadataItem(t,n){this.objectUpdatesService.setSelectedVirtualMetadata(this.url,this.relationshipId,t.uuid,n)}isSelectedVirtualMetadataItem(t){return this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.relationshipId,t.uuid)}trackItem(t,n){return n&&n.uuid}ngOnInit(){this.items.forEach(t=>{this.virtualMetadata.set(t.uuid,this.getVirtualMetadata(t))})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(K.d),e.\u0275\u0275directiveInject(Ve.q))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-virtual-metadata"]],inputs:{url:"url",relationshipId:"relationshipId",leftItem:"leftItem",rightItem:"rightItem"},outputs:{close:"close",save:"save"},decls:14,vars:9,consts:[[3,"ngClass"],[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-flex","flex-row-reverse","m-2"],[1,"btn","btn-primary","save",3,"click"],[1,"fas","fa-save"],["class","item d-flex flex-row",3,"click",4,"ngVar"],[1,"item","d-flex","flex-row",3,"click"],[1,"m-2"],["type","checkbox",1,"select",3,"checked"],[1,"flex-column"],[3,"object"],[4,"ngFor","ngForOf"],[1,"font-weight-bold"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementStart(4,"button",2),e.\u0275\u0275listener("click",function(){return n.close.emit()}),e.\u0275\u0275elementStart(5,"span",3),e.\u0275\u0275text(6,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",4),e.\u0275\u0275template(8,Jn,3,3,"ng-container",5),e.\u0275\u0275elementStart(9,"div",6)(10,"button",7),e.\u0275\u0275listener("click",function(){return n.save.emit()}),e.\u0275\u0275element(11,"i",8),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd()()()()),2&t&&(e.\u0275\u0275property("ngClass",n.showThumbnails?"hide-modal-thumbnail-column":""),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(3,5,"virtual-metadata.delete-relationship.modal-head")," "),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",n.items)("ngForTrackBy",n.trackItem),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(13,7,"item.edit.metadata.save-button")," "))},dependencies:[p.mk,p.sg,fe.p,te.g,p.Ov,b.X$],encapsulation:2}),i})();function Yn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",2)(1,"div",3),e.\u0275\u0275element(2,"ds-listable-object-component-loader",4),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",5)(5,"div",6)(6,"button",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(3);return e.\u0275\u0275resetView(a.openVirtualMetadataModal(o))}),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275element(8,"i",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",9),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.undo())}),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275element(11,"i",10),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("object",e.\u0275\u0275pipeBind1(3,7,t.relatedItem$))("viewMode",t.viewMode)("value",t.nameVariant),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(7,9,"item.edit.metadata.edit.buttons.remove")),e.\u0275\u0275property("disabled",!t.canRemove()),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(10,11,"item.edit.metadata.edit.buttons.undo")),e.\u0275\u0275property("disabled",!t.canUndo())}}function qn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-virtual-metadata",11),e.\u0275\u0275listener("close",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.closeVirtualMetadataModal())})("save",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.remove())}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("relationshipId",t.relationship.id)("leftItem",e.\u0275\u0275pipeBind1(1,4,t.leftItem$))("rightItem",e.\u0275\u0275pipeBind1(2,6,t.rightItem$))("url",t.url)}}let ei=(()=>{class i{constructor(t,n){this.objectUpdatesService=t,this.modalService=n,this.viewMode=Pe.w.ListElement}get relationship(){return this.update.relationship}get update(){return this.fieldUpdate.field}get nameVariant(){return this.update.nameVariant}ngOnChanges(){this.relationship&&(this.relationship.leftItem||this.relationship.rightItem)?(this.leftItem$=this.relationship.leftItem.pipe((0,_.xw)(),(0,_.xe)(),(0,J.h)(t=>(0,h.Uh)(t)&&(0,h.UE)(t.uuid))),this.rightItem$=this.relationship.rightItem.pipe((0,_.xw)(),(0,_.xe)(),(0,J.h)(t=>(0,h.Uh)(t)&&(0,h.UE)(t.uuid))),this.relatedItem$=(0,g.a)(this.leftItem$,this.rightItem$).pipe((0,c.U)(t=>t.find(n=>n.uuid!==this.editItem.uuid)))):this.relatedItem$=(0,v.of)(this.update.relatedItem)}remove(){this.closeVirtualMetadataModal(),(0,g.a)(this.leftItem$,this.rightItem$).pipe((0,c.U)(t=>t.map(n=>this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.relationship.id,n.uuid))),(0,E.w)(t=>(0,g.a)(t)),(0,c.U)(t=>Object.assign({},this.fieldUpdate.field,{keepLeftVirtualMetadata:!0===t[0],keepRightVirtualMetadata:!0===t[1]})),(0,D.q)(1)).subscribe(t=>this.objectUpdatesService.saveRemoveFieldUpdate(this.url,t))}openVirtualMetadataModal(t){this.modalRef=this.modalService.open(t)}closeVirtualMetadataModal(){this.modalRef.close()}undo(){this.objectUpdatesService.removeSingleFieldUpdate(this.url,this.fieldUpdate.field.uuid)}canRemove(){return this.fieldUpdate.changeType!==ne.m.REMOVE&&this.fieldUpdate.changeType!==ne.m.ADD}canUndo(){return this.fieldUpdate.changeType>=0}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(K.d),e.\u0275\u0275directiveInject(u.FF))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-edit-relationship"]],inputs:{fieldUpdate:"fieldUpdate",url:"url",editItem:"editItem"},features:[e.\u0275\u0275NgOnChangesFeature],decls:4,vars:3,consts:[["class","row",4,"ngIf"],["virtualMetadataModal",""],[1,"row"],[1,"col-10","relationship"],[3,"object","viewMode","value"],[1,"col-2"],[1,"btn-group","relationship-action-buttons"],[1,"btn","btn-outline-danger","btn-sm",3,"disabled","title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-warning","btn-sm",3,"disabled","title","click"],[1,"fas","fa-undo-alt","fa-fw"],[3,"relationshipId","leftItem","rightItem","url","close","save"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,Yn,12,13,"div",0),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275template(2,qn,3,8,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)),2&t&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,n.relatedItem$))},dependencies:[p.O5,fe.p,Zn,p.Ov,b.X$],styles:[".btn[disabled][_ngcontent-%COMP%]{color:var(--bs-gray-600);border-color:var(--bs-gray-600);z-index:0}.relationship-action-buttons[_ngcontent-%COMP%]{margin:0;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}"]}),i})();const ti=function(){return{}},ni=function(i,s,t){return{"alert-success":i,"alert-warning":s,"alert-danger":t}};function ii(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-edit-relationship",8),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(4);e.\u0275\u0275property("fieldUpdate",t||e.\u0275\u0275pureFunction0(4,ti))("url",n.url)("editItem",n.item)("ngClass",e.\u0275\u0275pureFunction3(5,ni,1===t.changeType,0===t.changeType,2===t.changeType))}}function ai(i,s){1&i&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"item.edit.relationships.no-relationships")))}function ri(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"ds-pagination",5),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementStart(5,"div",6),e.\u0275\u0275template(6,ii,1,9,"ds-edit-relationship",7),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(7,ai,3,3,"div",4),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.ngVar,n=e.\u0275\u0275nextContext(3);let a,o;e.\u0275\u0275advance(1),e.\u0275\u0275property("paginationOptions",n.paginationConfig)("pageInfoState",null==(a=e.\u0275\u0275pipeBind1(2,8,n.relationshipsRd$))||null==a.payload?null:a.payload.pageInfo)("collectionSize",(null==(o=e.\u0275\u0275pipeBind1(3,10,n.relationshipsRd$))||null==o.payload?null:o.payload.totalElements)+e.\u0275\u0275pipeBind1(4,12,n.nbAddedFields$))("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",t)("ngForTrackBy",n.trackUpdate),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0===t.length)}}function oi(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ri,8,14,"ng-container",3),e.\u0275\u0275pipe(2,"dsObjectValues"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,t))}}function si(i,s){1&i&&e.\u0275\u0275element(0,"ds-themed-loading")}function li(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,oi,3,3,"ng-container",4),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,si,1,0,"ds-themed-loading",4),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.ngVar,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t&&!e.\u0275\u0275pipeBind1(2,2,n.loading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(4,4,n.loading$))}}let ci=(()=>{class i{constructor(t,n,a,o,l,m,y,B){this.objectUpdatesService=t,this.linkService=n,this.relationshipService=a,this.relationshipTypeService=o,this.modalService=l,this.paginationService=m,this.selectableListService=y,this.appConfig=B,this.submit=new e.EventEmitter,this.updates$=new z.X(void 0),this.relationshipsRd$=new z.X(void 0),this.isLastPage$=new z.X(!0),this.loading$=new z.X(!0),this.nbAddedFields$=new z.X(0),this.subs=[],this.fetchThumbnail=this.appConfig.browseBy.showThumbnails}getRelationshipMessageKey(){return(0,g.a)(this.getLabel(),this.relatedEntityType$).pipe((0,c.U)(([t,n])=>{if((0,h.Uh)(t)&&t.indexOf("is")>-1&&t.indexOf("Of")>-1){const a=`${t.substring(2,t.indexOf("Of"))}`;return a!==n.label?`relationships.is${a}Of.${n.label}`:`relationships.is${a}Of`}return t}))}getLabel(){return(0,g.a)([this.relationshipType.leftType,this.relationshipType.rightType].map(t=>t.pipe((0,_.xw)(),(0,_.xe)()))).pipe((0,c.U)(t=>[this.relationshipType.leftwardType,this.relationshipType.rightwardType][t.findIndex(n=>n.id===this.itemType.id)]))}trackUpdate(t,n){return n&&n.field?n.field.uuid:void 0}openLookup(){this.modalRef=this.modalService.open(Nn.i,{size:"lg"});const t=this.modalRef.componentInstance;t.repeatable=!0,t.isEditRelationship=!0,t.listId=this.listId,t.item=this.item,t.relationshipType=this.relationshipType,t.currentItemIsLeftItem$=this.currentItemIsLeftItem$,t.toAdd=[],t.toRemove=[],t.isPending=!1,this.item.owningCollection.pipe((0,_.Gp)()).subscribe(n=>{t.collection=n}),t.select=(...n)=>{n.forEach(a=>{const o=a.indexableObject,l=t.toRemove.findIndex(m=>m.uuid===o.uuid);-1!==l?t.toRemove.splice(l,1):this.getRelationFromId(o).subscribe(m=>{if(m){const y=t.toRemove.findIndex(B=>B.indexableObject.uuid===o.uuid);-1!==y&&t.toRemove.splice(y,1)}else t.toAdd.push(a);this.loading$.next(!0),this.relationshipsRd$.next(this.relationshipsRd$.getValue())})})},t.deselect=(...n)=>{n.forEach(a=>{const o=a.indexableObject,l=t.toAdd.findIndex(m=>m.indexableObject.uuid===o.uuid);-1!==l?t.toAdd.splice(l,1):t.toRemove.push(a)})},t.submitEv=()=>{const n=[];t.toAdd.forEach(a=>{const o=a.indexableObject;n.push(this.relationshipService.getNameVariant(this.listId,o.uuid).pipe((0,c.U)(l=>{const m={uuid:this.relationshipType.id+"-"+a.indexableObject.uuid,nameVariant:l,type:this.relationshipType,relatedItem:o};return this.objectUpdatesService.saveAddFieldUpdate(this.url,m),m})))}),t.toRemove.forEach(a=>{n.push(this.relationshipService.getNameVariant(this.listId,a.indexableObjectuuid).pipe((0,E.w)(o=>this.getRelationFromId(a.indexableObject).pipe((0,c.U)(l=>{const m={uuid:l.id,nameVariant:o,type:this.relationshipType,relationship:l};return this.objectUpdatesService.saveRemoveFieldUpdate(this.url,m),m})))))}),(0,g.a)(n).subscribe(a=>{setTimeout(()=>{this.submit.emit()},1e3),t.isPending=!0})},t.discardEv=()=>{t.toAdd.forEach(n=>{this.selectableListService.deselectSingle(this.listId,n)}),t.toRemove.forEach(n=>{this.selectableListService.selectSingle(this.listId,n)}),t.toAdd=[],t.toRemove=[]},this.relatedEntityType$.pipe((0,D.q)(1)).subscribe(n=>{t.relationshipOptions=Object.assign(new kn.u,{relationshipType:n.label,searchConfiguration:n.label.toLowerCase(),nameVariants:"true"})}),this.selectableListService.deselectAll(this.listId)}getRelationFromId(t){return this.currentItemIsLeftItem$.pipe((0,D.q)(1),(0,E.w)(n=>{let a;return a=n?this.relationshipService.searchByItemsAndType(this.relationshipType.id,this.item.uuid,this.relationshipType.leftwardType,[t.id]).pipe((0,_.xw)(),(0,_.xe)()):this.relationshipService.searchByItemsAndType(this.relationshipType.id,this.item.uuid,this.relationshipType.rightwardType,[t.id]).pipe((0,_.xw)(),(0,_.xe)()),a.pipe((0,c.U)(o=>o.page[0]))}))}getFieldUpdatesForRelatedItem(t){return this.updates$.pipe((0,D.q)(1),(0,c.U)(n=>Object.values(n).map(a=>a.field).filter(a=>a.relationship)),(0,ue.z)(n=>(0,g.a)(n.map(a=>this.getRelatedItem(a.relationship))).pipe((0,ce.d)([]),(0,c.U)(a=>n.filter((o,l)=>a[l].uuid===t.uuid)))))}getIsRelatedItem(t){return this.currentItemIsLeftItem$.pipe((0,D.q)(1),(0,c.U)(n=>n?!!this.item.allMetadataValues("relation."+this.relationshipType.leftwardType).find(o=>o===t.uuid):!!this.item.allMetadataValues("relation."+this.relationshipType.rightwardType).find(o=>o===t.uuid)))}getRelatedItem(t){return this.relationshipService.isLeftItem(t,this.item).pipe((0,E.w)(n=>n?t.rightItem:t.leftItem),(0,_.xw)(),(0,_.xe)())}ngOnInit(){this.relationshipLeftAndRightType$=(0,g.a)([this.relationshipType.leftType,this.relationshipType.rightType].map(a=>a.pipe((0,_.xw)(),(0,_.xe)()))),this.relatedEntityType$=this.relationshipLeftAndRightType$.pipe((0,c.U)(a=>a.find(o=>o.uuid!==this.itemType.uuid)),(0,h.tz)()),this.relatedEntityType$.pipe((0,D.q)(1)).subscribe(a=>this.listId=`edit-relationship-${this.itemType.id}-${a.id}`),this.currentItemIsLeftItem$=this.relationshipLeftAndRightType$.pipe((0,c.U)(([a,o])=>a.id===this.itemType.id||o.id!==this.itemType.id&&void console.warn(`The item ${this.item.uuid} is not on the right or the left side of relationship type ${this.relationshipType.uuid}`))),this.paginationConfig=new we.r,this.paginationConfig.id=`er${this.relationshipType.id}`,this.paginationConfig.pageSize=5,this.paginationConfig.currentPage=1;const t=this.paginationService.getCurrentPagination(this.paginationConfig.id,this.paginationConfig).pipe((0,De.b)(()=>this.loading$.next(!0)));let n=(0,Hn.IX)(this.fetchThumbnail);this.subs.push((0,g.a)([t,this.currentItemIsLeftItem$]).pipe((0,E.w)(([a,o])=>this.relationshipService.getItemRelationshipsByLabel(this.item,o?this.relationshipType.leftwardType:this.relationshipType.rightwardType,{elementsPerPage:a.pageSize,currentPage:a.currentPage},!1,!0,...n))).subscribe(a=>{this.relationshipsRd$.next(a)})),this.subs.push(this.relationshipsRd$.pipe((0,h.tz)(),(0,_.g1)()).subscribe(a=>{this.isLastPage$.next((0,h.xI)(a.payload._links.next))})),this.subs.push(this.relationshipsRd$.pipe((0,h.tz)(),(0,_.g1)(),(0,E.w)(a=>(0,Kn.D)(a.payload.page).pipe((0,ue.z)(o=>this.relationshipService.isLeftItem(o,this.item).pipe((0,c.U)(l=>[o,l]))),(0,c.U)(([o,l])=>({uuid:o.id,type:this.relationshipType,relationship:o,nameVariant:l?o.rightwardValue:o.leftwardValue})),(0,Wn.q)(),(0,ce.d)([]))),(0,E.w)(a=>this.objectUpdatesService.getFieldUpdates(this.url,a).pipe((0,c.U)(o=>{const l={};return this.nbAddedFields$.next(0),Object.keys(o).forEach(m=>{(0,h.Uh)(o[m])&&o[m].field.type.id===this.relationshipType.id&&(o[m].changeType===ne.m.ADD?(this.nbAddedFields$.next(this.nbAddedFields$.getValue()+1),!0===this.isLastPage$.getValue()&&(l[m]=o[m])):l[m]=o[m])}),l}))),(0,Ee.O)({})).subscribe(a=>{this.loading$.next(!1),this.updates$.next(a)}))}ngOnDestroy(){this.subs.filter(t=>(0,h.Uh)(t)).forEach(t=>t.unsubscribe())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(K.d),e.\u0275\u0275directiveInject(ve.M),e.\u0275\u0275directiveInject(ge.U),e.\u0275\u0275directiveInject(Fe.X),e.\u0275\u0275directiveInject(u.FF),e.\u0275\u0275directiveInject(ye.N),e.\u0275\u0275directiveInject(Gn.w),e.\u0275\u0275directiveInject(Ve.q))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-edit-relationship-list"]],inputs:{item:"item",itemType:"itemType",url:"url",relationshipType:"relationshipType",hasChanges:"hasChanges"},outputs:{submit:"submit"},decls:12,vars:14,consts:[[1,"ml-2","btn","btn-success",3,"disabled","click"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[4,"ngVar"],[4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"my-2"],["class","relationship-row d-block alert",3,"fieldUpdate","url","editItem","ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"relationship-row","d-block","alert",3,"fieldUpdate","url","editItem","ngClass"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"h5"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementStart(4,"button",0),e.\u0275\u0275listener("click",function(){return n.openLookup()}),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275element(6,"i",1),e.\u0275\u0275elementStart(7,"span",2),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(10,li,5,6,"ng-container",3),e.\u0275\u0275pipe(11,"async")),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,4,e.\u0275\u0275pipeBind1(3,6,n.getRelationshipMessageKey()))," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(5,8,n.hasChanges)),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(9,10,"item.edit.relationships.edit.buttons.add"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(11,12,n.updates$)))},dependencies:[p.mk,p.sg,p.O5,pe.Z,Ce.Q,te.g,ei,p.Ov,me.g,b.X$],styles:[".relationship-row[_ngcontent-%COMP%]:not(.alert){padding:var(--bs-alert-padding-y) 0}.relationship-row.alert[_ngcontent-%COMP%]{margin-left:calc(-1 * var(--bs-alert-padding-x));margin-right:calc(-1 * var(--bs-alert-padding-x));margin-top:-1px;margin-bottom:-1px}"]}),i})();function di(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",14),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.discard())}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",15),e.\u0275\u0275elementStart(3,"span",9),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.metadata.discard-button"),"")}}function pi(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",16),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.reinstate())}),e.\u0275\u0275element(1,"i",17),e.\u0275\u0275elementStart(2,"span",9),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.metadata.reinstate-button"),""))}function mi(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",19)(1,"ds-edit-relationship-list",20),e.\u0275\u0275listener("submit",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(5);return e.\u0275\u0275resetView(a.submit())}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(1),e.\u0275\u0275property("url",n.url)("item",n.item)("itemType",e.\u0275\u0275pipeBind1(2,5,n.entityType$))("relationshipType",t)("hasChanges",n.hasChanges())}}function ui(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,mi,3,7,"div",18),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t)}}function hi(i,s){1&i&&e.\u0275\u0275element(0,"ds-themed-loading")}function _i(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ui,2,1,"ng-container",2),e.\u0275\u0275template(2,hi,1,0,"ds-themed-loading",2),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t)}}function gi(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",21),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.discard())}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",15),e.\u0275\u0275elementStart(3,"span",9),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.metadata.discard-button"),"")}}function vi(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",22),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.reinstate())}),e.\u0275\u0275element(1,"i",17),e.\u0275\u0275elementStart(2,"span",9),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.metadata.reinstate-button"),""))}function fi(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",4),e.\u0275\u0275template(2,di,6,6,"button",5),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275template(4,pi,5,3,"button",6),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275elementStart(6,"button",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.submit())}),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275element(8,"i",8),e.\u0275\u0275elementStart(9,"span",9),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(12,_i,3,2,"ng-container",1),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275elementStart(14,"div",10)(15,"div",11),e.\u0275\u0275template(16,gi,6,6,"button",12),e.\u0275\u0275pipe(17,"async"),e.\u0275\u0275template(18,vi,5,3,"button",13),e.\u0275\u0275pipe(19,"async"),e.\u0275\u0275elementStart(20,"button",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.submit())}),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275element(22,"i",8),e.\u0275\u0275elementStart(23,"span",9),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(3,9,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(5,11,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(7,13,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(11,15,"item.edit.metadata.save-button"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(13,17,t.relationshipTypes$)),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(17,19,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(19,21,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(21,23,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(25,25,"item.edit.metadata.save-button"),"")}}function bi(i,s){1&i&&(e.\u0275\u0275elementStart(0,"div",23),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.edit.relationships.no-entity-type")," "))}function Ii(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,fi,26,27,"ng-container",2),e.\u0275\u0275template(2,bi,3,3,"div",3),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t)}}let Ci=(()=>{class i extends Be{constructor(t,n,a,o,l,m,y,B,N,Y,ie,Oe,la){super(t,n,a,o,l,m),this.itemService=t,this.objectUpdatesService=n,this.router=a,this.notificationsService=o,this.translateService=l,this.route=m,this.relationshipService=y,this.objectCache=B,this.requestService=N,this.entityTypeService=Y,this.relationshipTypeService=ie,this.cdr=Oe,this.modalService=la}initializeUpdates(){const t=this.item.firstMetadataValue("dspace.entity.type");void 0!==t?(this.relationshipTypes$=this.relationshipTypeService.searchByEntityType(t,!0,!0,...this.getRelationshipTypeFollowLinks()).pipe((0,c.U)(n=>n.page)),this.entityType$=this.entityTypeService.getEntityTypeByLabel(t).pipe((0,_.xw)(),(0,_.xe)())):this.entityType$=(0,v.of)(void 0)}initializeNotificationsPrefix(){this.notificationsPrefix="item.edit.relationships.notifications."}submit(){const t=this.relationshipService.getItemRelationshipsArray(this.item).pipe((0,Ee.O)([]),(0,c.U)(a=>a.map(o=>Object.assign(new zn.W,o,{uuid:o.id}))),(0,E.w)(a=>this.objectUpdatesService.getFieldUpdatesExclusive(this.url,a)),(0,c.U)(a=>Object.values(a).filter(o=>o.changeType===ne.m.REMOVE).map(o=>o.field))),n=this.objectUpdatesService.getFieldUpdates(this.url,[]).pipe((0,c.U)(a=>Object.values(a).filter(o=>(0,h.Uh)(o)).filter(o=>o.changeType===ne.m.ADD).map(o=>o.field)));(0,g.a)(t,n).pipe((0,D.q)(1)).subscribe(([a,o])=>{[this.deleteRelationships(a),this.addRelationships(o)].forEach(m=>m.subscribe(y=>{y.length>0&&(this.initializeOriginalFields(),this.cdr.detectChanges(),this.displayNotifications(y),this.modalService.dismissAll())}))})}deleteRelationships(t){return(0,oe.$)(...t.map(n=>{let a;return a=n.keepLeftVirtualMetadata&&n.keepRightVirtualMetadata?"all":n.keepLeftVirtualMetadata?"left":n.keepRightVirtualMetadata?"right":"none",this.relationshipService.deleteRelationship(n.uuid,a)}))}addRelationships(t){return(0,oe.$)(...t.map(n=>this.entityType$.pipe((0,E.w)(a=>this.entityTypeService.isLeftType(n.type,a)),(0,E.w)(a=>{let o,l,m,y;return a?(o=this.item,l=n.relatedItem,m=null,y=n.nameVariant):(o=n.relatedItem,l=this.item,m=n.nameVariant,y=null),this.relationshipService.addRelationship(n.type.id,o,l,m,y)}))))}displayNotifications(t){const n=t.filter(o=>o.hasFailed),a=t.filter(o=>o.hasSucceeded);n.forEach(o=>{this.notificationsService.error(this.getNotificationTitle("failed"),o.errorMessage)}),a.length>0&&this.notificationsService.success(this.getNotificationTitle("saved"),this.getNotificationContent("saved"))}initializeOriginalFields(){return this.relationshipService.getRelatedItems(this.item).pipe((0,D.q)(1)).subscribe(t=>{this.objectUpdatesService.initialize(this.url,t,this.item.lastModified)})}getRelationshipTypeFollowLinks(){return[(0,G.l)("leftType"),(0,G.l)("rightType")]}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(K.d),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(M.T),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(ge.U),e.\u0275\u0275directiveInject(Re.a),e.\u0275\u0275directiveInject(de.s),e.\u0275\u0275directiveInject(Te.k),e.\u0275\u0275directiveInject(Fe.X),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(u.FF))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-relationships"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:3,consts:[[1,"item-relationships"],[4,"ngVar"],[4,"ngIf"],["class","alert alert-info mt-2","role","alert",4,"ngIf"],[1,"button-row","top","d-flex","space-children-mr"],["class","btn btn-danger ml-auto",3,"disabled","click",4,"ngIf"],["class","btn btn-warning ml-auto",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fas","fa-save"],[1,"d-none","d-sm-inline"],[1,"button-row","bottom"],[1,"float-right","space-children-mr","ml-gap"],["class","btn btn-danger",3,"disabled","click",4,"ngIf"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-danger","ml-auto",3,"disabled","click"],[1,"fas","fa-times"],[1,"btn","btn-warning","ml-auto",3,"click"],[1,"fas","fa-undo-alt"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[3,"url","item","itemType","relationshipType","hasChanges","submit"],[1,"btn","btn-danger",3,"disabled","click"],[1,"btn","btn-warning",3,"click"],["role","alert",1,"alert","alert-info","mt-2"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,Ii,3,2,"ng-container",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,n.entityType$)))},dependencies:[p.sg,p.O5,pe.Z,te.g,ci,p.Ov,b.X$],styles:[".button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:var(--ds-gap)}.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}@media screen and (min-width: 576px){.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:var(--ds-edit-item-button-min-width)}}.button-row.top[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-top:calc(var(--bs-spacer) / 2);margin-bottom:calc(var(--bs-spacer) / 2)}"]}),i})();var Ae=r(76457),yi=r(60987),xi=r(36482);function Ei(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-item-versions",3),2&i){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275property("item",t)("displayWhenEmpty",!0)("displayTitle",!1)("displayActions",!0)}}function Si(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",1),e.\u0275\u0275template(1,Ei,1,4,"ds-item-versions",2),e.\u0275\u0275elementEnd()),2&i){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t)}}let Mi=(()=>{class i{constructor(t){this.route=t,this.AlertTypeEnum=yi.N}ngOnInit(){this.itemRD$=this.route.parent.parent.data.pipe((0,c.U)(t=>t.dso)).pipe((0,_.xw)())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(d.gz))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-version-history"]],decls:2,vars:3,consts:[["class","mt-2",4,"ngVar"],[1,"mt-2"],[3,"item","displayWhenEmpty","displayTitle","displayActions",4,"ngIf"],[3,"item","displayWhenEmpty","displayTitle","displayActions"]],template:function(t,n){if(1&t&&(e.\u0275\u0275template(0,Si,2,1,"div",0),e.\u0275\u0275pipe(1,"async")),2&t){let a;e.\u0275\u0275property("ngVar",null==(a=e.\u0275\u0275pipeBind1(1,1,n.itemRD$))?null:a.payload)}},dependencies:[p.O5,te.g,xi.h,p.Ov],encapsulation:2}),i})();var Oi=r(94667),Le=r.n(Oi),ze=r(9249),Ke=r(20942),Pi=r(87586),Ti=r(36753),Di=r(53482);function Bi(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"ds-resource-policies",5),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("resourceType","bitstream")("resourceUUID",t.id)("resourceName",t.name)}}function Ri(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",11)(1,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2).$implicit,o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onBitstreamsLoad(a))}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,1,"collection.edit.item.authorizations.load-more-button")))}function wi(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",7)(2,"div",8)(3,"button",9),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext().$implicit,o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.collapseArea(a.id))}),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",10),e.\u0275\u0275template(7,Bi,2,3,"ng-container",3),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275template(9,Ri,4,3,"div",4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!1)("aria-controls",t.id),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(5,8,"collection.edit.item.authorizations.show-bitstreams-button")," ",n.nameService.getName(t)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("id",t.id)("ngbCollapse",n.bundleBitstreamsMap.get(t.id).isCollapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(8,10,n.bundleBitstreamsMap.get(t.id).bitstreams)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.bundleBitstreamsMap.get(t.id).allBitstreamsLoaded)}}function ji(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"ds-resource-policies",5),e.\u0275\u0275template(2,wi,10,12,"ng-container",6),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext();let a;e.\u0275\u0275advance(1),e.\u0275\u0275property("resourceType","bundle")("resourceUUID",t.id)("resourceName",t.name),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==(a=e.\u0275\u0275pipeBind1(3,4,null==(a=n.bundleBitstreamsMap.get(t.id))?null:a.bitstreams))?null:a.length)>0)}}function Ui(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",11)(1,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.onBundleLoad())}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,1,"collection.edit.item.authorizations.load-bundle-button")))}let $i=(()=>{class i{constructor(t,n,a){this.linkService=t,this.route=n,this.nameService=a,this.bundleBitstreamsMap=new Map,this.bundles$=new z.X([]),this.subs=[],this.bundlesPerPage=6,this.bundlesPageSize=1,this.allBundlesLoaded=!1,this.bitstreamSize=4,this.bitstreamPageSize=4}ngOnInit(){this.getBundlesPerItem()}getItemUUID(){return this.item$.pipe((0,c.U)(t=>t.id),(0,H.P)(t=>(0,h.UE)(t)))}getItemName(){return this.item$.pipe((0,c.U)(t=>this.nameService.getName(t)))}getItemBundles(){return this.bundles$.asObservable()}getBundlesPerItem(t=1){this.item$=this.route.data.pipe((0,c.U)(a=>a.dso),(0,_.A6)(),(0,c.U)(a=>this.linkService.resolveLink(a,(0,G.l)("bundles",{findListOptions:{currentPage:t,elementsPerPage:this.bundlesPerPage}},(0,G.l)("bitstreams")))));const n=this.item$.pipe((0,J.h)(a=>(0,h.UE)(a.bundles)),(0,ue.z)(a=>a.bundles),(0,_.A6)(),(0,ze.K)(a=>(console.error(a),(0,v.of)((0,Ke.b)(null,[])))));this.subs.push(n.pipe((0,D.q)(1),(0,c.U)(a=>a.page)).subscribe(a=>{(Le()(a.length,0)||a.length<this.bundlesPerPage)&&(this.allBundlesLoaded=!0),Le()(t,1)?this.bundles$.next(a):this.bundles$.next(this.bundles$.getValue().concat(a))}),n.pipe((0,D.q)(1),(0,ue.z)(a=>a.page),(0,c.U)(a=>({id:a.id,bitstreams:this.getBundleBitstreams(a)}))).subscribe(a=>{let o={isCollapsed:!0,allBitstreamsLoaded:!1,bitstreams:null};o.bitstreams=a.bitstreams.pipe((0,c.U)(l=>(o.allBitstreamsLoaded=l?.page.length<this.bitstreamSize,[...l.page.slice(0,this.bitstreamSize)]))),this.bundleBitstreamsMap.set(a.id,o)}))}getBundleBitstreams(t){return t.bitstreams.pipe((0,_.Gp)(),(0,ze.K)(n=>(console.error(n),(0,v.of)((0,Ke.b)(null,[])))))}collapseArea(t){this.bundleBitstreamsMap.get(t).isCollapsed=!this.bundleBitstreamsMap.get(t).isCollapsed}onBundleLoad(){this.bundlesPageSize++,this.getBundlesPerItem(this.bundlesPageSize)}onBitstreamsLoad(t){return this.getBundleBitstreams(t).subscribe(n=>{let a=n?.page.slice(this.bitstreamPageSize,this.bitstreamPageSize+this.bitstreamSize),o=this.bundleBitstreamsMap.get(t.id).bitstreams.pipe((0,c.U)(m=>[...m,...a]));this.bitstreamPageSize=this.bitstreamPageSize+this.bitstreamSize;let l={bitstreams:o,isCollapsed:this.bundleBitstreamsMap.get(t.id).isCollapsed,allBitstreamsLoaded:n?.page.length<=this.bitstreamPageSize};this.bundleBitstreamsMap.set(t.id,l)})}ngOnDestroy(){this.subs.filter(t=>(0,h.Uh)(t)).forEach(t=>t.unsubscribe())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(ve.M),e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(ae._))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-authorizations"]],decls:8,vars:13,consts:[[1,"container"],[3,"type","content"],[3,"resourceType","resourceName","resourceUUID"],[4,"ngFor","ngForTrackById","ngForOf"],["class","row justify-content-center",4,"ngIf"],[3,"resourceType","resourceUUID","resourceName"],[4,"ngIf"],[1,"card","auth-bitstream-container"],[1,"card-header"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"card-body",3,"id","ngbCollapse"],[1,"row","justify-content-center"],["type","button",1,"btn","btn-link",3,"click"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"ds-alert",1)(2,"ds-resource-policies",2),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275template(5,ji,4,6,"ng-container",3),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275template(7,Ui,4,3,"div",4),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("type","alert-info")("content","item.edit.authorizations.heading"),e.\u0275\u0275advance(1),e.\u0275\u0275property("resourceType","item")("resourceName",e.\u0275\u0275pipeBind1(3,7,n.getItemName()))("resourceUUID",e.\u0275\u0275pipeBind1(4,9,n.getItemUUID())),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(6,11,n.bundles$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.allBundlesLoaded))},dependencies:[p.sg,p.O5,Pi.w,Ti.$,Di.F,u._D,p.Ov,b.X$],styles:[".auth-bitstream-container[_ngcontent-%COMP%]{margin-top:-1em;margin-bottom:1.5em}"]}),i})();var We=r(84535),Ne=r(37161),Fi=r(60740),Vi=r(50269),Ai=r(26728),Z=r(80647),W=r(66377),V=r(21654),A=r(35794),R=r(80978),L=r(38123);let ke=(()=>{class i extends W.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,v.of)(R.i.ReinstateItem)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(V.o),e.\u0275\u0275inject(A._),e.\u0275\u0275inject(d.F0),e.\u0275\u0275inject(L.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Ge=(()=>{class i extends W.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,v.of)(R.i.WithdrawItem)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(V.o),e.\u0275\u0275inject(A._),e.\u0275\u0275inject(d.F0),e.\u0275\u0275inject(L.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),He=(()=>{class i extends W.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,v.of)(R.i.CanEditMetadata)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(V.o),e.\u0275\u0275inject(A._),e.\u0275\u0275inject(d.F0),e.\u0275\u0275inject(L.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Li=r(12002),zi=r(2715);let Xe=(()=>{class i extends zi.q{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureIDs(t,n){return(0,v.of)([R.i.CanManageMappings,R.i.WithdrawItem,R.i.ReinstateItem,R.i.CanManagePolicies,R.i.CanMakePrivate,R.i.CanDelete,R.i.CanMove,R.i.CanRegisterDOI])}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(V.o),e.\u0275\u0275inject(A._),e.\u0275\u0275inject(d.F0),e.\u0275\u0275inject(L.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Qe=(()=>{class i extends W.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,v.of)(R.i.CanManageBitstreamBundles)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(V.o),e.\u0275\u0275inject(A._),e.\u0275\u0275inject(d.F0),e.\u0275\u0275inject(L.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Je=(()=>{class i extends W.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,v.of)(R.i.CanManageRelationships)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(V.o),e.\u0275\u0275inject(A._),e.\u0275\u0275inject(d.F0),e.\u0275\u0275inject(L.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Ze=(()=>{class i extends W.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,v.of)(R.i.CanManageVersions)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(V.o),e.\u0275\u0275inject(A._),e.\u0275\u0275inject(d.F0),e.\u0275\u0275inject(L.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Ye=(()=>{class i extends W.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,v.of)(R.i.CanManageMappings)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(V.o),e.\u0275\u0275inject(A._),e.\u0275\u0275inject(d.F0),e.\u0275\u0275inject(L.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),qe=(()=>{class i extends W.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,v.of)(R.i.AdministratorOf)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(V.o),e.\u0275\u0275inject(A._),e.\u0275\u0275inject(d.F0),e.\u0275\u0275inject(L.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),et=(()=>{class i extends W.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,v.of)(R.i.AdministratorOf)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(V.o),e.\u0275\u0275inject(A._),e.\u0275\u0275inject(d.F0),e.\u0275\u0275inject(L.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Ki=r(36376);let tt=(()=>{class i extends W.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,v.of)(R.i.CanRegisterDOI)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(V.o),e.\u0275\u0275inject(A._),e.\u0275\u0275inject(d.F0),e.\u0275\u0275inject(L.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Wi=r(62583);function Ni(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-curation-form",2),2&i){const t=s.ngIf;e.\u0275\u0275property("dsoHandle",null==t?null:t.payload.handle)}}const ki=function(i){return{item:i}};let Gi=(()=>{class i{constructor(t,n){this.route=t,this.dsoNameService=n}ngOnInit(){this.dsoRD$=this.route.parent.data.pipe((0,D.q)(1),(0,c.U)(t=>t.dso)),this.itemName$=this.dsoRD$.pipe((0,J.h)(t=>(0,h.Uh)(t)),(0,c.U)(t=>this.dsoNameService.getName(t.payload)))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(d.gz),e.\u0275\u0275directiveInject(ae._))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-curate"]],decls:7,vars:11,consts:[[1,"container","mt-3"],[3,"dsoHandle",4,"ngIf"],[3,"dsoHandle"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"h3"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,Ni,1,1,"ds-curation-form",1),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(3,2,"item.edit.curate.title",e.\u0275\u0275pureFunction1(9,ki,e.\u0275\u0275pipeBind1(4,5,n.itemName$)))),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(6,7,n.dsoRD$)))},dependencies:[p.O5,Wi._,p.Ov,b.X$],encapsulation:2}),i})();var Hi=r(4682);function Xi(i,s){}const Qi=["*"];let Ji=(()=>{class i extends Hi.F{getComponentName(){return"ItemStatusComponent"}importThemedComponent(t){return r(92977)(`./${t}/app/item-page/edit-item-page/item-status/item-status.component`)}importUnthemedComponent(){return r.e(8592).then(r.bind(r,52097))}}return i.\u0275fac=function(){let s;return function(n){return(s||(s=e.\u0275\u0275getInheritedFactory(i)))(n||i)}}(),i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-themed-item-status"]],features:[e.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:Qi,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(t,n){1&t&&(e.\u0275\u0275projectionDef(),e.\u0275\u0275template(0,Xi,0,0,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(2,"div",null,1),e.\u0275\u0275projection(4),e.\u0275\u0275elementEnd())},encapsulation:2}),i})();var Zi=r(62467);function Yi(i,s){1&i&&e.\u0275\u0275element(0,"ds-access-control-form-container",1),2&i&&e.\u0275\u0275property("itemRD",s.ngIf)("showLimitToSpecificBitstreams",!0)}let qi=(()=>{class i{constructor(t){this.route=t}ngOnInit(){this.itemRD$=this.route.parent.parent.data.pipe((0,c.U)(t=>t.dso)).pipe((0,_.xw)())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(d.gz))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-access-control"]],decls:2,vars:3,consts:[["titleMessage","item-access-control-title",3,"itemRD","showLimitToSpecificBitstreams",4,"ngIf"],["titleMessage","item-access-control-title",3,"itemRD","showLimitToSpecificBitstreams"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,Yi,1,2,"ds-access-control-form-container",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,n.itemRD$))},dependencies:[p.O5,Zi.x,p.Ov]}),i})(),ea=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({providers:[Ae.t,Ai.d,Ne.b,We.a,ke,Ge,Li.F,He,qe,Xe,Qe,Je,Ze,Ye,et,tt],imports:[d.Bz.forChild([{path:"",resolve:{breadcrumb:Ae.t},data:{breadcrumbKey:"item.edit"},children:[{path:"",component:q,children:[{path:"",redirectTo:"status",pathMatch:"full"},{path:"status",component:Ji,data:{title:"item.edit.tabs.status.title",showBreadcrumbs:!0},canActivate:[Xe]},{path:"bitstreams",component:vn,data:{title:"item.edit.tabs.bitstreams.title",showBreadcrumbs:!0},canActivate:[Qe]},{path:"metadata",component:Ki.w,data:{title:"item.edit.tabs.metadata.title",showBreadcrumbs:!0},canActivate:[He]},{path:"curate",component:Gi,data:{title:"item.edit.tabs.curate.title",showBreadcrumbs:!0},canActivate:[qe]},{path:"relationships",component:Ci,data:{title:"item.edit.tabs.relationships.title",showBreadcrumbs:!0},canActivate:[Je]},{path:"versionhistory",component:Mi,data:{title:"item.edit.tabs.versionhistory.title",showBreadcrumbs:!0},canActivate:[Ze]},{path:"access-control",component:qi,data:{title:"item.edit.tabs.access-control.title",showBreadcrumbs:!0},canActivate:[et]},{path:"mapper",component:Ue,data:{title:"item.edit.tabs.item-mapper.title",showBreadcrumbs:!0},canActivate:[Ye]}]},{path:"mapper",component:Ue},{path:Z.M0,component:he,canActivate:[Ge]},{path:Z.Pu,component:it,canActivate:[ke]},{path:Z.X$,component:ot},{path:Z.dI,component:ct},{path:Z.kJ,component:yt},{path:Z.Gr,component:Un,data:{title:"item.edit.move.title"}},{path:Z.Js,component:Ln,canActivate:[tt],data:{title:"item.edit.register-doi.title"}},{path:Z.N,children:[{path:"create",resolve:{resourcePolicyTarget:We.a},component:Fi.v,data:{title:"resource-policies.create.page.title"}},{path:"edit",resolve:{resourcePolicy:Ne.b},component:Vi.x,data:{title:"resource-policies.edit.page.title"}},{path:"",component:$i,data:{title:"item.edit.authorizations.title"}}]}]}])]}),i})();var ta=r(94979),na=r(54131),ia=r(18345),aa=r(1543),ra=r(76814),oa=r(93682);let sa=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({providers:[be.b,$e.m,me.g],imports:[p.ez,f.m,u.HK,ea,ta.q,le._t,na.q,u.IJ,ia.N,aa.Z,ra.I,oa.J]}),i})()},12002:(P,x,r)=>{"use strict";r.d(x,{F:()=>h});var p=r(35794),u=r(21654),f=r(66377),d=r(9237),C=r(80978),v=r(38123),g=r(98678),c=r(67522);let h=(()=>{class I extends f.h{constructor(b,O,S,w){super(b,O,S,w),this.resolver=b,this.authorizationService=O,this.router=S,this.authService=w}getFeatureID(b,O){return(0,d.of)(C.i.AdministratorOf)}}return I.\u0275fac=function(b){return new(b||I)(g.\u0275\u0275inject(u.o),g.\u0275\u0275inject(p._),g.\u0275\u0275inject(c.F0),g.\u0275\u0275inject(v.e8))},I.\u0275prov=g.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac,providedIn:"root"}),I})()},21654:(P,x,r)=>{"use strict";r.d(x,{o:()=>h});var p=r(29442),u=r(48358),f=r(45608),d=r(15463),C=r(92127),v=r(98678),g=r(89702),c=r(67522);let h=(()=>{class I extends C.I{constructor(b,O,S){super(b,O,S),this.itemService=b,this.store=O,this.router=S}resolve(b,O){return super.resolve(b,O).pipe((0,u.U)(S=>{if(S.hasSucceeded&&(0,f.Uh)(S.payload)){const w=O.url,k=this.router.parseUrl((0,d.Tt)(S.payload)).toString();if(!w.startsWith(k)){const j=S.payload.uuid,q=w.substring(w.indexOf(j)+j.length,w.length);this.router.navigateByUrl(k+q)}}return S}))}}return I.\u0275fac=function(b){return new(b||I)(v.\u0275\u0275inject(p.S),v.\u0275\u0275inject(g.yh),v.\u0275\u0275inject(c.F0))},I.\u0275prov=v.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac}),I})()},92127:(P,x,r)=>{"use strict";r.d(x,{H:()=>c,I:()=>h});var p=r(29442),u=r(46533),f=r(10572),d=r(28452),C=r(98678),v=r(89702),g=r(67522);const c=[(0,u.l)("owningCollection",{},(0,u.l)("parentCommunity",{},(0,u.l)("parentCommunity"))),(0,u.l)("relationships"),(0,u.l)("version",{},(0,u.l)("versionhistory")),(0,u.l)("thumbnail")];let h=(()=>{class I{constructor(b,O,S){this.itemService=b,this.store=O,this.router=S}resolve(b,O){const S=this.itemService.findById(b.params.id,!0,!1,...c).pipe((0,f.hC)());return S.subscribe(w=>{this.store.dispatch(new d.K(O.url,w.payload))}),S}}return I.\u0275fac=function(b){return new(b||I)(C.\u0275\u0275inject(p.S),C.\u0275\u0275inject(v.yh),C.\u0275\u0275inject(g.F0))},I.\u0275prov=C.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac}),I})()},18345:(P,x,r)=>{"use strict";r.d(x,{N:()=>v});var p=r(57999),d=(r(36482),r(56766),r(98678));let v=(()=>{class g{}return g.\u0275fac=function(h){return new(h||g)},g.\u0275mod=d.\u0275\u0275defineNgModule({type:g}),g.\u0275inj=d.\u0275\u0275defineInjector({imports:[p.m]}),g})()},31330:(P,x,r)=>{"use strict";r.d(x,{B:()=>u});var p=r(98678);let u=(()=>{class f{canActivate(C,v){return C.data={title:C.params.configuration+".search.title"},!0}}return f.\u0275fac=function(C){return new(C||f)},f.\u0275prov=p.\u0275\u0275defineInjectable({token:f,factory:f.\u0275fac}),f})()},9770:(P,x,r)=>{"use strict";r.r(x),r.d(x,{SearchPageComponent:()=>C});var p=r(55963),u=r(27496),f=r(98678),d=r(52651);let C=(()=>{class v{}return v.\u0275fac=function(c){return new(c||v)},v.\u0275cmp=f.\u0275\u0275defineComponent({type:v,selectors:[["ds-search-page"]],features:[f.\u0275\u0275ProvidersFeature([{provide:p.SEARCH_CONFIG_SERVICE,useClass:u.U}])],decls:1,vars:2,consts:[[3,"showCsvExport","trackStatistics"]],template:function(c,h){1&c&&f.\u0275\u0275element(0,"ds-themed-search",0),2&c&&f.\u0275\u0275property("showCsvExport",!0)("trackStatistics",!0)},dependencies:[d.l],encapsulation:2}),v})()},94979:(P,x,r)=>{"use strict";r.d(x,{q:()=>k});var p=r(35103),u=r(59058),f=r(57999),d=r(8369),C=r(31330),v=r(20357),c=(r(9770),r(58055)),h=r(27496),I=r(40472),e=r(76844),O=(r(11411),r(29419)),S=r(98678);let k=(()=>{class j{}return j.\u0275fac=function(M){return new(M||j)},j.\u0275mod=S.\u0275\u0275defineNgModule({type:j}),j.\u0275inj=S.\u0275\u0275defineInjector({providers:[d.P,c.nJ,C.B,h.U],imports:[p.ez,O.t,f.m.withEntryComponents(),u.IR.forRoot(),v.p.forRoot(),I.x.withEntryComponents(),e.a.withEntryComponents()]}),j})()},11411:(P,x,r)=>{"use strict";r.d(x,{m:()=>C});var p=r(4682),u=r(98678);function f(v,g){}const d=["*"];let C=(()=>{class v extends p.F{getComponentName(){return"SearchPageComponent"}importThemedComponent(c){return r(217)(`./${c}/app/search-page/search-page.component`)}importUnthemedComponent(){return Promise.resolve().then(r.bind(r,9770))}}return v.\u0275fac=function(){let g;return function(h){return(g||(g=u.\u0275\u0275getInheritedFactory(v)))(h||v)}}(),v.\u0275cmp=u.\u0275\u0275defineComponent({type:v,selectors:[["ds-themed-search-page"]],features:[u.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:d,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(c,h){1&c&&(u.\u0275\u0275projectionDef(),u.\u0275\u0275template(0,f,0,0,"ng-template",null,0,u.\u0275\u0275templateRefExtractor),u.\u0275\u0275elementStart(2,"div",null,1),u.\u0275\u0275projection(4),u.\u0275\u0275elementEnd())},encapsulation:2}),v})()},93682:(P,x,r)=>{"use strict";r.d(x,{J:()=>g});var p=r(35103),u=r(96342),f=r(1599),d=r(57999),C=r(65706),v=r(98678);let g=(()=>{class c{}return c.\u0275fac=function(I){return new(I||c)},c.\u0275mod=v.\u0275\u0275defineNgModule({type:c}),c.\u0275inj=v.\u0275\u0275defineInjector({imports:[p.ez,d.m,u.aw,f.S,C.M]}),c})()},26442:(P,x,r)=>{var p={"./custom/app/dso-shared/dso-edit-metadata/dso-edit-metadata.component":[62511,2984,8592,2511]};function u(f){if(!r.o(p,f))return Promise.resolve().then(()=>{var v=new Error("Cannot find module '"+f+"'");throw v.code="MODULE_NOT_FOUND",v});var d=p[f],C=d[0];return Promise.all(d.slice(1).map(r.e)).then(()=>r(C))}u.keys=()=>Object.keys(p),u.id=26442,P.exports=u},92977:(P,x,r)=>{var p={"./custom/app/item-page/edit-item-page/item-status/item-status.component":[6744,8592,6744]};function u(f){if(!r.o(p,f))return Promise.resolve().then(()=>{var v=new Error("Cannot find module '"+f+"'");throw v.code="MODULE_NOT_FOUND",v});var d=p[f],C=d[0];return Promise.all(d.slice(1).map(r.e)).then(()=>r(C))}u.keys=()=>Object.keys(p),u.id=92977,P.exports=u},217:(P,x,r)=>{var p={"./custom/app/search-page/search-page.component":[46239,6239]};function u(f){if(!r.o(p,f))return Promise.resolve().then(()=>{var v=new Error("Cannot find module '"+f+"'");throw v.code="MODULE_NOT_FOUND",v});var d=p[f],C=d[0];return r.e(d[1]).then(()=>r(C))}u.keys=()=>Object.keys(p),u.id=217,P.exports=u}}]);