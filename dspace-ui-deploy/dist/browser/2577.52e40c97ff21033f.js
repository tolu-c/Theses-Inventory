(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[2577],{37920:(q,z,t)=>{"use strict";t.d(z,{w:()=>k});var X,i=t(70655),l=t(10102),d=t(6952),e=t(18005),p=t(55624),S=t(13604),o=t(16066),T=t(1411),L=t(98678);let k=((X=class extends l.o{constructor(D,c,M,A){super("submissionuploads",D,c,M,A),this.requestService=D,this.rdbService=c,this.objectCache=M,this.halService=A}findByHref(D,c=!0,M=!0,...A){return super.findByHref(D,c,M,...A)}}).\u0275fac=function(D){return new(D||X)(L.\u0275\u0275inject(d.s),L.\u0275\u0275inject(o.Q),L.\u0275\u0275inject(p.a),L.\u0275\u0275inject(e.q))},X.\u0275prov=L.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac}),X);k=(0,i.__decorate)([(0,T.cQ)(S.fB),(0,i.__metadata)("design:paramtypes",[d.s,o.Q,p.a,e.q])],k)},60030:(q,z,t)=>{"use strict";t.d(z,{K:()=>d});var i=t(45608),l=t(65521);class d extends l.R{constructor(p,...S){super(p,...S),this._rootElement=p,this._subRootElement=S.join("/")}get rootElement(){return this._rootElement}get subRootElement(){return this._subRootElement}getPath(p){(0,i.pT)(p)&&Array.isArray(p)&&(p=p.join("/"));let S="/"+this.toString();return(0,i.pT)(p)&&(S+="/"+p),{rootElement:this._rootElement,subRootElement:this._subRootElement,path:S}}}},44918:(q,z,t)=>{"use strict";t.r(z),t.d(z,{SubmissionEditComponent:()=>A});var i=t(35841),l=t(21160),d=t(77007),e=t(3358),p=t(45608),S=t(1579),o=t(65384),T=t(10572),L=t(29442),X=t(11915),k=t(97176),f=t(98678),D=t(67522),c=t(96342),M=t(86183);let A=(()=>{class V{constructor(G,N,_,O,b,I,$,w){this.changeDetectorRef=G,this.notificationsService=N,this.route=_,this.router=O,this.itemDataService=b,this.submissionService=I,this.translate=$,this.submissionJsonPatchOperationsService=w,this.collectionModifiable=null,this.subs=[],this.itemLink$=new i.X(void 0)}ngOnInit(){this.collectionModifiable=this.route.snapshot.data?.collectionModifiable??null,this.subs.push(this.route.paramMap.pipe((0,l.w)(G=>this.submissionService.retrieveSubmission(G.get("id"))),(0,d.h)(G=>(0,p.K0)(G))).subscribe(G=>{if(G.hasSucceeded)if((0,p.xb)(G.payload))this.notificationsService.info(null,this.translate.get("submission.general.cannot_submit")),this.router.navigate(["/mydspace"]);else{const{errors:N}=G.payload;this.submissionErrors=(0,k.Z)(N),this.submissionId=G.payload.id.toString(),this.collectionId=G.payload.collection.id,this.selfUrl=G.payload._links.self.href,this.sections=G.payload.sections,this.itemLink$.next(G.payload._links.item.href),this.item=G.payload.item,this.submissionDefinition=G.payload.submissionDefinition}else 404===G.statusCode&&this.router.navigate(["/404"],{skipLocationChange:!0})}),this.itemLink$.pipe((0,p.iy)(),(0,l.w)(G=>this.itemDataService.findByHref(G)),(0,T.g1)(),(0,e.b)(300)).subscribe(G=>{this.item=G.payload,this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subs.filter(G=>(0,p.Uh)(G)).forEach(G=>G.unsubscribe()),this.submissionJsonPatchOperationsService.deletePendingJsonPatchOperations()}}return V.\u0275fac=function(G){return new(G||V)(f.\u0275\u0275directiveInject(f.ChangeDetectorRef),f.\u0275\u0275directiveInject(o.T),f.\u0275\u0275directiveInject(D.gz),f.\u0275\u0275directiveInject(D.F0),f.\u0275\u0275directiveInject(L.S),f.\u0275\u0275directiveInject(S.b),f.\u0275\u0275directiveInject(c.sK),f.\u0275\u0275directiveInject(X.E))},V.\u0275cmp=f.\u0275\u0275defineComponent({type:V,selectors:[["ds-submission-edit"]],decls:2,vars:8,consts:[[1,"submission-submit-container"],[3,"collectionId","sections","selfUrl","submissionDefinition","submissionErrors","item","collectionModifiable","submissionId"]],template:function(G,N){1&G&&(f.\u0275\u0275elementStart(0,"div",0),f.\u0275\u0275element(1,"ds-submission-form",1),f.\u0275\u0275elementEnd()),2&G&&(f.\u0275\u0275advance(1),f.\u0275\u0275property("collectionId",N.collectionId)("sections",N.sections)("selfUrl",N.selfUrl)("submissionDefinition",N.submissionDefinition)("submissionErrors",N.submissionErrors)("item",N.item)("collectionModifiable",N.collectionModifiable)("submissionId",N.submissionId))},dependencies:[M.G]}),V})()},97359:(q,z,t)=>{"use strict";t.d(z,{I:()=>p});var i=t(4682),l=t(98678);function d(S,o){}const e=["*"];let p=(()=>{class S extends i.F{getComponentName(){return"SubmissionEditComponent"}importThemedComponent(T){return t(8377)(`./${T}/app/submission/edit/submission-edit.component`)}importUnthemedComponent(){return Promise.resolve().then(t.bind(t,44918))}}return S.\u0275fac=function(){let o;return function(L){return(o||(o=l.\u0275\u0275getInheritedFactory(S)))(L||S)}}(),S.\u0275cmp=l.\u0275\u0275defineComponent({type:S,selectors:[["ds-themed-submission-edit"]],features:[l.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:e,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(T,L){1&T&&(l.\u0275\u0275projectionDef(),l.\u0275\u0275template(0,d,0,0,"ng-template",null,0,l.\u0275\u0275templateRefExtractor),l.\u0275\u0275elementStart(2,"div",null,1),l.\u0275\u0275projection(4),l.\u0275\u0275elementEnd())},encapsulation:2}),S})()},35273:(q,z,t)=>{"use strict";t.d(z,{z:()=>w});var i=t(98678),l=t(35841),d=t(9237),e=t(66154),p=t(48358),S=t(69637),o=t(45608),T=t(60030),L=t(78187),X=t(1579),k=t(11915),f=t(95445),D=t(52972),c=t(73797),M=t(10572),A=t(96289),V=t(8842),v=t(35103),G=t(65706),N=t(19829),_=t(96342);function O(m,C){if(1&m&&(i.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"span",4),i.\u0275\u0275text(3),i.\u0275\u0275pipe(4,"translate"),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(5,"div",5)(6,"span",4),i.\u0275\u0275text(7),i.\u0275\u0275pipe(8,"async"),i.\u0275\u0275elementEnd()()()),2&m){const h=i.\u0275\u0275nextContext();i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(4,2,"submission.sections.general.collection")),i.\u0275\u0275advance(4),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(8,4,h.selectedCollectionName$))}}function b(m,C){1&m&&(i.\u0275\u0275elementStart(0,"span"),i.\u0275\u0275element(1,"i",13),i.\u0275\u0275elementEnd())}function I(m,C){if(1&m&&(i.\u0275\u0275elementStart(0,"span"),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"async"),i.\u0275\u0275elementEnd()),2&m){const h=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(1),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(2,1,h.selectedCollectionName$))}}function $(m,C){if(1&m){const h=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",6,7),i.\u0275\u0275listener("openChange",function(W){i.\u0275\u0275restoreView(h);const se=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(se.toggled(W))}),i.\u0275\u0275elementStart(2,"div",3)(3,"span",8),i.\u0275\u0275text(4),i.\u0275\u0275pipe(5,"translate"),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(6,"button",9),i.\u0275\u0275listener("blur",function(){i.\u0275\u0275restoreView(h);const W=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(W.onClose())})("click",function(){i.\u0275\u0275restoreView(h);const W=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(W.onClose())}),i.\u0275\u0275pipe(7,"async"),i.\u0275\u0275template(8,b,2,0,"span",10),i.\u0275\u0275pipe(9,"async"),i.\u0275\u0275template(10,I,3,3,"span",10),i.\u0275\u0275pipe(11,"async"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(12,"div",11)(13,"ds-themed-collection-dropdown",12),i.\u0275\u0275listener("selectionChange",function(W){i.\u0275\u0275restoreView(h);const se=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(se.onSelect(W))}),i.\u0275\u0275elementEnd()()()}if(2&m){const h=i.\u0275\u0275nextContext();i.\u0275\u0275advance(4),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(5,4,"submission.sections.general.collection")," "),i.\u0275\u0275advance(2),i.\u0275\u0275property("disabled",i.\u0275\u0275pipeBind1(7,6,h.processingChange$)||0==h.collectionModifiable||h.isReadonly),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",i.\u0275\u0275pipeBind1(9,8,h.processingChange$)),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",!i.\u0275\u0275pipeBind1(11,10,h.processingChange$))}}let w=(()=>{class m{constructor(h,F,W,se,U,R,g){this.cdr=h,this.collectionDataService=F,this.operationsBuilder=W,this.operationsService=se,this.submissionService=U,this.sectionsService=R,this.dsoNameService=g,this.collectionModifiable=null,this.isReadonly=!1,this.collectionChange=new i.EventEmitter,this.processingChange$=new l.X(!1),this.subs=[]}ngOnChanges(h){(0,o.Uh)(h.currentCollectionId)&&(0,o.Uh)(h.currentCollectionId.currentValue)&&(this.selectedCollectionId=this.currentCollectionId,this.selectedCollectionName$=this.collectionDataService.findById(this.currentCollectionId).pipe((0,e.s)(F=>(0,o.UE)(F.payload)),(0,p.U)(F=>this.dsoNameService.getName(F.payload))))}ngOnInit(){this.pathCombiner=new T.K("sections","collection"),this.available$=this.sectionsService.isSectionTypeAvailable(this.submissionId,A.i.collection)}ngOnDestroy(){this.subs.filter(h=>(0,o.Uh)(h)).forEach(h=>h.unsubscribe())}onSelect(h){this.processingChange$.next(!0),this.operationsBuilder.replace(this.pathCombiner.getPath(),h.collection.id,!0),this.subs.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections","collection").pipe((0,S.z)(F=>this.submissionService.retrieveSubmission(F[0].id).pipe((0,M.Gp)()))).subscribe(F=>{this.selectedCollectionId=h.collection.id,this.selectedCollectionName$=(0,d.of)(h.collection.name),this.collectionChange.emit(F),this.submissionService.changeSubmissionCollection(this.submissionId,h.collection.id),this.processingChange$.next(!1),this.cdr.detectChanges()}))}onClose(){this.collectionDropdown?.reset()}toggled(h){h||this.collectionDropdown?.reset()}}return m.\u0275fac=function(h){return new(h||m)(i.\u0275\u0275directiveInject(i.ChangeDetectorRef),i.\u0275\u0275directiveInject(f.W),i.\u0275\u0275directiveInject(L.w),i.\u0275\u0275directiveInject(k.E),i.\u0275\u0275directiveInject(X.b),i.\u0275\u0275directiveInject(c.J),i.\u0275\u0275directiveInject(V._))},m.\u0275cmp=i.\u0275\u0275defineComponent({type:m,selectors:[["ds-submission-form-collection"]],viewQuery:function(h,F){if(1&h&&i.\u0275\u0275viewQuery(D.CollectionDropdownComponent,5),2&h){let W;i.\u0275\u0275queryRefresh(W=i.\u0275\u0275loadQuery())&&(F.collectionDropdown=W.first)}},inputs:{currentCollectionId:"currentCollectionId",currentDefinition:"currentDefinition",collectionModifiable:"collectionModifiable",submissionId:"submissionId",isReadonly:"isReadonly"},outputs:{collectionChange:"collectionChange"},features:[i.\u0275\u0275NgOnChangesFeature],decls:5,vars:6,consts:[["class","input-group mb-3",4,"ngIf"],["ngbDropdown","","class","btn-group input-group",3,"openChange",4,"ngIf"],[1,"input-group","mb-3"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"input-group-append"],["ngbDropdown","",1,"btn-group","input-group",3,"openChange"],["collectionControls","ngbDropdown"],["id","collectionControlsMenuLabel",1,"input-group-text"],["aria-describedby","collectionControlsMenuLabel","id","collectionControlsMenuButton","ngbDropdownToggle","",1,"btn","btn-outline-primary",3,"disabled","blur","click"],[4,"ngIf"],["ngbDropdownMenu","","id","collectionControlsDropdownMenu","aria-labelledby","collectionControlsMenuButton",1,"dropdown-menu"],[3,"selectionChange"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(h,F){1&h&&(i.\u0275\u0275elementStart(0,"div"),i.\u0275\u0275template(1,O,9,6,"div",0),i.\u0275\u0275pipe(2,"async"),i.\u0275\u0275template(3,$,14,12,"div",1),i.\u0275\u0275pipe(4,"async"),i.\u0275\u0275elementEnd()),2&h&&(i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",!i.\u0275\u0275pipeBind1(2,2,F.available$)),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",i.\u0275\u0275pipeBind1(4,4,F.available$)))},dependencies:[v.O5,G.jt,G.iD,G.Vi,N.t,v.Ov,_.X$],styles:[".scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}.collection-item[_ngcontent-%COMP%]{border-bottom:var(--bs-dropdown-border-width) solid var(--bs-dropdown-border-color)}#collectionControlsDropdownMenu[_ngcontent-%COMP%]{left:0!important}#collectionControlsDropdownMenu[_ngcontent-%COMP%]{outline:0;box-shadow:var(--bs-btn-focus-box-shadow)}"]}),m})()},71532:(q,z,t)=>{"use strict";t.d(z,{z:()=>_});var i=t(9237),l=t(48358),d=t(53597),e=t(1579),p=t(94056),S=t(45608),o=t(98678),T=t(65706),L=t(35103),X=t(7027),k=t(96342);function f(O,b){if(1&O){const I=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"button",13),o.\u0275\u0275listener("click",function(w){o.\u0275\u0275restoreView(I);const m=o.\u0275\u0275nextContext(2),C=o.\u0275\u0275reference(2);return w.preventDefault(),o.\u0275\u0275resetView(m.confirmDiscard(C))}),o.\u0275\u0275pipe(1,"dsBrowserOnly"),o.\u0275\u0275pipe(2,"async"),o.\u0275\u0275pipe(3,"async"),o.\u0275\u0275element(4,"i",14),o.\u0275\u0275text(5),o.\u0275\u0275pipe(6,"translate"),o.\u0275\u0275elementEnd()}if(2&O){const I=o.\u0275\u0275nextContext(2);o.\u0275\u0275property("disabled",o.\u0275\u0275pipeBind1(2,5,I.processingSaveStatus)||o.\u0275\u0275pipeBind1(3,7,I.processingDepositStatus)),o.\u0275\u0275attribute("data-test",o.\u0275\u0275pipeBind1(1,3,"discard")),o.\u0275\u0275advance(5),o.\u0275\u0275textInterpolate1(" ",o.\u0275\u0275pipeBind1(6,9,"submission.general.discard.submit")," ")}}function D(O,b){1&O&&(o.\u0275\u0275elementStart(0,"span"),o.\u0275\u0275element(1,"i",15),o.\u0275\u0275text(2),o.\u0275\u0275pipe(3,"translate"),o.\u0275\u0275elementEnd()),2&O&&(o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate1(" ",o.\u0275\u0275pipeBind1(3,1,"submission.general.info.saved")," "))}function c(O,b){1&O&&(o.\u0275\u0275elementStart(0,"span"),o.\u0275\u0275element(1,"i",16),o.\u0275\u0275text(2),o.\u0275\u0275pipe(3,"translate"),o.\u0275\u0275elementEnd()),2&O&&(o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate1(" ",o.\u0275\u0275pipeBind1(3,1,"submission.general.info.pending-changes")," "))}function M(O,b){1&O&&(o.\u0275\u0275elementStart(0,"div",20),o.\u0275\u0275text(1,"Saving..."),o.\u0275\u0275elementEnd()),2&O&&o.\u0275\u0275styleProp("width","100%")}function A(O,b){1&O&&(o.\u0275\u0275elementStart(0,"div",20),o.\u0275\u0275text(1,"Depositing..."),o.\u0275\u0275elementEnd()),2&O&&o.\u0275\u0275styleProp("width","100%")}function V(O,b){if(1&O&&(o.\u0275\u0275elementStart(0,"div",17)(1,"div",18),o.\u0275\u0275template(2,M,2,2,"div",19),o.\u0275\u0275pipe(3,"async"),o.\u0275\u0275template(4,A,2,2,"div",19),o.\u0275\u0275pipe(5,"async"),o.\u0275\u0275elementEnd()()),2&O){const I=o.\u0275\u0275nextContext(2);o.\u0275\u0275advance(2),o.\u0275\u0275property("ngIf",o.\u0275\u0275pipeBind1(3,2,I.processingSaveStatus)),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngIf",o.\u0275\u0275pipeBind1(5,4,I.processingDepositStatus))}}function v(O,b){if(1&O){const I=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"button",21),o.\u0275\u0275listener("click",function(w){o.\u0275\u0275restoreView(I);const m=o.\u0275\u0275nextContext(2);return o.\u0275\u0275resetView(m.deposit(w))}),o.\u0275\u0275pipe(1,"dsBrowserOnly"),o.\u0275\u0275pipe(2,"async"),o.\u0275\u0275pipe(3,"async"),o.\u0275\u0275elementStart(4,"span"),o.\u0275\u0275element(5,"i",22),o.\u0275\u0275text(6),o.\u0275\u0275pipe(7,"translate"),o.\u0275\u0275elementEnd()()}if(2&O){const I=o.\u0275\u0275nextContext(2);o.\u0275\u0275property("disabled",o.\u0275\u0275pipeBind1(2,5,I.processingSaveStatus)||o.\u0275\u0275pipeBind1(3,7,I.processingDepositStatus)),o.\u0275\u0275attribute("data-test",o.\u0275\u0275pipeBind1(1,3,"deposit")),o.\u0275\u0275advance(6),o.\u0275\u0275textInterpolate1(" ",o.\u0275\u0275pipeBind1(7,9,"submission.general.deposit"),"")}}function G(O,b){if(1&O){const I=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"div",2)(1,"div",3),o.\u0275\u0275template(2,f,7,11,"button",4),o.\u0275\u0275pipe(3,"async"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(4,"div",5),o.\u0275\u0275template(5,D,4,3,"span",6),o.\u0275\u0275pipe(6,"async"),o.\u0275\u0275pipe(7,"async"),o.\u0275\u0275pipe(8,"async"),o.\u0275\u0275template(9,c,4,3,"span",6),o.\u0275\u0275pipe(10,"async"),o.\u0275\u0275pipe(11,"async"),o.\u0275\u0275pipe(12,"async"),o.\u0275\u0275template(13,V,6,6,"div",7),o.\u0275\u0275pipe(14,"async"),o.\u0275\u0275pipe(15,"async"),o.\u0275\u0275elementStart(16,"div",8)(17,"button",9),o.\u0275\u0275listener("click",function(w){o.\u0275\u0275restoreView(I);const m=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(m.save(w))}),o.\u0275\u0275pipe(18,"dsBrowserOnly"),o.\u0275\u0275pipe(19,"async"),o.\u0275\u0275pipe(20,"async"),o.\u0275\u0275elementStart(21,"span"),o.\u0275\u0275element(22,"i",10),o.\u0275\u0275text(23),o.\u0275\u0275pipe(24,"translate"),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(25,"button",11),o.\u0275\u0275listener("click",function(w){o.\u0275\u0275restoreView(I);const m=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(m.saveLater(w))}),o.\u0275\u0275pipe(26,"async"),o.\u0275\u0275pipe(27,"async"),o.\u0275\u0275pipe(28,"dsBrowserOnly"),o.\u0275\u0275pipe(29,"async"),o.\u0275\u0275pipe(30,"async"),o.\u0275\u0275elementStart(31,"span"),o.\u0275\u0275element(32,"i",10),o.\u0275\u0275text(33),o.\u0275\u0275pipe(34,"translate"),o.\u0275\u0275elementEnd()(),o.\u0275\u0275template(35,v,8,11,"button",12),o.\u0275\u0275pipe(36,"async"),o.\u0275\u0275elementEnd()()()}if(2&O){const I=o.\u0275\u0275nextContext();o.\u0275\u0275advance(2),o.\u0275\u0275property("ngIf",o.\u0275\u0275pipeBind1(3,15,I.showDepositAndDiscard)),o.\u0275\u0275advance(3),o.\u0275\u0275property("ngIf",!o.\u0275\u0275pipeBind1(6,17,I.hasUnsavedModification)&&!o.\u0275\u0275pipeBind1(7,19,I.processingSaveStatus)&&!o.\u0275\u0275pipeBind1(8,21,I.processingDepositStatus)),o.\u0275\u0275advance(4),o.\u0275\u0275property("ngIf",o.\u0275\u0275pipeBind1(10,23,I.hasUnsavedModification)&&!o.\u0275\u0275pipeBind1(11,25,I.processingSaveStatus)&&!o.\u0275\u0275pipeBind1(12,27,I.processingDepositStatus)),o.\u0275\u0275advance(4),o.\u0275\u0275property("ngIf",o.\u0275\u0275pipeBind1(14,29,I.processingSaveStatus)||o.\u0275\u0275pipeBind1(15,31,I.processingDepositStatus)),o.\u0275\u0275advance(4),o.\u0275\u0275property("disabled",o.\u0275\u0275pipeBind1(19,35,I.processingSaveStatus)||!o.\u0275\u0275pipeBind1(20,37,I.hasUnsavedModification)),o.\u0275\u0275attribute("data-test",o.\u0275\u0275pipeBind1(18,33,"save")),o.\u0275\u0275advance(6),o.\u0275\u0275textInterpolate1(" ",o.\u0275\u0275pipeBind1(24,39,"submission.general.save"),""),o.\u0275\u0275advance(2),o.\u0275\u0275classProp("btn-primary",!o.\u0275\u0275pipeBind1(26,41,I.showDepositAndDiscard))("btn-secondary",o.\u0275\u0275pipeBind1(27,43,I.showDepositAndDiscard)),o.\u0275\u0275property("disabled",o.\u0275\u0275pipeBind1(29,47,I.processingSaveStatus)||o.\u0275\u0275pipeBind1(30,49,I.processingDepositStatus)),o.\u0275\u0275attribute("data-test",o.\u0275\u0275pipeBind1(28,45,"save-for-later")),o.\u0275\u0275advance(8),o.\u0275\u0275textInterpolate1(" ",o.\u0275\u0275pipeBind1(34,51,"submission.general.save-later"),""),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngIf",o.\u0275\u0275pipeBind1(36,53,I.showDepositAndDiscard))}}function N(O,b){if(1&O){const I=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"div",23)(1,"h4",24),o.\u0275\u0275text(2),o.\u0275\u0275pipe(3,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(4,"button",25),o.\u0275\u0275listener("click",function(){const m=o.\u0275\u0275restoreView(I).dismiss;return o.\u0275\u0275resetView(m("cancel"))}),o.\u0275\u0275elementStart(5,"span",26),o.\u0275\u0275text(6,"\xd7"),o.\u0275\u0275elementEnd()()(),o.\u0275\u0275elementStart(7,"div",27)(8,"p"),o.\u0275\u0275text(9),o.\u0275\u0275pipe(10,"translate"),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(11,"div",28)(12,"button",29),o.\u0275\u0275listener("click",function(){const m=o.\u0275\u0275restoreView(I).close;return o.\u0275\u0275resetView(m("cancel"))}),o.\u0275\u0275text(13),o.\u0275\u0275pipe(14,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(15,"button",30),o.\u0275\u0275listener("click",function(){const m=o.\u0275\u0275restoreView(I).close;return o.\u0275\u0275resetView(m("ok"))}),o.\u0275\u0275text(16),o.\u0275\u0275pipe(17,"translate"),o.\u0275\u0275elementEnd()()}2&O&&(o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(3,4,"submission.general.discard.confirm.title")),o.\u0275\u0275advance(7),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(10,6,"submission.general.discard.confirm.info")),o.\u0275\u0275advance(4),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(14,8,"submission.general.discard.confirm.cancel")),o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(17,10,"submission.general.discard.confirm.submit")))}let _=(()=>{class O{constructor(I,$,w){this.modalService=I,this.restService=$,this.submissionService=w,this.submissionIsInvalid=(0,i.of)(!0)}ngOnChanges(I){(0,S.UE)(this.submissionId)&&(this.submissionIsInvalid=this.submissionService.getSubmissionStatus(this.submissionId).pipe((0,l.U)($=>!1===$)),this.processingSaveStatus=this.submissionService.getSubmissionSaveProcessingStatus(this.submissionId),this.processingDepositStatus=this.submissionService.getSubmissionDepositProcessingStatus(this.submissionId),this.showDepositAndDiscard=(0,i.of)(this.submissionService.getSubmissionScope()===p.S.WorkspaceItem),this.hasUnsavedModification=this.submissionService.hasUnsavedModification())}save(I){this.submissionService.dispatchSave(this.submissionId,!0)}saveLater(I){this.submissionService.dispatchSaveForLater(this.submissionId)}deposit(I){this.submissionService.dispatchDeposit(this.submissionId)}confirmDiscard(I){this.modalService.open(I).result.then($=>{"ok"===$&&this.submissionService.dispatchDiscard(this.submissionId)})}}return O.\u0275fac=function(I){return new(I||O)(o.\u0275\u0275directiveInject(T.FF),o.\u0275\u0275directiveInject(d.F),o.\u0275\u0275directiveInject(e.b))},O.\u0275cmp=o.\u0275\u0275defineComponent({type:O,selectors:[["ds-submission-form-footer"]],inputs:{submissionId:"submissionId"},features:[o.\u0275\u0275NgOnChangesFeature],decls:3,vars:1,consts:[["class","row",4,"ngIf"],["content",""],[1,"row"],[1,"col"],["type","button","id","discard","class","btn btn-danger",3,"disabled","click",4,"ngIf"],[1,"col","text-right","d-flex","justify-content-end","align-items-center"],[4,"ngIf"],["class","col d-flex justify-content-end align-items-center",4,"ngIf"],[1,"ml-2","space-children-mr"],["type","button","id","save",1,"btn","btn-secondary",3,"disabled","click"],[1,"fas","fa-save"],["type","button","id","saveForLater",1,"btn",3,"disabled","click"],["type","button","id","deposit","class","btn btn-success",3,"disabled","click",4,"ngIf"],["type","button","id","discard",1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-trash"],[1,"fas","fa-check-circle"],[1,"fas","fa-exclamation-circle"],[1,"col","d-flex","justify-content-end","align-items-center"],[1,"progress","w-75"],["class","progress-bar progress-bar-striped progress-bar-animated bg-info","role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",3,"width",4,"ngIf"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated","bg-info"],["type","button","id","deposit",1,"btn","btn-success",3,"disabled","click"],[1,"fas","fa-plus"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer","space-children-mr"],["type","button","id","discard_cancel",1,"btn","btn-secondary",3,"click"],["type","button","id","discard_submit",1,"btn","btn-danger",3,"click"]],template:function(I,$){1&I&&(o.\u0275\u0275template(0,G,37,55,"div",0),o.\u0275\u0275template(1,N,18,12,"ng-template",null,1,o.\u0275\u0275templateRefExtractor)),2&I&&o.\u0275\u0275property("ngIf",!!$.submissionId)},dependencies:[L.O5,L.Ov,X.g,k.X$]}),O})()},51104:(q,z,t)=>{"use strict";t.d(z,{i:()=>D});var i=t(48358),l=t(73797),d=t(79849),e=t(1579),p=t(98678),S=t(35103),o=t(65706),T=t(96342);const L=function(c){return{"w-100":c}};function X(c,M){if(1&c&&(p.\u0275\u0275elementContainerStart(0),p.\u0275\u0275elementStart(1,"button",6),p.\u0275\u0275pipe(2,"async"),p.\u0275\u0275text(3),p.\u0275\u0275pipe(4,"translate"),p.\u0275\u0275element(5,"i",7),p.\u0275\u0275elementEnd(),p.\u0275\u0275elementContainerEnd()),2&c){const A=p.\u0275\u0275nextContext();p.\u0275\u0275advance(1),p.\u0275\u0275property("ngClass",p.\u0275\u0275pureFunction1(6,L,p.\u0275\u0275pipeBind1(2,2,A.windowService.isXs()))),p.\u0275\u0275advance(2),p.\u0275\u0275textInterpolate1(" ",p.\u0275\u0275pipeBind1(4,4,"submission.sections.general.add-more")," ")}}function k(c,M){1&c&&(p.\u0275\u0275elementStart(0,"button",8),p.\u0275\u0275text(1),p.\u0275\u0275pipe(2,"translate"),p.\u0275\u0275elementEnd()),2&c&&(p.\u0275\u0275advance(1),p.\u0275\u0275textInterpolate1(" ",p.\u0275\u0275pipeBind1(2,1,"submission.sections.general.no-sections")," "))}function f(c,M){if(1&c){const A=p.\u0275\u0275getCurrentView();p.\u0275\u0275elementStart(0,"button",9),p.\u0275\u0275listener("click",function(){const G=p.\u0275\u0275restoreView(A).$implicit,N=p.\u0275\u0275nextContext();return p.\u0275\u0275resetView(N.addSection(G.id))}),p.\u0275\u0275text(1),p.\u0275\u0275pipe(2,"translate"),p.\u0275\u0275elementEnd()}if(2&c){const A=M.$implicit;p.\u0275\u0275advance(1),p.\u0275\u0275textInterpolate1(" ",p.\u0275\u0275pipeBind1(2,1,"submission.sections."+A.header)," ")}}let D=(()=>{class c{constructor(A,V,v){this.sectionService=A,this.submissionService=V,this.windowService=v}ngOnInit(){this.sectionList$=this.submissionService.getDisabledSectionsList(this.submissionId),this.hasSections$=this.sectionList$.pipe((0,i.U)(A=>A.length>0))}addSection(A){this.sectionService.addSection(this.submissionId,A)}}return c.\u0275fac=function(A){return new(A||c)(p.\u0275\u0275directiveInject(l.J),p.\u0275\u0275directiveInject(e.b),p.\u0275\u0275directiveInject(d.I))},c.\u0275cmp=p.\u0275\u0275defineComponent({type:c,selectors:[["ds-submission-form-section-add"]],inputs:{collectionId:"collectionId",submissionId:"submissionId"},decls:10,vars:17,consts:[["ngbDropdown","","placement","bottom-right",1,"d-inline-block",3,"ngClass"],["sectionAdd","ngbDropdown"],[4,"ngIf"],["ngbDropdownMenu","","aria-labelledby","sectionControls",1,"sections-dropdown-menu",3,"ngClass"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],["id","sectionControls","ngbDropdownToggle","",1,"btn","btn-outline-primary","dropdown-toggle",3,"ngClass"],["aria-hidden","true",1,"fa","fa-plus"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"]],template:function(A,V){1&A&&(p.\u0275\u0275elementStart(0,"div",0,1),p.\u0275\u0275template(2,X,6,8,"ng-container",2),p.\u0275\u0275pipe(3,"async"),p.\u0275\u0275elementStart(4,"div",3),p.\u0275\u0275pipe(5,"async"),p.\u0275\u0275template(6,k,3,3,"button",4),p.\u0275\u0275pipe(7,"async"),p.\u0275\u0275template(8,f,3,3,"button",5),p.\u0275\u0275pipe(9,"async"),p.\u0275\u0275elementEnd()()),2&A&&(p.\u0275\u0275property("ngClass",p.\u0275\u0275pureFunction1(13,L,V.windowService.isXs())),p.\u0275\u0275advance(2),p.\u0275\u0275property("ngIf",p.\u0275\u0275pipeBind1(3,5,V.hasSections$)),p.\u0275\u0275advance(2),p.\u0275\u0275property("ngClass",p.\u0275\u0275pureFunction1(15,L,p.\u0275\u0275pipeBind1(5,7,V.windowService.isXs()))),p.\u0275\u0275advance(2),p.\u0275\u0275property("ngIf",!p.\u0275\u0275pipeBind1(7,9,V.hasSections$)),p.\u0275\u0275advance(2),p.\u0275\u0275property("ngForOf",p.\u0275\u0275pipeBind1(9,11,V.sectionList$)))},dependencies:[S.mk,S.sg,S.O5,o.jt,o.iD,o.Vi,S.Ov,T.X$],styles:[".dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.sections-dropdown-menu[_ngcontent-%COMP%]{z-index:var(--ds-submission-header-z-index)}"]}),c})()},86183:(q,z,t)=>{"use strict";t.d(z,{G:()=>se});var i=t(9237),l=t(77007),d=t(48358),e=t(49887),p=t(21160),S=t(38123),T=(t(96187),t(18005)),L=t(45608),X=t(22170),k=t(1579),D=(t(13005),t(96289)),c=t(73797),M=t(99043),A=t(94667),V=t.n(A),v=t(98678),G=t(35103),N=t(87657),_=t(51104),O=t(35273),b=t(71532),I=t(49868),$=t(51437);function w(U,R){if(1&U&&(v.\u0275\u0275elementStart(0,"div",12),v.\u0275\u0275element(1,"ds-submission-upload-files",13)(2,"div",14),v.\u0275\u0275elementEnd()),2&U){const g=v.\u0275\u0275nextContext(2);v.\u0275\u0275advance(1),v.\u0275\u0275property("submissionId",g.submissionId)("collectionId",g.collectionId)("uploadFilesOptions",g.uploadFilesOptions)}}function m(U,R){if(1&U){const g=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementContainerStart(0),v.\u0275\u0275elementStart(1,"ds-submission-form-collection",15),v.\u0275\u0275listener("collectionChange",function(j){v.\u0275\u0275restoreView(g);const K=v.\u0275\u0275nextContext(2);return v.\u0275\u0275resetView(K.onCollectionChange(j))}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementContainerEnd()}if(2&U){const g=v.\u0275\u0275nextContext(2);v.\u0275\u0275advance(1),v.\u0275\u0275property("currentCollectionId",g.collectionId)("currentDefinition",g.definitionId)("submissionId",g.submissionId)("collectionModifiable",g.collectionModifiable)("isReadonly",g.isSectionReadonly)}}function C(U,R){if(1&U&&(v.\u0275\u0275elementStart(0,"div",6),v.\u0275\u0275template(1,w,3,3,"div",7),v.\u0275\u0275pipe(2,"async"),v.\u0275\u0275elementStart(3,"div",8),v.\u0275\u0275template(4,m,2,5,"ng-container",9),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(5,"div",10),v.\u0275\u0275element(6,"ds-submission-form-section-add",11),v.\u0275\u0275elementEnd()()),2&U){const g=v.\u0275\u0275nextContext();v.\u0275\u0275advance(1),v.\u0275\u0275property("ngIf",v.\u0275\u0275pipeBind1(2,4,g.uploadEnabled$)),v.\u0275\u0275advance(3),v.\u0275\u0275property("ngIf",!g.isSectionHidden),v.\u0275\u0275advance(2),v.\u0275\u0275property("collectionId",g.collectionId)("submissionId",g.submissionId)}}function h(U,R){1&U&&v.\u0275\u0275element(0,"ds-themed-loading",16)}function F(U,R){if(1&U&&(v.\u0275\u0275elementContainerStart(0),v.\u0275\u0275element(1,"ds-submission-section-container",17),v.\u0275\u0275elementContainerEnd()),2&U){const g=R.$implicit,x=v.\u0275\u0275nextContext();v.\u0275\u0275advance(1),v.\u0275\u0275property("collectionId",x.collectionId)("submissionId",x.submissionId)("sectionData",g)}}function W(U,R){if(1&U&&(v.\u0275\u0275elementStart(0,"div",18),v.\u0275\u0275element(1,"ds-submission-form-footer",19),v.\u0275\u0275elementEnd()),2&U){const g=v.\u0275\u0275nextContext();v.\u0275\u0275advance(1),v.\u0275\u0275property("submissionId",g.submissionId)}}let se=(()=>{class U{constructor(g,x,j,K,E){this.authService=g,this.changeDetectorRef=x,this.halService=j,this.submissionService=K,this.sectionsService=E,this.collectionModifiable=null,this.loading=(0,i.of)(!0),this.uploadFilesOptions=new X.n,this.subs=[],this.isActive=!0}ngOnChanges(g){g.collectionId&&this.collectionId&&g.submissionId&&this.submissionId&&(this.isActive=!0,this.submissionSections=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,l.h)(()=>this.isActive),(0,d.U)(x=>x.isLoading),(0,d.U)(x=>x),(0,e.x)(),(0,p.w)(x=>x?(0,i.of)([]):this.getSectionsList())),this.uploadEnabled$=this.sectionsService.isSectionTypeAvailable(this.submissionId,D.i.Upload),this.loading=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,l.h)(()=>this.isActive),(0,d.U)(x=>x.isLoading),(0,d.U)(x=>x),(0,e.x)()),this.subs.push(this.halService.getEndpoint(this.submissionService.getSubmissionObjectLinkName()).pipe((0,l.h)(x=>(0,L.UE)(x)),(0,e.x)()).subscribe(x=>{this.uploadFilesOptions.authToken=this.authService.buildAuthHeader(),this.uploadFilesOptions.url=x.concat(`/${this.submissionId}`),this.definitionId=this.submissionDefinition.name,this.submissionService.dispatchInit(this.collectionId,this.submissionId,this.selfUrl,this.submissionDefinition,this.sections,this.item,this.submissionErrors),this.changeDetectorRef.detectChanges()})),this.submissionService.startAutoSave(this.submissionId))}getCollectionVisibility(){const g=this.submissionDefinition.sections.page.find(x=>V()(x.sectionType,D.i.Collection));return(0,L.pT)(g.visibility)?g.visibility:null}get isSectionHidden(){const g=this.getCollectionVisibility();return(0,L.Uh)(g)&&V()(g.main,M.x.HIDDEN)&&V()(g.other,M.x.HIDDEN)}get isSectionReadonly(){const g=this.getCollectionVisibility();return(0,L.Uh)(g)&&V()(g.main,M.x.READONLY)&&V()(g.other,M.x.READONLY)}ngOnDestroy(){this.isActive=!1,this.submissionService.stopAutoSave(),this.submissionService.resetAllSubmissionObjects(),this.subs.filter(g=>(0,L.Uh)(g)).forEach(g=>g.unsubscribe())}onCollectionChange(g){this.collectionId=g.collection.id,this.definitionId!==g.submissionDefinition.name?(this.sections=g.sections,this.submissionDefinition=g.submissionDefinition,this.definitionId=this.submissionDefinition.name,this.submissionService.resetSubmissionObject(this.collectionId,this.submissionId,g._links.self.href,this.submissionDefinition,this.sections,this.item)):this.changeDetectorRef.detectChanges()}isLoading(){return this.loading}getSectionsList(){return this.submissionService.getSubmissionSections(this.submissionId).pipe((0,l.h)(g=>(0,L.UE)(g)),(0,d.U)(g=>g.filter(x=>!V()(x.sectionType,D.i.Collection))))}}return U.\u0275fac=function(g){return new(g||U)(v.\u0275\u0275directiveInject(S.e8),v.\u0275\u0275directiveInject(v.ChangeDetectorRef),v.\u0275\u0275directiveInject(T.q),v.\u0275\u0275directiveInject(k.b),v.\u0275\u0275directiveInject(c.J))},U.\u0275cmp=v.\u0275\u0275defineComponent({type:U,selectors:[["ds-submission-form"]],inputs:{collectionId:"collectionId",item:"item",collectionModifiable:"collectionModifiable",sections:"sections",submissionErrors:"submissionErrors",selfUrl:"selfUrl",submissionDefinition:"submissionDefinition",submissionId:"submissionId"},features:[v.\u0275\u0275NgOnChangesFeature],decls:10,vars:12,consts:[[1,"container-fluid"],["class","submission-form-header mb-3 d-flex flex-wrap position-sticky",4,"ngIf"],[1,"submission-form-content"],["message","Loading...",4,"ngIf"],[4,"ngFor","ngForOf"],["class","submission-form-footer mt-3 mb-3 position-sticky",4,"ngIf"],[1,"submission-form-header","mb-3","d-flex","flex-wrap","position-sticky"],["class","w-100",4,"ngIf"],[1,"submission-form-header-item","mb-3","mb-sm-0","flex-sm-grow-1","flex-md-grow-0"],[4,"ngIf"],[1,"submission-form-header-item","text-right"],[3,"collectionId","submissionId"],[1,"w-100"],[3,"submissionId","collectionId","uploadFilesOptions"],[1,"clearfix"],[3,"currentCollectionId","currentDefinition","submissionId","collectionModifiable","isReadonly","collectionChange"],["message","Loading..."],[3,"collectionId","submissionId","sectionData"],[1,"submission-form-footer","mt-3","mb-3","position-sticky"],[3,"submissionId"]],template:function(g,x){1&g&&(v.\u0275\u0275elementStart(0,"div",0),v.\u0275\u0275template(1,C,7,6,"div",1),v.\u0275\u0275pipe(2,"async"),v.\u0275\u0275elementStart(3,"div",2),v.\u0275\u0275template(4,h,1,0,"ds-themed-loading",3),v.\u0275\u0275pipe(5,"async"),v.\u0275\u0275template(6,F,2,3,"ng-container",4),v.\u0275\u0275pipe(7,"async"),v.\u0275\u0275elementEnd(),v.\u0275\u0275template(8,W,2,1,"div",5),v.\u0275\u0275pipe(9,"async"),v.\u0275\u0275elementEnd()),2&g&&(v.\u0275\u0275advance(1),v.\u0275\u0275property("ngIf",!v.\u0275\u0275pipeBind1(2,4,x.isLoading())),v.\u0275\u0275advance(3),v.\u0275\u0275property("ngIf",v.\u0275\u0275pipeBind1(5,6,x.isLoading())),v.\u0275\u0275advance(2),v.\u0275\u0275property("ngForOf",v.\u0275\u0275pipeBind1(7,8,x.submissionSections)),v.\u0275\u0275advance(2),v.\u0275\u0275property("ngIf",!v.\u0275\u0275pipeBind1(9,10,x.isLoading())))},dependencies:[G.sg,G.O5,N.Z,_.i,O.z,b.z,I.h,$.y,G.Ov],styles:[".submission-form-header[_ngcontent-%COMP%]{background-color:#fffffff7;padding:calc(var(--bs-spacer) / 2) 0 calc(var(--bs-spacer) / 2) 0;top:0;z-index:var(--ds-submission-header-z-index)}.submission-form-header-item[_ngcontent-%COMP%]{flex-grow:1}.submission-form-footer[_ngcontent-%COMP%]{border-radius:var(--bs-card-border-radius);bottom:0;background-color:var(--bs-gray-400);padding:calc(var(--bs-spacer) / 2);z-index:var(--ds-submission-footer-z-index)}.btn-link-focus[_ngcontent-%COMP%]{font-weight:400;color:#066;text-decoration:none}.btn-link-focus[_ngcontent-%COMP%]:hover{color:#001a1a;text-decoration:underline}.btn-link-focus[_ngcontent-%COMP%]:disabled, .btn-link-focus.disabled[_ngcontent-%COMP%]{color:#6c757d;pointer-events:none}.btn-link-focus[_ngcontent-%COMP%]:focus, .btn-link-focus.focus[_ngcontent-%COMP%]{text-decoration:underline}"]}),U})()},49868:(q,z,t)=>{"use strict";t.d(z,{h:()=>V});var i=t(9237),l=t(76215),d=t(77176),e=t(73797),p=t(45608),S=t(73716),o=t(1579),T=t(65384),L=t(97176),X=t(11915),k=t(96289),f=t(98678),D=t(96342),c=t(35103),M=t(17026);function A(v,G){if(1&v){const N=f.\u0275\u0275getCurrentView();f.\u0275\u0275elementStart(0,"ds-uploader",1),f.\u0275\u0275listener("onCompleteItem",function(O){f.\u0275\u0275restoreView(N);const b=f.\u0275\u0275nextContext();return f.\u0275\u0275resetView(b.onCompleteItem(O))})("onUploadError",function(){f.\u0275\u0275restoreView(N);const O=f.\u0275\u0275nextContext();return f.\u0275\u0275resetView(O.onUploadError())}),f.\u0275\u0275elementEnd()}if(2&v){const N=f.\u0275\u0275nextContext();f.\u0275\u0275property("dropMsg",N.dropMsg)("dropOverDocumentMsg",N.dropOverDocumentMsg)("enableDragOverDocument",N.enableDragOverDocument)("onBeforeUpload",N.onBeforeUpload)("uploadFilesOptions",N.uploadFilesOptions)}}let V=(()=>{class v{constructor(N,_,O,b,I){this.notificationsService=N,this.operationsService=_,this.sectionService=O,this.submissionService=b,this.translate=I,this.enableDragOverDocument=!0,this.dropOverDocumentMsg="submission.sections.upload.drop-message",this.dropMsg="submission.sections.upload.drop-message",this.subs=[],this.uploadEnabled=(0,i.of)(!1),this.onBeforeUpload=()=>{const $=this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections").subscribe();return this.subs.push($),$}}ngOnChanges(){this.uploadEnabled=this.sectionService.isSectionTypeAvailable(this.submissionId,k.i.Upload)}onCompleteItem(N){this.subs.push(this.uploadEnabled.pipe((0,l.P)()).subscribe(_=>{if(_){const{sections:O}=N,{errors:b}=N,I=(0,L.Z)(b);O&&(0,p.UE)(O)&&Object.keys(O).forEach($=>{const w=(0,S.Vv)(O[$]),m=I[$];this.sectionService.isSectionType(this.submissionId,$,k.i.Upload).pipe((0,d.q)(1)).subscribe(C=>{C&&((0,p.xb)(m)?this.notificationsService.success(null,this.translate.get("submission.sections.upload.upload-successful")):this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed")))}),this.sectionService.updateSectionData(this.submissionId,$,w,m,m)})}}))}onUploadError(){this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed"))}ngOnDestroy(){this.subs.filter(N=>(0,p.Uh)(N)).forEach(N=>N.unsubscribe())}}return v.\u0275fac=function(N){return new(N||v)(f.\u0275\u0275directiveInject(T.T),f.\u0275\u0275directiveInject(X.E),f.\u0275\u0275directiveInject(e.J),f.\u0275\u0275directiveInject(o.b),f.\u0275\u0275directiveInject(D.sK))},v.\u0275cmp=f.\u0275\u0275defineComponent({type:v,selectors:[["ds-submission-upload-files"]],inputs:{collectionId:"collectionId",submissionId:"submissionId",uploadFilesOptions:"uploadFilesOptions"},features:[f.\u0275\u0275NgOnChangesFeature],decls:1,vars:1,consts:[[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError",4,"ngIf"],[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError"]],template:function(N,_){1&N&&f.\u0275\u0275template(0,A,1,5,"ds-uploader",0),2&N&&f.\u0275\u0275property("ngIf",_.uploadFilesOptions.url)},dependencies:[c.O5,M.B],encapsulation:2}),v})()},76890:(q,z,t)=>{"use strict";t.d(z,{v:()=>D}),t(45123);var l=t(71432),d=t(69637),e=t(1579),p=t(65384),S=t(9925),o=t(98678),T=t(65706),L=t(67522),X=t(35103),k=t(96342);function f(c,M){if(1&c&&(o.\u0275\u0275elementStart(0,"div",5)(1,"div",6)(2,"strong"),o.\u0275\u0275text(3),o.\u0275\u0275pipe(4,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(5,"p"),o.\u0275\u0275text(6),o.\u0275\u0275elementEnd()()()),2&c){const A=M.$implicit;o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(4,2,"item.preview."+A.key)),o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate(A.value.value)}}let D=(()=>{class c{constructor(A,V,v,G,N){this.activeModal=A,this.submissionService=V,this.modalService=v,this.router=G,this.notificationService=N}ngOnInit(){this.metadataList=[],Object.keys(this.externalSourceEntry.metadata).forEach(V=>{this.metadataList.push({key:V,value:l.S.first(this.externalSourceEntry.metadata,V)})})}closeMetadataModal(){this.activeModal.dismiss(!1)}import(){this.modalRef=this.modalService.open(S.L,{size:"lg"}),this.modalRef.componentInstance.entityType=this.labelPrefix,this.closeMetadataModal(),this.modalRef.componentInstance.selectedEvent.pipe((0,d.z)(A=>this.submissionService.createSubmissionFromExternalSource(this.externalSourceEntry._links.self.href,A.collection.id))).subscribe(A=>{let V=!1;1===A.length&&null!==A[0]&&(V=!0,this.router.navigateByUrl("/workspaceitems/"+A[0].id+"/edit")),V||this.notificationService.error("submission.import-external.preview.error.import.title","submission.import-external.preview.error.import.body"),this.modalRef.close()})}}return c.\u0275fac=function(A){return new(A||c)(o.\u0275\u0275directiveInject(T.Kz),o.\u0275\u0275directiveInject(e.b),o.\u0275\u0275directiveInject(T.FF),o.\u0275\u0275directiveInject(L.F0),o.\u0275\u0275directiveInject(p.T))},c.\u0275cmp=o.\u0275\u0275defineComponent({type:c,selectors:[["ds-submission-import-external-preview"]],inputs:{externalSourceEntry:"externalSourceEntry"},decls:27,vars:10,consts:[[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"container"],[1,"row"],[1,"col-md-12"],["class","row",4,"ngFor","ngForOf"],[1,"col-md-12","text-right"],["role","button",1,"btn","btn-success",3,"click"],["aria-hidden","true",1,"fa","fa-file-import"]],template:function(A,V){1&A&&(o.\u0275\u0275elementStart(0,"div",0)(1,"h2"),o.\u0275\u0275text(2),o.\u0275\u0275pipe(3,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(4,"button",1),o.\u0275\u0275listener("click",function(){return V.closeMetadataModal()}),o.\u0275\u0275elementStart(5,"span",2),o.\u0275\u0275text(6,"\xd7"),o.\u0275\u0275elementEnd()()(),o.\u0275\u0275elementStart(7,"div",3)(8,"div",4)(9,"div",5)(10,"div",6)(11,"p"),o.\u0275\u0275text(12),o.\u0275\u0275pipe(13,"translate"),o.\u0275\u0275elementEnd()()(),o.\u0275\u0275elementStart(14,"div",5)(15,"div",6),o.\u0275\u0275element(16,"hr"),o.\u0275\u0275elementEnd()(),o.\u0275\u0275template(17,f,7,4,"div",7),o.\u0275\u0275elementStart(18,"div",5)(19,"div",6),o.\u0275\u0275element(20,"hr"),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(21,"div",5)(22,"div",8)(23,"button",9),o.\u0275\u0275listener("click",function(){return V.import()}),o.\u0275\u0275element(24,"i",10),o.\u0275\u0275text(25),o.\u0275\u0275pipe(26,"translate"),o.\u0275\u0275elementEnd()()()()()),2&A&&(o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(3,4,"submission.import-external.preview.title."+V.labelPrefix)),o.\u0275\u0275advance(10),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(13,6,"submission.import-external.preview.subtitle")),o.\u0275\u0275advance(5),o.\u0275\u0275property("ngForOf",V.metadataList),o.\u0275\u0275advance(8),o.\u0275\u0275textInterpolate1(" ",o.\u0275\u0275pipeBind1(26,8,"submission.import-external.preview.button.import")," "))},dependencies:[X.sg,k.X$],styles:[".close[_ngcontent-%COMP%]:focus{outline:none!important}"]}),c})()},8019:(q,z,t)=>{"use strict";t.d(z,{p:()=>I});var i=t(98678),l=t(9237),d=t(9249),e=t(27303),p=t(5803),S=t(74304),o=t(20942),T=t(87483),L=t(41121),X=t(10572),k=t(79849),f=t(45608),D=t(6144),c=t(35103),M=t(5476),A=t(60235),V=t(65706),v=t(96342);function G($,w){if(1&$){const m=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",10)(1,"input",11),i.\u0275\u0275listener("keyup.enter",function(){i.\u0275\u0275restoreView(m);const h=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(""===h.searchString?null:h.search())})("ngModelChange",function(h){i.\u0275\u0275restoreView(m);const F=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(F.searchString=h)}),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()()}if(2&$){const m=i.\u0275\u0275nextContext();i.\u0275\u0275advance(1),i.\u0275\u0275propertyInterpolate("placeholder",i.\u0275\u0275pipeBind1(2,2,"submission.import-external.search.placeholder")),i.\u0275\u0275property("ngModel",m.searchString)}}function N($,w){if(1&$){const m=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"input",11),i.\u0275\u0275listener("keyup.enter",function(){i.\u0275\u0275restoreView(m);const h=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(""===h.searchString?null:h.search())})("ngModelChange",function(h){i.\u0275\u0275restoreView(m);const F=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(F.searchString=h)}),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275elementEnd()}if(2&$){const m=i.\u0275\u0275nextContext();i.\u0275\u0275propertyInterpolate("placeholder",i.\u0275\u0275pipeBind1(1,2,"submission.import-external.search.placeholder")),i.\u0275\u0275property("ngModel",m.searchString)}}function _($,w){if(1&$){const m=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",12),i.\u0275\u0275listener("click",function(){const F=i.\u0275\u0275restoreView(m).$implicit,W=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(W.makeSourceSelection(F))}),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd()}if(2&$){const m=w.$implicit;i.\u0275\u0275propertyInterpolate("title",i.\u0275\u0275pipeBind1(1,2,"submission.import-external.source."+(null==m?null:m.name))),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(3,4,"submission.import-external.source."+(null==m?null:m.name)))}}function O($,w){1&$&&(i.\u0275\u0275elementStart(0,"div",13)(1,"p"),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd()()),2&$&&(i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(3,1,"submission.import-external.source.loading")))}const b=function($){return{"input-group-append":$}};let I=(()=>{class ${constructor(m,C,h){this.externalService=m,this.cdr=C,this.windowService=h,this.sourceListLoading=!1,this.externalSourceData=new i.EventEmitter}ngOnInit(){this.selectedElement={id:"",name:"loading"},this.searchString="",this.sourceList=[],this.findListOptions=Object.assign({},new D.R,{elementsPerPage:5,currentPage:1,searchParams:[new p.g("entityType",this.initExternalSourceData.entity)]}),this.externalService.searchBy("findByEntityType",this.findListOptions).pipe((0,d.K)(()=>{const m=new T.S,C=(0,o.b)(m,[]),h=(0,L.AC)(C);return(0,l.of)(h)}),(0,X.Gp)()).subscribe(m=>{m.page.forEach(C=>{this.sourceList.push({id:C.id,name:C.name}),this.initExternalSourceData.sourceId===C.id&&(this.selectedElement={id:C.id,name:C.name},this.searchString=this.initExternalSourceData.query)}),""===this.selectedElement.id&&(this.selectedElement=this.sourceList[0]),this.pageInfo=m.pageInfo,this.cdr.detectChanges()}),this.isXsOrSm$=this.windowService.isXsOrSm()}makeSourceSelection(m){this.selectedElement=m}onScroll(){!this.sourceListLoading&&this.pageInfo.currentPage+1<=this.pageInfo.totalPages&&(this.sourceListLoading=!0,this.findListOptions=Object.assign({},new D.R,{elementsPerPage:5,currentPage:this.findListOptions.currentPage+1,searchParams:[new p.g("entityType",this.initExternalSourceData.entity)]}),this.externalService.searchBy("findByEntityType",this.findListOptions).pipe((0,d.K)(()=>{const m=new T.S,C=(0,o.b)(m,[]),h=(0,L.AC)(C);return(0,l.of)(h)}),(0,X.xw)(),(0,e.b)(()=>this.sourceListLoading=!1)).subscribe(m=>{m.payload.page.forEach(C=>{this.sourceList.push({id:C.id,name:C.name})}),this.pageInfo=m.payload.pageInfo,this.cdr.detectChanges()}))}search(){this.externalSourceData.emit({entity:this.initExternalSourceData.entity,sourceId:this.selectedElement.id,query:this.searchString})}ngOnDestroy(){(0,f.Uh)(this.sub)&&this.sub.unsubscribe()}}return $.\u0275fac=function(m){return new(m||$)(i.\u0275\u0275directiveInject(S.G),i.\u0275\u0275directiveInject(i.ChangeDetectorRef),i.\u0275\u0275directiveInject(k.I))},$.\u0275cmp=i.\u0275\u0275defineComponent({type:$,selectors:[["ds-submission-import-external-searchbar"]],inputs:{initExternalSourceData:"initExternalSourceData"},outputs:{externalSourceData:"externalSourceData"},decls:20,vars:31,consts:[["class","input-group mb-2",4,"ngIf"],[1,"input-group","mb-5"],["type","text","class","form-control","aria-label","","aria-describedby","",3,"ngModel","placeholder","keyup.enter","ngModelChange",4,"ngIf"],["ngbDropdown","","role","group","aria-label","",3,"ngClass"],["ngbDropdownToggle","",1,"btn","btn-outline-secondary","w-fx",3,"title"],["ngbDropdownMenu","","aria-haspopup","true","aria-expanded","false","aria-labelledby","scrollableDropdownMenuButton",1,"dropdown-menu","scrollable-dropdown-menu","w-100"],["aria-labelledby","scrollableDropdownMenuButton","infiniteScroll","",1,"scrollable-menu",3,"infiniteScrollDistance","infiniteScrollThrottle","scrollWindow","scrolled"],["ngbDropdownItem","","class","dropdown-item text-truncate",3,"title","click",4,"ngFor","ngForOf"],["ngbDropdownItem","","class","scrollable-dropdown-loading text-center",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"title","disabled","click"],[1,"input-group","mb-2"],["type","text","aria-label","","aria-describedby","",1,"form-control",3,"ngModel","placeholder","keyup.enter","ngModelChange"],["ngbDropdownItem","",1,"dropdown-item","text-truncate",3,"title","click"],["ngbDropdownItem","",1,"scrollable-dropdown-loading","text-center"]],template:function(m,C){1&m&&(i.\u0275\u0275template(0,G,3,4,"div",0),i.\u0275\u0275pipe(1,"async"),i.\u0275\u0275elementStart(2,"div",1),i.\u0275\u0275template(3,N,2,4,"input",2),i.\u0275\u0275pipe(4,"async"),i.\u0275\u0275elementStart(5,"div",3),i.\u0275\u0275pipe(6,"async"),i.\u0275\u0275elementStart(7,"button",4),i.\u0275\u0275pipe(8,"translate"),i.\u0275\u0275text(9),i.\u0275\u0275pipe(10,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(11,"div",5)(12,"div",6),i.\u0275\u0275listener("scrolled",function(){return C.onScroll()}),i.\u0275\u0275template(13,_,4,6,"button",7),i.\u0275\u0275template(14,O,4,3,"div",8),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(15,"button",9),i.\u0275\u0275listener("click",function(){return C.search()}),i.\u0275\u0275pipe(16,"translate"),i.\u0275\u0275pipe(17,"translate"),i.\u0275\u0275text(18),i.\u0275\u0275pipe(19,"translate"),i.\u0275\u0275elementEnd()()()),2&m&&(i.\u0275\u0275property("ngIf",i.\u0275\u0275pipeBind1(1,13,C.isXsOrSm$)),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",!i.\u0275\u0275pipeBind1(4,15,C.isXsOrSm$)),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(29,b,!i.\u0275\u0275pipeBind1(6,17,C.isXsOrSm$))),i.\u0275\u0275advance(2),i.\u0275\u0275propertyInterpolate("title",i.\u0275\u0275pipeBind1(8,19,"submission.import-external.search.source.hint")),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(10,21,"submission.import-external.source."+(null==C.selectedElement?null:C.selectedElement.name))),i.\u0275\u0275advance(3),i.\u0275\u0275property("infiniteScrollDistance",2)("infiniteScrollThrottle",50)("scrollWindow",!1),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngForOf",C.sourceList),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",C.sourceListLoading),i.\u0275\u0275advance(1),i.\u0275\u0275property("title",""===C.searchString?i.\u0275\u0275pipeBind1(16,23,"submission.import-external.search.button.hint"):i.\u0275\u0275pipeBind1(17,25,"submission.import-external.search.button"))("disabled",""===C.searchString),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(19,27,"submission.import-external.search.button")))},dependencies:[c.mk,c.sg,c.O5,M.Fj,M.JJ,M.On,A.Ry,V.jt,V.iD,V.Vi,V.TH,c.Ov,v.X$],styles:[".input-group-append[_ngcontent-%COMP%]:last-child > .btn[_ngcontent-%COMP%]:not(:last-child):not(.dropdown-toggle){margin-left:-1px;border-radius:0 .25rem .25rem 0}.input-group-append[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]{border-radius:0}.w-fx[_ngcontent-%COMP%]{min-width:200px}.scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:calc(var(--ds-dropdown-menu-max-height) / 2);overflow-x:hidden}.scrollable-dropdown-loading[_ngcontent-%COMP%]{height:calc(var(--bs-spacer) * 2)!important}.scrollable-dropdown-loading[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff;line-height:calc(var(--bs-spacer) * 2);position:sticky;bottom:0}"]}),$})()},10251:(q,z,t)=>{"use strict";t.r(z),t.d(z,{SubmissionImportExternalComponent:()=>_e});var i=t(35841),l=t(53426),d=t(77176),e=t(77007),p=t(21160),S=t(27303),o=t(69637),T=t(74304),L=t(20942),X=t(27496),k=t(97462),f=t(45180),D=t(74997),c=t(41121),M=t(76890),A=t(58106),V=t(87483),v=t(45608),G=t(10572),N=t(44205),_=t(98678),O=t(67522),b=t(65706),I=t(35103),$=t(87586),w=t(87657),m=t(12955),C=t(41966),h=t(8019),F=t(96342);function W(Z,ae){1&Z&&(_.\u0275\u0275elementStart(0,"h3"),_.\u0275\u0275text(1),_.\u0275\u0275pipe(2,"translate"),_.\u0275\u0275elementEnd()),2&Z&&(_.\u0275\u0275advance(1),_.\u0275\u0275textInterpolate(_.\u0275\u0275pipeBind1(2,1,"submission.sections.describe.relationship-lookup.selection-tab.title")))}const se=function(Z,ae){return{repeatable:Z,listId:ae}};function U(Z,ae){if(1&Z){const Y=_.\u0275\u0275getCurrentView();_.\u0275\u0275elementStart(0,"ds-viewable-collection",15),_.\u0275\u0275listener("importObject",function(me){_.\u0275\u0275restoreView(Y);const fe=_.\u0275\u0275nextContext(4);return _.\u0275\u0275resetView(fe.import(me))}),_.\u0275\u0275elementEnd()}if(2&Z){const Y=_.\u0275\u0275nextContext().ngVar,re=_.\u0275\u0275nextContext(3);_.\u0275\u0275property("@fadeIn",void 0)("objects",Y)("selectionConfig",_.\u0275\u0275pureFunction2(8,se,re.repeatable,re.listId))("config",re.initialPagination)("hideGear",!0)("context",re.context)("importable",!0)("importConfig",re.importConfig)}}function R(Z,ae){1&Z&&(_.\u0275\u0275element(0,"ds-themed-loading",16),_.\u0275\u0275pipe(1,"translate")),2&Z&&_.\u0275\u0275propertyInterpolate("message",_.\u0275\u0275pipeBind1(1,1,"loading.search-results"))}function g(Z,ae){1&Z&&(_.\u0275\u0275elementStart(0,"div",17)(1,"ds-alert",18),_.\u0275\u0275text(2),_.\u0275\u0275pipe(3,"translate"),_.\u0275\u0275elementEnd()()),2&Z&&(_.\u0275\u0275advance(1),_.\u0275\u0275property("type","alert-info"),_.\u0275\u0275advance(1),_.\u0275\u0275textInterpolate(_.\u0275\u0275pipeBind1(3,2,"search.results.empty")))}function x(Z,ae){1&Z&&(_.\u0275\u0275elementStart(0,"div",19)(1,"ds-alert",18),_.\u0275\u0275text(2),_.\u0275\u0275pipe(3,"translate"),_.\u0275\u0275elementEnd()()),2&Z&&(_.\u0275\u0275advance(1),_.\u0275\u0275property("type","alert-info"),_.\u0275\u0275advance(1),_.\u0275\u0275textInterpolate(_.\u0275\u0275pipeBind1(3,2,"search.results.response.500")))}function j(Z,ae){if(1&Z&&(_.\u0275\u0275elementContainerStart(0),_.\u0275\u0275template(1,W,3,3,"h3",10),_.\u0275\u0275template(2,U,1,11,"ds-viewable-collection",11),_.\u0275\u0275pipe(3,"async"),_.\u0275\u0275template(4,R,2,3,"ds-themed-loading",12),_.\u0275\u0275pipe(5,"async"),_.\u0275\u0275template(6,g,4,4,"div",13),_.\u0275\u0275pipe(7,"async"),_.\u0275\u0275template(8,x,4,4,"div",14),_.\u0275\u0275pipe(9,"async"),_.\u0275\u0275elementContainerEnd()),2&Z){const Y=ae.ngVar,re=_.\u0275\u0275nextContext(3);_.\u0275\u0275advance(1),_.\u0275\u0275property("ngIf",Y&&0!==(null==Y||null==Y.payload||null==Y.payload.page?null:Y.payload.page.length)),_.\u0275\u0275advance(1),_.\u0275\u0275property("ngIf",(null==Y?null:Y.hasSucceeded)&&!_.\u0275\u0275pipeBind1(3,5,re.isLoading$)&&(null==Y||null==Y.payload||null==Y.payload.page?null:Y.payload.page.length)>0),_.\u0275\u0275advance(2),_.\u0275\u0275property("ngIf",_.\u0275\u0275pipeBind1(5,7,re.isLoading$)),_.\u0275\u0275advance(2),_.\u0275\u0275property("ngIf",!_.\u0275\u0275pipeBind1(7,9,re.isLoading$)&&0===(null==Y||null==Y.payload||null==Y.payload.page?null:Y.payload.page.length)),_.\u0275\u0275advance(2),_.\u0275\u0275property("ngIf",!_.\u0275\u0275pipeBind1(9,11,re.isLoading$)&&500===Y.statusCode)}}function K(Z,ae){if(1&Z&&(_.\u0275\u0275elementStart(0,"div",2),_.\u0275\u0275template(1,j,10,13,"ng-container",9),_.\u0275\u0275pipe(2,"async"),_.\u0275\u0275elementEnd()),2&Z){const Y=_.\u0275\u0275nextContext(2);_.\u0275\u0275advance(1),_.\u0275\u0275property("ngVar",_.\u0275\u0275pipeBind1(2,1,Y.entriesRD$))}}function E(Z,ae){1&Z&&(_.\u0275\u0275elementStart(0,"div",2)(1,"ds-alert",18)(2,"p",20),_.\u0275\u0275text(3),_.\u0275\u0275pipe(4,"translate"),_.\u0275\u0275elementEnd()()()),2&Z&&(_.\u0275\u0275advance(1),_.\u0275\u0275property("type","alert-info"),_.\u0275\u0275advance(2),_.\u0275\u0275textInterpolate(_.\u0275\u0275pipeBind1(4,2,"submission.import-external.page.hint")))}function J(Z,ae){if(1&Z&&(_.\u0275\u0275elementStart(0,"div",1),_.\u0275\u0275template(1,K,3,3,"div",8),_.\u0275\u0275template(2,E,5,4,"div",8),_.\u0275\u0275elementEnd()),2&Z){const Y=_.\u0275\u0275nextContext();_.\u0275\u0275advance(1),_.\u0275\u0275property("ngIf",""!==Y.reload$.value.sourceId),_.\u0275\u0275advance(1),_.\u0275\u0275property("ngIf",""===Y.reload$.value.sourceId)}}const Q=function(){return["/mydspace"]};let _e=(()=>{class Z{constructor(Y,re,me,fe,Ie){this.searchConfigService=Y,this.externalService=re,this.routeService=me,this.router=fe,this.modalService=Ie,this.entriesRD$=new i.X(null),this.isLoading$=new i.X(!1),this.reload$=new i.X({entity:"",query:"",sourceId:""}),this.initialPagination=Object.assign(new f.r,{id:"spc",pageSize:10}),this.subs=[]}ngOnInit(){this.listId="list-submission-external-sources",this.context=k._.EntitySearchModalWithNameVariants,this.repeatable=!1,this.routeData={entity:"",sourceId:"",query:""},this.importConfig={buttonLabel:"submission.sections.describe.relationship-lookup.external-source.import-button-title."+this.label},this.entriesRD$=new i.X((0,c.AC)((0,L.b)(new V.S,[]))),this.isLoading$=new i.X(!1),this.subs.push((0,l.a)([this.routeService.getQueryParameterValue("entity"),this.routeService.getQueryParameterValue("sourceId"),this.routeService.getQueryParameterValue("query")]).pipe((0,d.q)(1)).subscribe(([Y,re,me])=>{this.reload$.next({entity:Y||N.N,query:me,sourceId:re}),this.selectLabel(Y),this.retrieveExternalSources()}))}getExternalSourceData(Y){this.router.navigate([],{queryParams:Y,replaceUrl:!0}).then(()=>{this.reload$.next(Y),this.retrieveExternalSources()})}import(Y){this.modalRef=this.modalService.open(M.v,{size:"lg"});const re=this.modalRef.componentInstance;re.externalSourceEntry=Y,re.labelPrefix=this.label}ngOnDestroy(){this.subs.filter(Y=>(0,v.Uh)(Y)).forEach(Y=>Y.unsubscribe()),(0,v.Uh)(this.retrieveExternalSourcesSub)&&this.retrieveExternalSourcesSub.unsubscribe()}retrieveExternalSources(){(0,v.Uh)(this.retrieveExternalSourcesSub)&&this.retrieveExternalSourcesSub.unsubscribe(),this.retrieveExternalSourcesSub=this.reload$.pipe((0,e.h)(Y=>(0,v.UE)(Y.sourceId)&&(0,v.UE)(Y.query)),(0,p.w)(Y=>{const re=Y.query;return this.routeData=Y,this.searchConfigService.paginatedSearchOptions.pipe((0,S.b)(()=>this.isLoading$.next(!0)),(0,e.h)(me=>me.query===re),(0,o.z)(me=>this.externalService.getExternalSourceEntries(this.routeData.sourceId,me).pipe((0,G.sJ)())))})).subscribe(Y=>{this.entriesRD$.next(Y),this.isLoading$.next(!1)})}selectLabel(Y){this.label=Y,this.importConfig={buttonLabel:"submission.sections.describe.relationship-lookup.external-source.import-button-title."+this.label}}}return Z.\u0275fac=function(Y){return new(Y||Z)(_.\u0275\u0275directiveInject(X.U),_.\u0275\u0275directiveInject(T.G),_.\u0275\u0275directiveInject(D.MZ),_.\u0275\u0275directiveInject(O.F0),_.\u0275\u0275directiveInject(b.FF))},Z.\u0275cmp=_.\u0275\u0275defineComponent({type:Z,selectors:[["ds-submission-import-external"]],decls:15,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-md-12"],["id","header",1,"pb-2"],[3,"initExternalSourceData","externalSourceData"],["class","row",4,"ngIf"],["role","button",1,"btn","btn-outline-secondary",3,"routerLink"],["aria-hidden","true",1,"fa","fa-chevron-left"],["class","col-md-12",4,"ngIf"],[4,"ngVar"],[4,"ngIf"],[3,"objects","selectionConfig","config","hideGear","context","importable","importConfig","importObject",4,"ngIf"],[3,"message",4,"ngIf"],["data-test","empty-external-entry-list",4,"ngIf"],["data-test","empty-external-error-500",4,"ngIf"],[3,"objects","selectionConfig","config","hideGear","context","importable","importConfig","importObject"],[3,"message"],["data-test","empty-external-entry-list"],[3,"type"],["data-test","empty-external-error-500"],[1,"lead","mb-0"]],template:function(Y,re){1&Y&&(_.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),_.\u0275\u0275text(4),_.\u0275\u0275pipe(5,"translate"),_.\u0275\u0275elementEnd(),_.\u0275\u0275elementStart(6,"ds-submission-import-external-searchbar",4),_.\u0275\u0275listener("externalSourceData",function(fe){return re.getExternalSourceData(fe)}),_.\u0275\u0275elementEnd()()(),_.\u0275\u0275template(7,J,3,2,"div",5),_.\u0275\u0275elementStart(8,"div",1)(9,"div",2),_.\u0275\u0275element(10,"hr"),_.\u0275\u0275elementStart(11,"a",6),_.\u0275\u0275element(12,"i",7),_.\u0275\u0275text(13),_.\u0275\u0275pipe(14,"translate"),_.\u0275\u0275elementEnd()()()()),2&Y&&(_.\u0275\u0275advance(4),_.\u0275\u0275textInterpolate(_.\u0275\u0275pipeBind1(5,5,"submission.import-external.title"+(re.label?"."+re.label:""))),_.\u0275\u0275advance(2),_.\u0275\u0275property("initExternalSourceData",re.reload$.value),_.\u0275\u0275advance(1),_.\u0275\u0275property("ngIf",re.reload$.value.entity),_.\u0275\u0275advance(4),_.\u0275\u0275property("routerLink",_.\u0275\u0275pureFunction0(9,Q)),_.\u0275\u0275advance(2),_.\u0275\u0275textInterpolate1(" ",_.\u0275\u0275pipeBind1(14,7,"submission.import-external.back-to-my-dspace")," "))},dependencies:[I.O5,O.rH,$.w,w.Z,m.c,C.g,h.p,I.Ov,F.X$],data:{animation:[A.Ji]}}),Z})()},13873:(q,z,t)=>{"use strict";t.d(z,{i:()=>p});var i=t(4682),l=t(98678);function d(S,o){}const e=["*"];let p=(()=>{class S extends i.F{getComponentName(){return"SubmissionImportExternalComponent"}importThemedComponent(T){return t(49252)(`./${T}/app/submission/import-external/submission-import-external.component`)}importUnthemedComponent(){return Promise.resolve().then(t.bind(t,10251))}}return S.\u0275fac=function(){let o;return function(L){return(o||(o=l.\u0275\u0275getInheritedFactory(S)))(L||S)}}(),S.\u0275cmp=l.\u0275\u0275defineComponent({type:S,selectors:[["ds-themed-submission-import-external"]],features:[l.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:e,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(T,L){1&T&&(l.\u0275\u0275projectionDef(),l.\u0275\u0275template(0,d,0,0,"ng-template",null,0,l.\u0275\u0275templateRefExtractor),l.\u0275\u0275elementStart(2,"div",null,1),l.\u0275\u0275projection(4),l.\u0275\u0275elementEnd())},encapsulation:2}),S})()},51437:(q,z,t)=>{"use strict";t.d(z,{y:()=>w});var i=t(98678),l=t(32931),d=t(76297),e=t(60987),p=t(35103),S=t(87586),o=t(65706),T=t(96342);const L=["sectionRef"];function X(m,C){1&m&&(i.\u0275\u0275element(0,"i",18),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275pipe(2,"translate")),2&m&&(i.\u0275\u0275propertyInterpolate("title",i.\u0275\u0275pipeBind1(1,2,"submission.sections.status.warnings.title")),i.\u0275\u0275attribute("aria-label",i.\u0275\u0275pipeBind1(2,4,"submission.sections.status.warnings.aria")))}function k(m,C){1&m&&(i.\u0275\u0275element(0,"i",19),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275pipe(2,"translate")),2&m&&(i.\u0275\u0275propertyInterpolate("title",i.\u0275\u0275pipeBind1(1,2,"submission.sections.status.errors.title")),i.\u0275\u0275attribute("aria-label",i.\u0275\u0275pipeBind1(2,4,"submission.sections.status.errors.aria")))}function f(m,C){1&m&&(i.\u0275\u0275element(0,"i",20),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275pipe(2,"translate")),2&m&&(i.\u0275\u0275propertyInterpolate("title",i.\u0275\u0275pipeBind1(1,2,"submission.sections.status.valid.title")),i.\u0275\u0275attribute("aria-label",i.\u0275\u0275pipeBind1(2,4,"submission.sections.status.valid.aria")))}function D(m,C){1&m&&(i.\u0275\u0275element(0,"i",21),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275pipe(2,"translate")),2&m&&(i.\u0275\u0275propertyInterpolate("title",i.\u0275\u0275pipeBind1(1,2,"submission.sections.status.info.title")),i.\u0275\u0275attribute("aria-label",i.\u0275\u0275pipeBind1(2,4,"submission.sections.status.info.aria")))}const c=function(m){return{"text-white":m}};function M(m,C){if(1&m&&i.\u0275\u0275element(0,"span",22),2&m){i.\u0275\u0275nextContext(3);const h=i.\u0275\u0275reference(1);i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(1,c,h.isInfo()))}}function A(m,C){1&m&&i.\u0275\u0275element(0,"span",23)}function V(m,C){if(1&m){const h=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"a",24),i.\u0275\u0275listener("click",function(W){i.\u0275\u0275restoreView(h);const se=i.\u0275\u0275nextContext(3);return i.\u0275\u0275resetView(se.removeSection(W))}),i.\u0275\u0275element(1,"i",25),i.\u0275\u0275elementEnd()}}const v=function(m){return{sectionHeader:m}};function G(m,C){if(1&m&&(i.\u0275\u0275elementStart(0,"span",8),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"div",9),i.\u0275\u0275template(4,X,3,6,"i",10),i.\u0275\u0275pipe(5,"async"),i.\u0275\u0275template(6,k,3,6,"i",11),i.\u0275\u0275template(7,f,3,6,"i",12),i.\u0275\u0275pipe(8,"async"),i.\u0275\u0275template(9,D,3,6,"i",13),i.\u0275\u0275elementStart(10,"a",14),i.\u0275\u0275pipe(11,"translate"),i.\u0275\u0275pipe(12,"translate"),i.\u0275\u0275pipe(13,"translate"),i.\u0275\u0275template(14,M,1,3,"span",15),i.\u0275\u0275template(15,A,1,0,"span",16),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(16,V,2,0,"a",17),i.\u0275\u0275elementEnd()),2&m){const h=i.\u0275\u0275nextContext(2),F=i.\u0275\u0275reference(1);i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(24,c,F.isInfo())),i.\u0275\u0275advance(1),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(2,11,"submission.sections."+h.sectionData.header)),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",!i.\u0275\u0275pipeBind1(5,13,F.isValid())&&!F.hasErrors()&&!F.isInfo()),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",F.hasErrors()&&!F.isInfo()),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",i.\u0275\u0275pipeBind1(8,15,F.isValid())&&!F.hasErrors()&&!F.isInfo()),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",F.isInfo()),i.\u0275\u0275advance(1),i.\u0275\u0275property("title",i.\u0275\u0275pipeBind1(13,22,F.isOpen()?"submission.sections.toggle.close":"submission.sections.toggle.open")),i.\u0275\u0275attribute("aria-label",i.\u0275\u0275pipeBind2(11,17,F.isOpen()?"submission.sections.toggle.aria.close":"submission.sections.toggle.aria.open",i.\u0275\u0275pureFunction1(26,v,i.\u0275\u0275pipeBind1(12,20,"submission.sections."+h.sectionData.header)))),i.\u0275\u0275advance(4),i.\u0275\u0275property("ngIf",F.isOpen()),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",!F.isOpen()),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",!F.isMandatory())}}function N(m,C){if(1&m){const h=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"ds-alert",31),i.\u0275\u0275listener("close",function(){const se=i.\u0275\u0275restoreView(h).index;i.\u0275\u0275nextContext(4);const U=i.\u0275\u0275reference(1);return i.\u0275\u0275resetView(U.removeError(se))}),i.\u0275\u0275elementEnd()}if(2&m){const h=C.$implicit,F=i.\u0275\u0275nextContext(4);i.\u0275\u0275property("content",h)("dismissible",!0)("type",F.AlertTypeEnum.Error)}}function _(m,C){if(1&m&&(i.\u0275\u0275elementStart(0,"div",29),i.\u0275\u0275template(1,N,1,3,"ds-alert",30),i.\u0275\u0275elementEnd()),2&m){const h=i.\u0275\u0275nextContext(3),F=i.\u0275\u0275reference(1);i.\u0275\u0275propertyInterpolate1("id","sectionGenericError_",h.sectionData.id,""),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngForOf",F.getErrors())}}function O(m,C){1&m&&i.\u0275\u0275elementContainer(0)}function b(m,C){if(1&m){const h=i.\u0275\u0275getCurrentView();i.\u0275\u0275template(0,_,2,2,"div",26),i.\u0275\u0275elementStart(1,"div",27),i.\u0275\u0275listener("click",function(W){i.\u0275\u0275restoreView(h),i.\u0275\u0275nextContext(2);const se=i.\u0275\u0275reference(1);return i.\u0275\u0275resetView(se.setFocus(W))}),i.\u0275\u0275template(2,O,1,0,"ng-container",28),i.\u0275\u0275elementEnd()}if(2&m){const h=i.\u0275\u0275nextContext(2),F=i.\u0275\u0275reference(1);i.\u0275\u0275property("ngIf",F.hasGenericErrors()),i.\u0275\u0275advance(1),i.\u0275\u0275propertyInterpolate1("id","sectionContent_",h.sectionData.id,""),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngComponentOutlet",h.getSectionContent())("ngComponentOutletInjector",h.objectInjector)}}function I(m,C){if(1&m){const h=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"ngb-accordion",3,4),i.\u0275\u0275listener("panelChange",function(W){i.\u0275\u0275restoreView(h),i.\u0275\u0275nextContext();const se=i.\u0275\u0275reference(1);return i.\u0275\u0275resetView(se.sectionChange(W))}),i.\u0275\u0275elementStart(2,"ngb-panel",5),i.\u0275\u0275template(3,G,17,28,"ng-template",6),i.\u0275\u0275template(4,b,3,4,"ng-template",7),i.\u0275\u0275elementEnd()()}if(2&m){const h=i.\u0275\u0275nextContext(),F=i.\u0275\u0275reference(1);i.\u0275\u0275propertyInterpolate("activeIds",h.sectionData.id),i.\u0275\u0275property("destroyOnHide",!1),i.\u0275\u0275advance(2),i.\u0275\u0275propertyInterpolate("id",h.sectionData.id),i.\u0275\u0275property("type",F.isInfo()?"info":"")}}const $=function(m){return{"section-focus":m}};let w=(()=>{class m{constructor(h){this.injector=h,this.AlertTypeEnum=e.N}ngOnInit(){this.objectInjector=i.Injector.create({providers:[{provide:"collectionIdProvider",useFactory:()=>this.collectionId,deps:[]},{provide:"sectionDataProvider",useFactory:()=>this.sectionData,deps:[]},{provide:"submissionIdProvider",useFactory:()=>this.submissionId,deps:[]}],parent:this.injector})}removeSection(h){h.preventDefault(),h.stopPropagation(),this.sectionRef.removeSection(this.submissionId,this.sectionData.id)}getSectionContent(){return(0,d.A)(this.sectionData.sectionType)}}return m.\u0275fac=function(h){return new(h||m)(i.\u0275\u0275directiveInject(i.Injector))},m.\u0275cmp=i.\u0275\u0275defineComponent({type:m,selectors:[["ds-submission-section-container"]],viewQuery:function(h,F){if(1&h&&i.\u0275\u0275viewQuery(L,5),2&h){let W;i.\u0275\u0275queryRefresh(W=i.\u0275\u0275loadQuery())&&(F.sectionRef=W.first)}},inputs:{collectionId:"collectionId",sectionData:"sectionData",submissionId:"submissionId"},decls:4,vars:11,consts:[["dsSection","",3,"ngClass","mandatory","submissionId","sectionType","sectionId"],["sectionRef","sectionRef"],[3,"activeIds","destroyOnHide","panelChange",4,"ngIf"],[3,"activeIds","destroyOnHide","panelChange"],["acc","ngbAccordion"],[3,"id","type"],["ngbPanelTitle",""],["ngbPanelContent",""],["tabindex","0",1,"float-left","section-title",3,"ngClass"],[1,"d-inline-block","float-right"],["class","fas fa-exclamation-circle text-warning mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-exclamation-circle text-danger mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-check-circle text-success mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-info-circle mr-3 text-white","role","img",3,"title",4,"ngIf"],["tabindex","0","role","button",1,"close",3,"title"],["class","fas fa-chevron-up fa-fw",3,"ngClass",4,"ngIf"],["class","fas fa-chevron-down fa-fw",4,"ngIf"],["href","javascript:void(0);","class","close mr-3",3,"click",4,"ngIf"],["role","img",1,"fas","fa-exclamation-circle","text-warning","mr-3",3,"title"],["role","img",1,"fas","fa-exclamation-circle","text-danger","mr-3",3,"title"],["role","img",1,"fas","fa-check-circle","text-success","mr-3",3,"title"],["role","img",1,"fas","fa-info-circle","mr-3","text-white",3,"title"],[1,"fas","fa-chevron-up","fa-fw",3,"ngClass"],[1,"fas","fa-chevron-down","fa-fw"],["href","javascript:void(0);",1,"close","mr-3",3,"click"],["aria-hidden","true","tabindex","0",1,"fas","fa-trash-o"],[3,"id",4,"ngIf"],[3,"id","click"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[3,"id"],[3,"content","dismissible","type","close",4,"ngFor","ngForOf"],[3,"content","dismissible","type","close"]],template:function(h,F){if(1&h&&(i.\u0275\u0275elementStart(0,"div",0,1),i.\u0275\u0275template(2,I,5,4,"ngb-accordion",2),i.\u0275\u0275pipe(3,"async"),i.\u0275\u0275elementEnd()),2&h){const W=i.\u0275\u0275reference(1);i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(9,$,W.isSectionActive()))("mandatory",F.sectionData.mandatory)("submissionId",F.submissionId)("sectionType",F.sectionData.sectionType)("sectionId",F.sectionData.id),i.\u0275\u0275attribute("id","section_"+F.sectionData.id),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",i.\u0275\u0275pipeBind1(3,7,W.isEnabled()))}},dependencies:[p.mk,p.$G,p.sg,p.O5,S.w,o.gY,o.Gk,o.Cu,o.gW,l.y,p.Ov,T.X$],styles:["[_nghost-%COMP%]     .card{margin-bottom:var(--ds-submission-sections-margin-bottom);overflow:unset}.section-focus[_ngcontent-%COMP%]{border-radius:var(--bs-border-radius);box-shadow:var(--bs-btn-focus-box-shadow)}[_nghost-%COMP%]     .card:first-of-type{border-bottom:var(--bs-card-border-width) solid var(--bs-card-border-color)!important;border-bottom-left-radius:var(--bs-card-border-radius)!important;border-bottom-right-radius:var(--bs-card-border-radius)!important}[_nghost-%COMP%]     .card-header button{box-shadow:none!important}[_nghost-%COMP%]     .card-header button{width:100%}"]}),m})()},79900:(q,z,t)=>{"use strict";t.d(z,{v:()=>p});var i=t(77007),l=t(9302),d=t(45608),e=t(98678);let p=(()=>{class S{constructor(T,L,X){this.injectedCollectionId=T,this.injectedSectionData=L,this.injectedSubmissionId=X,this.collectionId=T,this.sectionData=L,this.submissionId=X}ngOnInit(){this.onSectionInit(),this.updateSectionStatus()}updateSectionStatus(){this.sectionStatusSub=this.getSectionStatus().pipe((0,i.h)(T=>(0,d.pT)(T)),(0,l.O)(!0)).subscribe(T=>{this.sectionService.setSectionStatus(this.submissionId,this.sectionData.id,T)})}ngOnDestroy(){(0,d.Uh)(this.sectionStatusSub)&&this.sectionStatusSub.unsubscribe(),this.onSectionDestroy()}}return S.\u0275fac=function(T){return new(T||S)(e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},S.\u0275cmp=e.\u0275\u0275defineComponent({type:S,selectors:[["ds-section-model"]],decls:0,vars:0,template:function(T,L){},encapsulation:2}),S})()},76297:(q,z,t)=>{"use strict";t.d(z,{A:()=>d,E:()=>l});const i=new Map;function l(e){return function(S){S&&i.set(e,S)}}function d(e){return i.get(e)}},96289:(q,z,t)=>{"use strict";t.d(z,{i:()=>i});var i=(()=>{return(l=i||(i={})).Relationships="relationships",l.SubmissionForm="submission-form",l.Upload="upload",l.License="license",l.CcLicense="cclicense",l.collection="collection",l.AccessesCondition="accessCondition",l.SherpaPolicies="sherpaPolicy",l.Identifiers="identifiers",l.Collection="collection",i;var l})()},32931:(q,z,t)=>{"use strict";t.d(z,{y:()=>L});var i=t(48358),l=t(75004),d=t.n(l),e=t(73797),p=t(45608),S=t(14297),o=t(1579),T=t(98678);let L=(()=>{class X{constructor(f,D,c){this.changeDetectorRef=f,this.submissionService=D,this.sectionService=c,this.mandatory=!0,this.genericSectionErrors=[],this.allSectionErrors=[],this.active=!0,this.sectionState=this.mandatory,this.subs=[]}ngOnInit(){this.valid=this.sectionService.isSectionValid(this.submissionId,this.sectionId).pipe((0,i.U)(f=>(f&&this.resetErrors(),f))),this.subs.push(this.sectionService.getShownSectionErrors(this.submissionId,this.sectionId,this.sectionType).subscribe(f=>{(0,p.UE)(f)?f.forEach(D=>{(0,S.Z)(D.path).forEach(M=>{M.fieldId?this.allSectionErrors.push(D.message):this.genericSectionErrors=d()(this.genericSectionErrors.concat(D.message))})}):this.resetErrors()}),this.submissionService.getActiveSectionId(this.submissionId).subscribe(f=>{const D=this.active;this.active=f===this.sectionId,D!==this.active&&(this.changeDetectorRef.detectChanges(),!this.active&&(0,p.K0)(f)&&this.submissionService.dispatchSave(this.submissionId))})),this.enabled=this.sectionService.isSectionEnabled(this.submissionId,this.sectionId)}ngOnDestroy(){this.subs.filter(f=>(0,p.Uh)(f)).forEach(f=>f.unsubscribe())}sectionChange(f){this.sectionState=f.nextState}isOpen(){return this.sectionState}isMandatory(){return this.mandatory}isSectionActive(){return this.active}isEnabled(){return this.enabled}isValid(){return this.valid}removeSection(f,D){this.sectionService.removeSection(f,D)}hasGenericErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0}hasErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0||this.allSectionErrors&&this.allSectionErrors.length>0}getErrors(){return this.genericSectionErrors}setFocus(f){this.active||this.submissionService.setActiveSection(this.submissionId,this.sectionId)}isInfo(){return this.sectionService.getIsInformational(this.sectionType)}removeError(f){this.genericSectionErrors.splice(f)}resetErrors(){(0,p.UE)(this.genericSectionErrors)&&this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionId),this.genericSectionErrors=[],this.allSectionErrors=[]}}return X.\u0275fac=function(f){return new(f||X)(T.\u0275\u0275directiveInject(T.ChangeDetectorRef),T.\u0275\u0275directiveInject(o.b),T.\u0275\u0275directiveInject(e.J))},X.\u0275dir=T.\u0275\u0275defineDirective({type:X,selectors:[["","dsSection",""]],inputs:{mandatory:"mandatory",sectionId:"sectionId",sectionType:"sectionType",submissionId:"submissionId"},exportAs:["sectionRef"]}),X})()},73797:(q,z,t)=>{"use strict";t.d(z,{J:()=>F});var i=t(53426),l=t(48358),d=t(49887),e=t(69637),p=t(77007),S=t(77176),o=t(54385),T=t.n(o),L=t(34045),X=t.n(L),k=t(94667),f=t.n(k),D=t(45608),c=t(32924),M=t(86769),A=t(94056),V=t(14297),v=t(64405),G=t(65384),N=t(1579),_=t(96289),O=t(73716),b=t(5737),I=t(4786),$=t(60030),w=t(98678),m=t(18603),C=t(89702),h=t(96342);let F=(()=>{class W{constructor(U,R,g,x,j,K){this.formService=U,this.notificationsService=R,this.scrollToService=g,this.submissionService=x,this.store=j,this.translate=K}checkSectionErrors(U,R,g,x,j=[]){if((0,D.xb)(x))this.store.dispatch(new c.QC(U,R)),this.store.dispatch(new v.y5(g));else if(!f()(x,j)){const K=[];x.forEach(E=>{(0,V.Z)(E.path).forEach(Q=>{Q.fieldId&&(this.formService.addError(g,Q.fieldId,Q.fieldIndex,E.message),K.push(Q.fieldId))})}),j.forEach(E=>{(0,V.Z)(E.path).forEach(Q=>{Q.fieldId&&(K.includes(Q.fieldId)||this.formService.removeError(g,Q.fieldId,Q.fieldIndex))})})}}dispatchRemoveSectionErrors(U,R){this.store.dispatch(new c.QC(U,R))}dispatchSetSectionFormId(U,R,g){this.store.dispatch(new c.re(U,R,g))}getSectionData(U,R,g){return this.store.select((0,M.y5)(U,R)).pipe((0,l.U)(x=>g===_.i.SubmissionForm?(0,O.Vv)(x):x),(0,d.x)())}getShownSectionErrors(U,R,g){let x;return x=g!==_.i.SubmissionForm?this.getSectionErrors(U,R):this.getSectionState(U,R,g).pipe((0,e.z)(j=>this.formService.getFormErrors(j.formId).pipe((0,l.U)(K=>{const E=new $.K("sections",R),J=K.map(Q=>({path:E.getPath(Q.fieldId.replace(/\_/g,".")).path,message:Q.message})).filter(Q=>-1===T()(j.errorsToShow,{path:Q.path}));return[...j.errorsToShow,...J]})))),x}getSectionErrors(U,R){return this.store.select((0,M.Mb)(U,R)).pipe((0,d.x)())}getSectionServerErrors(U,R){return this.store.select((0,M.fh)(U,R)).pipe((0,d.x)())}getSectionState(U,R,g){return this.store.select((0,M.gd)(U,R)).pipe((0,p.h)(x=>(0,D.Uh)(x)),(0,l.U)(x=>x),(0,l.U)(x=>(0,D.Uh)(x.data)&&g===_.i.SubmissionForm?Object.assign({},x,{data:(0,O.Vv)(x.data)}):x),(0,d.x)())}isSectionValid(U,R){return this.store.select((0,M.gd)(U,R)).pipe((0,p.h)(g=>(0,D.Uh)(g)),(0,l.U)(g=>g.isValid),(0,d.x)())}isSectionActive(U,R){return this.submissionService.getActiveSectionId(U).pipe((0,l.U)(g=>R===g),(0,d.x)())}isSectionEnabled(U,R){return this.store.select((0,M.gd)(U,R)).pipe((0,p.h)(g=>(0,D.Uh)(g)),(0,l.U)(g=>g.enabled),(0,d.x)())}isSectionReadOnly(U,R,g){return this.store.select((0,M.gd)(U,R)).pipe((0,p.h)(x=>(0,D.Uh)(x)),(0,l.U)(x=>(0,D.UE)(x.visibility)&&("READONLY"===x.visibility.other&&g!==A.S.WorkspaceItem||"READONLY"===x.visibility.main&&g===A.S.WorkspaceItem)),(0,d.x)())}isSectionAvailable(U,R){return this.store.select((0,M.ak)(U)).pipe((0,p.h)(g=>(0,D.pT)(g)),(0,l.U)(g=>(0,D.pT)(g.sections)&&(0,D.pT)(g.sections[R])),(0,d.x)())}isSectionTypeAvailable(U,R){return this.store.select((0,M.ak)(U)).pipe((0,p.h)(g=>(0,D.pT)(g)),(0,l.U)(g=>(0,D.pT)(g.sections)&&(0,D.pT)(X()(g.sections,{sectionType:R}))),(0,d.x)())}isSectionType(U,R,g){return this.store.select((0,M.ak)(U)).pipe((0,p.h)(x=>(0,D.pT)(x)),(0,l.U)(x=>(0,D.pT)(x.sections)&&(0,D.pT)(x.sections[R])&&x.sections[R].sectionType===g),(0,d.x)())}addSection(U,R){this.store.dispatch(new c.gn(U,R)),this.scrollToService.scrollTo({target:R,offset:-70})}removeSection(U,R){this.store.dispatch(new c.s0(U,R))}updateSectionData(U,R,g,x=[],j=[],K){if((0,D.UE)(g)){const E=this.isSectionAvailable(U,R),J=this.isSectionEnabled(U,R);(0,i.a)(E,J).pipe((0,S.q)(1),(0,p.h)(([Q,_e])=>Q)).subscribe(([Q,_e])=>{this.store.dispatch(new c.z6(U,R,g,x,j,K))})}}setSectionError(U,R,g){this.store.dispatch(new c.uO(U,R,g))}setSectionStatus(U,R,g){this.store.dispatch(new c.hx(U,R,g))}computeSectionConfiguredMetadata(U){const R=[],g="string"==typeof U?JSON.parse(U,b.WMN):U;return g.rows&&!(0,D.xb)(g.rows)&&g.rows.forEach(x=>{x.fields&&!(0,D.xb)(x.fields)&&x.fields.forEach(j=>{j.selectableMetadata&&!(0,D.xb)(j.selectableMetadata)&&j.selectableMetadata.forEach(K=>{R.includes(K.metadata)||R.push(K.metadata)})})}),R}getIsInformational(U){return U===_.i.SherpaPolicies}}return W.\u0275fac=function(U){return new(U||W)(w.\u0275\u0275inject(I.o),w.\u0275\u0275inject(G.T),w.\u0275\u0275inject(m.ij),w.\u0275\u0275inject(N.b),w.\u0275\u0275inject(C.yh),w.\u0275\u0275inject(h.sK))},W.\u0275prov=w.\u0275\u0275defineInjectable({token:W,factory:W.\u0275fac}),W})()},89360:(q,z,t)=>{"use strict";t.d(z,{O:()=>k});var i=t(66154),l=t(30303),d=t(45608),e=t(8842),p=t(98678),S=t(35103);function o(f,D){if(1&f&&(p.\u0275\u0275elementStart(0,"span",3),p.\u0275\u0275text(1),p.\u0275\u0275elementEnd()),2&f){const c=p.\u0275\u0275nextContext().$implicit;p.\u0275\u0275advance(1),p.\u0275\u0275textInterpolate3(" ",c.name," ",c.startDate," ",c.endDate," ")}}function T(f,D){if(1&f&&(p.\u0275\u0275elementStart(0,"span",3),p.\u0275\u0275text(1),p.\u0275\u0275elementEnd()),2&f){const c=p.\u0275\u0275nextContext().$implicit;p.\u0275\u0275advance(1),p.\u0275\u0275textInterpolate2("",c.name," from ",c.endDate,"")}}function L(f,D){if(1&f&&(p.\u0275\u0275elementStart(0,"span",4),p.\u0275\u0275text(1),p.\u0275\u0275elementEnd()),2&f){const c=p.\u0275\u0275nextContext().$implicit;p.\u0275\u0275advance(1),p.\u0275\u0275textInterpolate2("",c.name," until ",c.startDate,"")}}function X(f,D){if(1&f&&(p.\u0275\u0275elementContainerStart(0),p.\u0275\u0275template(1,o,2,3,"span",1),p.\u0275\u0275template(2,T,2,2,"span",1),p.\u0275\u0275template(3,L,2,2,"span",2),p.\u0275\u0275element(4,"br"),p.\u0275\u0275elementContainerEnd()),2&f){const c=D.$implicit;p.\u0275\u0275advance(1),p.\u0275\u0275property("ngIf","DEFAULT_BITSTREAM_READ"==c.action),p.\u0275\u0275advance(1),p.\u0275\u0275property("ngIf","lease"==c.name),p.\u0275\u0275advance(1),p.\u0275\u0275property("ngIf","embargo"==c.name)}}let k=(()=>{class f{constructor(c,M){this.dsoNameService=c,this.groupService=M,this.accessConditionsList=[]}ngOnInit(){this.accessConditions.forEach(c=>{(0,d.xb)(c.name)?this.groupService.findByHref(c._links.group.href).pipe((0,i.s)(M=>!M.isResponsePending&&M.hasSucceeded)).subscribe(M=>{const A=M.payload,V=Object.assign({},c);V.name=this.dsoNameService.getName(A),this.accessConditionsList.push(V)}):this.accessConditionsList.push(c)})}}return f.\u0275fac=function(c){return new(c||f)(p.\u0275\u0275directiveInject(e._),p.\u0275\u0275directiveInject(l.O))},f.\u0275cmp=p.\u0275\u0275defineComponent({type:f,selectors:[["ds-submission-section-upload-access-conditions"]],inputs:{accessConditions:"accessConditions"},decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["class","badge badge-primary mt-3 mr-2",4,"ngIf"],["class","badge badge-dark mt-3 mr-2",4,"ngIf"],[1,"badge","badge-primary","mt-3","mr-2"],[1,"badge","badge-dark","mt-3","mr-2"]],template:function(c,M){1&c&&p.\u0275\u0275template(0,X,5,3,"ng-container",0),2&c&&p.\u0275\u0275property("ngForOf",M.accessConditionsList)},dependencies:[S.sg,S.O5],encapsulation:2}),f})()},56152:(q,z,t)=>{"use strict";t.d(z,{e:()=>U});var i=t(5737),l=t(87893);const d={id:"metadata",group:[]},e={element:{container:"form-group",label:"col-form-label"},grid:{label:"col-sm-3"}},p={id:"accessConditionGroup",group:[]},S={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},o={id:"accessConditions",groupFactory:null},T={grid:{group:"form-row pt-4"}},L={id:"name",label:"submission.sections.upload.form.access-condition-label",hint:"submission.sections.upload.form.access-condition-hint",options:[]},X={element:{host:"col-12",label:"col-form-label name-label"}},k={id:"startDate",label:"submission.sections.upload.form.from-label",hint:"submission.sections.upload.form.from-hint",placeholder:"submission.sections.upload.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:i.O6Y,operator:i.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-from"}},f={element:{label:"col-form-label"},grid:{host:"col-6"}},D={id:"endDate",label:"submission.sections.upload.form.until-label",hint:"submission.sections.upload.form.until-hint",placeholder:"submission.sections.upload.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:i.O6Y,operator:i.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-until"}},c={element:{label:"col-form-label"},grid:{host:"col-6"}};var M=t(50123),A=t(45608),V=t(1579),v=t(4786),G=t(82485),N=t(77176),_=t(77007),O=t(69637),b=t(710),I=t(78187),$=t(11915),w=t(53113),m=t(98678),C=t(65706),h=t(35103),F=t(96342);const W=["formRef"];function se(R,g){if(1&R){const x=m.\u0275\u0275getCurrentView();m.\u0275\u0275elementStart(0,"ds-form",6,7),m.\u0275\u0275listener("submitForm",function(){m.\u0275\u0275restoreView(x);const K=m.\u0275\u0275nextContext();return m.\u0275\u0275resetView(K.onSubmit())})("cancel",function(){m.\u0275\u0275restoreView(x);const K=m.\u0275\u0275nextContext();return m.\u0275\u0275resetView(K.onModalClose())})("dfChange",function(K){m.\u0275\u0275restoreView(x);const E=m.\u0275\u0275nextContext();return m.\u0275\u0275resetView(E.onChange(K))}),m.\u0275\u0275elementEnd()}if(2&R){const x=m.\u0275\u0275nextContext();m.\u0275\u0275property("formId",x.formId)("formModel",x.formModel)("displaySubmit",!x.isSaving)("displayCancel",!x.isSaving)}}let U=(()=>{class R{constructor(x,j,K,E,J,Q,_e,Z){this.activeModal=x,this.cdr=j,this.formBuilderService=K,this.formService=E,this.submissionService=J,this.operationsBuilder=Q,this.operationsService=_e,this.uploadService=Z,this.formMetadata=[],this.isSaving=!1,this.subscriptions=[]}initModelData(x){this.fileData.accessConditions.forEach((j,K)=>{Array.of("name","startDate","endDate").filter(E=>j.hasOwnProperty(E)&&(0,A.UE)(j[E])).forEach(E=>{const J=this.formBuilderService.findById(E,x,K);if(J)if(J.type===i.VId){const Q=new Date(j[E]);J.value={year:Q.getUTCFullYear(),month:Q.getUTCMonth()+1,day:Q.getUTCDate()}}else J.value=j[E]})})}onChange(x){"name"===x.model.id&&this.setOptions(x.model,x.control)}onModalClose(){this.activeModal.dismiss()}onSubmit(){this.isSaving=!0,this.saveBitstreamData()}setOptions(x,j){let K=null;if(this.availableAccessConditionOptions.filter(E=>E.name===j.value).forEach(E=>K=E),(0,A.UE)(K)){const E=j.parent.get("startDate"),J=j.parent.get("endDate");E?.markAsUntouched(),J?.markAsUntouched(),E?.setValue(null),j.parent.markAsDirty(),J?.setValue(null)}}ngOnInit(){this.fileData&&this.formId&&(this.formModel=this.buildFileEditForm(),this.cdr.detectChanges())}ngOnDestroy(){this.unsubscribeAll()}retrieveValueFromField(x){const j=Array.isArray(x)?x[0]:x;return j?j.value:void 0}buildFileEditForm(){const x=Object.assign({},this.configMetadataForm.rows[0].fields[0]);x.repeatable=!1;const j=Object.assign({},this.configMetadataForm,{fields:Object.assign([],this.configMetadataForm.rows[0].fields[0],[this.configMetadataForm.rows[0].fields[0],x])}),K=[],E=Object.assign({},d);E.group=this.formBuilderService.modelFromConfiguration(this.submissionId,j,this.collectionId,this.fileData.metadata,this.submissionService.getSubmissionScope()),K.push(new i.S_O(E,e));const J=Object.assign({},L),Q=Object.assign({},o),_e=[];if(this.collectionPolicyType===M.B1){for(const he of this.availableAccessConditionOptions)_e.push({label:he.name,value:he.name});J.options=_e;const Z=[],ae=[];let Y,re;this.availableAccessConditionOptions.forEach(he=>{if(he.hasStartDate&&(Z.push({id:"name",value:he.name}),he.maxStartDate)){const te=new Date(he.maxStartDate);Y={year:te.getUTCFullYear(),month:te.getUTCMonth()+1,day:te.getUTCDate()}}if(he.hasEndDate&&(ae.push({id:"name",value:he.name}),he.maxEndDate)){const te=new Date(he.maxEndDate);re={year:te.getUTCFullYear(),month:te.getUTCMonth()+1,day:te.getUTCDate()}}});const me={relations:[{match:i.O6Y,operator:i.F8e,when:Z}]},fe={relations:[{match:i.O6Y,operator:i.F8e,when:ae}]},Ie=Z.length>0,Re=ae.length>0;Q.groupFactory=()=>{const he=new i.nMt(J,X),te=Object.assign({},k,me);Y&&(te.max=Y);const Ae=Object.assign({},D,fe);re&&(Ae.max=re);const Ee=new i.oqv(te,f),je=new i.oqv(Ae,c),xe=Object.assign({},p);return xe.group=[he],Ie&&xe.group.push(Ee),Re&&xe.group.push(je),[new i.S_O(xe,S)]},Q.initialCount=(0,A.UE)(this.fileData.accessConditions)?this.fileData.accessConditions.length:1,K.push(new i.RRz(Q,T))}return this.initModelData(K),K}saveBitstreamData(){this.formService.validateAllFormFields(this.formRef.formGroup);const x=this.formService.isValid(this.formId).pipe((0,N.q)(1),(0,_.h)(j=>j),(0,O.z)(()=>this.formService.getFormData(this.formId)),(0,N.q)(1),(0,O.z)(j=>{Object.keys(j.metadata).filter(E=>(0,A.UE)(j.metadata[E])).forEach(E=>{const Q=`metadata/${E.replace(/_/g,".")}`;this.operationsBuilder.add(this.pathCombiner.getPath(Q),j.metadata[E],!0)}),Object.keys(this.fileData.metadata).filter(E=>(0,A.UE)(this.fileData.metadata[E])).filter(E=>(0,A.xI)(j.metadata[E])).filter(E=>this.formMetadata.includes(E)).forEach(E=>{const Q=`metadata/${E.replace(/_/g,".")}`;this.operationsBuilder.remove(this.pathCombiner.getPath(Q))});const K=[];return j.accessConditions.map(E=>E.accessConditionGroup).filter(E=>(0,A.UE)(E)).forEach(E=>{let J;if(this.availableAccessConditionOptions.filter(Q=>(0,A.K0)(E.name)&&Q.name===E.name[0].value).forEach(Q=>J=Q),J){const Q=Object.assign({},E);if(Q.name=this.retrieveValueFromField(E.name),J.hasStartDate){if(E.startDate){const _e=this.retrieveValueFromField(E.startDate);let Z=new Date(_e);if(J.maxStartDate){const ae=new Date(J.maxStartDate);Z>ae&&(Z=ae)}Q.startDate=(0,b.iV)(Z)}}else delete Q.startDate;if(J.hasEndDate){if(E.endDate){const _e=this.retrieveValueFromField(E.endDate);let Z=new Date(_e);if(J.maxEndDate){const ae=new Date(J.maxEndDate);Z>ae&&(Z=ae)}Q.endDate=(0,b.iV)(Z)}}else delete Q.endDate;K.push(Q)}}),(0,A.UE)(K)&&this.operationsBuilder.add(this.pathCombiner.getPath("accessConditions"),K,!0),this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement)})).subscribe(j=>{if(j[0].sections[this.sectionId]){const K=j[0].sections[this.sectionId];Object.keys(K.files).filter(E=>K.files[E].uuid===this.fileId).forEach(E=>this.uploadService.updateFileData(this.submissionId,this.sectionId,this.fileId,K.files[E]))}this.isSaving=!1,this.activeModal.close()});this.subscriptions.push(x)}unsubscribeAll(){this.subscriptions.filter(x=>(0,A.Uh)(x)).forEach(x=>x.unsubscribe())}}return R.\u0275fac=function(x){return new(x||R)(m.\u0275\u0275directiveInject(C.Kz),m.\u0275\u0275directiveInject(m.ChangeDetectorRef),m.\u0275\u0275directiveInject(l.c),m.\u0275\u0275directiveInject(v.o),m.\u0275\u0275directiveInject(V.b),m.\u0275\u0275directiveInject(I.w),m.\u0275\u0275directiveInject($.E),m.\u0275\u0275directiveInject(w.K))},R.\u0275cmp=m.\u0275\u0275defineComponent({type:R,selectors:[["ds-submission-section-upload-file-edit"]],viewQuery:function(x,j){if(1&x&&m.\u0275\u0275viewQuery(W,5),2&x){let K;m.\u0275\u0275queryRefresh(K=m.\u0275\u0275loadQuery())&&(j.formRef=K.first)}},decls:10,vars:5,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"disabled","click"],["aria-hidden","true"],[1,"modal-body"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange"],["formRef","formComponent"]],template:function(x,j){1&x&&(m.\u0275\u0275elementStart(0,"div")(1,"div",0)(2,"h4",1),m.\u0275\u0275text(3),m.\u0275\u0275pipe(4,"translate"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(5,"button",2),m.\u0275\u0275listener("click",function(){return j.onModalClose()}),m.\u0275\u0275elementStart(6,"span",3),m.\u0275\u0275text(7,"\xd7"),m.\u0275\u0275elementEnd()()(),m.\u0275\u0275elementStart(8,"div",4),m.\u0275\u0275template(9,se,2,4,"ds-form",5),m.\u0275\u0275elementEnd()()),2&x&&(m.\u0275\u0275advance(3),m.\u0275\u0275textInterpolate(m.\u0275\u0275pipeBind1(4,3,"submission.sections.upload.edit.title")),m.\u0275\u0275advance(2),m.\u0275\u0275property("disabled",j.isSaving),m.\u0275\u0275advance(4),m.\u0275\u0275property("ngIf",j.formModel))},dependencies:[h.O5,G.U,F.X$],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]}),R})()},80434:(q,z,t)=>{"use strict";t.r(z),t.d(z,{SubmissionSectionUploadFileComponent:()=>$});var i=t(35841),l=t(77007),d=t(53113),e=t(45608),p=t(4786),S=t(78187),o=t(60030),L=(t(36424),t(1579)),X=t(18005),k=t(11915),f=t(56152),D=t(1535),c=t(98678),M=t(65706),A=t(35103),V=t(50122),v=t(64744),G=t(69721),N=t(96342);function _(w,m){1&w&&c.\u0275\u0275element(0,"i",16)}function O(w,m){1&w&&c.\u0275\u0275element(0,"i",17)}function b(w,m){if(1&w){const C=c.\u0275\u0275getCurrentView();c.\u0275\u0275elementContainerStart(0),c.\u0275\u0275elementStart(1,"div",2)(2,"div",3)(3,"div",4)(4,"h3"),c.\u0275\u0275text(5),c.\u0275\u0275elementStart(6,"span",5),c.\u0275\u0275text(7),c.\u0275\u0275pipe(8,"dsFileSize"),c.\u0275\u0275elementEnd()()(),c.\u0275\u0275elementStart(9,"div",6),c.\u0275\u0275elementContainerStart(10),c.\u0275\u0275elementStart(11,"ds-themed-file-download-link",7),c.\u0275\u0275element(12,"i",8),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(13,"button",9),c.\u0275\u0275listener("click",function(F){c.\u0275\u0275restoreView(C);const W=c.\u0275\u0275nextContext();return F.preventDefault(),c.\u0275\u0275resetView(W.editBitstreamData())}),c.\u0275\u0275pipe(14,"translate"),c.\u0275\u0275pipe(15,"translate"),c.\u0275\u0275element(16,"i",10),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(17,"button",11),c.\u0275\u0275listener("click",function(F){c.\u0275\u0275restoreView(C);const W=c.\u0275\u0275nextContext(),se=c.\u0275\u0275reference(2);return F.preventDefault(),c.\u0275\u0275resetView(W.confirmDelete(se))}),c.\u0275\u0275pipe(18,"translate"),c.\u0275\u0275pipe(19,"translate"),c.\u0275\u0275pipe(20,"async"),c.\u0275\u0275template(21,_,1,0,"i",12),c.\u0275\u0275pipe(22,"async"),c.\u0275\u0275template(23,O,1,0,"i",13),c.\u0275\u0275pipe(24,"async"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementContainerEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275element(25,"div",14)(26,"ds-submission-section-upload-file-view",15),c.\u0275\u0275elementEnd()(),c.\u0275\u0275elementContainerEnd()}if(2&w){const C=c.\u0275\u0275nextContext();c.\u0275\u0275advance(5),c.\u0275\u0275textInterpolate1("",C.fileName," "),c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate1("(",c.\u0275\u0275pipeBind1(8,14,null==C.fileData?null:C.fileData.sizeBytes),")"),c.\u0275\u0275advance(4),c.\u0275\u0275property("cssClasses","btn btn-link-focus")("isBlank",!0)("bitstream",C.getBitstream())("enableRequestACopy",!1),c.\u0275\u0275advance(2),c.\u0275\u0275propertyInterpolate("title",c.\u0275\u0275pipeBind1(15,18,"submission.sections.upload.edit.title")),c.\u0275\u0275attribute("aria-label",c.\u0275\u0275pipeBind1(14,16,"submission.sections.upload.edit.title")),c.\u0275\u0275advance(4),c.\u0275\u0275propertyInterpolate("title",c.\u0275\u0275pipeBind1(19,22,"submission.sections.upload.delete.confirm.title")),c.\u0275\u0275property("disabled",c.\u0275\u0275pipeBind1(20,24,C.processingDelete$)),c.\u0275\u0275attribute("aria-label",c.\u0275\u0275pipeBind1(18,20,"submission.sections.upload.delete.confirm.title")),c.\u0275\u0275advance(4),c.\u0275\u0275property("ngIf",c.\u0275\u0275pipeBind1(22,26,C.processingDelete$)),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngIf",!c.\u0275\u0275pipeBind1(24,28,C.processingDelete$)),c.\u0275\u0275advance(3),c.\u0275\u0275property("fileData",C.fileData)}}function I(w,m){if(1&w){const C=c.\u0275\u0275getCurrentView();c.\u0275\u0275elementStart(0,"div",18)(1,"h4",19),c.\u0275\u0275text(2),c.\u0275\u0275pipe(3,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(4,"button",20),c.\u0275\u0275listener("click",function(){const W=c.\u0275\u0275restoreView(C).dismiss;return c.\u0275\u0275resetView(W("cancel"))}),c.\u0275\u0275elementStart(5,"span",21),c.\u0275\u0275text(6,"\xd7"),c.\u0275\u0275elementEnd()()(),c.\u0275\u0275elementStart(7,"div",22)(8,"p"),c.\u0275\u0275text(9),c.\u0275\u0275pipe(10,"translate"),c.\u0275\u0275elementEnd()(),c.\u0275\u0275elementStart(11,"div",23)(12,"button",24),c.\u0275\u0275listener("click",function(){const W=c.\u0275\u0275restoreView(C).close;return c.\u0275\u0275resetView(W("cancel"))}),c.\u0275\u0275text(13),c.\u0275\u0275pipe(14,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(15,"button",25),c.\u0275\u0275listener("click",function(){const W=c.\u0275\u0275restoreView(C).close;return c.\u0275\u0275resetView(W("ok"))}),c.\u0275\u0275text(16),c.\u0275\u0275pipe(17,"translate"),c.\u0275\u0275elementEnd()()}2&w&&(c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(c.\u0275\u0275pipeBind1(3,4,"submission.sections.upload.delete.confirm.title")),c.\u0275\u0275advance(7),c.\u0275\u0275textInterpolate(c.\u0275\u0275pipeBind1(10,6,"submission.sections.upload.delete.confirm.info")),c.\u0275\u0275advance(4),c.\u0275\u0275textInterpolate(c.\u0275\u0275pipeBind1(14,8,"submission.sections.upload.delete.confirm.cancel")),c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate(c.\u0275\u0275pipeBind1(17,10,"submission.sections.upload.delete.confirm.submit")))}let $=(()=>{class w{constructor(C,h,F,W,se,U,R,g){this.cdr=C,this.formService=h,this.halService=F,this.modalService=W,this.operationsBuilder=se,this.operationsService=U,this.submissionService=R,this.uploadService=g,this.processingDelete$=new i.X(!1),this.subscriptions=[],this.formMetadata=[],this.readMode=!0}ngOnChanges(C){this.availableAccessConditionOptions&&this.subscriptions.push(this.uploadService.getFileData(this.submissionId,this.sectionId,this.fileId).pipe((0,l.h)(h=>(0,e.pT)(h))).subscribe(h=>{this.fileData=h}))}ngOnInit(){this.formId=this.formService.getUniqueId(this.fileId),this.pathCombiner=new o.K("sections",this.sectionId,"files",this.fileIndex),this.loadFormMetadata()}confirmDelete(C){this.modalService.open(C).result.then(h=>{"ok"===h&&(this.processingDelete$.next(!0),this.deleteFile())})}getBitstream(){return Object.assign(new D.Z,{uuid:this.fileData.uuid})}editBitstreamData(){const h=this.modalService.open(f.e,{size:"xl",backdrop:"static"});h.componentInstance.availableAccessConditionOptions=this.availableAccessConditionOptions,h.componentInstance.collectionId=this.collectionId,h.componentInstance.collectionPolicyType=this.collectionPolicyType,h.componentInstance.configMetadataForm=this.configMetadataForm,h.componentInstance.fileData=this.fileData,h.componentInstance.fileId=this.fileId,h.componentInstance.fileIndex=this.fileIndex,h.componentInstance.formId=this.formId,h.componentInstance.sectionId=this.sectionId,h.componentInstance.formMetadata=this.formMetadata,h.componentInstance.pathCombiner=this.pathCombiner,h.componentInstance.submissionId=this.submissionId}ngOnDestroy(){this.unsubscribeAll()}unsubscribeAll(){this.subscriptions.filter(C=>(0,e.Uh)(C)).forEach(C=>C.unsubscribe())}loadFormMetadata(){this.configMetadataForm.rows.forEach(C=>{C.fields.forEach(h=>{h.selectableMetadata.forEach(F=>{this.formMetadata.push(F.metadata)})})})}deleteFile(){this.operationsBuilder.remove(this.pathCombiner.getPath()),this.subscriptions.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement).subscribe(()=>{this.uploadService.removeUploadedFile(this.submissionId,this.sectionId,this.fileId),this.processingDelete$.next(!1)}))}}return w.\u0275fac=function(C){return new(C||w)(c.\u0275\u0275directiveInject(c.ChangeDetectorRef),c.\u0275\u0275directiveInject(p.o),c.\u0275\u0275directiveInject(X.q),c.\u0275\u0275directiveInject(M.FF),c.\u0275\u0275directiveInject(S.w),c.\u0275\u0275directiveInject(k.E),c.\u0275\u0275directiveInject(L.b),c.\u0275\u0275directiveInject(d.K))},w.\u0275cmp=c.\u0275\u0275defineComponent({type:w,selectors:[["ds-submission-upload-section-file"]],viewQuery:function(C,h){if(1&C&&c.\u0275\u0275viewQuery(f.e,5),2&C){let F;c.\u0275\u0275queryRefresh(F=c.\u0275\u0275loadQuery())&&(h.fileEditComp=F.first)}},inputs:{availableAccessConditionOptions:"availableAccessConditionOptions",collectionId:"collectionId",collectionPolicyType:"collectionPolicyType",configMetadataForm:"configMetadataForm",fileId:"fileId",fileIndex:"fileIndex",fileName:"fileName",sectionId:"sectionId",submissionId:"submissionId"},features:[c.\u0275\u0275NgOnChangesFeature],decls:3,vars:1,consts:[[4,"ngIf"],["content",""],[1,"row"],[1,"col-md-12"],[1,"float-left","w-75"],[1,"text-muted"],[1,"float-right","w-15"],[3,"cssClasses","isBlank","bitstream","enableRequestACopy"],["aria-hidden","true",1,"fa","fa-download","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"title","click"],[1,"fa","fa-edit","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"title","disabled","click"],["class","fas fa-circle-notch fa-spin fa-2x text-danger",4,"ngIf"],["class","fa fa-trash fa-2x text-danger",4,"ngIf"],[1,"clearfix"],[3,"fileData"],[1,"fas","fa-circle-notch","fa-spin","fa-2x","text-danger"],[1,"fa","fa-trash","fa-2x","text-danger"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(C,h){1&C&&(c.\u0275\u0275template(0,b,27,30,"ng-container",0),c.\u0275\u0275template(1,I,18,12,"ng-template",null,1,c.\u0275\u0275templateRefExtractor)),2&C&&c.\u0275\u0275property("ngIf",h.fileData)},dependencies:[A.O5,V.t,v.m,A.Ov,G.p,N.X$]}),w})()},64744:(q,z,t)=>{"use strict";t.d(z,{m:()=>_});var i=t(45608),l=t(71432),d=t(98678),e=t(35103),p=t(89360),S=t(21322),o=t(96342);function T(O,b){if(1&O&&(d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275elementStart(1,"h5"),d.\u0275\u0275text(2),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementContainerEnd()),2&O){const I=d.\u0275\u0275nextContext().$implicit;d.\u0275\u0275advance(2),d.\u0275\u0275textInterpolate1(" ",I.value," ")}}function L(O,b){if(1&O&&(d.\u0275\u0275elementStart(0,"h5")(1,"span",5),d.\u0275\u0275text(2),d.\u0275\u0275pipe(3,"translate"),d.\u0275\u0275elementEnd()()),2&O){const I=d.\u0275\u0275nextContext(4);d.\u0275\u0275advance(2),d.\u0275\u0275textInterpolate2("",d.\u0275\u0275pipeBind1(3,2,"submission.sections.upload.no-entry")," ",I.fileTitleKey,"")}}function X(O,b){if(1&O&&(d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275template(1,L,4,4,"h5",0),d.\u0275\u0275elementContainerEnd()),2&O){const I=d.\u0275\u0275nextContext().$implicit,$=d.\u0275\u0275nextContext(2);d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",0===$.metadata[$.fileTitleKey].indexOf(I))}}function k(O,b){if(1&O&&(d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275template(1,T,3,1,"ng-container",0),d.\u0275\u0275template(2,X,2,1,"ng-container",0),d.\u0275\u0275element(3,"span",2),d.\u0275\u0275elementContainerEnd()),2&O){const I=b.$implicit;d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",""!==I.value),d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",""===I.value)}}const f=function(){return["150"]};function D(O,b){if(1&O&&(d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275text(1),d.\u0275\u0275pipe(2,"dsTruncate"),d.\u0275\u0275elementContainerEnd()),2&O){const I=d.\u0275\u0275nextContext().$implicit;d.\u0275\u0275advance(1),d.\u0275\u0275textInterpolate1(" ",d.\u0275\u0275pipeBind2(2,1,I.value,d.\u0275\u0275pureFunction0(4,f))," ")}}function c(O,b){if(1&O&&(d.\u0275\u0275elementStart(0,"span",5),d.\u0275\u0275text(1),d.\u0275\u0275pipe(2,"translate"),d.\u0275\u0275elementEnd()),2&O){const I=d.\u0275\u0275nextContext(4);d.\u0275\u0275advance(1),d.\u0275\u0275textInterpolate2("",d.\u0275\u0275pipeBind1(2,2,"submission.sections.upload.no-entry")," ",I.fileDescrKey,"")}}function M(O,b){if(1&O&&(d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275template(1,c,3,4,"span",6),d.\u0275\u0275elementContainerEnd()),2&O){const I=d.\u0275\u0275nextContext().$implicit,$=d.\u0275\u0275nextContext(2);d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",0===$.metadata[$.fileDescrKey].indexOf(I))}}function A(O,b){if(1&O&&(d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275template(1,D,3,5,"ng-container",0),d.\u0275\u0275template(2,M,2,1,"ng-container",0),d.\u0275\u0275element(3,"span",2),d.\u0275\u0275elementContainerEnd()),2&O){const I=b.$implicit;d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",""!==I.value),d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",""===I.value)}}function V(O,b){if(1&O&&(d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275template(1,k,4,2,"ng-container",4),d.\u0275\u0275template(2,A,4,2,"ng-container",4),d.\u0275\u0275elementContainerEnd()),2&O){const I=d.\u0275\u0275nextContext();d.\u0275\u0275advance(1),d.\u0275\u0275property("ngForOf",I.getAllMetadataValue(I.fileTitleKey)),d.\u0275\u0275advance(1),d.\u0275\u0275property("ngForOf",I.getAllMetadataValue(I.fileDescrKey))}}const v=function(O){return{format:O}};function G(O,b){if(1&O&&(d.\u0275\u0275elementStart(0,"div",7),d.\u0275\u0275text(1),d.\u0275\u0275pipe(2,"translate"),d.\u0275\u0275elementEnd()),2&O){const I=d.\u0275\u0275nextContext();d.\u0275\u0275advance(1),d.\u0275\u0275textInterpolate1(" ",d.\u0275\u0275pipeBind2(2,1,"admin.registries.bitstream-formats.edit.head",d.\u0275\u0275pureFunction1(4,v,I.fileFormat))," ")}}function N(O,b){if(1&O&&(d.\u0275\u0275elementStart(0,"div",7),d.\u0275\u0275text(1),d.\u0275\u0275elementEnd()),2&O){const I=d.\u0275\u0275nextContext();d.\u0275\u0275advance(1),d.\u0275\u0275textInterpolate2(" Checksum ",I.fileCheckSum.checkSumAlgorithm,": ",I.fileCheckSum.value," ")}}let _=(()=>{class O{constructor(){this.metadata=Object.create({}),this.fileTitleKey="Title",this.fileDescrKey="Description"}ngOnInit(){(0,i.UE)(this.fileData.metadata)&&(this.metadata[this.fileTitleKey]=l.S.all(this.fileData.metadata,"dc.title"),this.metadata[this.fileDescrKey]=l.S.all(this.fileData.metadata,"dc.description")),this.fileCheckSum=this.fileData.checkSum,this.fileFormat=this.fileData.format.shortDescription}getAllMetadataValue(I){return l.S.all(this.metadata,I)}}return O.\u0275fac=function(I){return new(I||O)},O.\u0275cmp=d.\u0275\u0275defineComponent({type:O,selectors:[["ds-submission-section-upload-file-view"]],inputs:{fileData:"fileData"},decls:6,vars:4,consts:[[4,"ngIf"],["class","mt-1",4,"ngIf"],[1,"clearfix"],[3,"accessConditions"],[4,"ngFor","ngForOf"],[1,"text-muted"],["class","text-muted",4,"ngIf"],[1,"mt-1"]],template:function(I,$){1&I&&(d.\u0275\u0275elementStart(0,"div"),d.\u0275\u0275template(1,V,3,2,"ng-container",0),d.\u0275\u0275template(2,G,3,6,"div",1),d.\u0275\u0275template(3,N,2,2,"div",1),d.\u0275\u0275element(4,"span",2)(5,"ds-submission-section-upload-access-conditions",3),d.\u0275\u0275elementEnd()),2&I&&(d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",$.metadata),d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",$.fileFormat),d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",$.fileCheckSum),d.\u0275\u0275advance(2),d.\u0275\u0275property("accessConditions",$.fileData.accessConditions))},dependencies:[e.sg,e.O5,p.O,S.W,o.X$],encapsulation:2}),O})()},50123:(q,z,t)=>{"use strict";t.d(z,{B1:()=>g,vk:()=>x});var w,i=t(70655),l=t(98678),d=t(35841),e=t(53426),p=t(48358),S=t(21160),o=t(77007),T=t(27303),L=t(69637),X=t(49887),k=t(79900),f=t(45608),D=t(53113),c=t(95445),M=t(30303),A=t(35071),V=t(37920),v=t(96289),G=t(76297),N=t(60987),_=t(73797),O=t(1579),b=t(46533),I=t(10572),$=t(8842);function m(j,K){1&j&&(l.\u0275\u0275elementContainerStart(0),l.\u0275\u0275elementStart(1,"div",2)(2,"div",3)(3,"h3",4)(4,"span",5),l.\u0275\u0275text(5),l.\u0275\u0275pipe(6,"translate"),l.\u0275\u0275elementEnd()()()(),l.\u0275\u0275elementContainerEnd()),2&j&&(l.\u0275\u0275advance(5),l.\u0275\u0275textInterpolate(l.\u0275\u0275pipeBind1(6,1,"submission.sections.upload.no-file-uploaded")))}const C=function(j){return{collectionName:j}};function h(j,K){if(1&j&&(l.\u0275\u0275elementContainerStart(0),l.\u0275\u0275text(1),l.\u0275\u0275pipe(2,"translate"),l.\u0275\u0275elementContainerEnd()),2&j){const E=l.\u0275\u0275nextContext(3);l.\u0275\u0275advance(1),l.\u0275\u0275textInterpolate1(" ",l.\u0275\u0275pipeBind2(2,1,"submission.sections.upload.header.policy.default.nolist",l.\u0275\u0275pureFunction1(4,C,E.collectionName))," ")}}function F(j,K){if(1&j&&(l.\u0275\u0275elementContainerStart(0),l.\u0275\u0275text(1),l.\u0275\u0275pipe(2,"translate"),l.\u0275\u0275elementContainerEnd()),2&j){const E=l.\u0275\u0275nextContext(3);l.\u0275\u0275advance(1),l.\u0275\u0275textInterpolate1(" ",l.\u0275\u0275pipeBind2(2,1,"submission.sections.upload.header.policy.default.withlist",l.\u0275\u0275pureFunction1(4,C,E.collectionName))," ")}}function W(j,K){if(1&j&&(l.\u0275\u0275elementStart(0,"div",2)(1,"div",8)(2,"ds-alert",9),l.\u0275\u0275template(3,h,3,6,"ng-container",1),l.\u0275\u0275template(4,F,3,6,"ng-container",1),l.\u0275\u0275element(5,"span",10)(6,"ds-submission-section-upload-access-conditions",11),l.\u0275\u0275elementEnd()()()),2&j){const E=l.\u0275\u0275nextContext(2);l.\u0275\u0275advance(2),l.\u0275\u0275property("type",E.AlertTypeEnum.Warning),l.\u0275\u0275advance(1),l.\u0275\u0275property("ngIf",1===E.collectionPolicyType),l.\u0275\u0275advance(1),l.\u0275\u0275property("ngIf",2===E.collectionPolicyType),l.\u0275\u0275advance(2),l.\u0275\u0275property("accessConditions",E.collectionDefaultAccessConditions)}}function se(j,K){if(1&j&&(l.\u0275\u0275elementContainerStart(0),l.\u0275\u0275element(1,"ds-themed-submission-upload-section-file",12),l.\u0275\u0275pipe(2,"async"),l.\u0275\u0275elementStart(3,"div",2)(4,"div",3),l.\u0275\u0275element(5,"hr"),l.\u0275\u0275elementEnd()(),l.\u0275\u0275elementContainerEnd()),2&j){const E=K.$implicit,J=l.\u0275\u0275nextContext(2);l.\u0275\u0275advance(1),l.\u0275\u0275property("availableAccessConditionOptions",J.availableAccessConditionOptions)("collectionId",J.collectionId)("collectionPolicyType",J.collectionPolicyType)("configMetadataForm",l.\u0275\u0275pipeBind1(2,9,J.configMetadataForm$))("fileId",J.fileIndexes[J.fileList.indexOf(E)])("fileIndex",J.fileList.indexOf(E))("fileName",J.fileNames[J.fileList.indexOf(E)])("sectionId",J.sectionData.id)("submissionId",J.submissionId)}}function U(j,K){if(1&j&&(l.\u0275\u0275elementContainerStart(0),l.\u0275\u0275template(1,W,7,4,"div",6),l.\u0275\u0275template(2,se,6,11,"ng-container",7),l.\u0275\u0275elementContainerEnd()),2&j){const E=l.\u0275\u0275nextContext();l.\u0275\u0275advance(1),l.\u0275\u0275property("ngIf",E.collectionDefaultAccessConditions.length>0),l.\u0275\u0275advance(1),l.\u0275\u0275property("ngForOf",E.fileList)}}const g=2;let x=((w=class extends k.v{constructor(K,E,J,Q,_e,Z,ae,Y,re,me,fe){super(void 0,me,fe),this.bitstreamService=K,this.changeDetectorRef=E,this.collectionDataService=J,this.groupService=Q,this.resourcePolicyService=_e,this.sectionService=Z,this.submissionService=ae,this.uploadsConfigService=Y,this.dsoNameService=re,this.injectedSectionData=me,this.injectedSubmissionId=fe,this.AlertTypeEnum=N.N,this.fileIndexes=[],this.fileList=[],this.fileNames=[],this.collectionDefaultAccessConditions=[],this.required$=new d.X(!0),this.subs=[]}onSectionInit(){const K=this.uploadsConfigService.findByHref(this.sectionData.config,!0,!1,(0,b.l)("metadata")).pipe((0,I.xw)(),(0,p.U)(E=>E.payload));this.configMetadataForm$=K.pipe((0,S.w)(E=>E.metadata.pipe((0,I.xw)(),(0,p.U)(J=>J.payload)))),this.subs.push(this.submissionService.getSubmissionObject(this.submissionId).pipe((0,o.h)(E=>(0,f.pT)(E)&&!E.isLoading),(0,o.h)(E=>(0,f.o8)(this.collectionId)||this.collectionId!==E.collection),(0,T.b)(E=>this.collectionId=E.collection),(0,L.z)(E=>this.collectionDataService.findById(E.collection)),(0,o.h)(E=>(0,f.pT)(E.payload)),(0,T.b)(E=>this.collectionName=this.dsoNameService.getName(E.payload)),(0,L.z)(()=>K)).subscribe(E=>{this.required$.next(E.required),this.availableAccessConditionOptions=(0,f.UE)(E.accessConditionOptions)?E.accessConditionOptions:[],this.collectionPolicyType=this.availableAccessConditionOptions.length>0?g:1,this.changeDetectorRef.detectChanges()}),(0,e.a)(this.configMetadataForm$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id)).pipe((0,o.h)(([E,J])=>(0,f.UE)(E)&&(0,f.pT)(J)),(0,X.x)()).subscribe(([E,J])=>{this.fileList=[],this.fileIndexes=[],this.fileNames=[],this.changeDetectorRef.detectChanges(),(0,f.pT)(J)&&J.length>0&&J.forEach(Q=>{this.fileList.push(Q),this.fileIndexes.push(Q.uuid),this.fileNames.push(this.getFileName(E,Q))}),this.changeDetectorRef.detectChanges()}))}getFileName(K,E){const J=K.rows[0].fields[0].selectableMetadata[0].metadata;let Q;return Q=(0,f.UE)(E.metadata)&&(0,f.UE)(E.metadata[J])?E.metadata[J][0].display:E.uuid,Q}getSectionStatus(){return(0,e.a)(this.required$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id),(K,E)=>!K||(0,f.pT)(E)&&E.length>0)}onSectionDestroy(){this.subs.filter(K=>(0,f.Uh)(K)).forEach(K=>K.unsubscribe())}}).\u0275fac=function(K){return new(K||w)(l.\u0275\u0275directiveInject(D.K),l.\u0275\u0275directiveInject(l.ChangeDetectorRef),l.\u0275\u0275directiveInject(c.W),l.\u0275\u0275directiveInject(M.O),l.\u0275\u0275directiveInject(A.I),l.\u0275\u0275directiveInject(_.J),l.\u0275\u0275directiveInject(O.b),l.\u0275\u0275directiveInject(V.w),l.\u0275\u0275directiveInject($._),l.\u0275\u0275directiveInject("sectionDataProvider"),l.\u0275\u0275directiveInject("submissionIdProvider"))},w.\u0275cmp=l.\u0275\u0275defineComponent({type:w,selectors:[["ds-submission-section-upload"]],features:[l.\u0275\u0275InheritDefinitionFeature],decls:3,vars:5,consts:[[3,"content","dismissible","type"],[4,"ngIf"],[1,"row"],[1,"col-md-12"],[1,"text-center"],[1,"text-muted"],["class","row",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"col-sm-12"],[3,"type"],[1,"clearfix"],[3,"accessConditions"],[3,"availableAccessConditionOptions","collectionId","collectionPolicyType","configMetadataForm","fileId","fileIndex","fileName","sectionId","submissionId"]],template:function(K,E){1&K&&(l.\u0275\u0275element(0,"ds-alert",0),l.\u0275\u0275template(1,m,7,3,"ng-container",1),l.\u0275\u0275template(2,U,3,2,"ng-container",1)),2&K&&(l.\u0275\u0275property("content","submission.sections.upload.info")("dismissible",!0)("type",E.AlertTypeEnum.Info),l.\u0275\u0275advance(1),l.\u0275\u0275property("ngIf",0==E.fileList.length),l.\u0275\u0275advance(1),l.\u0275\u0275property("ngIf",E.fileList.length>0))}}),w);x=(0,i.__decorate)([(0,G.E)(v.i.Upload),(0,i.__metadata)("design:paramtypes",[D.K,l.ChangeDetectorRef,c.W,M.O,A.I,_.J,O.b,V.w,$._,Object,String])],x)},53113:(q,z,t)=>{"use strict";t.d(z,{K:()=>L});var i=t(48358),l=t(49887),d=t(77007),e=t(32924),p=t(86769),S=t(45608),o=t(98678),T=t(89702);let L=(()=>{class X{constructor(f){this.store=f}getUploadedFileList(f,D){return this.store.select((0,p.y8)(f,D)).pipe((0,i.U)(c=>c),(0,l.x)())}getFileData(f,D,c){return this.store.select((0,p.y8)(f,D)).pipe((0,d.h)(M=>!(0,S.o8)(M)),(0,i.U)(M=>{let A;return Object.keys(M).filter(V=>M[V].uuid===c).forEach(V=>A=M[V]),A}),(0,l.x)())}getDefaultPolicies(f,D,c){return this.store.select((0,p.G)(f,D,c)).pipe((0,i.U)(M=>M),(0,l.x)())}addUploadedFile(f,D,c,M){this.store.dispatch(new e.l5(f,D,c,M))}updateFileData(f,D,c,M){this.store.dispatch(new e.GM(f,D,c,M))}removeUploadedFile(f,D,c){this.store.dispatch(new e.YU(f,D,c))}}return X.\u0275fac=function(f){return new(f||X)(o.\u0275\u0275inject(T.yh))},X.\u0275prov=o.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac}),X})()},72577:(q,z,t)=>{"use strict";t.d(z,{o:()=>Qi});var i=t(59058),l=t(57999),d=t(70655),e=t(98678),p=t(53426),S=t(48358),o=t(27303),T=t(69637),L=t(77176),X=t(66154),k=t(49887),f=t(77007),D=t(96342),c=t(54385),M=t.n(c),A=t(94667),V=t.n(A),v=t(87893),G=t(82485),N=t(4786),_=t(79900),O=t(61285),b=t(45608),I=t(60030);class ${constructor(s=null,n=null){this._path=s,this._value=n}get path(){return this._path}set path(s){this._path=s}get value(){return this._value}set value(s){this._value=s}delete(){this._value=null,this._path=null}isPathEqual(s){return this._path&&V()(this._path,s)}}var w=t(76297),m=t(96289),C=t(1579),h=t(90537),F=t.n(h),W=t(5737),se=t(78187),U=t(97686),R=t(22726),g=t(31042),x=t(88666),j=t(55152),K=t(710);let E=(()=>{class a{constructor(n,r){this.formBuilder=n,this.operationsBuilder=r}dispatchOperationsFromEvent(n,r,u,y){switch(r.type){case"remove":this.dispatchOperationsFromRemoveEvent(n,r,u);break;case"change":this.dispatchOperationsFromChangeEvent(n,r,u,y);break;case"move":this.dispatchOperationsFromMoveEvent(n,r,u)}}getArrayIndexFromEvent(n){let r;return(0,b.UE)(n)&&((0,W.Gp8)(n)?(0,b.Ft)(n.context)?this.isPartOfArrayOfGroup(n.model)&&(r=n.model.parent.parent.index):r=n.context.index:r=n.index),(0,b.pT)(r)?r:0}isPartOfArrayOfGroup(n){return(0,b.K0)(n.parent)&&n.parent.type===W.Qam&&n.parent.parent&&n.parent.parent.context&&n.parent.parent.context.type===W.i9b}getQualdropValueMap(n){const r=new Map;return(this.formBuilder.isQualdropGroup(n.model)?n.model.parent.context:n.model.parent.parent.context).groups.forEach(y=>{const B=y.group[0],H=r.get(B.qualdropId)?r.get(B.qualdropId):[];B.value&&(H.push(B.value),r.set(B.qualdropId,H))}),r}getFieldPathFromEvent(n){const r=this.getArrayIndexFromEvent(n),u=this.getFieldPathSegmentedFromChangeEvent(n);return(0,b.pT)(r)?u+"/"+r:u}getQualdropItemPathFromEvent(n){const r=this.getArrayIndexFromEvent(n),u=new Map;let y=null;return(this.formBuilder.isQualdropGroup(n.model)?n.model.parent.context:n.model.parent.parent.context).groups.forEach((H,ee)=>{const le=H.group[0],P=u.get(le.qualdropId)?u.get(le.qualdropId):[];le.value&&(P.push(le.value),u.set(le.qualdropId,P)),ee===r&&(y=le.qualdropId+"/"+(P.length-1))}),y}getFieldPathSegmentedFromChangeEvent(n){let r;return r=this.formBuilder.isQualdropGroup(n.model)?n.model.qualdropId:this.formBuilder.isQualdropGroup(n.model.parent)?n.model.parent.qualdropId:this.formBuilder.getId(n.model),r}getFieldValueFromChangeEvent(n){let r;const u=n.model.value;if(this.formBuilder.isModelInCustomGroup(n.model))r=n.model.parent.value;else if(this.formBuilder.isRelationGroup(n.model))r=n.model.getGroupValue();else if(n.model.hasLanguages){const y=n.model.language;n.model.hasAuthority?Array.isArray(u)?(u.forEach((B,H)=>{B=Object.assign(new R.j,B,{language:y}),u[H]=B}),r=u):r=Object.assign(new R.j,u,{language:y}):r=new g.u(u,y)}else r=(0,K.UV)(u)?new g.u((0,K.UW)(u)):u instanceof U.Z||u instanceof R.j||u instanceof x.w||F()(u)?u:new g.u(u);return r}getValueMap(n){const r=new Map;return n.forEach(u=>{Object.keys(u).forEach(y=>{const B=r.get(y)?r.get(y):[];B.push(u[y]),r.set(y,B)})}),r}dispatchOperationsFromRemoveEvent(n,r,u){const y=this.getFieldPathFromEvent(r),B=this.getFieldValueFromChangeEvent(r);this.formBuilder.isQualdropGroup(r.model)?this.dispatchOperationsFromMap(this.getQualdropValueMap(r),n,r,u):r.context&&r.context instanceof W.NJD?this.handleArrayGroupPatch(n,r,r.context.context,u):((0,b.UE)(B)&&"string"==typeof B||(0,b.UE)(B)&&B instanceof g.u&&B.hasValue())&&this.operationsBuilder.remove(n.getPath(y))}dispatchOperationsFromAddEvent(n,r){const u=this.getFieldPathSegmentedFromChangeEvent(r),y=(0,j.I8)(this.getFieldValueFromChangeEvent(r));(0,b.UE)(y)&&(y.place=this.getArrayIndexFromEvent(r),(0,b.Uh)(r.group)&&(0,b.Uh)(r.group.value)&&(1===r.group.value.map(H=>Object.values(H)).reduce((H,ee)=>H.concat(ee)).filter(H=>(0,b.UE)(H)).length?this.operationsBuilder.add(n.getPath([u]),[y],!1):this.operationsBuilder.add(n.getPath([u,"-"]),y,!1)))}dispatchOperationsFromChangeEvent(n,r,u,y){if(r.context&&r.context instanceof W.NJD)return void this.handleArrayGroupPatch(n,r,r.context.context,u);const B=this.getFieldPathFromEvent(r),H=this.getFieldPathSegmentedFromChangeEvent(r),ee=this.getFieldValueFromChangeEvent(r);if(this.formBuilder.isQualdropGroup(r.model.parent)||this.formBuilder.isQualdropGroup(r.model))this.dispatchOperationsFromMap(this.getQualdropValueMap(r),n,r,u);else if(this.formBuilder.isRelationGroup(r.model))this.dispatchOperationsFromMap(this.getValueMap(ee),n,r,u);else if(this.formBuilder.hasArrayGroupValue(r.model))this.operationsBuilder.add(n.getPath(H),ee,!0);else if(u.isPathEqual(this.formBuilder.getPath(r.model))||y&&(0,b.UE)(u.value)){if((0,b.Uh)(r.$event)&&(0,b.Uh)(r.$event.previousIndex))if(r.$event.previousIndex<0)this.operationsBuilder.add(n.getPath(H),ee,!0);else{const le=n.getPath(B),P=n.getPath(H+"/"+r.$event.previousIndex);(0,b.UE)(P.path)&&(0,b.UE)(le.path)&&P.path!==le.path&&this.operationsBuilder.move(le,P.path)}else ee.hasValue()?this.operationsBuilder.replace(n.getPath(B),ee):0===this.getArrayIndexFromEvent(r)?this.operationsBuilder.remove(n.getPath(H)):this.operationsBuilder.remove(n.getPath(B));u.delete()}else ee.hasValue()&&((0,b.o8)(this.getArrayIndexFromEvent(r))||0===this.getArrayIndexFromEvent(r)?this.operationsBuilder.add(n.getPath(H),ee,!0):this.operationsBuilder.add(n.getPath(B),ee))}dispatchOperationsFromMap(n,r,u,y){const B=n;if("remove"===u.type){const H=this.getQualdropItemPathFromEvent(u);this.operationsBuilder.remove(r.getPath(H))}else y.isPathEqual(this.formBuilder.getPath(u.model))&&y.value.forEach((H,ee)=>{const le=B.get(ee);le?(V()(H,le)||this.operationsBuilder.add(r.getPath(ee),le,!0),B.delete(ee)):le||this.operationsBuilder.remove(r.getPath(ee))}),B.forEach((H,ee)=>{1===H.length&&(0,b.Ft)(H[0])?this.operationsBuilder.remove(r.getPath(ee)):this.operationsBuilder.add(r.getPath(ee),H,!0)});y.delete()}dispatchOperationsFromMoveEvent(n,r,u){return this.handleArrayGroupPatch(n,r.$event,r.$event.arrayModel,u)}handleArrayGroupPatch(n,r,u,y){const B=this.formBuilder.getValueFromModel([u]),H=this.getFieldPathSegmentedFromChangeEvent(r);(0,b.UE)(B)?this.operationsBuilder.add(n.getPath(H),B[H],!1):y.isPathEqual(this.formBuilder.getPath(r.model))&&this.operationsBuilder.remove(n.getPath(H))}}return a.\u0275fac=function(n){return new(n||a)(e.\u0275\u0275inject(v.c),e.\u0275\u0275inject(se.w))},a.\u0275prov=e.\u0275\u0275defineInjectable({token:a,factory:a.\u0275fac}),a})();var Ee,J=t(65384),Q=t(73797),_e=t(10882),Z=t(31638),ae=t(10572),Y=t(14677),re=t(55624),me=t(6952),fe=t(46533),Ie=t(76774),Re=t(94056),he=t(54384),te=t(35103),Ae=t(87657);const je=["formRef"];function xe(a,s){1&a&&e.\u0275\u0275element(0,"ds-themed-loading",2)}function ft(a,s){if(1&a){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",3,4),e.\u0275\u0275listener("dfChange",function(u){e.\u0275\u0275restoreView(n);const y=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(y.onChange(u))})("dfFocus",function(u){e.\u0275\u0275restoreView(n);const y=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(y.onFocus(u))})("remove",function(u){e.\u0275\u0275restoreView(n);const y=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(y.onRemove(u))})("ngbEvent",function(u){e.\u0275\u0275restoreView(n);const y=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(y.onCustomEvent(u))})("removeArrayItem",function(u){e.\u0275\u0275restoreView(n);const y=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(y.onRemove(u))}),e.\u0275\u0275elementEnd()}if(2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",n.formId)("formModel",n.formModel)("displaySubmit",!1)("displayCancel",!1)}}let Ke=((Ee=class extends _.v{constructor(s,n,r,u,y,B,H,ee,le,P,ie,ue,oe,de,pe){super(oe,de,pe),this.cdr=s,this.formBuilderService=n,this.formOperationsService=r,this.formService=u,this.formConfigService=y,this.notificationsService=B,this.sectionService=H,this.submissionService=ee,this.translate=le,this.submissionObjectService=P,this.objectCache=ie,this.requestService=ue,this.injectedCollectionId=oe,this.injectedSectionData=de,this.injectedSubmissionId=pe,this.isUpdating=!1,this.isLoading=!0,this.fieldsOnTheirWayToBeRemoved=new Map,this.formData=Object.create({}),this.previousValue=new $,this.subs=[],this.isSectionReadonly=!1}onSectionInit(){this.pathCombiner=new I.K("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.sectionService.dispatchSetSectionFormId(this.submissionId,this.sectionData.id,this.formId),this.formConfigService.findByHref(this.sectionData.config).pipe((0,S.U)(s=>s.payload),(0,o.b)(s=>this.formConfig=s),(0,T.z)(()=>(0,p.a)([this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType),this.submissionObjectService.findById(this.submissionId,!0,!1,(0,fe.l)("item")).pipe((0,ae.xw)(),(0,ae.xe)()),this.sectionService.isSectionReadOnly(this.submissionId,this.sectionData.id,this.submissionService.getSubmissionScope())])),(0,L.q)(1)).subscribe(([s,n,r])=>{(0,b.o8)(this.formModel)&&(this.submissionObject=n,this.isSectionReadonly=r,this.initForm(s),this.sectionData.data=s,this.subscriptions(),this.isLoading=!1,this.cdr.detectChanges())})}onSectionDestroy(){this.subs.filter(s=>(0,b.Uh)(s)).forEach(s=>s.unsubscribe())}getSectionStatus(){const s=this.formService.isValid(this.formId),n=this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe((0,S.U)(r=>(0,b.xb)(r)));return(0,p.a)([s,n]).pipe((0,S.U)(([r,u])=>r&&u))}hasMetadataEnrichment(s){const n={};Object.keys(s).forEach(y=>{this.inCurrentSubmissionScope(y)&&(n[y]=s[y])});const r=[],u=(0,_e.e5)(n,this.formData);return Object.keys(u).forEach(y=>{u[y].forEach(B=>{B.hasOwnProperty("value")&&M()(this.formData[y],{value:B.value})<0&&r.push(B)})}),(0,b.UE)(r)}inCurrentSubmissionScope(s){switch(this.formConfig?.rows.find(r=>r.fields?.[0]?.selectableMetadata?r.fields?.[0]?.selectableMetadata?.[0]?.metadata===s:!!r.fields?.[0]?.selectableRelationship&&r.fields?.[0]?.selectableRelationship.relationshipType===s.replace(/^relationship\./g,""))?.fields?.[0]?.scope){case Re.S.WorkspaceItem:return this.submissionObject.type===Z.K.type.value;case Re.S.WorkflowItem:return this.submissionObject.type===he.p.type.value;default:return!0}}initForm(s){try{this.formModel=this.formBuilderService.modelFromConfiguration(this.submissionId,this.formConfig,this.collectionId,s,this.submissionService.getSubmissionScope(),this.isSectionReadonly);const n=this.sectionService.computeSectionConfiguredMetadata(this.formConfig);this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,s,this.sectionData.errorsToShow,this.sectionData.serverValidationErrors,n)}catch(n){const u={message:this.translate.instant("error.submission.sections.init-form-error")+n.toString(),path:"/sections/"+this.sectionData.id};console.error(n.stack),this.sectionService.setSectionError(this.submissionId,this.sectionData.id,u)}}updateForm(s,n){(0,b.UE)(s)&&!V()(s,this.sectionData.data)?(this.sectionData.data=s,this.hasMetadataEnrichment(s)?(this.isUpdating=!0,this.formModel=null,this.cdr.detectChanges(),this.initForm(s),this.checksForErrors(n),this.isUpdating=!1,this.cdr.detectChanges()):((0,b.UE)(n)||(0,b.UE)(this.sectionData.errorsToShow))&&this.checksForErrors(n)):((0,b.UE)(n)||(0,b.UE)(this.sectionData.errorsToShow))&&this.checksForErrors(n)}checksForErrors(s){this.formService.isFormInitialized(this.formId).pipe((0,X.s)(n=>!0===n&&!this.isUpdating)).subscribe(()=>{this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,s,this.sectionData.errorsToShow),this.sectionData.errorsToShow=s,this.cdr.detectChanges()})}subscriptions(){this.subs.push(this.formService.getFormData(this.formId).pipe((0,k.x)()).subscribe(s=>{this.formData=s}),this.sectionService.getSectionState(this.submissionId,this.sectionData.id,this.sectionData.sectionType).pipe((0,f.h)(s=>(0,b.UE)(s)&&((0,b.UE)(s.data)||(0,b.UE)(s.errorsToShow))),(0,k.x)()).subscribe(s=>{this.fieldsOnTheirWayToBeRemoved=new Map,this.sectionMetadata=s.metadata,this.updateForm(s.data,s.errorsToShow)}))}onChange(s){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,s,this.previousValue,this.hasStoredValue(this.formBuilderService.getId(s.model),this.formOperationsService.getArrayIndexFromEvent(s)));const n=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(s),r=this.formOperationsService.getFieldValueFromChangeEvent(s);(-1!==Ie.N.submission.autosave.metadata.indexOf(n)&&(0,b.UE)(r)||this.hasRelatedCustomError(n))&&this.submissionService.dispatchSave(this.submissionId)}hasRelatedCustomError(s){const n=M()(this.sectionData.errorsToShow,{path:this.pathCombiner.getPath(s).path});if(-1!==n){const u=this.sectionData.errorsToShow[n].message.replace("error.validation.","");return!Ie.N.form.validatorMap.hasOwnProperty(u)}return!1}onFocus(s){const n=this.formOperationsService.getFieldValueFromChangeEvent(s),r=this.formBuilderService.getPath(s.model);this.formBuilderService.hasMappedGroupValue(s.model)?(this.previousValue.path=r,this.previousValue.value=this.formOperationsService.getQualdropValueMap(s)):(0,b.UE)(n)&&("object"==typeof n&&(0,b.UE)(n.value)||"string"==typeof n)&&(this.previousValue.path=r,this.previousValue.value=n)}onRemove(s){const n=this.formBuilderService.getId(s.model),r=this.formOperationsService.getArrayIndexFromEvent(s);if(this.fieldsOnTheirWayToBeRemoved.has(n)){const u=this.fieldsOnTheirWayToBeRemoved.get(n);u.push(r),this.fieldsOnTheirWayToBeRemoved.set(n,u)}else this.fieldsOnTheirWayToBeRemoved.set(n,[r]);this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,s,this.previousValue,this.hasStoredValue(n,r))}hasStoredValue(s,n){return!!(0,b.UE)(this.sectionData.data)&&this.sectionData.data.hasOwnProperty(s)&&(0,b.UE)(this.sectionData.data[s][n])&&!this.isFieldToRemove(s,n)}isFieldToRemove(s,n){return this.fieldsOnTheirWayToBeRemoved.has(s)&&this.fieldsOnTheirWayToBeRemoved.get(s).includes(n)}onCustomEvent(s){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,s,this.previousValue,null)}}).\u0275fac=function(s){return new(s||Ee)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(v.c),e.\u0275\u0275directiveInject(E),e.\u0275\u0275directiveInject(N.o),e.\u0275\u0275directiveInject(O.X),e.\u0275\u0275directiveInject(J.T),e.\u0275\u0275directiveInject(Q.J),e.\u0275\u0275directiveInject(C.b),e.\u0275\u0275directiveInject(D.sK),e.\u0275\u0275directiveInject(Y.O),e.\u0275\u0275directiveInject(re.a),e.\u0275\u0275directiveInject(me.s),e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},Ee.\u0275cmp=e.\u0275\u0275defineComponent({type:Ee,selectors:[["ds-submission-section-form"]],viewQuery:function(s,n){if(1&s&&e.\u0275\u0275viewQuery(je,5),2&s){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(n.formRef=r.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:2,consts:[["message","Loading...",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem",4,"ngIf"],["message","Loading..."],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem"],["formRef","formComponent"]],template:function(s,n){1&s&&(e.\u0275\u0275template(0,xe,1,0,"ds-themed-loading",0),e.\u0275\u0275template(1,ft,2,4,"ds-form",1)),2&s&&(e.\u0275\u0275property("ngIf",n.isLoading),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.isLoading&&n.formModel))},dependencies:[te.O5,Ae.Z,G.U]}),Ee);Ke=(0,d.__decorate)([(0,w.E)(m.i.SubmissionForm),(0,d.__metadata)("design:paramtypes",[e.ChangeDetectorRef,v.c,E,N.o,O.X,J.T,Q.J,C.b,D.sK,Y.O,re.a,me.s,String,Object,String])],Ke);t(32931),t(35273),t(71532),t(86183),t(51104),t(51437);var We=t(89702),ce=t(589),Ct=t(66723),It=t(34045),xt=t.n(It),Dt=t(56246),Ot=t.n(Dt),Ve=t(14111),ve=t(9237),Se=t(21160),De=t(9249),Fe=t(22040),$e=t(11915),yt=t(97176),ne=t(32924),Mt=t(14297);function Tt(a,s,n){return a?a[s.sections[n].formId]:null}function Ut(a,s,n,r){if(r||n!==m.i.SubmissionForm)return s;if(!a||!a.touched)return[];const u=[];return s.forEach(y=>{(0,Mt.Z)(y.path).forEach(H=>{H.fieldId&&a.touched[H.fieldId]&&u.push(y)})}),u}const Bt=[(()=>{class a{constructor(n,r,u,y,B,H,ee,le){this.actions$=n,this.notificationsService=r,this.operationsService=u,this.sectionService=y,this.store$=B,this.submissionService=H,this.submissionObjectService=ee,this.translate=le,this.loadForm$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.INIT_SUBMISSION_FORM),(0,S.U)(P=>{const ie=P.payload.submissionDefinition,ue=[];return ie.sections.page.forEach(oe=>{const de=oe._links.self.href||oe._links.self,pe=de.substr(de.lastIndexOf("/")+1),Ue=oe._links.config?oe._links.config.href||oe._links.config:"",Be=oe.mandatory||(0,b.UE)(P.payload.sections)&&P.payload.sections.hasOwnProperty(pe);let ge;ge=oe.sectionType!==m.i.SubmissionForm?(0,b.pT)(P.payload.sections)&&(0,b.pT)(P.payload.sections[pe])?P.payload.sections[pe]:Object.create(null):P.payload.item.metadata;const He=(0,b.UE)(P.payload.errors)&&P.payload.errors[pe]||null;ue.push(new ne.qK(P.payload.submissionId,pe,oe.header,Ue,oe.mandatory,oe.sectionType,oe.visibility,Be,ge,He))}),{action:P,definition:ie,mappedActions:ue}}),(0,T.z)(P=>(0,Ve.D)(P.mappedActions.concat(new ne.p3(P.action.payload.submissionId)))))),this.resetForm$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.RESET_SUBMISSION_FORM),(0,S.U)(P=>new ne.Xq(P.payload.collectionId,P.payload.submissionId,P.payload.selfUrl,P.payload.submissionDefinition,P.payload.sections,P.payload.item,null)))),this.saveSubmission$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.SAVE_SUBMISSION_FORM),(0,Se.w)(P=>this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),P.payload.submissionId,"sections").pipe((0,S.U)(ie=>new ne.Uq(P.payload.submissionId,ie,P.payload.isManual,P.payload.isManual)),(0,De.K)(()=>(0,ve.of)(new ne.ec(P.payload.submissionId))))))),this.saveForLaterSubmission$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.SAVE_FOR_LATER_SUBMISSION_FORM),(0,Se.w)(P=>this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),P.payload.submissionId,"sections").pipe((0,S.U)(ie=>new ne.gA(P.payload.submissionId,ie)),(0,De.K)(()=>(0,ve.of)(new ne.ec(P.payload.submissionId))))))),this.saveSubmissionSuccess$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.SAVE_SUBMISSION_FORM_SUCCESS),(0,Fe.M)(this.store$),(0,S.U)(([P,ie])=>this.parseSaveResponse(ie.submission.objects[P.payload.submissionId],P.payload.submissionObject,P.payload.submissionId,ie.forms,P.payload.showNotifications,P.payload.showErrors)),(0,T.z)(P=>(0,Ve.D)(P)))),this.saveSubmissionSectionSuccess$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.SAVE_SUBMISSION_SECTION_FORM_SUCCESS),(0,Fe.M)(this.store$),(0,S.U)(([P,ie])=>this.parseSaveResponse(ie.submission.objects[P.payload.submissionId],P.payload.submissionObject,P.payload.submissionId,ie.forms,!1,!1)),(0,T.z)(P=>(0,Ve.D)(P)))),this.saveSection$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.SAVE_SUBMISSION_SECTION_FORM),(0,Se.w)(P=>this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),P.payload.submissionId,"sections",P.payload.sectionId).pipe((0,S.U)(ie=>new ne.hM(P.payload.submissionId,ie)),(0,De.K)(()=>(0,ve.of)(new ne.cT(P.payload.submissionId))))))),this.saveError$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.SAVE_SUBMISSION_FORM_ERROR,ne.tI.SAVE_SUBMISSION_SECTION_FORM_ERROR),(0,Fe.M)(this.store$),(0,o.b)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.save_error_notice")))),{dispatch:!1}),this.saveAndDeposit$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.SAVE_AND_DEPOSIT_SUBMISSION),(0,Fe.M)(this.submissionService.hasUnsavedModification()),(0,Se.w)(([P,ie])=>{let ue;return ue=ie?this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),P.payload.submissionId,"sections"):this.submissionObjectService.findById(P.payload.submissionId,!1,!0,(0,fe.l)("item"),(0,fe.l)("collection")).pipe((0,ae.Gp)(),(0,S.U)(oe=>[oe])),ue.pipe((0,S.U)(oe=>this.canDeposit(oe)?new ne.wn(P.payload.submissionId):(this.notificationsService.warning(null,this.translate.instant("submission.sections.general.cannot_deposit"),null,!0),new ne.Uq(P.payload.submissionId,oe,!1,!0))),(0,De.K)(()=>(0,ve.of)(new ne.ec(P.payload.submissionId))))}))),this.depositSubmission$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.DEPOSIT_SUBMISSION),(0,Fe.M)(this.store$),(0,Se.w)(([P,ie])=>this.submissionService.depositSubmission(ie.submission.objects[P.payload.submissionId].selfUrl).pipe((0,S.U)(()=>new ne.e7(P.payload.submissionId)),(0,De.K)(ue=>(0,ve.of)(new ne.jn(P.payload.submissionId))))))),this.saveForLaterSubmissionSuccess$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.SAVE_FOR_LATER_SUBMISSION_FORM_SUCCESS),(0,o.b)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.save_success_notice"))),(0,o.b)(()=>this.submissionService.redirectToMyDSpace())),{dispatch:!1}),this.depositSubmissionSuccess$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.DEPOSIT_SUBMISSION_SUCCESS),(0,o.b)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.deposit_success_notice"))),(0,o.b)(()=>this.submissionService.redirectToMyDSpace())),{dispatch:!1}),this.depositSubmissionError$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.DEPOSIT_SUBMISSION_ERROR),(0,o.b)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.deposit_error_notice")))),{dispatch:!1}),this.discardSubmission$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.DISCARD_SUBMISSION),(0,Se.w)(P=>this.submissionService.discardSubmission(P.payload.submissionId).pipe((0,S.U)(()=>new ne._w(P.payload.submissionId)),(0,De.K)(()=>(0,ve.of)(new ne.kj(P.payload.submissionId))))))),this.addAllMetadataToSectionData=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.UPDATE_SECTION_DATA),(0,Se.w)(P=>this.sectionService.getSectionState(P.payload.submissionId,P.payload.sectionId,m.i.Upload).pipe((0,S.U)(ie=>[P,ie]),(0,L.q)(1))),(0,f.h)(([P,ie])=>ie.sectionType===m.i.SubmissionForm),(0,Se.w)(([P,ie])=>ie.sectionType===m.i.SubmissionForm?this.submissionObjectService.findById(P.payload.submissionId,!0,!1,(0,fe.l)("item")).pipe((0,ae.Gp)()).pipe((0,Se.w)(de=>de.item.pipe((0,ae.Gp)()))).pipe((0,S.U)(de=>de.metadata),(0,f.h)(de=>!V()(P.payload.data,de)),(0,S.U)(de=>new ne.z6(P.payload.submissionId,P.payload.sectionId,de,P.payload.errorsToShow,P.payload.serverValidationErrors,P.payload.metadata))):(0,ve.of)(new ne.jQ)))),this.discardSubmissionSuccess$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.DISCARD_SUBMISSION_SUCCESS),(0,o.b)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.discard_success_notice"))),(0,o.b)(()=>this.submissionService.redirectToMyDSpace())),{dispatch:!1}),this.discardSubmissionError$=(0,ce.GW)(()=>this.actions$.pipe((0,ce.l4)(ne.tI.DISCARD_SUBMISSION_ERROR),(0,o.b)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.discard_error_notice")))),{dispatch:!1})}canDeposit(n){let r=!0;return(0,b.UE)(n)&&n.forEach(u=>{const{errors:y}=u;y&&!(0,b.xb)(y)&&(r=!1)}),r}parseSaveResponse(n,r,u,y,B=!0,H=!0){const ee=[];return(0,b.UE)(r)&&(B&&this.notificationsService.success(null,this.translate.get("submission.sections.general.save_success_notice")),r.forEach(le=>{let P=Object.create({});const{errors:ie}=le;ie&&!(0,b.xb)(ie)&&(P=(0,yt.Z)(ie),B&&this.notificationsService.warning(null,this.translate.get("submission.sections.general.sections_not_valid")));const ue=le.sections&&(0,b.UE)(le.sections)?le.sections:{},oe=Ot()(Object.keys(ue),Object.keys(P));for(const pe of oe){const Ue=P[pe]||[],Be=ue[pe]||{};if(n.sections[pe].sectionType===m.i.Upload&&(0,b.xb)(Be.files)&&!n.sections[pe].enabled)continue;B&&!n.sections[pe].enabled&&this.submissionService.notifyNewSection(u,pe,n.sections[pe].sectionType);const He=Ut(Tt(y,n,pe),Ue,n.sections[pe].sectionType,H);ee.push(new ne.z6(u,pe,Be,He,Ue))}const de=xt()(n.sections,pe=>pe.sectionType===m.i.SherpaPolicies);(0,b.pT)(de)&&(0,b.UE)(n.sections[de]?.data)&&(0,b.xb)(ue[de])&&ee.push(new ne.z6(u,de,null,[],[]))})),ee}}return a.\u0275fac=function(n){return new(n||a)(e.\u0275\u0275inject(ce.eX),e.\u0275\u0275inject(J.T),e.\u0275\u0275inject($e.E),e.\u0275\u0275inject(Q.J),e.\u0275\u0275inject(We.yh),e.\u0275\u0275inject(C.b),e.\u0275\u0275inject(Y.O),e.\u0275\u0275inject(D.sK))},a.\u0275prov=e.\u0275\u0275defineInjectable({token:a,factory:a.\u0275fac}),a})()];var Ze=t(50123),At=t(53113),ke=(t(49868),t(9302)),qe=t(95445);const Lt={granted:{element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}}},Rt=[{id:"granted",label:"submission.sections.license.granted-label",required:!0,value:!1,validators:{required:null},errorMessages:{required:"submission.sections.license.required",notgranted:"submission.sections.license.notgranted"},type:"CHECKBOX"}];var Oe;const jt=["formRef"];function Kt(a,s){if(1&a){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",2,3),e.\u0275\u0275listener("dfChange",function(u){e.\u0275\u0275restoreView(n);const y=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(y.onChange(u))}),e.\u0275\u0275elementEnd()}if(2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",n.formId)("formModel",n.formModel)("formLayout",n.formLayout)("displaySubmit",n.displaySubmit)("displayCancel",!1)}}let we=((Oe=class extends _.v{constructor(s,n,r,u,y,B,H,ee,le,P,ie,ue){super(P,ie,ue),this.changeDetectorRef=s,this.collectionDataService=n,this.formBuilderService=r,this.formOperationsService=u,this.formService=y,this.operationsBuilder=B,this.sectionService=H,this.submissionService=ee,this.translateService=le,this.injectedCollectionId=P,this.injectedSectionData=ie,this.injectedSubmissionId=ue,this.formLayout=Lt,this.displaySubmit=!1,this.subs=[]}onSectionInit(){this.pathCombiner=new I.K("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.formModel=this.formBuilderService.fromJSON(Rt);const s=this.formBuilderService.findById("granted",this.formModel);s.label=this.translateService.instant(s.label),s.value=this.sectionData.data.granted,this.licenseText$=this.collectionDataService.findById(this.collectionId,!0,!0,(0,fe.l)("license")).pipe((0,f.h)(n=>(0,b.pT)(n.payload)),(0,T.z)(n=>n.payload.license),(0,X.s)(n=>(0,b.pT)(n.payload)),(0,S.U)(n=>n.payload.text),(0,ke.O)("")),this.subs.push(this.sectionService.isSectionReadOnly(this.submissionId,this.sectionData.id,this.submissionService.getSubmissionScope()).pipe((0,L.q)(1),(0,f.h)(n=>n)).subscribe(()=>{s.disabled=!0}),this.sectionService.getSectionErrors(this.submissionId,this.sectionData.id).pipe((0,f.h)(n=>(0,b.UE)(n)),(0,k.x)()).subscribe(n=>{const r=n.map(u=>"/sections/license"===u.path?s.checked?null:Object.assign({},u,{path:"/sections/license/granted"}):u).filter(u=>(0,b.K0)(u));(0,b.UE)(r)?(this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,r),this.sectionData.errors=n):this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id),this.changeDetectorRef.detectChanges()}))}getSectionStatus(){const s=this.formBuilderService.findById("granted",this.formModel);return s.valueChanges.pipe((0,S.U)(n=>!0===n),(0,ke.O)(s.value))}onChange(s){const n=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(s),r=this.formOperationsService.getFieldValueFromChangeEvent(s);r?(this.operationsBuilder.add(this.pathCombiner.getPath(n),r.value.toString(),!1,!0),this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)):this.operationsBuilder.remove(this.pathCombiner.getPath(n))}onSectionDestroy(){this.subs.filter(s=>(0,b.Uh)(s)).forEach(s=>s.unsubscribe())}}).\u0275fac=function(s){return new(s||Oe)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(qe.W),e.\u0275\u0275directiveInject(v.c),e.\u0275\u0275directiveInject(E),e.\u0275\u0275directiveInject(N.o),e.\u0275\u0275directiveInject(se.w),e.\u0275\u0275directiveInject(Q.J),e.\u0275\u0275directiveInject(C.b),e.\u0275\u0275directiveInject(D.sK),e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},Oe.\u0275cmp=e.\u0275\u0275defineComponent({type:Oe,selectors:[["ds-submission-section-license"]],viewQuery:function(s,n){if(1&s&&e.\u0275\u0275viewQuery(jt,5),2&s){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(n.formRef=r.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:5,vars:4,consts:[[1,"mb-5","preserve-line-breaks",3,"innerHTML"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange",4,"ngIf"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange"],["formRef","formComponent"]],template:function(s,n){1&s&&(e.\u0275\u0275element(0,"span",0),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"br")(3,"br"),e.\u0275\u0275template(4,Kt,2,5,"ds-form",1)),2&s&&(e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind1(1,2,n.licenseText$),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",n.formModel))},dependencies:[te.O5,G.U,te.Ov]}),Oe);we=(0,d.__decorate)([(0,w.E)(m.i.License),(0,d.__metadata)("design:paramtypes",[e.ChangeDetectorRef,qe.W,v.c,E,N.o,se.w,Q.J,C.b,D.sK,String,Object,String])],we);var ye,Wt=t(37920),et=(t(44918),t(80434),t(56152),t(64744),t(89360)),zt=(t(69653),t(39100)),tt=(t(10251),t(8019),t(76890),t(9925),t(23266)),be=t(65706),nt=t(29353),it=t(73194),Ht=t(78154),Ne=t(41966);function Zt(a,s){1&a&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"ds-themed-loading"),e.\u0275\u0275elementEnd())}function kt(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",n.getSelectedCcLicense().name," ")}}function qt(a,s){1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&a&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.change")," "))}function en(a,s){1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&a&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.select")," "))}function tn(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275template(1,qt,3,3,"ng-container",3),e.\u0275\u0275template(2,en,3,3,"ng-container",3),e.\u0275\u0275elementEnd()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.storedCcLicenseLink),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.storedCcLicenseLink)}}function nn(a,s){1&a&&(e.\u0275\u0275elementStart(0,"button",7),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.none")," "))}function on(a,s){if(1&a){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",8),e.\u0275\u0275listener("click",function(){const y=e.\u0275\u0275restoreView(n).$implicit,B=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(B.selectCcLicense(y))}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}if(2&a){const n=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",n.name," ")}}function sn(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",10)(1,"h5"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"div",21),e.\u0275\u0275elementEnd()),2&a){const n=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",n.label," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("innerHTML",n.description,e.\u0275\u0275sanitizeHtml)}}function an(a,s){if(1&a){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"div",16)(2,"div")(3,"h4"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"div",17),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"button",18),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(n);const u=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(u.closeInfoModal())}),e.\u0275\u0275elementStart(7,"span",19),e.\u0275\u0275text(8,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(9,"div",20),e.\u0275\u0275template(10,sn,4,2,"div",9),e.\u0275\u0275elementEnd()()}if(2&a){const n=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",n.label," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("innerHTML",n.description,e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",n.enums)}}function rn(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const n=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",n.label," ")}}function cn(a,s){1&a&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.option.select")," "))}function ln(a,s){if(1&a&&(e.\u0275\u0275elementContainerStart(0,2),e.\u0275\u0275template(1,rn,2,1,"span",3),e.\u0275\u0275template(2,cn,3,3,"span",3),e.\u0275\u0275elementContainerEnd()),2&a){const n=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n)}}function dn(a,s){if(1&a){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",8),e.\u0275\u0275listener("click",function(){const y=e.\u0275\u0275restoreView(n).$implicit,B=e.\u0275\u0275nextContext(2).$implicit,H=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(H.selectOption(H.getSelectedCcLicense(),B,y))}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}if(2&a){const n=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",n.label," ")}}function pn(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"ds-select",1),e.\u0275\u0275template(1,ln,3,2,"ng-container",22),e.\u0275\u0275elementContainerStart(2,4),e.\u0275\u0275elementStart(3,"div",23),e.\u0275\u0275template(4,dn,2,1,"button",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()),2&a){const n=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("disabled","jurisdiction"===n.id&&void 0!==r.defaultJurisdiction&&"none"!==r.defaultJurisdiction),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",r.getSelectedOption(r.getSelectedCcLicense(),n)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.enums)}}function mn(a,s){if(1&a){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",25)(1,"div",26),e.\u0275\u0275listener("click",function(){const y=e.\u0275\u0275restoreView(n).$implicit,B=e.\u0275\u0275nextContext(2).$implicit,H=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(H.selectOption(H.getSelectedCcLicense(),B,y))}),e.\u0275\u0275element(2,"input",27),e.\u0275\u0275elementStart(3,"span"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()()}if(2&a){const n=s.$implicit,r=e.\u0275\u0275nextContext(2).$implicit,u=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("title",n.label),e.\u0275\u0275property("checked",u.isSelectedOption(u.getSelectedCcLicense(),r,n)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(n.label)}}function un(a,s){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,mn,5,3,"div",24),e.\u0275\u0275elementContainerEnd()),2&a){const n=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",n.enums)}}function _n(a,s){if(1&a){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"div",11)(2,"div"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(n);const u=e.\u0275\u0275reference(7),y=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(y.openInfoModal(u))}),e.\u0275\u0275element(5,"i",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(6,an,11,3,"ng-template",null,14,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(8,pn,5,3,"ds-select",15),e.\u0275\u0275template(9,un,2,1,"ng-container",3),e.\u0275\u0275elementEnd()}if(2&a){const n=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("font-weight-bold ",n.id,""),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",n.label," "),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",(null==n.enums?null:n.enums.length)>5),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==n.enums?null:n.enums.length)<=5)}}function fn(a,s){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,_n,10,6,"div",9),e.\u0275\u0275elementContainerEnd()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",n.getSelectedCcLicense().fields)}}function hn(a,s){1&a&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275element(1,"ds-themed-loading"),e.\u0275\u0275elementEnd())}function vn(a,s){if(1&a){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",30)(1,"div"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"a",31),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",32)(7,"div",26),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(n);const u=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(u.setAccepted(!u.accepted))}),e.\u0275\u0275element(8,"input",33),e.\u0275\u0275elementStart(9,"span"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()()()()}if(2&a){const n=e.\u0275\u0275nextContext().ngVar,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,5,"submission.sections.ccLicense.link")," "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("href",n,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",n," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("checked",r.accepted),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(11,7,"submission.sections.ccLicense.confirmation"),"")}}function gn(a,s){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,hn,2,0,"div",3),e.\u0275\u0275template(2,vn,12,9,"div",29),e.\u0275\u0275elementContainerEnd()),2&a){const n=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n)}}function Sn(a,s){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,gn,3,2,"ng-container",28),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,n.getCcLicenseLink$()))}}let Ge=((ye=class extends _.v{constructor(s,n,r,u,y,B,H,ee,le){super(H,ee,le),this.modalService=s,this.sectionService=n,this.submissionCcLicensesDataService=r,this.submissionCcLicenseUrlDataService=u,this.operationsBuilder=y,this.configService=B,this.injectedCollectionId=H,this.injectedSectionData=ee,this.injectedSubmissionId=le,this.isLoading=!0,this.subscriptions=[]}get storedCcLicenseLink(){return this.data.uri}get accepted(){return void 0===this.data.accepted?!!this.data.uri:this.data.accepted}get data(){return this.sectionData.data}selectCcLicense(s){this.getSelectedCcLicense()&&this.getSelectedCcLicense().id===s.id||(this.setAccepted(!1),this.updateSectionData({ccLicense:{id:s.id,fields:{}},uri:void 0}))}getSelectedCcLicense(){return this.submissionCcLicenses&&this.data.ccLicense?this.submissionCcLicenses.filter(s=>s.id===this.data.ccLicense.id)[0]:null}selectOption(s,n,r){this.isSelectedOption(s,n,r)||this.updateSectionData({ccLicense:{id:s.id,fields:Object.assign({},this.data.ccLicense.fields,{[n.id]:r})},accepted:!1})}getSelectedOption(s,n){return"jurisdiction"===n.id&&void 0!==this.defaultJurisdiction&&"none"!==this.defaultJurisdiction?n.enums.find(r=>r.id===this.defaultJurisdiction):this.data.ccLicense.fields[n.id]}isSelectedOption(s,n,r){return this.getSelectedOption(s,n)&&this.getSelectedOption(s,n).id===r.id}getCcLicenseLink$(){if(this.storedCcLicenseLink)return(0,ve.of)(this.storedCcLicenseLink);if(!this.getSelectedCcLicense()||this.getSelectedCcLicense().fields.some(n=>!this.getSelectedOption(this.getSelectedCcLicense(),n)))return;const s=this.getSelectedCcLicense();return this.submissionCcLicenseUrlDataService.getCcLicenseLink(s,new Map(s.fields.map(n=>[n,this.getSelectedOption(s,n)])))}openInfoModal(s){this.modalRef=this.modalService.open(s)}closeInfoModal(){this.modalRef.close()}getSectionStatus(){return(0,ve.of)(this.accepted)}onSectionDestroy(){this.subscriptions.forEach(s=>s.unsubscribe())}onSectionInit(){this.pathCombiner=new I.K("sections",this.sectionData.id),this.subscriptions.push(this.sectionService.getSectionState(this.submissionId,this.sectionData.id,m.i.CcLicense).pipe((0,f.h)(s=>(0,b.UE)(s)&&((0,b.UE)(s.data)||(0,b.UE)(s.errorsToShow))),(0,k.x)(),(0,S.U)(s=>s.data)).subscribe(s=>{if(this.data.accepted!==s.accepted){const n=this.pathCombiner.getPath("uri");s.accepted?this.getCcLicenseLink$().pipe((0,L.q)(1)).subscribe(r=>{this.operationsBuilder.add(n,r.toString(),!1,!0)}):this.data.uri&&this.operationsBuilder.remove(n)}this.sectionData.data=s}),this.submissionCcLicensesDataService.findAll({elementsPerPage:9999}).pipe((0,ae.xw)(),(0,ae.xe)(),(0,S.U)(s=>s.page)).subscribe(s=>this.submissionCcLicenses=s),this.configService.findByPropertyName("cc.license.jurisdiction").pipe((0,ae.hC)(),(0,ae.xe)()).subscribe(s=>{this.defaultJurisdiction=void 0===s||0===s.values.length?"":s.values[0]}))}setAccepted(s){this.updateSectionData({accepted:s}),this.updateSectionStatus()}updateSectionData(s){this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,Object.assign({},this.data,s))}}).\u0275fac=function(s){return new(s||ye)(e.\u0275\u0275directiveInject(be.FF),e.\u0275\u0275directiveInject(Q.J),e.\u0275\u0275directiveInject(tt.I),e.\u0275\u0275directiveInject(nt.K),e.\u0275\u0275directiveInject(se.w),e.\u0275\u0275directiveInject(it.i),e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},ye.\u0275cmp=e.\u0275\u0275defineComponent({type:ye,selectors:[["ds-submission-section-cc-licenses"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:11,vars:8,consts:[[1,"mb-4","ccLicense-select"],[3,"disabled"],[1,"selection"],[4,"ngIf"],[1,"menu"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"d-flex","flex-row"],[1,"btn","btn-outline-info","btn-sm","ml-2",3,"click"],[1,"fas","fa-question"],["infoModal",""],[3,"disabled",4,"ngIf"],[1,"modal-header","mb-4"],[3,"innerHTML"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"font-weight-light",3,"innerHTML"],["class","selection",4,"ngVar"],[1,"options-select-menu","overflow-auto"],["class","d-flex flex-row m-1",4,"ngFor","ngForOf"],[1,"d-flex","flex-row","m-1"],[3,"click"],["type","radio",1,"mr-1",3,"title","checked"],[4,"ngVar"],["class","mt-2 p-4 bg-light text-dark",4,"ngIf"],[1,"mt-2","p-4","bg-light","text-dark"],["target","_blank","rel","noopener noreferrer",1,"license-link",3,"href"],[1,"m-2"],["type","checkbox","title","accepted",1,"mr-2",3,"checked"]],template:function(s,n){1&s&&(e.\u0275\u0275elementStart(0,"div",0)(1,"ds-select",1),e.\u0275\u0275elementContainerStart(2,2),e.\u0275\u0275template(3,Zt,2,0,"span",3),e.\u0275\u0275template(4,kt,2,1,"span",3),e.\u0275\u0275template(5,tn,3,2,"span",3),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(6,4),e.\u0275\u0275template(7,nn,3,3,"button",5),e.\u0275\u0275template(8,on,2,1,"button",6),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(9,fn,2,1,"ng-container",3),e.\u0275\u0275template(10,Sn,3,3,"ng-container",3)),2&s&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!n.submissionCcLicenses),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.submissionCcLicenses),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.getSelectedCcLicense()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.submissionCcLicenses&&!n.getSelectedCcLicense()),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==n.submissionCcLicenses?null:n.submissionCcLicenses.length)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",n.submissionCcLicenses),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.getSelectedCcLicense()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.getCcLicenseLink$()))},dependencies:[te.sg,te.O5,Ht.N,Ae.Z,Ne.g,te.Ov,D.X$],styles:[".options-select-menu[_ngcontent-%COMP%]{max-height:25vh}"]}),ye);Ge=(0,d.__decorate)([(0,w.E)(m.i.CcLicense),(0,d.__metadata)("design:paramtypes",[be.FF,Q.J,tt.I,nt.K,se.w,it.i,String,Object,String])],Ge);var En=t(40472),bn=t(76844),Dn=(t(97359),t(83346),t(13873),t(36424),t(4682));function On(a,s){}const yn=["*"];let ot=(()=>{class a extends Dn.F{constructor(){super(...arguments),this.inAndOutputNames=["availableAccessConditionOptions","collectionId","collectionPolicyType","configMetadataForm","fileId","fileIndex","fileName","sectionId","submissionId"]}getComponentName(){return"SubmissionSectionUploadFileComponent"}importThemedComponent(n){return t(88402)(`./${n}/app/submission/sections/upload/file/section-upload-file.component`)}importUnthemedComponent(){return Promise.resolve().then(t.bind(t,80434))}}return a.\u0275fac=function(){let s;return function(r){return(s||(s=e.\u0275\u0275getInheritedFactory(a)))(r||a)}}(),a.\u0275cmp=e.\u0275\u0275defineComponent({type:a,selectors:[["ds-themed-submission-upload-section-file"]],inputs:{availableAccessConditionOptions:"availableAccessConditionOptions",collectionId:"collectionId",collectionPolicyType:"collectionPolicyType",configMetadataForm:"configMetadataForm",fileId:"fileId",fileIndex:"fileIndex",fileName:"fileName",sectionId:"sectionId",submissionId:"submissionId"},features:[e.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:yn,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(n,r){1&n&&(e.\u0275\u0275projectionDef(),e.\u0275\u0275template(0,On,0,0,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(2,"div",null,1),e.\u0275\u0275projection(4),e.\u0275\u0275elementEnd())},encapsulation:2}),a})();var st=t(50867),Mn=t(86769);let ze=(()=>{class a{constructor(n){this.store=n}getAccessesData(n,r){return this.store.select((0,Mn.y5)(n,r)).pipe((0,f.h)(u=>(0,b.pT)(u)),(0,k.x)())}}return a.\u0275fac=function(n){return new(n||a)(e.\u0275\u0275inject(We.yh))},a.\u0275prov=e.\u0275\u0275defineInjectable({token:a,factory:a.\u0275fac}),a})();const Pn={id:"discoverable",name:"discoverable"},Tn={element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}},Un={id:"accessConditionGroup",group:[]},Bn={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},An={id:"accessCondition",groupFactory:null},Fn={grid:{group:"form-row pt-4"}},at={id:"name",label:"submission.sections.accesses.form.access-condition-label",hint:"submission.sections.accesses.form.access-condition-hint",options:[]},Ln={element:{host:"col-12",label:"col-form-label name-label"}},Rn={id:"startDate",label:"submission.sections.accesses.form.from-label",hint:"submission.sections.accesses.form.from-hint",placeholder:"submission.sections.accesses.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:W.O6Y,operator:W.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-from"}},jn={element:{label:"col-form-label"},grid:{host:"col-6"}},Kn={id:"endDate",label:"submission.sections.accesses.form.until-label",hint:"submission.sections.accesses.form.until-hint",placeholder:"submission.sections.accesses.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:W.O6Y,operator:W.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-until"}},Wn={element:{label:"col-form-label"},grid:{host:"col-6"}};var Ce,Vn=t(10102),rt=t(18005),$n=t(13604),ct=t(16066),wn=t(1411);let Le=((Ce=class extends Vn.o{constructor(s,n,r,u){super("submissionaccessoptions",s,n,r,u),this.requestService=s,this.rdbService=n,this.objectCache=r,this.halService=u}findByHref(s,n=!0,r=!0,...u){return super.findByHref(s,n,r,...u)}}).\u0275fac=function(s){return new(s||Ce)(e.\u0275\u0275inject(me.s),e.\u0275\u0275inject(ct.Q),e.\u0275\u0275inject(re.a),e.\u0275\u0275inject(rt.q))},Ce.\u0275prov=e.\u0275\u0275defineInjectable({token:Ce,factory:Ce.\u0275fac}),Ce);var Me;Le=(0,d.__decorate)([(0,wn.cQ)($n.MX),(0,d.__metadata)("design:paramtypes",[me.s,ct.Q,re.a,rt.q])],Le);const Nn=["formRef"];function Gn(a,s){if(1&a){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",1,2),e.\u0275\u0275listener("dfChange",function(u){e.\u0275\u0275restoreView(n);const y=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(y.onChange(u))})("removeArrayItem",function(u){e.\u0275\u0275restoreView(n);const y=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(y.onRemove(u))}),e.\u0275\u0275elementEnd()}if(2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",n.formId)("formModel",n.formModel)("displaySubmit",!1)("displayCancel",!1)}}let Qe=((Me=class extends _.v{constructor(s,n,r,u,y,B,H,ee,le,P,ie){super(void 0,P,ie),this.sectionService=s,this.formBuilderService=n,this.accessesConfigService=r,this.accessesService=u,this.formOperationsService=y,this.operationsBuilder=B,this.formService=H,this.translate=ee,this.operationsService=le,this.injectedSectionData=P,this.injectedSubmissionId=ie,this.subs=[]}initModelData(s){this.accessesData.accessConditions.forEach((n,r)=>{Array.of("name","startDate","endDate").filter(u=>n.hasOwnProperty(u)&&(0,b.UE)(n[u])).forEach(u=>{const y=this.formBuilderService.findById(u,s,r);if(y)if(y.type===W.VId){const B=new Date(n[u]);y.value={year:B.getUTCFullYear(),month:B.getUTCMonth()+1,day:B.getUTCDate()}}else y.value=n[u]})})}onChange(s){if(s.model.type===W.fSU){const n=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(s),r=this.formOperationsService.getFieldValueFromChangeEvent(s);this.operationsBuilder.replace(this.pathCombiner.getPath(n),r.value,!0)}else{if(s.model.id===at.id){const n=s.control.parent.get("startDate"),r=s.control.parent.get("endDate");n?.markAsUntouched(),r?.markAsUntouched(),n?.setValue(null),r?.setValue(null),s.control.parent.markAsDirty()}this.formService.validateAllFormFields(this.formRef.formGroup),this.formService.isValid(this.formId).pipe((0,L.q)(1),(0,f.h)(n=>n),(0,T.z)(()=>this.formService.getFormData(this.formId)),(0,L.q)(1)).subscribe(n=>{const r=[];n.accessCondition.map(u=>u.accessConditionGroup).filter(u=>(0,b.UE)(u)).forEach(u=>{let y;if(this.availableAccessConditionOptions.filter(B=>(0,b.K0)(u.name)&&B.name===u.name[0].value).forEach(B=>y=B),y){const B=Object.assign({},u);if(B.name=this.retrieveValueFromField(u.name),y.hasStartDate){if(u.startDate){const H=this.retrieveValueFromField(u.startDate);B.startDate=(0,K.iV)(H)}}else delete B.startDate;if(y.hasEndDate){if(u.endDate){const H=this.retrieveValueFromField(u.endDate);B.endDate=(0,K.iV)(H)}}else delete B.endDate;r.push(B)}}),this.operationsBuilder.add(this.pathCombiner.getPath("accessConditions"),r,!0)})}}onRemove(s){const r="accessConditions/"+this.formOperationsService.getArrayIndexFromEvent(s);this.operationsBuilder.remove(this.pathCombiner.getPath(r))}onSectionDestroy(){this.subs.filter(s=>(0,b.Uh)(s)).forEach(s=>s.unsubscribe())}onSectionInit(){this.pathCombiner=new I.K("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id);const s=this.accessesConfigService.findByHref(this.sectionData.config,!0,!1).pipe((0,ae.xw)(),(0,S.U)(r=>r.payload)),n=this.accessesService.getAccessesData(this.submissionId,this.sectionData.id);(0,p.a)([s,n]).subscribe(([r,u])=>{this.availableAccessConditionOptions=(0,b.UE)(r.accessConditionOptions)?r.accessConditionOptions:[],this.canChangeDiscoverable=!!r.canChangeDiscoverable,this.accessesData=u,this.formModel=this.buildFileEditForm()})}getSectionStatus(){return(0,ve.of)(!0)}buildFileEditForm(){const s=[];if(this.canChangeDiscoverable){const oe=Object.assign({},Pn,{label:this.translate.instant("submission.sections.accesses.form.discoverable-label"),hint:this.translate.instant("submission.sections.accesses.form.discoverable-description"),value:this.accessesData.discoverable});s.push(new W.dwp(oe,Tn))}const n=Object.assign({},at),r=Object.assign({},An),u=[];for(const oe of this.availableAccessConditionOptions)u.push({label:oe.name,value:oe.name});n.options=u;const y=[],B=[];let H,ee;this.availableAccessConditionOptions.forEach(oe=>{if(oe.hasStartDate&&(y.push({id:"name",value:oe.name}),oe.maxStartDate)){const de=new Date(oe.maxStartDate);H={year:de.getUTCFullYear(),month:de.getUTCMonth()+1,day:de.getUTCDate()}}if(oe.hasEndDate&&(B.push({id:"name",value:oe.name}),oe.maxEndDate)){const de=new Date(oe.maxEndDate);ee={year:de.getUTCFullYear(),month:de.getUTCMonth()+1,day:de.getUTCDate()}}});const le={relations:[{match:W.O6Y,operator:W.F8e,when:y}]},P={relations:[{match:W.O6Y,operator:W.F8e,when:B}]},ie=y.length>0,ue=B.length>0;return r.groupFactory=()=>{const oe=new W.nMt(n,Ln),de=Object.assign({},Rn,le);H&&(de.max=H);const pe=Object.assign({},Kn,P);ee&&(pe.max=ee);const Ue=new W.oqv(de,jn),Be=new W.oqv(pe,Wn),ge=Object.assign({},Un);return ge.group=[oe],ie&&ge.group.push(Ue),ue&&ge.group.push(Be),[new W.S_O(ge,Bn)]},r.initialCount=(0,b.UE)(this.accessesData.accessConditions)?this.accessesData.accessConditions.length:1,s.push(new W.RRz(r,Fn)),this.initModelData(s),s}retrieveValueFromField(s){const n=Array.isArray(s)?s[0]:s;return n?n.value:void 0}}).\u0275fac=function(s){return new(s||Me)(e.\u0275\u0275directiveInject(Q.J),e.\u0275\u0275directiveInject(v.c),e.\u0275\u0275directiveInject(Le),e.\u0275\u0275directiveInject(ze),e.\u0275\u0275directiveInject(E),e.\u0275\u0275directiveInject(se.w),e.\u0275\u0275directiveInject(N.o),e.\u0275\u0275directiveInject(D.sK),e.\u0275\u0275directiveInject($e.E),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},Me.\u0275cmp=e.\u0275\u0275defineComponent({type:Me,selectors:[["ds-section-accesses"]],viewQuery:function(s,n){if(1&s&&e.\u0275\u0275viewQuery(Nn,5),2&s){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(n.formRef=r.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem"],["formRef","formComponent"]],template:function(s,n){1&s&&e.\u0275\u0275template(0,Gn,2,4,"ds-form",0),2&s&&e.\u0275\u0275property("ngIf",!!n.formModel)},dependencies:[te.O5,G.U],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]}),Me);Qe=(0,d.__decorate)([(0,w.E)(m.i.AccessesCondition),(0,d.__metadata)("design:paramtypes",[Q.J,v.c,Le,ze,E,se.w,N.o,D.sK,$e.E,Object,String])],Qe);var Ye=t(60987),zn=t(35841),lt=t(87586);function Qn(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",15),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2(" ",n.version.embargo.amount," ",null==n.version.embargo?null:n.version.embargo.units[0],"")}}function Yn(a,s){1&a&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",15),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"submission.sections.sherpa.publisher.policy.noembargo"),""))}function Xn(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("+",n.version.locations.length-1,"")}}function Jn(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275template(2,Xn,2,1,"span",16),e.\u0275\u0275elementEnd()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",n.version.locations[0]," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.version.locations.length>1)}}function Hn(a,s){1&a&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"submission.sections.sherpa.publisher.policy.nolocation")))}function Zn(a,s){1&a&&e.\u0275\u0275element(0,"span",17)}function kn(a,s){1&a&&e.\u0275\u0275element(0,"span",18)}function qn(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const n=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",n.version.embargo.amount," ",n.version.embargo.units,"")}}function ei(a,s){1&a&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"submission.sections.sherpa.publisher.policy.noembargo")))}function ti(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",15),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,qn,2,2,"p",25),e.\u0275\u0275template(8,ei,3,3,"ng-template",null,26,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()),2&a){const n=e.\u0275\u0275reference(9),r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,3,"submission.sections.sherpa.publisher.policy.embargo"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!!r.version.embargo)("ngIfElse",n)}}function ni(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const n=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(n)}}function ii(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",27),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,ni,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&a){const n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.license"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.version.licenses)}}function oi(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const n=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(n)}}function si(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",29),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,oi,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&a){const n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.prerequisites"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.version.prerequisites)}}function ai(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const n=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(n)}}function ri(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",7),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,ai,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&a){const n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.location"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.version.locations)}}function ci(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const n=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(n)}}function li(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",30),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,ci,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&a){const n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.conditions"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.version.conditions)}}function di(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",19),e.\u0275\u0275template(1,ti,10,5,"div",20),e.\u0275\u0275template(2,ii,8,4,"div",20),e.\u0275\u0275template(3,si,8,4,"div",20),e.\u0275\u0275template(4,ri,8,4,"div",20),e.\u0275\u0275template(5,li,8,4,"div",20),e.\u0275\u0275elementEnd()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==n.version||!n.version.embargo||null==n.version||!n.version.embargo.amount)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==n.version||!n.version.licenses)&&n.version.licenses.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==n.version||!n.version.prerequisites)&&n.version.prerequisites.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==n.version||!n.version.locations)&&n.version.locations.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==n.version||!n.version.conditions)&&n.version.conditions.length>0)}}let dt=(()=>{class a{constructor(){this.isCollapsed=!0}}return a.\u0275fac=function(n){return new(n||a)},a.\u0275cmp=e.\u0275\u0275defineComponent({type:a,selectors:[["ds-content-accordion"]],inputs:{version:"version"},decls:22,vars:15,consts:[["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle",3,"click"],[1,"d-flex"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0","mr-4",3,"click"],[4,"ngIf","ngIfElse"],["noEmbargoTitle",""],[1,"m-1","ml-4"],[1,"far","fa-folder-open"],["noLocations",""],[1,"d-inline-block"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[3,"ngbCollapse"],["collapse","ngbCollapse"],["class","ml-4",4,"ngIf"],[1,"fas","fa-hourglass-half"],[4,"ngIf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-6"],["class","m-1",4,"ngIf","ngIfElse"],["noEmbargo",""],[1,"fas","fa-certificate"],["class","m-1",4,"ngFor","ngForOf"],[1,"fas","fa-exclamation-circle"],[1,"fas","fa-tasks"]],template:function(n,r){if(1&n){const u=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(u);const B=e.\u0275\u0275reference(20);return e.\u0275\u0275resetView(B.toggle())}),e.\u0275\u0275elementStart(2,"div",2)(3,"button",3),e.\u0275\u0275listener("click",function(B){return B.preventDefault()}),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"titlecase"),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div"),e.\u0275\u0275template(8,Qn,3,2,"span",4),e.\u0275\u0275template(9,Yn,4,3,"ng-template",null,5,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(11,"span",6),e.\u0275\u0275element(12,"i",7),e.\u0275\u0275template(13,Jn,3,2,"span",4),e.\u0275\u0275template(14,Hn,3,3,"ng-template",null,8,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(16,"div",9),e.\u0275\u0275template(17,Zn,1,0,"span",10),e.\u0275\u0275template(18,kn,1,0,"span",11),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(19,"div",12,13),e.\u0275\u0275template(21,di,6,5,"div",14),e.\u0275\u0275elementEnd()()}if(2&n){const u=e.\u0275\u0275reference(10),y=e.\u0275\u0275reference(15),B=e.\u0275\u0275reference(20);e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!B.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(5,11,r.version.articleVersion)," ",e.\u0275\u0275pipeBind1(6,13,"submission.sections.sherpa.publisher.policy.version")," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!(null==r.version||!r.version.embargo||null==r.version||!r.version.embargo.amount))("ngIfElse",u),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",!(null==r.version||!r.version.locations)&&r.version.locations.length>0)("ngIfElse",y),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",B.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!B.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",r.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!!r.version)}},dependencies:[te.sg,te.O5,be._D,te.rS,D.X$]}),a})();function pi(a,s){1&a&&e.\u0275\u0275element(0,"ds-content-accordion",3),2&a&&e.\u0275\u0275property("version",s.$implicit)}function mi(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"li")(1,"a",8),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),2&a){const n=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("href",n.key,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(n.value)}}function ui(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",4)(1,"div",5)(2,"p",6),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"ul"),e.\u0275\u0275template(6,mi,3,2,"li",7),e.\u0275\u0275pipe(7,"keyvalue"),e.\u0275\u0275elementEnd()()()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publisher.policy.more.information")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(7,4,n.policy.urls))}}let pt=(()=>{class a{constructor(){this.AlertTypeEnum=Ye.N}}return a.\u0275fac=function(n){return new(n||a)},a.\u0275cmp=e.\u0275\u0275defineComponent({type:a,selectors:[["ds-publisher-policy"]],inputs:{policy:"policy"},decls:3,vars:2,consts:[[1,"ml-4"],[3,"version",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],[3,"version"],[1,"row"],[1,"col-12"],[1,"m-1"],[4,"ngFor","ngForOf"],["target","_blank","rel","noopener noreferrer",3,"href"]],template:function(n,r){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,pi,1,1,"ds-content-accordion",1),e.\u0275\u0275template(2,ui,8,6,"div",2),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",r.policy.permittedVersions),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.policy||!r.policy.urls)))},dependencies:[te.sg,te.O5,dt,te.Nd,D.X$]}),a})();function _i(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"p",4),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const n=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("",n," ")}}function fi(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3),e.\u0275\u0275template(6,_i,2,1,"p",5),e.\u0275\u0275elementEnd()()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.title")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.journal.titles)}}function hi(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"p",4),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const n=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("",n," ")}}function vi(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3),e.\u0275\u0275template(6,hi,2,1,"p",5),e.\u0275\u0275elementEnd()()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.issns")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.journal.issns)}}function gi(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3)(6,"p",4)(7,"a",6),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()()()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"submission.sections.sherpa.publication.information.url")),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("href",n.journal.url,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",n.journal.url," ")}}function Si(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",3)(1,"p",4)(2,"a",6),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()()()),2&a){const n=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("href",n.uri,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",n.name," ")}}function Ei(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(5,Si,4,2,"div",7),e.\u0275\u0275elementEnd()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.publishers")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.journal.publishers)}}function bi(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.romeoPub")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",n.journal.romeoPub," ")}}function Ci(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.zetoPub")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",n.journal.zetoPub," ")}}let mt=(()=>{class a{}return a.\u0275fac=function(n){return new(n||a)},a.\u0275cmp=e.\u0275\u0275defineComponent({type:a,selectors:[["ds-publication-information"]],inputs:{journal:"journal"},decls:7,vars:6,consts:[[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],["class","m-1",4,"ngFor","ngForOf"],["target","_blank","rel","noopener noreferrer",3,"href"],["class","col-4",4,"ngFor","ngForOf"]],template:function(n,r){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,fi,7,4,"div",1),e.\u0275\u0275template(2,vi,7,4,"div",1),e.\u0275\u0275template(3,gi,9,5,"div",1),e.\u0275\u0275template(4,Ei,6,4,"div",1),e.\u0275\u0275template(5,bi,8,4,"div",1),e.\u0275\u0275template(6,Ci,8,4,"div",1),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.titles)&&r.journal.titles.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.issns)&&r.journal.issns.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.url)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.publishers)&&r.journal.publishers.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.romeoPub)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.zetoPub)))},dependencies:[te.sg,te.O5,D.X$]}),a})();function Ii(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.record.information.id")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",n.metadata.id," ")}}function xi(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"date"),e.\u0275\u0275elementEnd()()()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.record.information.date.created")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind2(8,4,n.metadata.dateCreated,"d MMMM Y H:mm:ss zzzz")," ")}}function Di(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"date"),e.\u0275\u0275elementEnd()()()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.record.information.date.modified")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind2(8,4,n.metadata.dateModified,"d MMMM Y H:mm:ss zzzz")," ")}}function Oi(a,s){if(1&a&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4)(7,"a",6),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()()()),2&a){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"submission.sections.sherpa.record.information.uri")),e.\u0275\u0275advance(4),e.\u0275\u0275property("href",n.metadata.uri,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(n.metadata.uri)}}let ut=(()=>{class a{}return a.\u0275fac=function(n){return new(n||a)},a.\u0275cmp=e.\u0275\u0275defineComponent({type:a,selectors:[["ds-metadata-information"]],inputs:{metadata:"metadata"},decls:5,vars:4,consts:[[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-8"],["target","_blank",3,"href"]],template:function(n,r){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,Ii,8,4,"div",1),e.\u0275\u0275template(2,xi,9,7,"div",1),e.\u0275\u0275template(3,Di,9,7,"div",1),e.\u0275\u0275template(4,Oi,9,5,"div",1),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.id)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.dateCreated)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.dateModified)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.uri)))},dependencies:[te.O5,te.uU,D.X$]}),a})();var Pe;function yi(a,s){1&a&&e.\u0275\u0275element(0,"ds-alert",3),2&a&&e.\u0275\u0275property("type","alert-info")("content","submission.sections.sherpa-policy.title-empty")}function Mi(a,s){if(1&a){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",4)(1,"ds-alert",5),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div")(5,"button",6),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(n);const u=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(u.refresh())}),e.\u0275\u0275elementStart(6,"span"),e.\u0275\u0275element(7,"i",7),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()()()}2&a&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("type","alert-info"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,"submission.sections.sherpa.publisher.policy.description")," "),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(9,5,"submission.sections.sherpa.publisher.policy.refresh")," "))}function Pi(a,s){1&a&&e.\u0275\u0275element(0,"span",21)}function Ti(a,s){1&a&&e.\u0275\u0275element(0,"span",22)}function Ui(a,s){1&a&&e.\u0275\u0275element(0,"span",21)}function Bi(a,s){1&a&&e.\u0275\u0275element(0,"span",22)}function Ai(a,s){if(1&a){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"div",11),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(n);const u=e.\u0275\u0275reference(9);return e.\u0275\u0275resetView(u.toggle())}),e.\u0275\u0275elementStart(2,"button",12),e.\u0275\u0275listener("click",function(u){return u.preventDefault()}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",13),e.\u0275\u0275template(6,Ui,1,0,"span",14),e.\u0275\u0275template(7,Bi,1,0,"span",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(8,"div",16,17),e.\u0275\u0275element(10,"ds-publisher-policy",23),e.\u0275\u0275elementEnd()()}if(2&a){const n=s.$implicit,r=e.\u0275\u0275reference(9),u=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275attribute("aria-expanded",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,6,"submission.sections.sherpa.publisher.policy")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",u.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("policy",n)}}function Fi(a,s){if(1&a){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",10)(2,"div",11),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(n);const u=e.\u0275\u0275reference(10);return e.\u0275\u0275resetView(u.toggle())}),e.\u0275\u0275elementStart(3,"button",12),e.\u0275\u0275listener("click",function(u){return u.preventDefault()}),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",13),e.\u0275\u0275template(7,Pi,1,0,"span",14),e.\u0275\u0275template(8,Ti,1,0,"span",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",16,17),e.\u0275\u0275element(11,"ds-publication-information",19),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(12,Ai,11,8,"div",20),e.\u0275\u0275elementContainerEnd()}if(2&a){const n=s.$implicit,r=e.\u0275\u0275reference(10),u=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,7,"submission.sections.sherpa.publication.information")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",u.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("journal",n),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",n.policies)}}function Li(a,s){1&a&&e.\u0275\u0275element(0,"span",21)}function Ri(a,s){1&a&&e.\u0275\u0275element(0,"span",22)}function ji(a,s){if(1&a){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Fi,13,9,"ng-container",9),e.\u0275\u0275elementStart(2,"div",10)(3,"div",11),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(n);const u=e.\u0275\u0275reference(11);return e.\u0275\u0275resetView(u.toggle())}),e.\u0275\u0275elementStart(4,"button",12),e.\u0275\u0275listener("click",function(u){return u.preventDefault()}),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",13),e.\u0275\u0275template(8,Li,1,0,"span",14),e.\u0275\u0275template(9,Ri,1,0,"span",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"div",16,17),e.\u0275\u0275element(12,"ds-metadata-information",18),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&a){const n=e.\u0275\u0275reference(11),r=e.\u0275\u0275nextContext().ngVar,u=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",r.journals),e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!n.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(6,7,"submission.sections.sherpa.record.information")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",n.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",u.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("metadata",r.metadata)}}function Ki(a,s){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"ds-alert",3),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&a){const n=e.\u0275\u0275nextContext().ngVar,r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("type",r.AlertTypeEnum.Error)("content",n.message?n.message:e.\u0275\u0275pipeBind1(2,2,"submission.sections.sherpa.error.message"))}}function Wi(a,s){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ji,13,9,"ng-container",8),e.\u0275\u0275template(2,Ki,3,4,"ng-container",8),e.\u0275\u0275elementContainerEnd()),2&a){const n=s.ngVar,r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.hasNoData()&&!!n&&!n.error),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!!n&&n.error)}}let Xe=((Pe=class extends _.v{constructor(s,n,r,u,y){super(void 0,u,y),this.sectionService=s,this.operationsBuilder=n,this.submissionService=r,this.injectedSectionData=u,this.injectedSubmissionId=y,this.sherpaPoliciesData$=new zn.X(null),this.subs=[],this.isCollapsed=!1,this.AlertTypeEnum=Ye.N}onSectionDestroy(){this.subs.filter(s=>(0,b.Uh)(s)).forEach(s=>s.unsubscribe())}onSectionInit(){this.pathCombiner=new I.K("sections",this.sectionData.id),this.subs.push(this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType).subscribe(s=>{this.sherpaPoliciesData$.next(s)}))}getSectionStatus(){return(0,ve.of)(!0)}hasNoData(){return(0,b.xb)(this.sherpaPoliciesData$.value)}refresh(){this.operationsBuilder.remove(this.pathCombiner.getPath("retrievalTime")),this.submissionService.dispatchSaveSection(this.submissionId,this.sectionData.id)}}).\u0275fac=function(s){return new(s||Pe)(e.\u0275\u0275directiveInject(Q.J),e.\u0275\u0275directiveInject(se.w),e.\u0275\u0275directiveInject(C.b),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},Pe.\u0275cmp=e.\u0275\u0275defineComponent({type:Pe,selectors:[["ds-section-sherpa-policies"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:4,vars:5,consts:[[3,"type","content",4,"ngIf"],["class","d-flex flex-column flex-nowrap mt-2 mb-4",4,"ngIf"],[4,"ngVar"],[3,"type","content"],[1,"d-flex","flex-column","flex-nowrap","mt-2","mb-4"],[3,"type"],["type","button","data-test","refresh-btn",1,"btn","btn-secondary","float-right",3,"click"],[1,"fas","fa-sync"],[4,"ngIf"],[4,"ngFor","ngForOf"],["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle","mb-3",3,"click"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0",3,"click"],[1,"d-inline-block"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[3,"ngbCollapse"],["collapse","ngbCollapse"],[3,"metadata"],[3,"journal"],["class","mb-3 border-bottom","data-test","collapse",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[3,"policy"]],template:function(s,n){if(1&s&&(e.\u0275\u0275template(0,yi,1,2,"ds-alert",0),e.\u0275\u0275template(1,Mi,10,7,"div",1),e.\u0275\u0275template(2,Wi,3,2,"ng-container",2),e.\u0275\u0275pipe(3,"async")),2&s){let r;e.\u0275\u0275property("ngIf",n.hasNoData()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.hasNoData()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",null==(r=e.\u0275\u0275pipeBind1(3,3,n.sherpaPoliciesData$))?null:r.sherpaResponse)}},dependencies:[te.sg,te.O5,lt.w,Ne.g,be._D,pt,mt,ut,te.Ov,D.X$]}),Pe);Xe=(0,d.__decorate)([(0,w.E)(m.i.SherpaPolicies),(0,d.__metadata)("design:paramtypes",[Q.J,se.w,C.b,Object,String])],Xe);var Te,Vi=t(89716),$i=t(42878);function wi(a,s){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"li"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&a){const n=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2("",e.\u0275\u0275pipeBind1(3,2,"submission.sections.identifiers."+n.identifierType+"_label")," ",n.value,"")}}function Ni(a,s){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,wi,4,4,"ng-container",1),e.\u0275\u0275elementContainerEnd()),2&a){const n=s.$implicit,r=e.\u0275\u0275nextContext(2).ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.displayTypes.includes(n.identifierType)&&n.value)}}function Gi(a,s){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div")(2,"span"),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"ul"),e.\u0275\u0275template(6,Ni,2,1,"ng-container",2),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()),2&a){const n=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.identifiers.info")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.identifiers)}}function zi(a,s){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Gi,7,4,"ng-container",1),e.\u0275\u0275elementContainerEnd()),2&a){const n=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n&&n.identifiers)}}let Je=((Te=class extends _.v{constructor(s,n,r,u,y,B){super(u,y,B),this.translate=s,this.sectionService=n,this.submissionService=r,this.injectedCollectionId=u,this.injectedSectionData=y,this.injectedSubmissionId=B,this.AlertTypeEnum=Ye.N,this.isLoading=!0,this.identifierData$=new $i.y,this.subs=[]}ngOnInit(){super.ngOnInit()}onSectionInit(){this.isLoading=!1,this.identifierData$=this.getIdentifierData()}isReadOnly(){return!0}onSectionDestroy(){}getSectionStatus(){return(0,ve.of)(!this.isLoading)}getIdentifierData(){return this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType)}}).\u0275fac=function(s){return new(s||Te)(e.\u0275\u0275directiveInject(D.sK),e.\u0275\u0275directiveInject(Q.J),e.\u0275\u0275directiveInject(C.b),e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},Te.\u0275cmp=e.\u0275\u0275defineComponent({type:Te,selectors:[["ds-submission-section-identifiers"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[[4,"ngVar"],[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(s,n){1&s&&(e.\u0275\u0275template(0,zi,2,1,"ng-container",0),e.\u0275\u0275pipe(1,"async")),2&s&&e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(1,1,n.getIdentifierData()))},dependencies:[te.sg,te.O5,Ne.g,te.Ov,D.X$],encapsulation:2}),Te);Je=(0,d.__decorate)([(0,w.E)(m.i.Identifiers),(0,d.__metadata)("design:paramtypes",[D.sK,Q.J,C.b,String,Object,String])],Je);const _t=[Ze.vk,Ke,we,Ge,Qe,Xe];let Qi=(()=>{class a{static withEntryComponents(){return{ngModule:a,providers:_t.map(n=>({provide:n}))}}}return a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=e.\u0275\u0275defineNgModule({type:a}),a.\u0275inj=e.\u0275\u0275defineInjector({providers:[At.K,Q.J,Wt.w,Le,ze,E],imports:[te.ez,i.IR.forRoot(),l.m,We.Aw.forFeature("submission",Ct.L,zt.z7),ce.sQ.forFeature(Bt),En.x.withEntryComponents(),bn.a.withEntryComponents(),st.e,be.bz,be.lQ,be.Gs,Vi.c,st.e]}),a})();e.\u0275\u0275setComponentScope(Ze.vk,function(){return[te.sg,te.O5,lt.w,et.O,ot]},function(){return[te.Ov,D.X$]})},69653:(q,z,t)=>{"use strict";t.r(z),t.d(z,{SubmissionSubmitComponent:()=>f});var i=t(35841),l=t(21160),d=t(3358),e=t(45608),p=t(65384),S=t(1579),o=t(10572),T=t(29442),L=t(98678),X=t(67522),k=t(96342);let f=(()=>{class D{constructor(M,A,V,v,G,N,_,O){this.changeDetectorRef=M,this.notificationsService=A,this.router=V,this.itemDataService=v,this.submissionService=G,this.translate=N,this.viewContainerRef=_,this.route=O,this.itemLink$=new i.X(void 0),this.subs=[],this.route.queryParams.subscribe(b=>{this.collectionParam=b.collection})}ngOnInit(){this.subs.push(this.submissionService.createSubmission(this.collectionParam).subscribe(M=>{(0,e.K0)(M)&&((0,e.xb)(M)?(this.notificationsService.info(null,this.translate.get("submission.general.cannot_submit")),this.router.navigate(["/mydspace"])):this.router.navigate(["/workspaceitems",M.id,"edit"],{replaceUrl:!0}))}),this.itemLink$.pipe((0,e.iy)(),(0,l.w)(M=>this.itemDataService.findByHref(M)),(0,o.g1)(),(0,d.b)(300)).subscribe(M=>{this.item=M.payload,this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subs.filter(M=>(0,e.Uh)(M)).forEach(M=>M.unsubscribe()),this.viewContainerRef.clear(),this.changeDetectorRef.markForCheck()}}return D.\u0275fac=function(M){return new(M||D)(L.\u0275\u0275directiveInject(L.ChangeDetectorRef),L.\u0275\u0275directiveInject(p.T),L.\u0275\u0275directiveInject(X.F0),L.\u0275\u0275directiveInject(T.S),L.\u0275\u0275directiveInject(S.b),L.\u0275\u0275directiveInject(k.sK),L.\u0275\u0275directiveInject(L.ViewContainerRef),L.\u0275\u0275directiveInject(X.gz))},D.\u0275cmp=L.\u0275\u0275defineComponent({type:D,selectors:[["ds-submission-submit"]],decls:0,vars:0,template:function(M,A){}}),D})()},83346:(q,z,t)=>{"use strict";t.d(z,{Y:()=>p});var i=t(4682),l=t(98678);function d(S,o){}const e=["*"];let p=(()=>{class S extends i.F{getComponentName(){return"SubmissionSubmitComponent"}importThemedComponent(T){return t(39881)(`./${T}/app/submission/submit/submission-submit.component`)}importUnthemedComponent(){return Promise.resolve().then(t.bind(t,69653))}}return S.\u0275fac=function(){let o;return function(L){return(o||(o=l.\u0275\u0275getInheritedFactory(S)))(L||S)}}(),S.\u0275cmp=l.\u0275\u0275defineComponent({type:S,selectors:[["ds-themed-submission-submit"]],features:[l.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:e,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(T,L){1&T&&(l.\u0275\u0275projectionDef(),l.\u0275\u0275template(0,d,0,0,"ng-template",null,0,l.\u0275\u0275templateRefExtractor),l.\u0275\u0275elementStart(2,"div",null,1),l.\u0275\u0275projection(4),l.\u0275\u0275elementEnd())},encapsulation:2}),S})()},14297:(q,z,t)=>{"use strict";t.d(z,{Z:()=>p});var i=t(45608);const l=/([^\/]+)/g,d=/\/sections\/(.*)/,p=S=>("string"==typeof S?[S]:S).map(T=>T.match(l)&&T.match(l).length>2?{sectionId:T.match(l)[1],fieldId:T.match(l)[2],fieldIndex:(0,i.Uh)(T.match(l)[3])?+T.match(l)[3]:0,originalPath:T}:{sectionId:T.match(d)[1],originalPath:T})},97176:(q,z,t)=>{"use strict";t.d(z,{Z:()=>d});var i=t(14297);const d=(e=[])=>{const p=Object.create({});return e.forEach(S=>{(0,i.Z)(S.paths).forEach(T=>{const L={path:T.originalPath,message:S.message};p[T.sectionId]||(p[T.sectionId]=[]),p[T.sectionId].push(L)})}),p}},56246:(q,z,t)=>{var i=t(6380),l=t(86667),d=t(40976),e=t(91609),p=l(function(S){return d(i(S,1,e,!0))});q.exports=p},75004:(q,z,t)=>{var i=t(40976);q.exports=function l(d){return d&&d.length?i(d):[]}},8377:(q,z,t)=>{var i={"./custom/app/submission/edit/submission-edit.component":[52678,2678]};function l(d){if(!t.o(i,d))return Promise.resolve().then(()=>{var S=new Error("Cannot find module '"+d+"'");throw S.code="MODULE_NOT_FOUND",S});var e=i[d],p=e[0];return t.e(e[1]).then(()=>t(p))}l.keys=()=>Object.keys(i),l.id=8377,q.exports=l},49252:(q,z,t)=>{var i={"./custom/app/submission/import-external/submission-import-external.component":[57094,7094]};function l(d){if(!t.o(i,d))return Promise.resolve().then(()=>{var S=new Error("Cannot find module '"+d+"'");throw S.code="MODULE_NOT_FOUND",S});var e=i[d],p=e[0];return t.e(e[1]).then(()=>t(p))}l.keys=()=>Object.keys(i),l.id=49252,q.exports=l},88402:(q,z,t)=>{var i={"./custom/app/submission/sections/upload/file/section-upload-file.component":[62285,2285]};function l(d){if(!t.o(i,d))return Promise.resolve().then(()=>{var S=new Error("Cannot find module '"+d+"'");throw S.code="MODULE_NOT_FOUND",S});var e=i[d],p=e[0];return t.e(e[1]).then(()=>t(p))}l.keys=()=>Object.keys(i),l.id=88402,q.exports=l},39881:(q,z,t)=>{var i={"./custom/app/submission/submit/submission-submit.component":[9700,9700]};function l(d){if(!t.o(i,d))return Promise.resolve().then(()=>{var S=new Error("Cannot find module '"+d+"'");throw S.code="MODULE_NOT_FOUND",S});var e=i[d],p=e[0];return t.e(e[1]).then(()=>t(p))}l.keys=()=>Object.keys(i),l.id=39881,q.exports=l}}]);