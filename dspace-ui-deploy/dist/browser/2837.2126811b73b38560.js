"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[2837],{36482:(w,T,r)=>{r.d(T,{h:()=>be}),r(13005);var D=r(35841),m=r(53426),h=r(9237),l=r(10572),u=r(21160),v=r(48358),C=r(77176),y=r(69637),p=r(27303),P=r(9302),b=r(45180),A=r(33895),R=r(40772),U=r(60987),B=r(46533),c=r(45608),S=r(81323),a=r(15463),f=r(64398),z=r(65384),N=r(69522),H=r(43550),G=r(29442),F=r(35794),V=r(80978),k=r(72910),Q=r(46342),X=r(956),J=r(73194),e=r(98678),M=r(5476),Y=r(65706),L=r(96342),K=r(67522),O=r(35103),Z=r(87586),q=r(78530),ee=r(41966);function te(n,_){1&n&&(e.\u0275\u0275elementStart(0,"h2"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"item.version.history.head")))}const ne=function(n){return{version:n}};function ie(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"ds-alert",7),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2).ngVar,i=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("type",i.AlertTypeEnum.Info),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(2,2,"item.version.history.selected.alert",e.\u0275\u0275pureFunction1(5,ne,t.version))," ")}}function oe(n,_){1&n&&(e.\u0275\u0275elementStart(0,"th",10),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"item.version.history.table.editor")))}function re(n,_){1&n&&e.\u0275\u0275element(0,"span")}function se(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"a",30),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(3).$implicit,i=e.\u0275\u0275nextContext(5);e.\u0275\u0275property("routerLink",i.getVersionRoute(t.id)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.version)}}function _e(n,_){if(1&n&&e.\u0275\u0275text(0),2&n){const t=e.\u0275\u0275nextContext(3).$implicit;e.\u0275\u0275textInterpolate1(" ",t.version," ")}}function ae(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1,"*"),e.\u0275\u0275elementEnd())}function le(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",31),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.version.history.table.workspaceItem")," "))}function pe(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",32),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.version.history.table.workflowItem")," "))}function de(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",35),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(3).ngVar,s=e.\u0275\u0275nextContext(6);return e.\u0275\u0275resetView(s.editWorkspaceItem(o))}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",36),e.\u0275\u0275elementEnd()}2&n&&e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(1,1,"item.version.history.table.action.editWorkspaceItem"))}function ce(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"button",37),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(4).$implicit,s=e.\u0275\u0275nextContext(5);return e.\u0275\u0275resetView(s.createNewVersion(o))}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275element(5,"i",38),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&n){const t=e.\u0275\u0275nextContext(9);e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(3,4,e.\u0275\u0275pipeBind1(4,6,t.createVersionTitle$))),e.\u0275\u0275property("disabled",t.isAnyBeingEdited()||e.\u0275\u0275pipeBind1(2,2,t.hasDraftVersion$))}}function me(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"button",39),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(4).$implicit,s=e.\u0275\u0275nextContext(3).ngVar,d=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(d.deleteVersion(o,o.id==s.id))}),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"i",40),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&n){const t=e.\u0275\u0275nextContext(9);e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(2,3,"item.version.history.table.action.deleteVersion")),e.\u0275\u0275property("ngClass",t.isAnyBeingEdited()?"btn-outline-primary":"btn-outline-danger")("disabled",t.isAnyBeingEdited())}}function ve(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",33),e.\u0275\u0275template(1,de,3,3,"button",34),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,ce,6,8,"ng-container",3),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275template(5,me,4,5,"ng-container",3),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2).ngVar,i=e.\u0275\u0275nextContext().$implicit,o=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,3,t)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(4,5,o.canCreateVersion$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(6,7,o.canDeleteVersion$(i)))}}function ge(n,_){if(1&n&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",23),e.\u0275\u0275template(2,re,1,0,"span",19),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275template(5,se,2,2,"ng-template",null,24,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(7,_e,1,1,"ng-template",null,25,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(9,ae,2,0,"span",3),e.\u0275\u0275template(10,le,3,3,"span",26),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275template(12,pe,3,3,"span",27),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"div",28),e.\u0275\u0275template(15,ve,7,9,"div",29),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&n){const t=_.ngVar,i=e.\u0275\u0275reference(6),o=e.\u0275\u0275reference(8),s=e.\u0275\u0275nextContext().ngVar,d=e.\u0275\u0275nextContext().$implicit,g=e.\u0275\u0275nextContext(3).ngVar,x=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(3,7,s)||e.\u0275\u0275pipeBind1(4,9,t))("ngIfThen",o)("ngIfElse",i),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",(null==d?null:d.id)===(null==g?null:g.id)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(11,11,s)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(13,13,t)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",x.displayActions)}}function ue(n,_){if(1&n&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ge,16,15,"ng-container",0),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&n){const t=_.ngVar,i=e.\u0275\u0275nextContext().$implicit,o=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,t)?void 0:o.getWorkflowId(null==i?null:i.item))}}function he(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"td",41),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",null==t?null:t.submitterName," ")}}function fe(n,_){1&n&&e.\u0275\u0275elementContainer(0)}function Ee(n,_){if(1&n&&e.\u0275\u0275text(0),2&n){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275textInterpolate(null==t?null:t.summary)}}function Ie(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"input",42),e.\u0275\u0275listener("ngModelChange",function(o){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext(6);return e.\u0275\u0275resetView(s.versionBeingEditedSummary=o)})("keyup.enter",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(6);return e.\u0275\u0275resetView(o.onSummarySubmit())}),e.\u0275\u0275elementEnd()}if(2&n){const t=e.\u0275\u0275nextContext(6);e.\u0275\u0275property("ngModel",t.versionBeingEditedSummary)}}function ye(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"button",44),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(7);return e.\u0275\u0275resetView(o.disableVersionEditing())}),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"i",45),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&n){const t=e.\u0275\u0275nextContext(2).$implicit,i=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(2,2,"item.version.history.table.action.discardSummary")),e.\u0275\u0275property("ngClass",i.isThisBeingEdited(t)?"btn-outline-warning":"btn-outline-primary")}}function xe(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",48),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(3).$implicit,s=e.\u0275\u0275nextContext(5);return e.\u0275\u0275resetView(s.enableVersionEditing(o))}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",49),e.\u0275\u0275elementEnd()}if(2&n){const t=e.\u0275\u0275nextContext(8);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(1,2,"item.version.history.table.action.editSummary")),e.\u0275\u0275property("disabled",t.isAnyBeingEdited())}}function Ce(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",50),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(8);return e.\u0275\u0275resetView(o.onSummarySubmit())}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",51),e.\u0275\u0275elementEnd()}2&n&&e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(1,1,"item.version.history.table.action.saveSummary"))}function Ve(n,_){if(1&n&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,xe,3,4,"button",46),e.\u0275\u0275template(2,Ce,3,3,"button",47),e.\u0275\u0275elementContainerEnd()),2&n){const t=e.\u0275\u0275nextContext(2).$implicit,i=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!i.isThisBeingEdited(t)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.isThisBeingEdited(t))}}function De(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",43),e.\u0275\u0275template(1,ye,4,4,"ng-container",3),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,Ve,3,2,"ng-container",3),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext().$implicit,i=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,2,i.canEditVersion$(t))&&i.isThisBeingEdited(t)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(4,4,i.canEditVersion$(t)))}}function Pe(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"tr",13)(1,"td",14),e.\u0275\u0275template(2,ue,3,3,"ng-container",0),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,he,2,1,"td",15),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275elementStart(6,"td",16),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"date"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"td",17)(10,"div",18),e.\u0275\u0275template(11,fe,1,0,"ng-container",19),e.\u0275\u0275template(12,Ee,1,1,"ng-template",null,20,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(14,Ie,1,1,"ng-template",null,21,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(16,De,5,6,"div",22),e.\u0275\u0275elementEnd()()),2&n){const t=_.$implicit,i=e.\u0275\u0275reference(13),o=e.\u0275\u0275reference(15),s=e.\u0275\u0275nextContext(5);e.\u0275\u0275property("id","version-row-"+t.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(3,8,s.hasDraftVersion$)?s.getWorkspaceId(null==t?null:t.item):void 0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(5,10,s.showSubmitter())),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(8,12,null==t?null:t.created,"yyyy-MM-dd HH:mm:ss")," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",s.isThisBeingEdited(t))("ngIfThen",o)("ngIfElse",i),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",s.displayActions)}}function Se(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-pagination",8),e.\u0275\u0275listener("paginationChange",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(o.onPageChange())}),e.\u0275\u0275elementStart(1,"table",9)(2,"thead")(3,"tr")(4,"th",10),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(7,oe,3,3,"th",11),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementStart(9,"th",10),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"th",10),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(15,"tbody"),e.\u0275\u0275template(16,Pe,17,15,"tr",12),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(17,"div"),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275elementEnd()()}if(2&n){const t=e.\u0275\u0275nextContext(3).ngVar,i=e.\u0275\u0275nextContext();e.\u0275\u0275property("hideGear",!0)("hidePagerWhenSinglePage",!0)("paginationOptions",i.options)("pageInfoState",t)("collectionSize",null==t?null:t.totalElements)("retainScrollPosition",!0),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,12,"item.version.history.table.version")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(8,14,i.showSubmitter())),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,16,"item.version.history.table.date")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,18,"item.version.history.table.summary")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==t?null:t.page),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("*\xa0",e.\u0275\u0275pipeBind1(19,20,"item.version.history.selected"),"")}}function Oe(n,_){if(1&n&&e.\u0275\u0275element(0,"ds-alert",52),2&n){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275property("content","item.version.history.empty")("type",t.AlertTypeEnum.Info)}}function Be(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",2),e.\u0275\u0275template(1,te,3,3,"h2",3),e.\u0275\u0275template(2,ie,3,7,"ds-alert",4),e.\u0275\u0275template(3,Se,20,22,"ds-pagination",5),e.\u0275\u0275template(4,Oe,1,2,"ds-alert",6),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext().ngVar,i=e.\u0275\u0275nextContext().ngVar,o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.displayTitle),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==i||null==i.page?null:i.page.length)>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t||0===(null==i||null==i.page?null:i.page.length))}}function Me(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,Be,5,4,"div",1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext().ngVar,i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==t||null==t.page?null:t.page.length)>0||i.displayWhenEmpty)}}function Te(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,Me,2,1,"div",0),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();let i;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",null==(i=e.\u0275\u0275pipeBind1(2,1,t.versionRD$))?null:i.payload)}}let be=(()=>{class n{constructor(t,i,o,s,d,g,x,$,E,I,W,Ae,Re,Ue){this.versionHistoryService=t,this.versionService=i,this.itemService=o,this.paginationService=s,this.formBuilder=d,this.modalService=g,this.notificationsService=x,this.translateService=$,this.router=E,this.itemVersionShared=I,this.authorizationService=W,this.workspaceItemDataService=Ae,this.workflowItemDataService=Re,this.configurationService=Ue,this.displayWhenEmpty=!1,this.displayTitle=!0,this.subs=[],this.AlertTypeEnum=U.N,this.versionsRD$=new D.X(null),this.pageSize=10,this.options=Object.assign(new b.r,{id:"ivo",currentPage:1,pageSize:this.pageSize})}isAnyBeingEdited(){return null!=this.versionBeingEditedNumber}isThisBeingEdited(t){return t?.version===this.versionBeingEditedNumber}enableVersionEditing(t){this.versionBeingEditedSummary=t?.summary,this.versionBeingEditedNumber=t?.version,this.versionBeingEditedId=t?.id}disableVersionEditing(){this.versionBeingEditedSummary=void 0,this.versionBeingEditedNumber=void 0,this.versionBeingEditedId=void 0}getVersionRoute(t){return(0,a.ni)(t)}onSummarySubmit(){this.versionService.findById(this.versionBeingEditedId).pipe((0,l.xw)(),(0,u.w)(o=>{const g=Object.assign({},o.payload,{summary:this.versionBeingEditedSummary});return this.versionService.update(g).pipe((0,l.hC)())})).subscribe(o=>{o.hasSucceeded?(this.notificationsService.success(null,this.translateService.get("item.version.edit.notification.success",{version:this.versionBeingEditedNumber})),this.getAllVersions(this.versionHistory$)):this.notificationsService.warning(null,this.translateService.get("item.version.edit.notification.failure",{version:this.versionBeingEditedNumber})),this.disableVersionEditing()})}deleteItemAndGetResult$(t){return this.itemService.delete(t.id).pipe((0,l.hC)(),(0,v.U)(i=>i.hasSucceeded),(0,C.q)(1))}deleteVersion(t,i){const d=t.version,g=t.item,x=this.modalService.open(N._);x.componentInstance.versionNumber=t.version,x.componentInstance.firstVersion=!1,x.componentInstance.response.pipe((0,C.q)(1)).subscribe($=>{$&&g.pipe((0,l.Gp)(),(0,y.z)(E=>(0,m.a)([(0,h.of)(E),this.versionHistoryService.getVersionHistoryFromVersion$(t)])),(0,y.z)(([E,I])=>(0,m.a)([this.deleteItemAndGetResult$(E),(0,h.of)(I)])),(0,y.z)(([E,I])=>(0,m.a)([(0,h.of)(E),this.versionHistoryService.getLatestVersionItemFromHistory$(I).pipe((0,p.b)(()=>{this.getAllVersions((0,h.of)(I))}))]))).subscribe(([E,I])=>{if(E?this.notificationsService.success(null,this.translateService.get("item.version.delete.notification.success",{version:d})):this.notificationsService.error(null,this.translateService.get("item.version.delete.notification.failure",{version:d})),i){const W=(0,a.TP)(I);this.router.navigateByUrl(W)}})})}createNewVersion(t){const i=t.version,o=this.modalService.open(f.u);o.componentInstance.versionNumber=i,o.componentInstance.createVersionEvent.pipe((0,y.z)(s=>(0,m.a)([(0,h.of)(s),t.item.pipe((0,l.Gp)())])),(0,y.z)(([s,d])=>this.versionHistoryService.createVersion(d._links.self.href,s)),(0,l.hC)(),(0,p.b)(()=>o.close()),(0,p.b)(s=>{if(this.itemVersionShared.notifyCreateNewVersion(s),s.hasSucceeded){const d=this.versionService.getHistoryFromVersion(t).pipe((0,p.b)(g=>{this.itemService.invalidateItemCache(this.item.uuid),this.versionHistoryService.invalidateVersionHistoryCache(g.id)}));this.getAllVersions(d)}}),(0,l.Gp)(),(0,u.w)(s=>this.itemService.findByHref(s._links.item.href)),(0,l.Gp)(),(0,u.w)(s=>this.workspaceItemDataService.findByItem(s.uuid,!0,!1)),(0,l.Gp)()).subscribe(s=>{this.router.navigateByUrl("workspaceitems/"+s.id+"/edit")})}canEditVersion$(t){return this.authorizationService.isAuthorized(V.i.CanEditVersion,t.self)}showSubmitter(){const t=this.configurationService.findByPropertyName("versioning.item.history.include.submitter").pipe((0,l.Gp)(),(0,v.U)(o=>o.values[0]),(0,P.O)(!1)),i=(0,m.a)([this.authorizationService.isAuthorized(V.i.IsCollectionAdmin),this.authorizationService.isAuthorized(V.i.IsCommunityAdmin),this.authorizationService.isAuthorized(V.i.AdministratorOf)]).pipe((0,v.U)(([o,s,d])=>o||s||d),(0,C.q)(1));return(0,m.a)([t,i]).pipe((0,v.U)(([o,s])=>o&&s))}canDeleteVersion$(t){return this.authorizationService.isAuthorized(V.i.CanDeleteVersion,t.self)}getAllVersions(t){const i=this.paginationService.getCurrentPagination(this.options.id,this.options);(0,m.a)([t,i]).pipe((0,u.w)(([o,s])=>this.versionHistoryService.getVersions(o.id,new R.t({pagination:Object.assign({},s,{currentPage:s.currentPage})}),!1,!0,(0,B.l)("item"),(0,B.l)("eperson"))),(0,l.hC)()).subscribe(o=>{this.versionsRD$.next(o)})}onPageChange(){this.getAllVersions(this.versionHistory$)}getWorkspaceId(t){return t.pipe((0,l.Gp)(),(0,v.U)(i=>i.uuid),(0,u.w)(i=>this.workspaceItemDataService.findByItem(i,!0)),(0,l.hC)(),(0,v.U)(i=>i?.payload?.id))}getWorkflowId(t){return t.pipe((0,l.Gp)(),(0,v.U)(i=>i.uuid),(0,u.w)(i=>this.workflowItemDataService.findByItem(i,!0)),(0,l.hC)(),(0,v.U)(i=>i?.payload?.id))}editWorkspaceItem(t){t.subscribe(i=>{this.router.navigateByUrl("workspaceitems/"+i+"/edit")})}ngOnInit(){(0,c.Uh)(this.item.version)&&(this.versionRD$=this.item.version,this.versionHistoryRD$=this.versionRD$.pipe((0,l.g1)(),(0,l.xe)(),(0,c.tz)(),(0,u.w)(t=>t.versionhistory)),this.versionHistory$=this.versionHistoryRD$.pipe((0,l.Gp)(),(0,c.tz)()),this.canCreateVersion$=this.authorizationService.isAuthorized(V.i.CanCreateVersion,this.item.self),this.hasDraftVersion$=this.versionHistoryRD$.pipe((0,l.Gp)(),(0,v.U)(t=>Boolean(t?.draftVersion))),this.createVersionTitle$=this.hasDraftVersion$.pipe((0,C.q)(1),(0,u.w)(t=>(0,h.of)(t?"item.version.history.table.action.hasDraft":"item.version.history.table.action.newVersion"))),this.getAllVersions(this.versionHistory$),this.hasEpersons$=this.versionsRD$.pipe((0,l.g1)(),(0,l.xe)(),(0,c.tz)(),(0,v.U)(t=>t.page.filter(i=>void 0!==i.eperson).length>0),(0,P.O)(!1)),this.itemPageRoutes$=this.versionsRD$.pipe((0,l.mc)(),(0,u.w)(t=>(0,m.a)(t.page.map(i=>i.item.pipe((0,l.mc)())))),(0,v.U)(t=>{const i={};return t.forEach(o=>i[o.uuid]=(0,a.Tt)(o)),i})))}ngOnDestroy(){this.cleanupSubscribes(),this.paginationService.clearPagination(this.options.id)}cleanupSubscribes(){this.subs.filter(t=>(0,c.Uh)(t)).forEach(t=>t.unsubscribe())}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275directiveInject(A.Q),e.\u0275\u0275directiveInject(H._),e.\u0275\u0275directiveInject(G.S),e.\u0275\u0275directiveInject(S.N),e.\u0275\u0275directiveInject(M.QS),e.\u0275\u0275directiveInject(Y.FF),e.\u0275\u0275directiveInject(z.T),e.\u0275\u0275directiveInject(L.sK),e.\u0275\u0275directiveInject(K.F0),e.\u0275\u0275directiveInject(k.D),e.\u0275\u0275directiveInject(F._),e.\u0275\u0275directiveInject(Q.p),e.\u0275\u0275directiveInject(X.K),e.\u0275\u0275directiveInject(J.i))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["ds-item-versions"]],inputs:{item:"item",displayWhenEmpty:"displayWhenEmpty",displayTitle:"displayTitle",displayActions:"displayActions"},decls:2,vars:3,consts:[[4,"ngVar"],["class","mb-2",4,"ngIf"],[1,"mb-2"],[4,"ngIf"],[3,"type",4,"ngIf"],[3,"hideGear","hidePagerWhenSinglePage","paginationOptions","pageInfoState","collectionSize","retainScrollPosition","paginationChange",4,"ngIf"],[3,"content","type",4,"ngIf"],[3,"type"],[3,"hideGear","hidePagerWhenSinglePage","paginationOptions","pageInfoState","collectionSize","retainScrollPosition","paginationChange"],[1,"table","table-striped","table-bordered","align-middle","my-2"],["scope","col"],["scope","col",4,"ngIf"],[3,"id",4,"ngFor","ngForOf"],[3,"id"],[1,"version-row-element-version"],["class","version-row-element-editor",4,"ngIf"],[1,"version-row-element-date"],[1,"version-row-element-summary"],[1,"float-left"],[4,"ngIf","ngIfThen","ngIfElse"],["showSummary",""],["editSummary",""],["class","float-right btn-group edit-field space-children-mr",4,"ngIf"],[1,"left-column"],["versionNumberWithLink",""],["versionNumberWithoutLink",""],["class","text-light badge badge-primary ml-3",4,"ngIf"],["class","text-light badge badge-info ml-3",4,"ngIf"],[1,"right-column"],["class","btn-group edit-field space-children-mr",4,"ngIf"],[3,"routerLink"],[1,"text-light","badge","badge-primary","ml-3"],[1,"text-light","badge","badge-info","ml-3"],[1,"btn-group","edit-field","space-children-mr"],["class","btn btn-outline-primary btn-sm version-row-element-edit",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm","version-row-element-edit",3,"title","click"],[1,"fas","fa-pencil-alt","fa-fw"],[1,"btn","btn-outline-primary","btn-sm","version-row-element-create",3,"disabled","title","click"],[1,"fas","fa-code-branch","fa-fw"],[1,"btn","btn-sm","version-row-element-delete",3,"ngClass","disabled","title","click"],[1,"fas","fa-trash","fa-fw"],[1,"version-row-element-editor"],["type","text",1,"form-control",3,"ngModel","ngModelChange","keyup.enter"],[1,"float-right","btn-group","edit-field","space-children-mr"],[1,"btn","btn-sm",3,"ngClass","title","click"],[1,"fas","fa-undo-alt","fa-fw"],["class","btn btn-outline-primary btn-sm version-row-element-edit",3,"disabled","title","click",4,"ngIf"],["class","btn btn-outline-success btn-sm",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm","version-row-element-edit",3,"disabled","title","click"],[1,"fas","fa-edit","fa-fw"],[1,"btn","btn-outline-success","btn-sm",3,"title","click"],[1,"fas","fa-check","fa-fw"],[3,"content","type"]],template:function(t,i){if(1&t&&(e.\u0275\u0275template(0,Te,3,3,"div",0),e.\u0275\u0275pipe(1,"async")),2&t){let o;e.\u0275\u0275property("ngVar",null==(o=e.\u0275\u0275pipeBind1(1,1,i.versionsRD$))?null:o.payload)}},dependencies:[O.mk,O.sg,O.O5,M.Fj,M.JJ,M.On,K.rH,Z.w,q.Q,ee.g,O.Ov,O.uU,L.X$],styles:[".left-column[_ngcontent-%COMP%]{float:left;text-align:left}.right-column[_ngcontent-%COMP%]{float:right;text-align:right}"]}),n})()},56766:(w,T,r)=>{r.d(T,{s:()=>B}),r(13005);var D=r(45608),m=r(10572),h=r(21160),l=r(48358),u=r(9302),v=r(33895),C=r(60987),y=r(15463),p=r(98678),P=r(35103),b=r(87586),A=r(96342);const R=function(c){return{destination:c}};function U(c,S){if(1&c&&(p.\u0275\u0275element(0,"ds-alert",1),p.\u0275\u0275pipe(1,"translate"),p.\u0275\u0275pipe(2,"async"),p.\u0275\u0275pipe(3,"async")),2&c){const a=p.\u0275\u0275nextContext();let f;p.\u0275\u0275property("content",p.\u0275\u0275pipeBind2(1,3,"item.version.notice",p.\u0275\u0275pureFunction1(10,R,a.getItemPage(null==(f=p.\u0275\u0275pipeBind1(2,6,null==(f=p.\u0275\u0275pipeBind1(3,8,a.latestVersion$))?null:f.item))?null:f.payload))))("dismissible",!1)("type",a.AlertTypeEnum.Warning)}}let B=(()=>{class c{constructor(a){this.versionHistoryService=a,this.AlertTypeEnum=C.N}ngOnInit(){(0,D.Uh)(this.item.version)&&(this.versionRD$=this.item.version,this.versionHistoryRD$=this.versionRD$.pipe((0,m.g1)(),(0,m.xe)(),(0,D.tz)(),(0,h.w)(a=>a.versionhistory)),this.latestVersion$=this.versionHistoryRD$.pipe((0,m.Gp)(),(0,h.w)(a=>this.versionHistoryService.getLatestVersionFromHistory$(a))),this.showLatestVersionNotice$=this.versionRD$.pipe((0,m.Gp)(),(0,h.w)(a=>this.versionHistoryService.isLatest$(a)),(0,l.U)(a=>null!=a&&!a),(0,u.O)(!1)))}getItemPage(a){if((0,D.Uh)(a))return(0,y.Tt)(a)}}return c.\u0275fac=function(a){return new(a||c)(p.\u0275\u0275directiveInject(v.Q))},c.\u0275cmp=p.\u0275\u0275defineComponent({type:c,selectors:[["ds-item-versions-notice"]],inputs:{item:"item"},decls:2,vars:3,consts:[[3,"content","dismissible","type",4,"ngIf"],[3,"content","dismissible","type"]],template:function(a,f){1&a&&(p.\u0275\u0275template(0,U,4,12,"ds-alert",0),p.\u0275\u0275pipe(1,"async")),2&a&&p.\u0275\u0275property("ngIf",f.showLatestVersionNotice$&&p.\u0275\u0275pipeBind1(1,1,f.showLatestVersionNotice$))},dependencies:[P.O5,b.w,P.Ov,A.X$],encapsulation:2}),c})()}}]);