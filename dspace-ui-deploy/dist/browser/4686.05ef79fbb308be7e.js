"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[4686],{14686:(T,_,n)=>{n.r(_),n.d(_,{ExternalSourceEntryImportModalComponent:()=>R,ImportType:()=>o});var e=n(98678),u=n(71432),m=n(69552),E=n(40772),y=n(64455),v=n(97462),f=n(91416),I=n(29442),C=n(45180),s=n(10572),d=n(21160),a=n(77176),c=n(122),h=n(65384),x=n(9925),O=n(65706),S=n(96342),g=n(35103),M=n(8517);function P(l,p){if(1&l&&(e.\u0275\u0275elementStart(0,"div")(1,"a",17),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),2&l){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("href",t.uri.value,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.uri.value)}}const D=function(l){return{repeatable:!1,listId:l}};function L(l,p){if(1&l){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-search-results",18),e.\u0275\u0275listener("deselectObject",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.deselectEntity())})("selectObject",function(r){e.\u0275\u0275restoreView(t);const b=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(b.selectEntity(r))}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementEnd()}if(2&l){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("searchResults",e.\u0275\u0275pipeBind1(1,9,t.localEntitiesRD$))("sortConfig",null==t.lookupRelationService.searchConfig?null:t.lookupRelationService.searchConfig.sort)("searchConfig",t.lookupRelationService.searchConfig)("selectable",!0)("disableHeader",!0)("hidePaginationDetail",!0)("selectionConfig",e.\u0275\u0275pureFunction1(11,D,t.entityListId))("linkType",t.linkTypes.ExternalLink)("context",t.context)}}function A(l,p){if(1&l){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",19)(1,"h5",8),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",10)(5,"input",20),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.selectNewAuthority())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"label",21),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd()()()}if(2&l){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,3,t.labelPrefix+"authority")),e.\u0275\u0275advance(3),e.\u0275\u0275property("checked",t.selectedImportType===t.importType.NewAuthority),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,5,t.labelPrefix+"authority.new"))}}var o=(()=>{return(l=o||(o={})).None="None",l.LocalEntity="LocalEntity",l.LocalAuthority="LocalAuthority",l.NewEntity="NewEntity",l.NewAuthority="NewAuthority",o;var l})();let R=(()=>{class l{constructor(t,i,r,b,B,w,j){this.modal=t,this.lookupRelationService=i,this.modalService=r,this.selectService=b,this.itemService=B,this.notificationsService=w,this.translateService=j,this.labelPrefix="submission.sections.describe.relationship-lookup.external-source.import-modal.",this.linkTypes=y.m,this.context=v._.EntitySearchModalWithNameVariants,this.entityListId="external-source-import-entity",this.authorityListId="external-source-import-authority",this.importType=o,this.selectedImportType=o.None,this.importedObject=new e.EventEmitter,this.authorityEnabled=!1}ngOnInit(){this.uri=u.S.first(this.externalSourceEntry.metadata,"dc.identifier.uri");const t=Object.assign(new C.r,{id:"external-entry-import",pageSize:5});this.searchOptions=Object.assign(new E.t({query:this.externalSourceEntry.value,pagination:t})),this.localEntitiesRD$=this.lookupRelationService.getLocalResults(this.relationship,this.searchOptions)}close(){this.modal.close()}import(){switch(this.selectedImportType){case o.LocalEntity:this.importLocalEntity();break;case o.NewEntity:this.importNewEntity();break;case o.LocalAuthority:this.importLocalAuthority();break;case o.NewAuthority:this.importNewAuthority()}this.selectedImportType=o.None,this.deselectAllLists(),this.close()}importLocalEntity(){void 0!==this.selectedEntity&&(this.notificationsService.success(this.translateService.get(this.labelPrefix+this.label+".added.local-entity")),this.importedObject.emit(this.selectedEntity))}importNewEntity(){this.modalRef=this.modalService.open(x.L,{size:"lg"}),this.modalRef.componentInstance.entityType=this.relatedEntityType.label,this.modalRef.componentInstance.selectedEvent.pipe((0,d.w)(t=>this.itemService.importExternalSourceEntry(this.externalSourceEntry,t.collection.id).pipe((0,s.xw)(),(0,s.xe)(),(0,a.q)(1)))).subscribe(t=>{this.lookupRelationService.removeLocalResultsCache();const i=Object.assign(new c.T,{indexableObject:t});this.notificationsService.success(this.translateService.get(this.labelPrefix+this.label+".added.new-entity")),this.modalRef.close(),this.importedObject.emit(i)})}importLocalAuthority(){}importNewAuthority(){}deselectEntity(){this.selectedEntity=void 0,this.selectedImportType===o.LocalEntity&&(this.selectedImportType=o.None)}selectEntity(t){this.selectedEntity=t,this.selectedImportType=o.LocalEntity}selectNewEntity(){this.selectedImportType===o.NewEntity?this.selectedImportType=o.None:(this.selectedImportType=o.NewEntity,this.deselectAllLists())}deselectAuthority(){this.selectedAuthority=void 0,this.selectedImportType===o.LocalAuthority&&(this.selectedImportType=o.None)}selectAuthority(t){this.selectedAuthority=t,this.selectedImportType=o.LocalAuthority}selectNewAuthority(){this.selectedImportType===o.NewAuthority?this.selectedImportType=o.None:(this.selectedImportType=o.NewAuthority,this.deselectAllLists())}deselectAllLists(){this.selectService.deselectAll(this.entityListId),this.selectService.deselectAll(this.authorityListId)}}return l.\u0275fac=function(t){return new(t||l)(e.\u0275\u0275directiveInject(O.Kz),e.\u0275\u0275directiveInject(m.P),e.\u0275\u0275directiveInject(O.FF),e.\u0275\u0275directiveInject(f.w),e.\u0275\u0275directiveInject(I.S),e.\u0275\u0275directiveInject(h.T),e.\u0275\u0275directiveInject(S.sK))},l.\u0275cmp=e.\u0275\u0275defineComponent({type:l,selectors:[["ds-external-source-entry-import-modal"]],decls:40,vars:29,consts:[[1,"modal-header"],["id","modal-title",1,"modal-title"],["type","button","aria-label","Close button","aria-describedby","modal-title",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],["id","external-source-entry-information",1,"mb-3"],[4,"ngIf"],["id","external-source-entry-entities",1,"mb-3"],[1,"font-weight-bold"],[3,"searchResults","sortConfig","searchConfig","selectable","disableHeader","hidePaginationDetail","selectionConfig","linkType","context","deselectObject","selectObject",4,"ngIf"],[1,"ml-4"],["type","radio","name","new-entity","id","new-entity","value","new-entity",1,"form-check-input",3,"checked","click"],["for","new-entity",1,"form-check-label"],["id","external-source-entry-authority",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[3,"href"],[3,"searchResults","sortConfig","searchConfig","selectable","disableHeader","hidePaginationDetail","selectionConfig","linkType","context","deselectObject","selectObject"],["id","external-source-entry-authority"],["type","radio","name","new-authority","id","new-authority","value","new-authority",1,"form-check-input",3,"checked","click"],["for","new-authority",1,"form-check-label"]],template:function(t,i){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"h4",1),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"button",2),e.\u0275\u0275listener("click",function(){return i.modal.dismiss()}),e.\u0275\u0275elementStart(5,"span",3),e.\u0275\u0275text(6,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",4)(8,"h4"),e.\u0275\u0275text(9),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",5)(12,"div")(13,"span"),e.\u0275\u0275text(14),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(15,P,3,2,"div",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"h4"),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"div",7)(20,"h5",8),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(23,L,2,13,"ds-search-results",9),e.\u0275\u0275pipe(24,"async"),e.\u0275\u0275elementStart(25,"div",10)(26,"input",11),e.\u0275\u0275listener("click",function(){return i.selectNewEntity()}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(27,"label",12),e.\u0275\u0275text(28),e.\u0275\u0275pipe(29,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(30,A,9,7,"div",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(31,"div",14)(32,"div")(33,"button",15),e.\u0275\u0275listener("click",function(){return i.close()}),e.\u0275\u0275text(34),e.\u0275\u0275pipe(35,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(36,"div")(37,"button",16),e.\u0275\u0275listener("click",function(){return i.import()}),e.\u0275\u0275text(38),e.\u0275\u0275pipe(39,"translate"),e.\u0275\u0275elementEnd()()()),2&t){let r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,13,i.labelPrefix+i.label+".title")),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(10,15,i.labelPrefix+"head."+i.externalSourceEntry.externalSource)),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(i.externalSourceEntry.display),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.uri),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,17,i.labelPrefix+"select")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(22,19,i.labelPrefix+"entities")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(r=e.\u0275\u0275pipeBind1(24,21,i.localEntitiesRD$))||null==r.payload||null==r.payload.page?null:r.payload.page.length)>0),e.\u0275\u0275advance(3),e.\u0275\u0275property("checked",i.selectedImportType===i.importType.NewEntity),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(29,23,i.labelPrefix+"entities.new")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.authorityEnabled),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(35,25,i.labelPrefix+"cancel")),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",i.selectedImportType===i.importType.None),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(39,27,i.labelPrefix+"import"))}},dependencies:[g.O5,M.SearchResultsComponent,g.Ov,S.X$],styles:[".modal-footer[_ngcontent-%COMP%]{justify-content:space-between}"]}),l})()},9925:(T,_,n)=>{n.d(_,{L:()=>C});var e=n(98678),u=n(65706),m=n(35103),E=n(87657),y=n(19829),v=n(96342);function f(s,d){1&s&&e.\u0275\u0275element(0,"ds-themed-loading")}const I=function(s){return{"d-none":s}};let C=(()=>{class s{constructor(a){this.activeModal=a,this.selectedEvent=new e.EventEmitter,this.loading=!0}selectObject(a){this.loading=!0,this.selectedEvent.emit(a)}closeCollectionModal(){this.activeModal.dismiss(!1)}theOnlySelectable(a){this.selectedEvent.emit(a)}searchComplete(){this.loading=!1}isLoading(){return!!this.loading}}return s.\u0275fac=function(a){return new(a||s)(e.\u0275\u0275directiveInject(u.Kz))},s.\u0275cmp=e.\u0275\u0275defineComponent({type:s,selectors:[["ds-submission-import-external-collection"]],outputs:{selectedEvent:"selectedEvent"},decls:10,vars:8,consts:[[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[4,"ngIf"],[3,"ngClass","entityType","selectionChange","searchComplete"]],template:function(a,c){1&a&&(e.\u0275\u0275elementStart(0,"div")(1,"div",0),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementStart(4,"button",1),e.\u0275\u0275listener("click",function(){return c.closeCollectionModal()}),e.\u0275\u0275elementStart(5,"span",2),e.\u0275\u0275text(6,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",3),e.\u0275\u0275template(8,f,1,0,"ds-themed-loading",4),e.\u0275\u0275elementStart(9,"ds-themed-collection-dropdown",5),e.\u0275\u0275listener("selectionChange",function(x){return c.selectObject(x)})("searchComplete",function(){return c.searchComplete()}),e.\u0275\u0275elementEnd()()()),2&a&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(3,4,"dso-selector.select.collection.head")," "),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",c.isLoading()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(6,I,c.isLoading()))("entityType",c.entityType))},dependencies:[m.mk,m.O5,E.Z,y.t,v.X$],styles:[".close[_ngcontent-%COMP%]:focus{outline:none!important}"]}),s})()}}]);