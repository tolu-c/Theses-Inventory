"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[9484],{39484:(Et,O,a)=>{a.r(O),a.d(O,{EditCollectionPageModule:()=>Tt});var u=a(35103),X=a(57999),m=a(67522),E=a(35841),x=a(53426),N=a(8842),V=a(58106),h=a(48358),f=a(21160),K=a(9302),B=a(77176),l=a(10572),Y=a(37683),U=a(42281),R=a(65384),Q=a(29442),$=a(95445),d=a(45608),j=a(55963),W=a(27496),J=a(40772),Z=a(57066),A=a(46533),L=a(80978),e=a(98678),g=a(96342),T=a(65706),q=a(51864),ee=a(96067);const te=["tabs"];function ne(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"ds-item-select",11),e.\u0275\u0275listener("confirm",function(i){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.mapItems(i,!0))})("cancel",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.onCancel())}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()()}if(2&o){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275advance(1),e.\u0275\u0275property("key","browse")("dsoRD$",t.collectionItemsRD$)("paginationOptions",null==(n=e.\u0275\u0275pipeBind1(2,7,t.searchOptions$))?null:n.pagination)("confirmButton","collection.edit.item-mapper.remove")("cancelButton","collection.edit.item-mapper.cancel")("dangerConfirm",!0)("hideCollection",!0)}}function oe(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"ds-item-select",17),e.\u0275\u0275listener("confirm",function(i){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(s.mapItems(i))})("cancel",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.onCancel())}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()()}if(2&o){const t=e.\u0275\u0275nextContext(2);let n;e.\u0275\u0275advance(1),e.\u0275\u0275property("key","map")("dsoRD$",t.mappedItemsRD$)("paginationOptions",null==(n=e.\u0275\u0275pipeBind1(2,6,t.searchOptions$))?null:n.pagination)("featureId",t.FeatureIds.CanManageMappings)("confirmButton","collection.edit.item-mapper.confirm")("cancelButton","collection.edit.item-mapper.cancel")}}function ie(o,r){1&o&&(e.\u0275\u0275elementStart(0,"div",18),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"collection.edit.item-mapper.no-search")," "))}function ae(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",12)(1,"div",13)(2,"ds-themed-search-form",14),e.\u0275\u0275listener("submitSearch",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.performedSearch=!0)}),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(6,oe,3,8,"div",15),e.\u0275\u0275template(7,ie,3,3,"div",16)}if(2&o){const t=e.\u0275\u0275nextContext();let n,i;e.\u0275\u0275advance(2),e.\u0275\u0275property("query",null==(n=e.\u0275\u0275pipeBind1(3,7,t.searchOptions$))?null:n.query)("scope",null==(i=e.\u0275\u0275pipeBind1(4,9,t.searchOptions$))?null:i.scope)("currentUrl","./")("inPlaceSearch",!0)("searchPlaceholder",e.\u0275\u0275pipeBind1(5,11,"collection.edit.item-mapper.search-form.placeholder")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.performedSearch),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.performedSearch)}}const re=function(o){return{name:o}};let se=(()=>{class o{constructor(t,n,i,s,p,v,C,S,_){this.route=t,this.router=n,this.searchConfigService=i,this.searchService=s,this.notificationsService=p,this.itemDataService=v,this.collectionDataService=C,this.translateService=S,this.dsoNameService=_,this.FeatureIds=L.i,this.defaultSortOptions=new U.o("dc.title",U.S.ASC),this.performedSearch=!1}ngOnInit(){this.collectionRD$=this.route.parent.data.pipe((0,h.U)(t=>t.dso),(0,l.xw)()),this.collectionName$=this.collectionRD$.pipe((0,h.U)(t=>this.dsoNameService.getName(t.payload))),this.searchOptions$=this.searchConfigService.paginatedSearchOptions,this.loadItemLists()}loadItemLists(){this.shouldUpdate$=new E.X(!0);const t=(0,x.a)(this.collectionRD$,this.searchOptions$,this.shouldUpdate$);this.collectionItemsRD$=t.pipe((0,f.w)(([n,i,s])=>(!0===s&&this.shouldUpdate$.next(!1),this.itemDataService.findListByHref(n.payload._links.mappedItems.href,Object.assign(i,{sort:this.defaultSortOptions}),!s,!1,(0,A.l)("owningCollection")).pipe((0,l.g1)())))),this.mappedItemsRD$=t.pipe((0,f.w)(([n,i,s])=>this.searchService.search(Object.assign(new J.t(i),{query:this.buildQuery(n.payload.id,i.query),scope:void 0,dsoTypes:[Y.h.ITEM],sort:this.defaultSortOptions}),1e4,void 0,void 0,(0,A.l)("owningCollection")).pipe((0,l.Ie)(),(0,K.O)(void 0))))}mapItems(t,n){const i=this.collectionRD$.pipe((0,l.xw)(),(0,h.U)(s=>s.payload),(0,f.w)(s=>(0,x.a)(t.map(p=>n?this.itemDataService.removeMappingFromCollection(p,s.id).pipe((0,l.hC)()):this.itemDataService.mapToCollection(p,s._links.self.href).pipe((0,l.hC)())))));this.showNotifications(i,n)}showNotifications(t,n){const i=n?"unmap":"map";t.subscribe(s=>{const p=s.filter(C=>C.hasSucceeded),v=s.filter(C=>C.hasFailed);p.length>0&&((0,x.a)(this.translateService.get(`collection.edit.item-mapper.notifications.${i}.success.head`),this.translateService.get(`collection.edit.item-mapper.notifications.${i}.success.content`,{amount:p.length})).subscribe(([S,_])=>{this.notificationsService.success(S,_)}),this.shouldUpdate$.next(!0)),v.length>0&&(0,x.a)(this.translateService.get(`collection.edit.item-mapper.notifications.${i}.error.head`),this.translateService.get(`collection.edit.item-mapper.notifications.${i}.error.content`,{amount:v.length})).subscribe(([S,_])=>{this.notificationsService.error(S,_)}),this.switchToFirstTab()})}tabChange(t){this.performedSearch=!1,this.router.navigateByUrl(this.getCurrentUrl())}getCurrentUrl(){return this.router.url.indexOf("?")>-1?this.router.url.substring(0,this.router.url.indexOf("?")):this.router.url}buildQuery(t,n){const i=`-location.coll:"${t}"`;return(0,d.UE)(n)?`${i} AND ${n}`:i}switchToFirstTab(){this.tabs.select("browseTab")}onCancel(){this.collectionRD$.pipe((0,l.xw)(),(0,l.xe)(),(0,B.q)(1)).subscribe(t=>{this.router.navigate(["/collections/",t.id])})}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(m.gz),e.\u0275\u0275directiveInject(m.F0),e.\u0275\u0275directiveInject(j.SEARCH_CONFIG_SERVICE),e.\u0275\u0275directiveInject(Z.o),e.\u0275\u0275directiveInject(R.T),e.\u0275\u0275directiveInject(Q.S),e.\u0275\u0275directiveInject($.W),e.\u0275\u0275directiveInject(g.sK),e.\u0275\u0275directiveInject(N._))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-collection-item-mapper"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(te,5),2&t){let i;e.\u0275\u0275queryRefresh(i=e.\u0275\u0275loadQuery())&&(n.tabs=i.first)}},features:[e.\u0275\u0275ProvidersFeature([{provide:j.SEARCH_CONFIG_SERVICE,useClass:W.U}])],decls:25,vars:24,consts:[[1,"container"],[1,"row"],[1,"col-12"],["id","collection-name",3,"innerHTML"],["ngbNav","",1,"nav-tabs",3,"destroyOnHide","navChange"],["tabs","ngbNav"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"mt-2"],[1,"mt-2",3,"key","dsoRD$","paginationOptions","confirmButton","cancelButton","dangerConfirm","hideCollection","confirm","cancel"],[1,"row","mt-2"],[1,"col-12","col-lg-6"],["id","search-form",3,"query","scope","currentUrl","inPlaceSearch","searchPlaceholder","submitSearch"],[4,"ngIf"],["class","alert alert-info w-100","role","alert",4,"ngIf"],[1,"mt-2",3,"key","dsoRD$","paginationOptions","featureId","confirmButton","cancelButton","confirm","cancel"],["role","alert",1,"alert","alert-info","w-100"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(6,"p",3),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementStart(9,"p"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"ul",4,5),e.\u0275\u0275listener("navChange",function(s){return n.tabChange(s)}),e.\u0275\u0275elementStart(14,"li",6)(15,"a",7),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,ne,3,9,"ng-template",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"li",6)(20,"a",7),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(23,ae,8,13,"ng-template",8),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(24,"div",9),e.\u0275\u0275elementEnd()()()),2&t){const i=e.\u0275\u0275reference(13);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,9,"collection.edit.item-mapper.head")),e.\u0275\u0275advance(2),e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind2(7,11,"collection.edit.item-mapper.collection",e.\u0275\u0275pureFunction1(22,re,e.\u0275\u0275pipeBind1(8,14,n.collectionName$))),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,16,"collection.edit.item-mapper.description")),e.\u0275\u0275advance(2),e.\u0275\u0275property("destroyOnHide",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngbNavItem","browseTab"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,18,"collection.edit.item-mapper.tabs.browse")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngbNavItem","mapTab"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(22,20,"collection.edit.item-mapper.tabs.map")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngbNavOutlet",i)}},dependencies:[u.O5,T.uN,T.Pz,T.nv,T.Vx,T.tO,q.p,ee.p,u.Ov,g.X$],data:{animation:[V.Ji,V.Ic]},changeDetection:0}),o})();var le=a(24806),P=a(42620);const ce=function(o){return{active:o}},pe=function(o){return[o]};function de(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"li",13)(1,"a",14),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()),2&o){const t=r.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(5,ce,t===n.currentPage))("routerLink",e.\u0275\u0275pureFunction1(7,pe,"./"+t)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,n.type+".edit.tabs."+t+".head")," ")}}function ue(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"a",15),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",16),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275property("routerLink",t.getPageUrl(null==(n=e.\u0275\u0275pipeBind1(1,2,t.dsoRD$))?null:n.payload)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,4,t.type+".edit.return")," ")}}let me=(()=>{class o extends le.x{constructor(t,n){super(t,n),this.router=t,this.route=n,this.type="collection"}getPageUrl(t){return(0,P.MI)(t.id)}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(m.F0),e.\u0275\u0275directiveInject(m.gz))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-edit-collection"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:21,vars:11,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom"],[1,"btn","btn-danger",3,"routerLink"],[1,"fas","fa-trash"],[1,"pt-2"],[1,"nav","nav-tabs","justify-content-start","mb-2"],["class","nav-item",4,"ngFor","ngForOf"],[1,"tab-pane","active"],[1,"mb-4"],[1,"col-12","text-right"],["class","btn btn-outline-secondary",3,"routerLink",4,"ngIf"],[1,"nav-item"],[1,"nav-link",3,"ngClass","routerLink"],[1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2"),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div")(8,"a",4),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275element(10,"i",5),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(13,"div",6)(14,"ul",7),e.\u0275\u0275template(15,de,4,9,"li",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",9)(17,"div",10),e.\u0275\u0275element(18,"router-outlet"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"div",11),e.\u0275\u0275template(20,ue,5,6,"a",12),e.\u0275\u0275elementEnd()()()()()()),2&t){let i;e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,5,n.type+".edit.head")),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLink",("community"===n.type?"/communities/":"/collections/")+(null==(i=e.\u0275\u0275pipeBind1(9,7,n.dsoRD$))?null:i.payload.uuid)+"/delete"),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,9,n.type+".edit.delete"),""),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",n.pages),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",!n.hideReturnButton)}},dependencies:[u.mk,u.sg,u.O5,m.lC,m.rH,u.Ov,g.X$],encapsulation:2}),o})();var he=a(80180),fe=a(5378),ve=a(84803),Ce=a(13005),w=a(6952),H=a(41966),Se=a(57755);function ge(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.addItemTemplate())}),e.\u0275\u0275element(1,"i",8),e.\u0275\u0275elementStart(2,"span",9),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&o&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"collection.edit.template.add-button"),""))}function ye(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",10),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.deleteItemTemplate())}),e.\u0275\u0275element(1,"i",11),e.\u0275\u0275elementStart(2,"span",9),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&o&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"collection.edit.template.delete-button"),""))}function be(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"button",12),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",13),e.\u0275\u0275elementStart(3,"span",9),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext(2);let n;e.\u0275\u0275property("routerLink","/collections/"+(null==(n=e.\u0275\u0275pipeBind1(1,2,t.dsoRD$))?null:n.payload.uuid)+"/itemtemplate"),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"collection.edit.template.edit-button"),"")}}function Ie(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"label"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",3),e.\u0275\u0275template(5,ge,5,3,"button",4),e.\u0275\u0275template(6,ye,5,3,"button",5),e.\u0275\u0275template(7,be,6,6,"button",6),e.\u0275\u0275elementEnd()()),2&o){const t=r.ngVar;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,4,"collection.edit.template.label")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!(null!=t&&t.payload)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t?null:t.payload),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t?null:t.payload)}}let _e=(()=>{class o extends he.Z{constructor(t,n,i,s,p,v,C,S){super(t,i,s,p,v),this.collectionDataService=t,this.itemTemplateService=n,this.router=i,this.route=s,this.notificationsService=p,this.translate=v,this.requestService=C,this.chd=S,this.frontendURL="/collections/",this.type=fe.F.type}ngOnInit(){this.router.events.subscribe(t=>{(t instanceof m.m2||t instanceof m.Xs&&t.routerEvent instanceof m.m2)&&(super.ngOnInit(),this.initTemplateItem(),this.chd.detectChanges())})}initTemplateItem(){this.itemTemplateRD$=this.dsoRD$.pipe((0,l.Gp)(),(0,f.w)(t=>this.itemTemplateService.findByCollectionID(t.uuid)))}addItemTemplate(){const t=this.dsoRD$.pipe((0,l.Gp)()),n=t.pipe((0,f.w)(s=>this.itemTemplateService.createByCollectionID(new Ce.c,s.uuid).pipe((0,l.Gp)()))),i=t.pipe((0,f.w)(s=>this.itemTemplateService.getCollectionEndpoint(s.id)));(0,x.a)(t,n,i).subscribe(([s,p,v])=>{this.requestService.setStaleByHrefSubstring(v),this.router.navigate([(0,P.$X)(s.uuid)])})}deleteItemTemplate(){this.dsoRD$.pipe((0,l.Gp)(),(0,f.w)(t=>this.itemTemplateService.findByCollectionID(t.uuid)),(0,l.Gp)(),(0,f.w)(t=>this.itemTemplateService.delete(t.uuid)),(0,l.hC)(),(0,h.U)(t=>(0,d.Uh)(t)&&t.hasSucceeded)).subscribe(t=>{t?this.notificationsService.success(null,this.translate.get("collection.edit.template.notifications.delete.success")):this.notificationsService.error(null,this.translate.get("collection.edit.template.notifications.delete.error")),this.initTemplateItem()})}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject($.W),e.\u0275\u0275directiveInject(ve.w),e.\u0275\u0275directiveInject(m.F0),e.\u0275\u0275directiveInject(m.gz),e.\u0275\u0275directiveInject(R.T),e.\u0275\u0275directiveInject(g.sK),e.\u0275\u0275directiveInject(w.s),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-collection-metadata"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:4,vars:6,consts:[["class","container-fluid mb-2",4,"ngVar"],[3,"dso","submitForm","back","finish"],[1,"container-fluid","mb-2"],[1,"button-row","space-children-mr"],["class","btn btn-success",3,"click",4,"ngIf"],["class","btn btn-danger",3,"click",4,"ngIf"],["class","btn btn-primary",3,"routerLink",4,"ngIf"],[1,"btn","btn-success",3,"click"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[1,"btn","btn-danger",3,"click"],[1,"fas","fa-trash-alt"],[1,"btn","btn-primary",3,"routerLink"],[1,"fas","fa-edit"]],template:function(t,n){if(1&t&&(e.\u0275\u0275template(0,Ie,8,6,"div",0),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementStart(2,"ds-collection-form",1),e.\u0275\u0275listener("submitForm",function(s){return n.onSubmit(s)})("back",function(){return n.navigateToHomePage()})("finish",function(){return n.navigateToHomePage()}),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd()),2&t){let i;e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(1,2,n.itemTemplateRD$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("dso",null==(i=e.\u0275\u0275pipeBind1(3,4,n.dsoRD$))?null:i.payload)}},dependencies:[u.O5,m.rH,H.g,Se.L,u.Ov,g.X$],encapsulation:2}),o})();var D=a(76215),xe=a(31258);function Te(o,r){if(1&o&&(e.\u0275\u0275element(0,"ds-comcol-role",1),e.\u0275\u0275pipe(1,"async")),2&o){const t=r.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("dso",e.\u0275\u0275pipeBind1(1,2,n.collection$))("comcolRole",t)}}let Ee=(()=>{class o{constructor(t){this.route=t}ngOnInit(){this.dsoRD$=this.route.parent.data.pipe((0,D.P)(),(0,h.U)(t=>t.dso)),this.collection$=this.dsoRD$.pipe((0,l.xw)(),(0,l.xe)()),this.comcolRoles$=this.collection$.pipe((0,h.U)(t=>{let n=(0,d.Uh)(t._links.workflowGroups)?t._links.workflowGroups:[];return Array.isArray(n)||(n=[n]),[{name:"collection-admin",href:t._links.adminGroup.href},{name:"submitters",href:t._links.submittersGroup.href},{name:"item_read",href:t._links.itemReadGroup.href},{name:"bitstream_read",href:t._links.bitstreamReadGroup.href},...n]}))}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(m.gz))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-collection-roles"]],decls:2,vars:3,consts:[[3,"dso","comcolRole",4,"ngFor","ngForOf"],[3,"dso","comcolRole"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,Te,2,4,"ds-comcol-role",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(1,1,n.comcolRoles$))},dependencies:[u.sg,xe.b,u.Ov],encapsulation:2}),o})();var Be=a(90321),y=a(5737),Re=a(5453),b=a(89290),$e=a(62574),F=a.n($e),we=a(76774),z=a(5476),De=a(87657),Fe=a(82485),Me=a(75286),Oe=a(97920),M=a(27303),I=a(77007),c=a(58371),Ne=a(39034),Ve=a(97785),Ue=a(78964);function je(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",8),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2).ngVar,s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.testConfiguration(i))}),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}if(2&o){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("disabled",!t.isEnabled),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,2,"collection.source.controls.test.submit"))}}function Ae(o,r){1&o&&(e.\u0275\u0275elementStart(0,"button",9),e.\u0275\u0275element(1,"span",10),e.\u0275\u0275elementStart(2,"span"),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()),2&o&&(e.\u0275\u0275property("disabled",!0),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"collection.source.controls.test.running")))}function Le(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",11),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(i.importNow())}),e.\u0275\u0275elementStart(1,"span",12),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}if(2&o){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("disabled",!t.isEnabled),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,2,"collection.source.controls.import.submit"))}}function Pe(o,r){1&o&&(e.\u0275\u0275elementStart(0,"button",13),e.\u0275\u0275element(1,"span",10),e.\u0275\u0275elementStart(2,"span",12),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()),2&o&&(e.\u0275\u0275property("disabled",!0),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"collection.source.controls.import.running")))}function He(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",11),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(i.resetAndReimport())}),e.\u0275\u0275elementStart(1,"span",12),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}if(2&o){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("disabled",!t.isEnabled),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(3,2,"collection.source.controls.reset.submit"),"")}}function ze(o,r){1&o&&(e.\u0275\u0275elementStart(0,"button",13),e.\u0275\u0275element(1,"span",10),e.\u0275\u0275elementStart(2,"span",12),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()),2&o&&(e.\u0275\u0275property("disabled",!0),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,2,"collection.source.controls.reset.running"),""))}function Ge(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"h4"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div")(5,"span",3),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"span"),e.\u0275\u0275text(9),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"div")(11,"span",3),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"span"),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(17,"div")(18,"span",3),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"span"),e.\u0275\u0275text(22),e.\u0275\u0275pipe(23,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(24,"div")(25,"span",3),e.\u0275\u0275text(26),e.\u0275\u0275pipe(27,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"span"),e.\u0275\u0275text(29),e.\u0275\u0275pipe(30,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(31,je,4,4,"button",4),e.\u0275\u0275pipe(32,"async"),e.\u0275\u0275template(33,Ae,5,4,"button",5),e.\u0275\u0275pipe(34,"async"),e.\u0275\u0275template(35,Le,4,4,"button",6),e.\u0275\u0275pipe(36,"async"),e.\u0275\u0275template(37,Pe,5,4,"button",7),e.\u0275\u0275pipe(38,"async"),e.\u0275\u0275template(39,He,4,4,"button",6),e.\u0275\u0275pipe(40,"async"),e.\u0275\u0275template(41,ze,5,4,"button",7),e.\u0275\u0275pipe(42,"async"),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext().ngVar,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,15,"collection.source.controls.head")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(7,17,"collection.source.controls.harvest.status")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(null==t?null:t.harvestStatus),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(13,19,"collection.source.controls.harvest.start")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(null!=t&&t.harvestStartTime?null==t?null:t.harvestStartTime:e.\u0275\u0275pipeBind1(16,21,"collection.source.controls.harvest.no-information")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(20,23,"collection.source.controls.harvest.last")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(null!=t&&t.lastHarvested?null==t?null:t.lastHarvested:e.\u0275\u0275pipeBind1(23,25,"collection.source.controls.harvest.no-information")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(27,27,"collection.source.controls.harvest.message")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(null!=t&&t.message?null==t?null:t.message:e.\u0275\u0275pipeBind1(30,29,"collection.source.controls.harvest.no-information")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(32,31,n.testConfigRunning$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(34,33,n.testConfigRunning$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(36,35,n.importRunning$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(38,37,n.importRunning$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(40,39,n.reImportRunning$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(42,41,n.reImportRunning$))}}function ke(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,Ge,43,43,"div",1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.shouldShow)}}let Xe=(()=>{class o{constructor(t,n,i,s,p,v,C,S){this.scriptDataService=t,this.processDataService=n,this.requestService=i,this.notificationsService=s,this.collectionService=p,this.translateService=v,this.httpClient=C,this.bitstreamService=S,this.subs=[],this.testConfigRunning$=new E.X(!1),this.importRunning$=new E.X(!1),this.reImportRunning$=new E.X(!1)}ngOnInit(){this.contentSource$=this.collectionService.findByHref(this.collection._links.self.href,!1).pipe((0,l.mc)(),(0,f.w)(t=>this.collectionService.getContentSource(t.uuid,!1)),(0,l.mc)())}testConfiguration(t){this.testConfigRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-g",value:null},{name:"-a",value:t.oaiSource},{name:"-i",value:(new Ve.q).Serialize(t.oaiSetId)}],[]).pipe((0,l.hC)(),(0,M.b)(n=>{n.hasFailed&&(this.notificationsService.error(this.translateService.get("collection.source.controls.test.submit.error")),this.testConfigRunning$.next(!1))}),(0,I.h)(n=>n.hasSucceeded&&(0,d.Uh)(n.payload)),(0,f.w)(n=>this.processDataService.findById(n.payload.processId,!1)),(0,l.f1)(),(0,I.h)(n=>!n.isStale&&(n.hasSucceeded||n.hasFailed)),(0,h.U)(n=>n.payload),(0,d.tz)()).subscribe(n=>{n.processStatus.toString()!==c.N[c.N.COMPLETED].toString()&&n.processStatus.toString()!==c.N[c.N.FAILED].toString()&&setTimeout(()=>{this.requestService.setStaleByHrefSubstring(n._links.self.href)},5e3),n.processStatus.toString()===c.N[c.N.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.test.failed")),this.testConfigRunning$.next(!1)),n.processStatus.toString()===c.N[c.N.COMPLETED].toString()&&(this.bitstreamService.findByHref(n._links.output.href).pipe((0,l.Gp)()).subscribe(i=>{this.httpClient.get(i._links.content.href,{responseType:"text"}).subscribe(s=>{const p=s.replaceAll(new RegExp(".*\\@(.*)","g"),"$1").replaceAll("The script has started","").replaceAll("The script has completed","");this.notificationsService.info(this.translateService.get("collection.source.controls.test.completed"),p)})}),this.testConfigRunning$.next(!1))}))}importNow(){this.importRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-r",value:null},{name:"-c",value:this.collection.uuid}],[]).pipe((0,l.hC)(),(0,M.b)(t=>{t.hasFailed?(this.notificationsService.error(this.translateService.get("collection.source.controls.import.submit.error")),this.importRunning$.next(!1)):this.notificationsService.success(this.translateService.get("collection.source.controls.import.submit.success"))}),(0,I.h)(t=>t.hasSucceeded&&(0,d.Uh)(t.payload)),(0,f.w)(t=>this.processDataService.findById(t.payload.processId,!1)),(0,l.f1)(),(0,I.h)(t=>!t.isStale&&(t.hasSucceeded||t.hasFailed)),(0,h.U)(t=>t.payload),(0,d.tz)()).subscribe(t=>{t.processStatus.toString()!==c.N[c.N.COMPLETED].toString()&&t.processStatus.toString()!==c.N[c.N.FAILED].toString()&&setTimeout(()=>{this.requestService.setStaleByHrefSubstring(t._links.self.href),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href)},5e3),t.processStatus.toString()===c.N[c.N.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.import.failed")),this.importRunning$.next(!1)),t.processStatus.toString()===c.N[c.N.COMPLETED].toString()&&(this.notificationsService.success(this.translateService.get("collection.source.controls.import.completed")),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href),this.importRunning$.next(!1))}))}resetAndReimport(){this.reImportRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-o",value:null},{name:"-c",value:this.collection.uuid}],[]).pipe((0,l.hC)(),(0,M.b)(t=>{t.hasFailed?(this.notificationsService.error(this.translateService.get("collection.source.controls.reset.submit.error")),this.reImportRunning$.next(!1)):this.notificationsService.success(this.translateService.get("collection.source.controls.reset.submit.success"))}),(0,I.h)(t=>t.hasSucceeded&&(0,d.Uh)(t.payload)),(0,f.w)(t=>this.processDataService.findById(t.payload.processId,!1)),(0,l.f1)(),(0,I.h)(t=>!t.isStale&&(t.hasSucceeded||t.hasFailed)),(0,h.U)(t=>t.payload),(0,d.tz)()).subscribe(t=>{t.processStatus.toString()!==c.N[c.N.COMPLETED].toString()&&t.processStatus.toString()!==c.N[c.N.FAILED].toString()&&setTimeout(()=>{this.requestService.setStaleByHrefSubstring(t._links.self.href),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href)},5e3),t.processStatus.toString()===c.N[c.N.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.reset.failed")),this.reImportRunning$.next(!1)),t.processStatus.toString()===c.N[c.N.COMPLETED].toString()&&(this.notificationsService.success(this.translateService.get("collection.source.controls.reset.completed")),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href),this.reImportRunning$.next(!1))}))}ngOnDestroy(){this.subs.forEach(t=>{(0,d.Uh)(t)&&t.unsubscribe()})}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(Me.UY),e.\u0275\u0275directiveInject(Oe.n),e.\u0275\u0275directiveInject(w.s),e.\u0275\u0275directiveInject(R.T),e.\u0275\u0275directiveInject($.W),e.\u0275\u0275directiveInject(g.sK),e.\u0275\u0275directiveInject(Ue.eN),e.\u0275\u0275directiveInject(Ne.J))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-collection-source-controls"]],inputs:{isEnabled:"isEnabled",collection:"collection",shouldShow:"shouldShow"},decls:2,vars:3,consts:[[4,"ngVar"],["class","container-fluid space-children-mr",4,"ngIf"],[1,"container-fluid","space-children-mr"],[1,"font-weight-bold"],["class","btn btn-secondary",3,"disabled","click",4,"ngIf"],["class","btn btn-secondary",3,"disabled",4,"ngIf"],["class","btn btn-primary",3,"disabled","click",4,"ngIf"],["class","btn btn-primary",3,"disabled",4,"ngIf"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"btn","btn-secondary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","spinner-button"],[1,"btn","btn-primary",3,"disabled","click"],[1,"d-none","d-sm-inline"],[1,"btn","btn-primary",3,"disabled"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,ke,2,1,"div",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(1,1,n.contentSource$))},dependencies:[u.O5,H.g,u.Ov,g.X$],styles:[".spinner-button[_ngcontent-%COMP%]{margin-bottom:calc((var(--bs-line-height-base) * 1rem - var(--bs-font-size-base)) / 2)}"]}),o})();function Ke(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",14),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.discard())}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",15),e.\u0275\u0275elementStart(3,"span",6),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.metadata.discard-button"),"")}}function Ye(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",16),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.reinstate())}),e.\u0275\u0275element(1,"i",17),e.\u0275\u0275elementStart(2,"span",6),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&o&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.metadata.reinstate-button"),""))}function Qe(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",18)(1,"input",19),e.\u0275\u0275listener("change",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.changeExternalSource())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(2,"label",20),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("checked",(null==t.contentSource?null:t.contentSource.harvestType)!==t.harvestTypeNone),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"collection.edit.tabs.source.external"))}}function We(o,r){1&o&&(e.\u0275\u0275element(0,"ds-themed-loading",21),e.\u0275\u0275pipe(1,"translate")),2&o&&e.\u0275\u0275property("message",e.\u0275\u0275pipeBind1(1,1,"loading.content-source"))}function Je(o,r){1&o&&(e.\u0275\u0275elementStart(0,"h4"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"collection.edit.tabs.source.form.head")))}function Ze(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",22),e.\u0275\u0275listener("dfChange",function(i){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.onChange(i))})("submitForm",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.onSubmit())})("cancel",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.onCancel())}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId","collection-source-form-id")("formGroup",t.formGroup)("formModel",t.formModel)("formLayout",t.formLayout)("displaySubmit",!1)("displayCancel",!1)}}function qe(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",14),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.discard())}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",15),e.\u0275\u0275elementStart(3,"span",6),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.metadata.discard-button"),"")}}function et(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",16),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.reinstate())}),e.\u0275\u0275element(1,"i",17),e.\u0275\u0275elementStart(2,"span",6),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&o&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.metadata.reinstate-button"),""))}function tt(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",23)(1,"div",10)(2,"div",24)(3,"div",25),e.\u0275\u0275template(4,qe,6,6,"button",2),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275template(6,et,5,3,"button",3),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275elementStart(8,"button",4),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.onSubmit())}),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275element(10,"i",5),e.\u0275\u0275elementStart(11,"span",6),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd()()()()()()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(5,4,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(7,6,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(9,8,t.hasChanges())||!t.isValid()||t.initialHarvestType===t.harvestTypeNone&&t.contentSource.harvestType===t.initialHarvestType),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(13,10,"item.edit.metadata.save-button"),"")}}let nt=(()=>{class o extends Be._{constructor(t,n,i,s,p,v,C,S,_){super(t,n,p),this.objectUpdatesService=t,this.notificationsService=n,this.location=i,this.formService=s,this.translate=p,this.route=v,this.router=C,this.collectionService=S,this.requestService=_,this.LABEL_KEY_PREFIX="collection.edit.tabs.source.form.",this.ERROR_KEY_PREFIX="collection.edit.tabs.source.form.errors.",this.OPTIONS_KEY_PREFIX="collection.edit.tabs.source.form.options.",this.oaiSourceModel=new y.b1u({id:"oaiSource",name:"oaiSource",required:!0,validators:{required:null},errorMessages:{required:"You must provide a set id of the target collection."}}),this.oaiSetIdModel=new y.b1u({id:"oaiSetId",name:"oaiSetId"}),this.metadataConfigIdModel=new y.nMt({id:"metadataConfigId",name:"metadataConfigId"}),this.harvestTypeModel=new y.TJt({id:"harvestType",name:"harvestType",options:[{value:b.V.Metadata},{value:b.V.MetadataAndRef},{value:b.V.MetadataAndBitstreams}]}),this.inputModels=[this.oaiSourceModel,this.oaiSetIdModel,this.metadataConfigIdModel,this.harvestTypeModel],this.formModel=[new y.S_O({id:"oaiSourceContainer",group:[this.oaiSourceModel]}),new y.S_O({id:"oaiSetContainer",group:[this.oaiSetIdModel,this.metadataConfigIdModel]}),new y.S_O({id:"harvestTypeContainer",group:[this.harvestTypeModel]})],this.formLayout={oaiSource:{grid:{host:"col-12 d-inline-block"}},oaiSetId:{grid:{host:"col col-sm-6 d-inline-block"}},metadataConfigId:{grid:{host:"col col-sm-6 d-inline-block"}},harvestType:{grid:{host:"col-12",option:"btn-outline-secondary"}},oaiSetContainer:{grid:{host:"row"}},oaiSourceContainer:{grid:{host:"row"}},harvestTypeContainer:{grid:{host:"row"}}},this.harvestTypeNone=b.V.None,this.previouslySelectedHarvestType=b.V.Metadata,this.displayedNotifications=[]}ngOnInit(){this.notificationsPrefix="collection.edit.tabs.source.notifications.",this.discardTimeOut=we.N.collection.edit.undoTimeout,this.url=this.router.url,this.url.indexOf("?")>0&&(this.url=this.url.substr(0,this.url.indexOf("?"))),this.formGroup=this.formService.createFormGroup(this.formModel),this.collectionRD$=this.route.parent.data.pipe((0,D.P)(),(0,h.U)(t=>t.dso)),this.collectionRD$.pipe((0,l.xw)(),(0,h.U)(t=>t.payload.uuid),(0,f.w)(t=>this.collectionService.getContentSource(t)),(0,l.hC)()).subscribe(t=>{this.initializeOriginalContentSource(t.payload)}),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()})}initializeOriginalContentSource(t){this.contentSource=t,this.initialHarvestType=t.harvestType,this.initializeMetadataConfigs();const n=F()(this.contentSource);this.objectUpdatesService.initialize(this.url,[n],new Date),this.update$=this.objectUpdatesService.getFieldUpdates(this.url,[n]).pipe((0,h.U)(i=>i[n.uuid])),this.updateSub=this.update$.subscribe(i=>{if(i){const s=i.field;let p;(0,d.Uh)(this.contentSource)&&(0,d.UE)(this.contentSource.metadataConfigs)&&(p=this.contentSource.metadataConfigs[0].id),(0,d.Uh)(s)&&(0,d.Uh)(s.metadataConfigId)&&(p=s.metadataConfigId),(0,d.Uh)(s)&&(this.formGroup.patchValue({oaiSourceContainer:{oaiSource:s.oaiSource},oaiSetContainer:{oaiSetId:s.oaiSetId,metadataConfigId:p},harvestTypeContainer:{harvestType:s.harvestType}}),this.contentSource=F()(s)),this.contentSource.metadataConfigId=p}})}initializeMetadataConfigs(){this.metadataConfigIdModel.options=this.contentSource.metadataConfigs.map(t=>Object.assign({value:t.id,label:t.label})),this.metadataConfigIdModel.options.length>0&&this.formGroup.patchValue({oaiSetContainer:{metadataConfigId:this.metadataConfigIdModel.options[0].value}})}updateFieldTranslations(){this.inputModels.forEach(t=>{this.updateFieldTranslation(t)})}updateFieldTranslation(t){t.label=this.translate.instant(this.LABEL_KEY_PREFIX+t.id),(0,d.UE)(t.validators)&&(t.errorMessages={},Object.keys(t.validators).forEach(n=>{t.errorMessages[n]=this.translate.instant(this.ERROR_KEY_PREFIX+t.id+"."+n)})),t instanceof y.WS&&(0,d.UE)(t.options)&&t.options.forEach(n=>{(0,d.xI)(n.label)&&(n.label=this.translate.instant(this.OPTIONS_KEY_PREFIX+t.id+"."+n.value))})}onChange(t){this.updateContentSourceField(t.model,!0),this.saveFieldUpdate()}onSubmit(){this.collectionRD$.pipe((0,l.xw)(),(0,h.U)(t=>t.payload.uuid),(0,f.w)(t=>this.collectionService.getHarvesterEndpoint(t)),(0,B.q)(1)).subscribe(t=>this.requestService.removeByHrefSubstring(t)),this.requestService.setStaleByHrefSubstring(this.contentSource._links.self.href),this.collectionRD$.pipe((0,l.xw)(),(0,h.U)(t=>t.payload.uuid),(0,f.w)(t=>this.collectionService.updateContentSource(t,this.contentSource)),(0,B.q)(1)).subscribe(t=>{(0,d.Uh)(t.harvestType)?(this.clearNotifications(),this.initializeOriginalContentSource(t),this.displayedNotifications.push(this.notificationsService.success(this.getNotificationTitle("saved"),this.getNotificationContent("saved")))):this.displayedNotifications.push(t)})}onCancel(){this.location.back()}isValid(){return this.contentSource.harvestType===b.V.None||this.formGroup.valid}changeExternalSource(){this.contentSource.harvestType===b.V.None?this.contentSource.harvestType=this.previouslySelectedHarvestType:(this.previouslySelectedHarvestType=this.contentSource.harvestType,this.contentSource.harvestType=b.V.None),this.updateContentSource(!1)}updateContentSource(t){this.inputModels.forEach(n=>{this.updateContentSourceField(n,t)}),this.saveFieldUpdate()}updateContentSourceField(t,n){(0,d.Uh)(t.value)&&(t.id!==this.harvestTypeModel.id||n)&&(this.contentSource[t.id]=t.value)}saveFieldUpdate(){this.objectUpdatesService.saveAddFieldUpdate(this.url,F()(this.contentSource))}clearNotifications(){this.displayedNotifications.forEach(t=>{this.notificationsService.remove(t)}),this.displayedNotifications=[]}ngOnDestroy(){this.updateSub&&this.updateSub.unsubscribe()}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(Re.d),e.\u0275\u0275directiveInject(R.T),e.\u0275\u0275directiveInject(u.Ye),e.\u0275\u0275directiveInject(y.w1X),e.\u0275\u0275directiveInject(g.sK),e.\u0275\u0275directiveInject(m.gz),e.\u0275\u0275directiveInject(m.F0),e.\u0275\u0275directiveInject($.W),e.\u0275\u0275directiveInject(w.s))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-collection-source"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:24,vars:27,consts:[[1,"container-fluid"],[1,"d-inline-block","float-right","space-children-mr"],["class"," btn btn-danger",3,"disabled","click",4,"ngIf"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fas","fa-save"],[1,"d-none","d-sm-inline"],["class","form-check mb-4",4,"ngIf"],[3,"message",4,"ngIf"],[4,"ngIf"],[1,"row"],[3,"formId","formGroup","formModel","formLayout","displaySubmit","displayCancel","dfChange","submitForm","cancel",4,"ngIf"],["class","container mt-2",4,"ngIf"],[3,"isEnabled","shouldShow","collection"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-times"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-undo-alt"],[1,"form-check","mb-4"],["type","checkbox","id","externalSourceCheck",1,"form-check-input",3,"checked","change"],["for","externalSourceCheck",1,"form-check-label"],[3,"message"],[3,"formId","formGroup","formModel","formLayout","displaySubmit","displayCancel","dfChange","submitForm","cancel"],[1,"container","mt-2"],[1,"col-12"],[1,"d-inline-block","float-right","ml-1","space-children-mr"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275template(2,Ke,6,6,"button",2),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275template(4,Ye,5,3,"button",3),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275elementStart(6,"button",4),e.\u0275\u0275listener("click",function(){return n.onSubmit()}),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275element(8,"i",5),e.\u0275\u0275elementStart(9,"span",6),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(12,"h4"),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(15,Qe,5,4,"div",7),e.\u0275\u0275template(16,We,2,3,"ds-themed-loading",8),e.\u0275\u0275template(17,Je,3,3,"h4",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"div",10),e.\u0275\u0275template(19,Ze,1,6,"ds-form",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(20,tt,14,12,"div",12),e.\u0275\u0275element(21,"ds-collection-source-controls",13),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275pipe(23,"async")),2&t){let i;e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(3,13,n.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(5,15,n.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(7,17,n.hasChanges())||!n.isValid()||n.initialHarvestType===n.harvestTypeNone&&n.contentSource.harvestType===n.initialHarvestType),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(11,19,"item.edit.metadata.save-button"),""),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,21,"collection.edit.tabs.source.head")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.contentSource),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.contentSource),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.contentSource&&(null==n.contentSource?null:n.contentSource.harvestType)!==n.harvestTypeNone),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.formGroup&&n.contentSource&&(null==n.contentSource?null:n.contentSource.harvestType)!==n.harvestTypeNone),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==n.contentSource?null:n.contentSource.harvestType)!==n.harvestTypeNone),e.\u0275\u0275advance(1),e.\u0275\u0275property("isEnabled",!e.\u0275\u0275pipeBind1(22,23,n.hasChanges()))("shouldShow",(null==n.contentSource?null:n.contentSource.harvestType)!==n.harvestTypeNone)("collection",null==(i=e.\u0275\u0275pipeBind1(23,25,n.collectionRD$))?null:i.payload)}},dependencies:[u.O5,z.JL,z.sg,De.Z,Fe.U,Xe,u.Ov,g.X$],encapsulation:2}),o})();var ot=a(62583);const it=function(o){return{collection:o}};let at=(()=>{class o{constructor(t,n){this.route=t,this.dsoNameService=n}ngOnInit(){this.dsoRD$=this.route.parent.data.pipe((0,B.q)(1),(0,h.U)(t=>t.dso)),this.collectionName$=this.dsoRD$.pipe((0,I.h)(t=>(0,d.Uh)(t)),(0,h.U)(t=>this.dsoNameService.getName(t.payload)))}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(m.gz),e.\u0275\u0275directiveInject(N._))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-collection-curate"]],decls:7,vars:11,consts:[[1,"container"],[3,"dsoHandle"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"h3"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"ds-curation-form",1),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd()),2&t){let i;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(3,2,"collection.curate.header",e.\u0275\u0275pureFunction1(9,it,e.\u0275\u0275pipeBind1(4,5,n.collectionName$)))),e.\u0275\u0275advance(3),e.\u0275\u0275property("dsoHandle",null==(i=e.\u0275\u0275pipeBind1(6,7,n.dsoRD$))?null:i.payload.handle)}},dependencies:[ot._,u.Ov,g.X$],encapsulation:2}),o})();var rt=a(53482);let st=(()=>{class o{constructor(t){this.route=t}ngOnInit(){this.dsoRD$=this.route.parent.parent.data.pipe((0,D.P)(),(0,h.U)(t=>t.dso))}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(m.gz))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-collection-authorizations"]],decls:3,vars:4,consts:[[1,"container"],[3,"resourceType","resourceUUID"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"ds-resource-policies",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&t){let i;e.\u0275\u0275advance(1),e.\u0275\u0275property("resourceType","collection")("resourceUUID",null==(i=e.\u0275\u0275pipeBind1(2,2,n.dsoRD$))||null==i.payload?null:i.payload.id)}},dependencies:[rt.F,u.Ov],encapsulation:2}),o})();var lt=a(76457),G=a(84535),ct=a(60740),k=a(37161),pt=a(50269),dt=a(24049),ut=a(35794),mt=a(38123),ht=a(9237);let ft=(()=>{class o extends dt.C{constructor(t,n,i){super(t,n,i),this.authorizationService=t,this.router=n,this.authService=i}getFeatureID(t,n){return(0,ht.of)(L.i.IsCollectionAdmin)}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(ut._),e.\u0275\u0275inject(m.F0),e.\u0275\u0275inject(mt.e8))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var vt=a(62467);function Ct(o,r){1&o&&e.\u0275\u0275element(0,"ds-access-control-form-container",1),2&o&&e.\u0275\u0275property("itemRD",r.ngIf)("showLimitToSpecificBitstreams",!1)}let St=(()=>{class o{constructor(t){this.route=t}ngOnInit(){this.itemRD$=this.route.parent.parent.data.pipe((0,h.U)(t=>t.dso)).pipe((0,l.xw)())}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(m.gz))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-collection-access-control"]],decls:2,vars:3,consts:[["titleMessage","collection-access-control-title",3,"itemRD","showLimitToSpecificBitstreams",4,"ngIf"],["titleMessage","collection-access-control-title",3,"itemRD","showLimitToSpecificBitstreams"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,Ct,1,2,"ds-access-control-form-container",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,n.itemRD$))},dependencies:[u.O5,vt.x,u.Ov]}),o})(),gt=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=e.\u0275\u0275defineInjector({providers:[k.b,G.a],imports:[m.Bz.forChild([{path:"",resolve:{breadcrumb:lt.t},data:{breadcrumbKey:"collection.edit"},component:me,canActivate:[ft],children:[{path:"",redirectTo:"metadata",pathMatch:"full"},{path:"metadata",component:_e,data:{title:"collection.edit.tabs.metadata.title",hideReturnButton:!0,showBreadcrumbs:!0}},{path:"roles",component:Ee,data:{title:"collection.edit.tabs.roles.title",showBreadcrumbs:!0}},{path:"source",component:nt,data:{title:"collection.edit.tabs.source.title",showBreadcrumbs:!0}},{path:"curate",component:at,data:{title:"collection.edit.tabs.curate.title",showBreadcrumbs:!0}},{path:"access-control",component:St,data:{title:"collection.edit.tabs.access-control.title",showBreadcrumbs:!0}},{path:"authorizations",data:{showBreadcrumbs:!0},children:[{path:"create",resolve:{resourcePolicyTarget:G.a},component:ct.v,data:{title:"resource-policies.create.page.title"}},{path:"edit",resolve:{resourcePolicy:k.b},component:pt.x,data:{title:"resource-policies.edit.page.title"}},{path:"",component:st,data:{title:"collection.edit.tabs.authorizations.title",showBreadcrumbs:!0}}]},{path:"mapper",component:se,data:{title:"collection.edit.tabs.item-mapper.title",hideReturnButton:!0,showBreadcrumbs:!0}}]}])]}),o})();var yt=a(95418),bt=a(54131),It=a(50867),_t=a(47413),xt=a(93682);let Tt=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=e.\u0275\u0275defineInjector({imports:[u.ez,X.m,gt,yt.s,bt.q,It.e,_t.H,xt.J]}),o})()}}]);