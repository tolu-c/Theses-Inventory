"use strict";var __defProp=Object.defineProperty,__name=(target,value)=>__defProp(target,"name",{value,configurable:!0});exports.id=3238,exports.ids=[3238],exports.modules={3238:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EditBitstreamPageComponent:()=>EditBitstreamPageComponent});var operators=__webpack_require__(96846),cjs=__webpack_require__(93489),core=__webpack_require__(49417),custom_switch_model=__webpack_require__(99861),cloneDeep=__webpack_require__(80115),cloneDeep_default=__webpack_require__.n(cloneDeep),bitstream_data_service=__webpack_require__(83167),shared_operators=__webpack_require__(53829),notifications_service=__webpack_require__(39373),bitstream_format_data_service=__webpack_require__(71391),bitstream_format_support_level=__webpack_require__(82333),empty_util=__webpack_require__(59501),metadata_utils=__webpack_require__(97559),item_page_routing_paths=__webpack_require__(50306),dso_name_service=__webpack_require__(17306),ds_dynamic_input_model=__webpack_require__(14156),ds_dynamic_textarea_model=__webpack_require__(15513),request_service=__webpack_require__(91751),remote_data_build_service=__webpack_require__(20018),object_cache_service=__webpack_require__(54174),hal_endpoint_service=__webpack_require__(54781),http=__webpack_require__(8280),request_models=__webpack_require__(10289),bundle_data_service=__webpack_require__(49068),fesm2020_core=__webpack_require__(86209);class PrimaryBitstreamService{constructor(requestService,rdbService,objectCache,halService,notificationsService,bundleDataService){this.requestService=requestService,this.rdbService=rdbService,this.objectCache=objectCache,this.halService=halService,this.notificationsService=notificationsService,this.bundleDataService=bundleDataService}getHttpOptions(){const options=Object.create({});let headers=new http.WM;return headers=headers.append("Content-Type","text/uri-list"),options.headers=headers,options}createAndSendRequest(requestType,endpointURL,primaryBitstreamSelfLink){const requestId=this.requestService.generateRequestId(),request=new requestType(requestId,endpointURL,primaryBitstreamSelfLink,this.getHttpOptions());return this.requestService.send(request),this.rdbService.buildFromRequestUUID(requestId)}create(primaryBitstream,bundle){return this.createAndSendRequest(request_models.xo,bundle._links.primaryBitstream.href,primaryBitstream.self)}put(primaryBitstream,bundle){return this.createAndSendRequest(request_models.an,bundle._links.primaryBitstream.href,primaryBitstream.self)}delete(bundle){return this.createAndSendRequest(request_models.jx,bundle._links.primaryBitstream.href).pipe((0,shared_operators.f1)(),(0,cjs.switchMap)(rd=>this.bundleDataService.findByHref(bundle.self,rd.hasFailed)))}}__name(PrimaryBitstreamService,"PrimaryBitstreamService"),PrimaryBitstreamService.\u0275fac=__name(function(t){return new(t||PrimaryBitstreamService)(fesm2020_core.LFG(request_service.s),fesm2020_core.LFG(remote_data_build_service.Q),fesm2020_core.LFG(object_cache_service.a),fesm2020_core.LFG(hal_endpoint_service.q),fesm2020_core.LFG(notifications_service.T),fesm2020_core.LFG(bundle_data_service.b))},"PrimaryBitstreamService_Factory"),PrimaryBitstreamService.\u0275prov=fesm2020_core.Yz7({token:PrimaryBitstreamService,factory:PrimaryBitstreamService.\u0275fac,providedIn:"root"});var router=__webpack_require__(16088),common=__webpack_require__(65159),ngx_translate_core=__webpack_require__(4330),fesm2020_forms=__webpack_require__(32189),error_component=__webpack_require__(35964),themed_loading_component=__webpack_require__(24442),themed_thumbnail_component=__webpack_require__(3010),var_directive=__webpack_require__(61562),form_component=__webpack_require__(23593),file_size_pipe=__webpack_require__(46724);const _c0=__name(function(a1){return["/bitstreams",a1,"authorizations"]},"_c0");function EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template(rf,ctx){if(1&rf){const _r9=fesm2020_core.EpF();fesm2020_core.TgZ(0,"ds-form",12),fesm2020_core.NdJ("submitForm",__name(function(){fesm2020_core.CHM(_r9);const ctx_r8=fesm2020_core.oxw(4);return fesm2020_core.KtG(ctx_r8.onSubmit())},"EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template_ds_form_submitForm_0_listener"))("cancel",__name(function(){fesm2020_core.CHM(_r9);const ctx_r10=fesm2020_core.oxw(4);return fesm2020_core.KtG(ctx_r10.onCancel())},"EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template_ds_form_cancel_0_listener"))("dfChange",__name(function($event){fesm2020_core.CHM(_r9);const ctx_r11=fesm2020_core.oxw(4);return fesm2020_core.KtG(ctx_r11.onChange($event))},"EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template_ds_form_dfChange_0_listener")),fesm2020_core.TgZ(1,"div",13)(2,"a",14),fesm2020_core._uU(3),fesm2020_core.ALo(4,"translate"),fesm2020_core.qZA()()()}if(2&rf){const bitstreamRD_r1=fesm2020_core.oxw(3).ngVar,ctx_r7=fesm2020_core.oxw();fesm2020_core.Q6J("formId","edit-bitstream-form-id")("formGroup",ctx_r7.formGroup)("formModel",ctx_r7.formModel)("formLayout",ctx_r7.formLayout)("submitLabel","form.save"),fesm2020_core.xp6(2),fesm2020_core.Q6J("routerLink",fesm2020_core.VKq(9,_c0,null==bitstreamRD_r1||null==bitstreamRD_r1.payload?null:bitstreamRD_r1.payload.id)),fesm2020_core.xp6(1),fesm2020_core.Oqu(fesm2020_core.lcZ(4,7,"bitstream.edit.authorizations.link"))}}function EditBitstreamPageComponent_ng_container_0_div_1_div_1_Template(rf,ctx){if(1&rf&&(fesm2020_core.TgZ(0,"div",5)(1,"div",6),fesm2020_core._UZ(2,"ds-themed-thumbnail",7),fesm2020_core.qZA(),fesm2020_core.TgZ(3,"div",8)(4,"div",2)(5,"div",5)(6,"div",9)(7,"h3"),fesm2020_core._uU(8),fesm2020_core.TgZ(9,"span",10),fesm2020_core._uU(10),fesm2020_core.ALo(11,"dsFileSize"),fesm2020_core.qZA()()()()(),fesm2020_core.YNc(12,EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template,5,11,"ds-form",11),fesm2020_core.qZA()()),2&rf){const bitstreamRD_r1=fesm2020_core.oxw(2).ngVar,ctx_r4=fesm2020_core.oxw();fesm2020_core.xp6(2),fesm2020_core.Q6J("thumbnail",null==bitstreamRD_r1?null:bitstreamRD_r1.payload),fesm2020_core.xp6(6),fesm2020_core.hij("",ctx_r4.dsoNameService.getName(null==bitstreamRD_r1?null:bitstreamRD_r1.payload)," "),fesm2020_core.xp6(2),fesm2020_core.hij("(",fesm2020_core.lcZ(11,4,null==bitstreamRD_r1||null==bitstreamRD_r1.payload?null:bitstreamRD_r1.payload.sizeBytes),")"),fesm2020_core.xp6(2),fesm2020_core.Q6J("ngIf",ctx_r4.formGroup)}}function EditBitstreamPageComponent_ng_container_0_div_1_ds_error_2_Template(rf,ctx){1&rf&&(fesm2020_core._UZ(0,"ds-error",15),fesm2020_core.ALo(1,"translate")),2&rf&&fesm2020_core.s9C("message",fesm2020_core.lcZ(1,1,"error.bitstream"))}function EditBitstreamPageComponent_ng_container_0_div_1_ds_themed_loading_3_Template(rf,ctx){1&rf&&(fesm2020_core._UZ(0,"ds-themed-loading",15),fesm2020_core.ALo(1,"translate")),2&rf&&fesm2020_core.s9C("message",fesm2020_core.lcZ(1,1,"loading.bitstream"))}function EditBitstreamPageComponent_ng_container_0_div_1_Template(rf,ctx){if(1&rf&&(fesm2020_core.TgZ(0,"div",2),fesm2020_core.YNc(1,EditBitstreamPageComponent_ng_container_0_div_1_div_1_Template,13,6,"div",3),fesm2020_core.YNc(2,EditBitstreamPageComponent_ng_container_0_div_1_ds_error_2_Template,2,3,"ds-error",4),fesm2020_core.YNc(3,EditBitstreamPageComponent_ng_container_0_div_1_ds_themed_loading_3_Template,2,3,"ds-themed-loading",4),fesm2020_core.qZA()),2&rf){const formatsRD_r3=ctx.ngVar,bitstreamRD_r1=fesm2020_core.oxw().ngVar;fesm2020_core.xp6(1),fesm2020_core.Q6J("ngIf",(null==bitstreamRD_r1?null:bitstreamRD_r1.hasSucceeded)&&(null==formatsRD_r3?null:formatsRD_r3.hasSucceeded)),fesm2020_core.xp6(1),fesm2020_core.Q6J("ngIf",null==bitstreamRD_r1?null:bitstreamRD_r1.hasFailed),fesm2020_core.xp6(1),fesm2020_core.Q6J("ngIf",!bitstreamRD_r1||!formatsRD_r3||(null==bitstreamRD_r1?null:bitstreamRD_r1.isLoading)||(null==formatsRD_r3?null:formatsRD_r3.isLoading))}}function EditBitstreamPageComponent_ng_container_0_Template(rf,ctx){if(1&rf&&(fesm2020_core.ynx(0),fesm2020_core.YNc(1,EditBitstreamPageComponent_ng_container_0_div_1_Template,4,3,"div",1),fesm2020_core.ALo(2,"async"),fesm2020_core.BQk()),2&rf){const ctx_r0=fesm2020_core.oxw();fesm2020_core.xp6(1),fesm2020_core.Q6J("ngVar",fesm2020_core.lcZ(2,1,ctx_r0.bitstreamFormatsRD$))}}__name(EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template,"EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template"),__name(EditBitstreamPageComponent_ng_container_0_div_1_div_1_Template,"EditBitstreamPageComponent_ng_container_0_div_1_div_1_Template"),__name(EditBitstreamPageComponent_ng_container_0_div_1_ds_error_2_Template,"EditBitstreamPageComponent_ng_container_0_div_1_ds_error_2_Template"),__name(EditBitstreamPageComponent_ng_container_0_div_1_ds_themed_loading_3_Template,"EditBitstreamPageComponent_ng_container_0_div_1_ds_themed_loading_3_Template"),__name(EditBitstreamPageComponent_ng_container_0_div_1_Template,"EditBitstreamPageComponent_ng_container_0_div_1_Template"),__name(EditBitstreamPageComponent_ng_container_0_Template,"EditBitstreamPageComponent_ng_container_0_Template");class EditBitstreamPageComponent{constructor(route,router2,changeDetectorRef,location,formService,translate,bitstreamService,dsoNameService,notificationsService,bitstreamFormatService,primaryBitstreamService){this.route=route,this.router=router2,this.changeDetectorRef=changeDetectorRef,this.location=location,this.formService=formService,this.translate=translate,this.bitstreamService=bitstreamService,this.dsoNameService=dsoNameService,this.notificationsService=notificationsService,this.bitstreamFormatService=bitstreamFormatService,this.primaryBitstreamService=primaryBitstreamService,this.KEY_PREFIX="bitstream.edit.form.",this.LABEL_KEY_SUFFIX=".label",this.HINT_KEY_SUFFIX=".hint",this.NOTIFICATIONS_PREFIX="bitstream.edit.notifications.",this.IMAGE_WIDTH_METADATA="iiif.image.width",this.IMAGE_HEIGHT_METADATA="iiif.image.height",this.IIIF_TOC_METADATA="iiif.toc",this.IIIF_LABEL_METADATA="iiif.label",this.findAllOptions={elementsPerPage:9999},this.fileNameModel=new ds_dynamic_input_model.u({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"fileName",name:"fileName",required:!0,validators:{required:null},errorMessages:{required:"You must provide a file name for the bitstream"}}),this.primaryBitstreamModel=new custom_switch_model.p({id:"primaryBitstream",name:"primaryBitstream"}),this.descriptionModel=new ds_dynamic_textarea_model.D({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"description",name:"description",rows:10}),this.selectedFormatModel=new core.nMt({id:"selectedFormat",name:"selectedFormat"}),this.newFormatModel=new core.b1u({id:"newFormat",name:"newFormat"}),this.iiifLabelModel=new ds_dynamic_input_model.u({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifLabel",name:"iiifLabel"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifLabelContainer=new core.S_O({id:"iiifLabelContainer",group:[this.iiifLabelModel]},{grid:{host:"form-row"}}),this.iiifTocModel=new ds_dynamic_input_model.u({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifToc",name:"iiifToc"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifTocContainer=new core.S_O({id:"iiifTocContainer",group:[this.iiifTocModel]},{grid:{host:"form-row"}}),this.iiifWidthModel=new ds_dynamic_input_model.u({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifWidth",name:"iiifWidth"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifWidthContainer=new core.S_O({id:"iiifWidthContainer",group:[this.iiifWidthModel]},{grid:{host:"form-row"}}),this.iiifHeightModel=new ds_dynamic_input_model.u({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifHeight",name:"iiifHeight"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifHeightContainer=new core.S_O({id:"iiifHeightContainer",group:[this.iiifHeightModel]},{grid:{host:"form-row"}}),this.inputModels=[this.fileNameModel,this.primaryBitstreamModel,this.descriptionModel,this.selectedFormatModel,this.newFormatModel],this.formModel=[new core.S_O({id:"fileNamePrimaryContainer",group:[this.fileNameModel,this.primaryBitstreamModel]},{grid:{host:"form-row"}}),new core.S_O({id:"descriptionContainer",group:[this.descriptionModel]}),new core.S_O({id:"formatContainer",group:[this.selectedFormatModel,this.newFormatModel]})],this.newFormatBaseLayout="col col-sm-6 d-inline-block",this.formLayout={fileName:{grid:{host:"col col-sm-8 d-inline-block"}},primaryBitstream:{grid:{host:"col col-sm-4 d-inline-block switch border-0"}},description:{grid:{host:"col-12 d-inline-block"}},embargo:{grid:{host:"col-12 d-inline-block"}},selectedFormat:{grid:{host:"col col-sm-6 d-inline-block"}},newFormat:{grid:{host:this.newFormatBaseLayout+" invisible"}},fileNamePrimaryContainer:{grid:{host:"row position-relative"}},descriptionContainer:{grid:{host:"row"}},formatContainer:{grid:{host:"row"}}},this.isIIIF=!1,this.subs=[]}ngOnInit(){this.itemId=this.route.snapshot.queryParams.itemId,this.entityType=this.route.snapshot.queryParams.entityType,this.bitstreamRD$=this.route.data.pipe((0,operators.UI)(data=>data.bitstream)),this.bitstreamFormatsRD$=this.bitstreamFormatService.findAll(this.findAllOptions);const bitstream$=this.bitstreamRD$.pipe((0,shared_operators.xw)(),(0,shared_operators.xe)()),allFormats$=this.bitstreamFormatsRD$.pipe((0,shared_operators.xw)(),(0,shared_operators.xe)()),bundle$=bitstream$.pipe((0,operators.wt)(bitstream=>bitstream.bundle),(0,shared_operators.Gp)()),primaryBitstream$=bundle$.pipe((0,empty_util.tz)(),(0,operators.wt)(bundle=>this.bitstreamService.findByHref(bundle._links.primaryBitstream.href)),(0,shared_operators.Gp)()),item$=bundle$.pipe((0,operators.wt)(bundle=>bundle.item),(0,shared_operators.Gp)());this.subs.push((0,cjs.combineLatest)(bitstream$,allFormats$,bundle$,primaryBitstream$,item$).pipe().subscribe(([bitstream,allFormats,bundle,primaryBitstream,item])=>{this.bitstream=bitstream,this.formats=allFormats.page,this.bundle=bundle,this.primaryBitstreamUUID=(0,empty_util.Uh)(primaryBitstream)?primaryBitstream.uuid:null,this.itemId=item.uuid,this.setIiifStatus(this.bitstream)})),this.subs.push(this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()}))}setForm(){this.formGroup=this.formService.createFormGroup(this.formModel),this.updateFormatModel(),this.updateForm(this.bitstream),this.updateFieldTranslations()}updateForm(bitstream){this.formGroup.patchValue({fileNamePrimaryContainer:{fileName:bitstream.name,primaryBitstream:this.primaryBitstreamUUID===bitstream.uuid},descriptionContainer:{description:bitstream.firstMetadataValue("dc.description")},formatContainer:{newFormat:(0,empty_util.Uh)(bitstream.firstMetadata("dc.format"))?bitstream.firstMetadata("dc.format").value:void 0}}),this.isIIIF&&this.formGroup.patchValue({iiifLabelContainer:{iiifLabel:bitstream.firstMetadataValue(this.IIIF_LABEL_METADATA)},iiifTocContainer:{iiifToc:bitstream.firstMetadataValue(this.IIIF_TOC_METADATA)},iiifWidthContainer:{iiifWidth:bitstream.firstMetadataValue(this.IMAGE_WIDTH_METADATA)},iiifHeightContainer:{iiifHeight:bitstream.firstMetadataValue(this.IMAGE_HEIGHT_METADATA)}}),this.bitstream.format.pipe((0,shared_operators.mc)()).subscribe(format=>{this.originalFormat=format,this.formGroup.patchValue({formatContainer:{selectedFormat:format.id}}),this.updateNewFormatLayout(format.id)})}updateFormatModel(){this.selectedFormatModel.options=this.formats.map(format=>Object.assign({value:format.id,label:this.isUnknownFormat(format.id)?this.translate.instant(this.KEY_PREFIX+"selectedFormat.unknown"):format.shortDescription}))}updateNewFormatLayout(selectedId){this.isUnknownFormat(selectedId)?this.formLayout.newFormat.grid.host=this.newFormatBaseLayout:this.formLayout.newFormat.grid.host=this.newFormatBaseLayout+" invisible"}isUnknownFormat(id){const format=this.formats.find(f=>f.id===id);return(0,empty_util.Uh)(format)&&format.supportLevel===bitstream_format_support_level.o.Unknown}updateFieldTranslations(){this.inputModels.forEach(fieldModel=>{this.updateFieldTranslation(fieldModel)})}updateFieldTranslation(fieldModel){fieldModel.label=this.translate.instant(this.KEY_PREFIX+fieldModel.id+this.LABEL_KEY_SUFFIX),fieldModel.id!==this.primaryBitstreamModel.id&&(fieldModel.hint=this.translate.instant(this.KEY_PREFIX+fieldModel.id+this.HINT_KEY_SUFFIX))}onChange(event){const model=event.model;model.id===this.selectedFormatModel.id&&this.updateNewFormatLayout(model.value)}onSubmit(){const updatedValues=this.formGroup.getRawValue(),updatedBitstream=this.formToBitstream(updatedValues),selectedFormat=this.formats.find(f=>f.id===updatedValues.formatContainer.selectedFormat),isNewFormat=selectedFormat.id!==this.originalFormat.id,isPrimary=updatedValues.fileNamePrimaryContainer.primaryBitstream,wasPrimary=this.primaryBitstreamUUID===this.bitstream.uuid;let bitstream$,bundle$,errorWhileSaving=!1;if(wasPrimary!==isPrimary){let bundleRd$;bundleRd$=wasPrimary?this.primaryBitstreamService.delete(this.bundle):(0,empty_util.Uh)(this.primaryBitstreamUUID)?this.primaryBitstreamService.put(this.bitstream,this.bundle):this.primaryBitstreamService.create(this.bitstream,this.bundle);const completedBundleRd$=bundleRd$.pipe((0,shared_operators.hC)());this.subs.push(completedBundleRd$.pipe((0,operators.hX)(bundleRd=>bundleRd.hasFailed)).subscribe(bundleRd=>{this.notificationsService.error(this.translate.instant(this.NOTIFICATIONS_PREFIX+"error.primaryBitstream.title"),bundleRd.errorMessage),errorWhileSaving=!0})),bundle$=completedBundleRd$.pipe((0,operators.UI)(bundleRd=>bundleRd.hasSucceeded?bundleRd.payload:this.bundle)),this.subs.push(bundle$.pipe((0,empty_util.tz)(),(0,operators.wt)(bundle=>this.bitstreamService.findByHref(bundle._links.primaryBitstream.href,!1)),(0,shared_operators.Gp)()).subscribe(bitstream=>{this.primaryBitstreamUUID=(0,empty_util.Uh)(bitstream)?bitstream.uuid:null}))}else bundle$=(0,cjs.of)(this.bundle);bitstream$=isNewFormat?this.bitstreamService.updateFormat(this.bitstream,selectedFormat).pipe((0,shared_operators.hC)(),(0,operators.UI)(formatResponse=>{if(!(0,empty_util.Uh)(formatResponse)||!formatResponse.hasFailed)return formatResponse.payload;this.notificationsService.error(this.translate.instant(this.NOTIFICATIONS_PREFIX+"error.format.title"),formatResponse.errorMessage)})):(0,cjs.of)(this.bitstream),(0,cjs.combineLatest)([bundle$,bitstream$]).pipe((0,operators.bw)(([bundle])=>this.bundle=bundle),(0,operators.wt)(()=>this.bitstreamService.update(updatedBitstream).pipe((0,shared_operators.Gp)()))).subscribe(()=>{this.bitstreamService.commitUpdates(),this.notificationsService.success(this.translate.instant(this.NOTIFICATIONS_PREFIX+"saved.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"saved.content")),errorWhileSaving||this.navigateToItemEditBitstreams()})}formToBitstream(rawForm){const updatedBitstream=cloneDeep_default()(this.bitstream),newMetadata=updatedBitstream.metadata;return metadata_utils.S.setFirstValue(newMetadata,"dc.title",rawForm.fileNamePrimaryContainer.fileName),(0,empty_util.xb)(rawForm.descriptionContainer.description)?delete newMetadata["dc.description"]:metadata_utils.S.setFirstValue(newMetadata,"dc.description",rawForm.descriptionContainer.description),this.isIIIF&&((0,empty_util.xb)(rawForm.iiifLabelContainer.iiifLabel)?delete newMetadata[this.IIIF_LABEL_METADATA]:metadata_utils.S.setFirstValue(newMetadata,this.IIIF_LABEL_METADATA,rawForm.iiifLabelContainer.iiifLabel),(0,empty_util.xb)(rawForm.iiifTocContainer.iiifToc)?delete newMetadata[this.IIIF_TOC_METADATA]:metadata_utils.S.setFirstValue(newMetadata,this.IIIF_TOC_METADATA,rawForm.iiifTocContainer.iiifToc),(0,empty_util.xb)(rawForm.iiifWidthContainer.iiifWidth)?delete newMetadata[this.IMAGE_WIDTH_METADATA]:metadata_utils.S.setFirstValue(newMetadata,this.IMAGE_WIDTH_METADATA,rawForm.iiifWidthContainer.iiifWidth),(0,empty_util.xb)(rawForm.iiifHeightContainer.iiifHeight)?delete newMetadata[this.IMAGE_HEIGHT_METADATA]:metadata_utils.S.setFirstValue(newMetadata,this.IMAGE_HEIGHT_METADATA,rawForm.iiifHeightContainer.iiifHeight)),(0,empty_util.UE)(rawForm.formatContainer.newFormat)&&metadata_utils.S.setFirstValue(newMetadata,"dc.format",rawForm.formatContainer.newFormat),updatedBitstream.metadata=newMetadata,updatedBitstream}onCancel(){this.navigateToItemEditBitstreams()}navigateToItemEditBitstreams(){this.router.navigate([(0,item_page_routing_paths.dZ)(this.entityType,this.itemId),"bitstreams"])}setIiifStatus(bitstream){const regexExcludeBundles=/OTHERCONTENT|THUMBNAIL|LICENSE/,regexIIIFItem=/true|yes/i,isImage$=this.bitstream.format.pipe((0,shared_operators.xw)(),(0,operators.UI)(format=>format.payload.mimetype.includes("image/"))),isIIIFBundle$=this.bitstream.bundle.pipe((0,shared_operators.xw)(),(0,operators.UI)(bundle=>null==this.dsoNameService.getName(bundle.payload).match(regexExcludeBundles))),isEnabled$=this.bitstream.bundle.pipe((0,shared_operators.xw)(),(0,operators.UI)(bundle=>bundle.payload.item.pipe((0,shared_operators.xw)(),(0,operators.UI)(item=>item.payload.firstMetadataValue("dspace.iiif.enabled")&&null!==item.payload.firstMetadataValue("dspace.iiif.enabled").match(regexIIIFItem))))),iiifSub=(0,cjs.combineLatest)(isImage$,isIIIFBundle$,isEnabled$).subscribe(([isImage,isIIIFBundle,isEnabled])=>{isImage&&isIIIFBundle&&isEnabled&&(this.isIIIF=!0,this.inputModels.push(this.iiifLabelModel),this.formModel.push(this.iiifLabelContainer),this.inputModels.push(this.iiifTocModel),this.formModel.push(this.iiifTocContainer),this.inputModels.push(this.iiifWidthModel),this.formModel.push(this.iiifWidthContainer),this.inputModels.push(this.iiifHeightModel),this.formModel.push(this.iiifHeightContainer)),this.setForm(),this.changeDetectorRef.detectChanges()});this.subs.push(iiifSub)}ngOnDestroy(){this.subs.filter(subscription=>(0,empty_util.Uh)(subscription)).forEach(subscription=>subscription.unsubscribe())}}__name(EditBitstreamPageComponent,"EditBitstreamPageComponent"),EditBitstreamPageComponent.\u0275fac=__name(function(t){return new(t||EditBitstreamPageComponent)(fesm2020_core.Y36(router.gz),fesm2020_core.Y36(router.F0),fesm2020_core.Y36(fesm2020_core.sBO),fesm2020_core.Y36(common.Ye),fesm2020_core.Y36(core.w1X),fesm2020_core.Y36(ngx_translate_core.sK),fesm2020_core.Y36(bitstream_data_service.J),fesm2020_core.Y36(dso_name_service._),fesm2020_core.Y36(notifications_service.T),fesm2020_core.Y36(bitstream_format_data_service.O),fesm2020_core.Y36(PrimaryBitstreamService))},"EditBitstreamPageComponent_Factory"),EditBitstreamPageComponent.\u0275cmp=fesm2020_core.Xpm({type:EditBitstreamPageComponent,selectors:[["ds-edit-bitstream-page"]],decls:2,vars:3,consts:[[4,"ngVar"],["class","container",4,"ngVar"],[1,"container"],["class","row",4,"ngIf"],[3,"message",4,"ngIf"],[1,"row"],[1,"col-md-2"],[3,"thumbnail"],[1,"col-md-10"],[1,"col-12"],[1,"text-muted"],[3,"formId","formGroup","formModel","formLayout","submitLabel","submitForm","cancel","dfChange",4,"ngIf"],[3,"formId","formGroup","formModel","formLayout","submitLabel","submitForm","cancel","dfChange"],["additional","",1,"container","py-3"],[3,"routerLink"],[3,"message"]],template:__name(function(rf,ctx){1&rf&&(fesm2020_core.YNc(0,EditBitstreamPageComponent_ng_container_0_Template,3,3,"ng-container",0),fesm2020_core.ALo(1,"async")),2&rf&&fesm2020_core.Q6J("ngVar",fesm2020_core.lcZ(1,1,ctx.bitstreamRD$))},"EditBitstreamPageComponent_Template"),dependencies:[common.O5,fesm2020_forms.JL,fesm2020_forms.sg,router.rH,error_component.q,themed_loading_component.Z,themed_thumbnail_component.z,var_directive.g,form_component.U,common.Ov,file_size_pipe.p,ngx_translate_core.X$],styles:["[_nghost-%COMP%]     .switch{position:absolute;top:calc(var(--bs-spacer) * 2.5)}[_nghost-%COMP%]     ds-dynamic-form-control-container>div>label{margin-top:1.75rem}"],changeDetection:0})}};