"use strict";var __defProp=Object.defineProperty,__name=(target,value)=>__defProp(target,"name",{value,configurable:!0});exports.id=3515,exports.ids=[3515],exports.modules={16675:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>ItemOperationComponent});var _angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(86209),_angular_common__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(65159),_ng_bootstrap_ng_bootstrap__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(23506),_angular_router__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(16088),_ngx_translate_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(4330);function ItemOperationComponent_span_5_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(0,"span")(1,"button",5),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(2,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_0__._uU(3),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(4,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA()()),2&rf){const ctx_r0=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw();_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("disabled",ctx_r0.operation.disabled)("routerLink",ctx_r0.operation.operationUrl),_angular_core__WEBPACK_IMPORTED_MODULE_0__.uIk("aria-label",_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(2,4,"item.edit.tabs.status.buttons."+ctx_r0.operation.operationKey+".button")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.hij(" ",_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(4,6,"item.edit.tabs.status.buttons."+ctx_r0.operation.operationKey+".button")," ")}}function ItemOperationComponent_span_6_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(0,"span",6),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(1,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(2,"button",7),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(3,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_0__._uU(4),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(5,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA()()),2&rf){const ctx_r1=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw();_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngbTooltip",_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(1,4,"item.edit.tabs.status.buttons.unauthorized")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("disabled",!0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.uIk("aria-label",_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(3,6,"item.edit.tabs.status.buttons."+ctx_r1.operation.operationKey+".button")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.hij(" ",_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(5,8,"item.edit.tabs.status.buttons."+ctx_r1.operation.operationKey+".button")," ")}}__name(ItemOperationComponent_span_5_Template,"ItemOperationComponent_span_5_Template"),__name(ItemOperationComponent_span_6_Template,"ItemOperationComponent_span_6_Template");class ItemOperationComponent{}__name(ItemOperationComponent,"ItemOperationComponent"),ItemOperationComponent.\u0275fac=__name(function(t){return new(t||ItemOperationComponent)},"ItemOperationComponent_Factory"),ItemOperationComponent.\u0275cmp=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Xpm({type:ItemOperationComponent,selectors:[["ds-item-operation"]],inputs:{operation:"operation"},decls:7,vars:5,consts:[[1,"col-3","float-left","d-flex","h-100","action-label"],[1,"justify-content-center","align-self-center"],[1,"col-9","float-left","action-button"],[4,"ngIf"],[3,"ngbTooltip",4,"ngIf"],[1,"btn","btn-outline-primary",3,"disabled","routerLink"],[3,"ngbTooltip"],[1,"btn","btn-outline-primary",3,"disabled"]],template:__name(function(rf,ctx){1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(0,"div",0)(1,"span",1),_angular_core__WEBPACK_IMPORTED_MODULE_0__._uU(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(3,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA()(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(4,"div",2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.YNc(5,ItemOperationComponent_span_5_Template,5,8,"span",3),_angular_core__WEBPACK_IMPORTED_MODULE_0__.YNc(6,ItemOperationComponent_span_6_Template,6,10,"span",4),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA()),2&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.hij(" ",_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(3,3,"item.edit.tabs.status.buttons."+ctx.operation.operationKey+".label")," "),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(3),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngIf",ctx.operation.authorized),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngIf",!ctx.operation.authorized))},"ItemOperationComponent_Template"),dependencies:[_angular_common__WEBPACK_IMPORTED_MODULE_1__.O5,_ng_bootstrap_ng_bootstrap__WEBPACK_IMPORTED_MODULE_2__._L,_angular_router__WEBPACK_IMPORTED_MODULE_3__.rH,_ngx_translate_core__WEBPACK_IMPORTED_MODULE_4__.X$],encapsulation:2})},13515:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ItemStatusComponent:()=>ItemStatusComponent});var fade=__webpack_require__(65245);class ItemOperation{constructor(operationKey,operationUrl,featureID,disabled=!1,authorized=!0){this.operationKey=operationKey,this.operationUrl=operationUrl,this.featureID=featureID,this.authorized=authorized,this.setDisabled(disabled)}setDisabled(disabled){this.disabled=disabled}setAuthorized(authorized){this.authorized=authorized}}__name(ItemOperation,"ItemOperation");var operators=__webpack_require__(96846),cjs=__webpack_require__(93489),item_page_routing_paths=__webpack_require__(50306),authorization_data_service=__webpack_require__(32418),feature_id=__webpack_require__(60676),empty_util=__webpack_require__(59501),shared_operators=__webpack_require__(53829),identifier_data_service=__webpack_require__(70450),configuration_data_service=__webpack_require__(68259),orcid_auth_service=__webpack_require__(14588),core=__webpack_require__(86209),router=__webpack_require__(16088),common=__webpack_require__(65159),item_operation_component=__webpack_require__(16675),ngx_translate_core=__webpack_require__(4330);function ItemStatusComponent_div_4_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",7)(1,"div",3),core._uU(2),core.ALo(3,"translate"),core.qZA(),core.TgZ(4,"div",8),core._uU(5),core.qZA()()),2&rf){const statusKey_r3=ctx.$implicit,ctx_r0=core.oxw();core.xp6(2),core.hij(" ",core.lcZ(3,3,"item.edit.tabs.status.labels."+statusKey_r3),": "),core.xp6(2),core.MGl("id","status-",statusKey_r3,""),core.xp6(1),core.hij(" ",ctx_r0.statusData[statusKey_r3]," ")}}function ItemStatusComponent_div_5_div_1_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div")(1,"div",3),core._uU(2),core.qZA(),core.TgZ(3,"div",10),core._uU(4),core.ALo(5,"translate"),core.qZA()()),2&rf){const identifier_r4=core.oxw().$implicit;core.xp6(2),core.hij(" ",identifier_r4.identifierType.toLocaleUpperCase()," "),core.xp6(2),core.AsE("",identifier_r4.value," (",core.lcZ(5,3,"item.edit.identifiers.doi.status."+identifier_r4.identifierStatus),")")}}function ItemStatusComponent_div_5_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",7),core.YNc(1,ItemStatusComponent_div_5_div_1_Template,6,5,"div",9),core.qZA()),2&rf){const identifier_r4=ctx.$implicit;core.xp6(1),core.Q6J("ngIf","doi"==identifier_r4.identifierType)}}__name(ItemStatusComponent_div_4_Template,"ItemStatusComponent_div_4_Template"),__name(ItemStatusComponent_div_5_div_1_Template,"ItemStatusComponent_div_5_div_1_Template"),__name(ItemStatusComponent_div_5_Template,"ItemStatusComponent_div_5_Template");const _c0=__name(function(a0){return{"pt-3":a0}},"_c0");function ItemStatusComponent_div_15_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",11),core._UZ(1,"ds-item-operation",12),core.qZA()),2&rf){const operation_r7=ctx.$implicit;core.Q6J("ngClass",core.VKq(2,_c0,operation_r7)),core.xp6(1),core.Q6J("operation",operation_r7)}}__name(ItemStatusComponent_div_15_Template,"ItemStatusComponent_div_15_Template");class ItemStatusComponent{constructor(route,authorizationService,identifierDataService,configurationService,orcidAuthService){this.route=route,this.authorizationService=authorizationService,this.identifierDataService=identifierDataService,this.configurationService=configurationService,this.orcidAuthService=orcidAuthService,this.operations$=new cjs.BehaviorSubject([]),this.subs=[]}ngOnInit(){this.itemRD$=this.route.parent.data.pipe((0,operators.UI)(data=>data.dso)),this.itemRD$.pipe((0,operators.Ps)(),(0,operators.UI)(data=>data.payload)).pipe((0,operators.wt)(item=>{this.statusData=Object.assign({id:item.id,handle:item.handle,lastModified:item.lastModified}),this.statusDataKeys=Object.keys(this.statusData),this.identifiers$=this.identifierDataService.getIdentifierDataFor(item).pipe((0,operators.UI)(identifierRD=>401!==identifierRD.statusCode&&(0,empty_util.Uh)(identifierRD.payload)?identifierRD.payload.identifiers:null));let registerConfigEnabled$=this.configurationService.findByPropertyName("identifiers.item-status.register-doi").pipe((0,shared_operators.hC)(),(0,operators.UI)(enabledRD=>enabledRD.hasSucceeded&&enabledRD.payload.values.length>0));const currentUrl=this.getCurrentUrl(item),inititalOperations=[new ItemOperation("authorizations",`${currentUrl}/authorizations`,feature_id.i.CanManagePolicies,!0),new ItemOperation("mappedCollections",`${currentUrl}/mapper`,feature_id.i.CanManageMappings,!0),item.isWithdrawn?new ItemOperation("reinstate",`${currentUrl}/reinstate`,feature_id.i.ReinstateItem,!0):new ItemOperation("withdraw",`${currentUrl}/withdraw`,feature_id.i.WithdrawItem,!0),item.isDiscoverable?new ItemOperation("private",`${currentUrl}/private`,feature_id.i.CanMakePrivate,!0):new ItemOperation("public",`${currentUrl}/public`,feature_id.i.CanMakePrivate,!0),new ItemOperation("move",`${currentUrl}/move`,feature_id.i.CanMove,!0),new ItemOperation("delete",`${currentUrl}/delete`,feature_id.i.CanDelete,!0)];this.operations$.next(inititalOperations);const ops$=this.identifierDataService.getIdentifierDataFor(item).pipe((0,shared_operators.hC)(),(0,operators.zg)(dataRD=>{if(dataRD.hasSucceeded){let identifiers=dataRD.payload.identifiers,no_doi=!0,pending=!1;return identifiers?.forEach(identifier=>{(0,empty_util.Uh)(identifier)&&"doi"===identifier.identifierType&&(no_doi=!1,["PENDING","MINTED",null].includes(identifier.identifierStatus)&&(pending=!0))}),registerConfigEnabled$.pipe((0,operators.UI)(enabled=>enabled&&(pending||no_doi)))}return(0,cjs.of)(!1)}),(0,operators.wt)(showDoi=>{const ops=[...inititalOperations];if(showDoi){const op=new ItemOperation("register-doi",`${currentUrl}/register-doi`,feature_id.i.CanRegisterDOI,!0);ops.splice(ops.length-1,0,op)}return inititalOperations}),(0,operators.bJ)(op=>(0,empty_util.Uh)(op.featureID)?this.authorizationService.isAuthorized(op.featureID,item.self).pipe((0,operators.xb)(),(0,operators.UI)(authorized=>(op.setDisabled(!authorized),op.setAuthorized(authorized),op))):[op]),(0,operators.qo)());let orcidOps$=(0,cjs.of)([]);return this.orcidAuthService.isLinkedToOrcid(item)&&(orcidOps$=this.orcidAuthService.onlyAdminCanDisconnectProfileFromOrcid().pipe((0,operators.UI)(canDisconnect=>canDisconnect?[new ItemOperation("unlinkOrcid",`${currentUrl}/unlink-orcid`)]:[]))),(0,cjs.combineLatest)([ops$,orcidOps$])}),(0,operators.UI)(([ops,orcidOps])=>[...ops,...orcidOps])).subscribe(ops=>this.operations$.next(ops)),this.itemPageRoute$=this.itemRD$.pipe((0,shared_operators.mc)(),(0,operators.UI)(item=>(0,item_page_routing_paths.Tt)(item)))}getCurrentUrl(item){return(0,item_page_routing_paths.tn)(item)}trackOperation(index,operation){return(0,empty_util.Uh)(operation)?operation.operationKey:void 0}ngOnDestroy(){this.subs.filter(subscription=>(0,empty_util.Uh)(subscription)).forEach(subscription=>subscription.unsubscribe())}}__name(ItemStatusComponent,"ItemStatusComponent"),ItemStatusComponent.\u0275fac=__name(function(t){return new(t||ItemStatusComponent)(core.Y36(router.gz),core.Y36(authorization_data_service._),core.Y36(identifier_data_service.m),core.Y36(configuration_data_service.i),core.Y36(orcid_auth_service.m))},"ItemStatusComponent_Factory"),ItemStatusComponent.\u0275cmp=core.Xpm({type:ItemStatusComponent,selectors:[["ds-item-status"]],decls:17,vars:19,consts:[[1,"mt-2"],[1,"row"],["class","w-100",4,"ngFor","ngForOf"],[1,"col-3","float-left","status-label"],["id","status-itemPage",1,"col-9","float-left","status-data"],[3,"routerLink"],["class","w-100",3,"ngClass",4,"ngFor","ngForOf"],[1,"w-100"],[1,"col-9","float-left","status-data",3,"id"],[4,"ngIf"],[1,"col-9","float-left","status-label"],[1,"w-100",3,"ngClass"],[3,"operation"]],template:__name(function(rf,ctx){1&rf&&(core.TgZ(0,"p",0),core._uU(1),core.ALo(2,"translate"),core.qZA(),core.TgZ(3,"div",1),core.YNc(4,ItemStatusComponent_div_4_Template,6,5,"div",2),core.YNc(5,ItemStatusComponent_div_5_Template,2,1,"div",2),core.ALo(6,"async"),core.TgZ(7,"div",3),core._uU(8),core.ALo(9,"translate"),core.qZA(),core.TgZ(10,"div",4)(11,"a",5),core.ALo(12,"async"),core._uU(13),core.ALo(14,"async"),core.qZA()(),core.YNc(15,ItemStatusComponent_div_15_Template,2,4,"div",6),core.ALo(16,"async"),core.qZA()),2&rf&&(core.xp6(1),core.Oqu(core.lcZ(2,7,"item.edit.tabs.status.description")),core.xp6(3),core.Q6J("ngForOf",ctx.statusDataKeys),core.xp6(1),core.Q6J("ngForOf",core.lcZ(6,9,ctx.identifiers$)),core.xp6(3),core.hij(" ",core.lcZ(9,11,"item.edit.tabs.status.labels.itemPage"),": "),core.xp6(3),core.Q6J("routerLink",core.lcZ(12,13,ctx.itemPageRoute$)),core.xp6(2),core.Oqu(core.lcZ(14,15,ctx.itemPageRoute$)),core.xp6(2),core.Q6J("ngForOf",core.lcZ(16,17,ctx.operations$)))},"ItemStatusComponent_Template"),dependencies:[common.mk,common.sg,common.O5,router.rH,item_operation_component.Z,common.Ov,ngx_translate_core.X$],encapsulation:2,data:{animation:[fade.Ji,fade.Ic]}})}};