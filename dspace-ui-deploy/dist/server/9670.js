"use strict";var __defProp=Object.defineProperty,__name=(target,value)=>__defProp(target,"name",{value,configurable:!0});exports.id=9670,exports.ids=[9670],exports.modules={31832:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{u:()=>ProfilePageMetadataFormComponent});var _ng_dynamic_forms_core__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(49417),_shared_empty_util__WEBPACK_IMPORTED_MODULE_10__=(__webpack_require__(49060),__webpack_require__(59501)),_core_eperson_eperson_data_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(74708),lodash_cloneDeep__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(80115),lodash_cloneDeep__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(lodash_cloneDeep__WEBPACK_IMPORTED_MODULE_2__),_core_shared_operators__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(53829),_shared_form_builder_form_builder_service__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(88286),_shared_notifications_notifications_service__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(39373),_environments_environment__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(91602),_angular_core__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(86209),_ngx_translate_core__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(4330),_angular_common__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(65159),_angular_forms__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(32189),_shared_form_form_component__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(23593);function ProfilePageMetadataFormComponent_ds_form_0_Template(rf,ctx){if(1&rf&&_angular_core__WEBPACK_IMPORTED_MODULE_8__._UZ(0,"ds-form",1),2&rf){const ctx_r0=_angular_core__WEBPACK_IMPORTED_MODULE_8__.oxw();_angular_core__WEBPACK_IMPORTED_MODULE_8__.Q6J("formId","profile-page-metadata-form-id")("formModel",ctx_r0.formModel)("formGroup",ctx_r0.formGroup)("displaySubmit",!1)("displayCancel",!1)}}__name(ProfilePageMetadataFormComponent_ds_form_0_Template,"ProfilePageMetadataFormComponent_ds_form_0_Template");class ProfilePageMetadataFormComponent{constructor(formBuilderService,translate,epersonService,notificationsService){this.formBuilderService=formBuilderService,this.translate=translate,this.epersonService=epersonService,this.notificationsService=notificationsService,this.formModel=[new _ng_dynamic_forms_core__WEBPACK_IMPORTED_MODULE_9__.b1u({id:"email",name:"email",readOnly:!0}),new _ng_dynamic_forms_core__WEBPACK_IMPORTED_MODULE_9__.b1u({id:"firstname",name:"eperson.firstname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"}}),new _ng_dynamic_forms_core__WEBPACK_IMPORTED_MODULE_9__.b1u({id:"lastname",name:"eperson.lastname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"}}),new _ng_dynamic_forms_core__WEBPACK_IMPORTED_MODULE_9__.b1u({id:"phone",name:"eperson.phone"}),new _ng_dynamic_forms_core__WEBPACK_IMPORTED_MODULE_9__.nMt({id:"language",name:"eperson.language"})],this.LABEL_PREFIX="profile.metadata.form.label.",this.ERROR_PREFIX="profile.metadata.form.error.",this.NOTIFICATION_PREFIX="profile.metadata.form.notifications."}ngOnInit(){this.activeLangs=_environments_environment__WEBPACK_IMPORTED_MODULE_6__.N.languages.filter(MyLangConfig=>!0===MyLangConfig.active),this.setFormValues(),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()})}setFormValues(){this.formModel.forEach(fieldModel=>{"email"===fieldModel.name?fieldModel.value=this.user.email:fieldModel.value=this.user.firstMetadataValue(fieldModel.name),"language"===fieldModel.id&&(fieldModel.options=this.activeLangs.map(langConfig=>Object.assign({value:langConfig.code,label:langConfig.label})))}),this.formGroup=this.formBuilderService.createFormGroup(this.formModel)}updateFieldTranslations(){this.formModel.forEach(fieldModel=>{fieldModel.label=this.translate.instant(this.LABEL_PREFIX+fieldModel.id),(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_10__.UE)(fieldModel.validators)&&(fieldModel.errorMessages={},Object.keys(fieldModel.validators).forEach(key=>{fieldModel.errorMessages[key]=this.translate.instant(this.ERROR_PREFIX+fieldModel.id+"."+key)}))})}updateProfile(){if(!this.formGroup.valid)return!1;const newMetadata=lodash_cloneDeep__WEBPACK_IMPORTED_MODULE_2___default()(this.user.metadata);let changed=!1;return this.formModel.filter(fieldModel=>"email"!==fieldModel.id).forEach(fieldModel=>{newMetadata.hasOwnProperty(fieldModel.name)&&newMetadata[fieldModel.name].length>0?(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_10__.Uh)(fieldModel.value)?newMetadata[fieldModel.name][0].value!==fieldModel.value&&(newMetadata[fieldModel.name][0].value=fieldModel.value,changed=!0):(newMetadata[fieldModel.name]=[],changed=!0):(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_10__.Uh)(fieldModel.value)&&(newMetadata[fieldModel.name]=[{value:fieldModel.value,language:null}],changed=!0)}),changed&&this.epersonService.update(Object.assign(lodash_cloneDeep__WEBPACK_IMPORTED_MODULE_2___default()(this.user),{metadata:newMetadata})).pipe((0,_core_shared_operators__WEBPACK_IMPORTED_MODULE_3__.xw)(),(0,_core_shared_operators__WEBPACK_IMPORTED_MODULE_3__.xe)()).subscribe(user=>{this.user=user,this.setFormValues(),this.notificationsService.success(this.translate.instant(this.NOTIFICATION_PREFIX+"success.title"),this.translate.instant(this.NOTIFICATION_PREFIX+"success.content"))}),changed}}__name(ProfilePageMetadataFormComponent,"ProfilePageMetadataFormComponent"),ProfilePageMetadataFormComponent.\u0275fac=__name(function(t){return new(t||ProfilePageMetadataFormComponent)(_angular_core__WEBPACK_IMPORTED_MODULE_8__.Y36(_shared_form_builder_form_builder_service__WEBPACK_IMPORTED_MODULE_4__.c),_angular_core__WEBPACK_IMPORTED_MODULE_8__.Y36(_ngx_translate_core__WEBPACK_IMPORTED_MODULE_11__.sK),_angular_core__WEBPACK_IMPORTED_MODULE_8__.Y36(_core_eperson_eperson_data_service__WEBPACK_IMPORTED_MODULE_1__.k),_angular_core__WEBPACK_IMPORTED_MODULE_8__.Y36(_shared_notifications_notifications_service__WEBPACK_IMPORTED_MODULE_5__.T))},"ProfilePageMetadataFormComponent_Factory"),ProfilePageMetadataFormComponent.\u0275cmp=_angular_core__WEBPACK_IMPORTED_MODULE_8__.Xpm({type:ProfilePageMetadataFormComponent,selectors:[["ds-profile-page-metadata-form"]],inputs:{user:"user"},decls:1,vars:1,consts:[[3,"formId","formModel","formGroup","displaySubmit","displayCancel",4,"ngIf"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel"]],template:__name(function(rf,ctx){1&rf&&_angular_core__WEBPACK_IMPORTED_MODULE_8__.YNc(0,ProfilePageMetadataFormComponent_ds_form_0_Template,1,5,"ds-form",0),2&rf&&_angular_core__WEBPACK_IMPORTED_MODULE_8__.Q6J("ngIf",ctx.formModel)},"ProfilePageMetadataFormComponent_Template"),dependencies:[_angular_common__WEBPACK_IMPORTED_MODULE_12__.O5,_angular_forms__WEBPACK_IMPORTED_MODULE_13__.JL,_angular_forms__WEBPACK_IMPORTED_MODULE_13__.sg,_shared_form_form_component__WEBPACK_IMPORTED_MODULE_7__.U],encapsulation:2})},79889:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>ProfilePageResearcherFormComponent});var cjs=__webpack_require__(93489),operators=__webpack_require__(96846),shared_operators=__webpack_require__(53829),core=__webpack_require__(86209),dso_selector_modal_wrapper_component=__webpack_require__(99393),item_page_routing_paths=__webpack_require__(50306),view_mode_model=(__webpack_require__(72827),__webpack_require__(87878)),profile_claim_service=__webpack_require__(83639),collection_element_link_type=__webpack_require__(83460),dso_name_service=__webpack_require__(17306),ng_bootstrap=__webpack_require__(23506),router=__webpack_require__(16088),common=__webpack_require__(65159),listable_object_component_loader_component=__webpack_require__(76038),ngx_translate_core=__webpack_require__(4330);function ProfileClaimItemModalComponent_div_14_Template(rf,ctx){if(1&rf){const _r4=core.EpF();core.TgZ(0,"div",8)(1,"button",15,16),core.NdJ("click",__name(function(){const listEntry_r1=core.CHM(_r4).$implicit,ctx_r3=core.oxw();return core.KtG(ctx_r3.selectItem(listEntry_r1.indexableObject))},"ProfileClaimItemModalComponent_div_14_Template_button_click_1_listener")),core._UZ(3,"ds-listable-object-component-loader",17),core.qZA()()}if(2&rf){const listEntry_r1=ctx.$implicit,ctx_r0=core.oxw();core.xp6(1),core.s9C("title",ctx_r0.dsoNameService.getName(listEntry_r1.indexableObject)),core.xp6(2),core.Q6J("object",listEntry_r1)("viewMode",ctx_r0.viewMode)("linkType",ctx_r0.linkTypes.None)}}__name(ProfileClaimItemModalComponent_div_14_Template,"ProfileClaimItemModalComponent_div_14_Template");class ProfileClaimItemModalComponent extends dso_selector_modal_wrapper_component.q{constructor(activeModal,route,router2,profileClaimService,dsoNameService){super(activeModal,route),this.activeModal=activeModal,this.route=route,this.router=router2,this.profileClaimService=profileClaimService,this.dsoNameService=dsoNameService,this.listEntries$=new cjs.BehaviorSubject(null),this.viewMode=view_mode_model.w.ListElement,this.linkTypes=collection_element_link_type.m,this.checked=!1,this.create=new core.vpe}ngOnInit(){this.profileClaimService.searchForSuggestions(this.dso).pipe((0,shared_operators.hC)()).subscribe(result=>this.listEntries$.next(result))}selectItem(dso){this.close(),this.navigate(dso)}navigate(dso){this.router.navigate([(0,item_page_routing_paths.Tt)(dso)])}toggleCheckbox(){this.checked=!this.checked}createFromScratch(){this.create.emit(),this.close()}}__name(ProfileClaimItemModalComponent,"ProfileClaimItemModalComponent"),ProfileClaimItemModalComponent.\u0275fac=__name(function(t){return new(t||ProfileClaimItemModalComponent)(core.Y36(ng_bootstrap.Kz),core.Y36(router.gz),core.Y36(router.F0),core.Y36(profile_claim_service.n),core.Y36(dso_name_service._))},"ProfileClaimItemModalComponent_Factory"),ProfileClaimItemModalComponent.\u0275cmp=core.Xpm({type:ProfileClaimItemModalComponent,selectors:[["ds-profile-claim-item-modal"]],inputs:{dso:"dso"},outputs:{create:"create"},features:[core.qOj],decls:27,vars:17,consts:[[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],["role","alert",1,"alert","alert-info"],[1,"dropdown-divider"],[1,"scrollable-menu","list-group","container"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[1,"col-md","mt-2"],[1,"modal-footer"],[1,"mr-5"],["type","checkbox",3,"checked","change"],["type","submit",1,"btn","btn-primary","ml-5","mr-2",3,"disabled","click"],[1,"fas","fa-plus"],[1,"list-group-item","list-group-item-action","border-0","list-entry",3,"title","click"],["listEntryElement",""],[3,"object","viewMode","linkType"]],template:__name(function(rf,ctx){if(1&rf&&(core.TgZ(0,"div")(1,"div",0)(2,"h4"),core._uU(3),core.ALo(4,"translate"),core.qZA(),core.TgZ(5,"button",1),core.NdJ("click",__name(function(){return ctx.close()},"ProfileClaimItemModalComponent_Template_button_click_5_listener")),core.TgZ(6,"span",2),core._uU(7,"\xd7"),core.qZA()()(),core.TgZ(8,"div",3)(9,"div",4),core._uU(10),core.ALo(11,"translate"),core.qZA(),core._UZ(12,"div",5),core.TgZ(13,"div",6),core.YNc(14,ProfileClaimItemModalComponent_div_14_Template,4,4,"div",7),core.ALo(15,"async"),core.TgZ(16,"div",8),core._UZ(17,"div",9),core.qZA()()(),core.TgZ(18,"div",10)(19,"div",11)(20,"input",12),core.NdJ("change",__name(function(){return ctx.toggleCheckbox()},"ProfileClaimItemModalComponent_Template_input_change_20_listener")),core.qZA(),core._uU(21),core.ALo(22,"translate"),core.qZA(),core.TgZ(23,"button",13),core.NdJ("click",__name(function(){return ctx.createFromScratch()},"ProfileClaimItemModalComponent_Template_button_click_23_listener")),core._UZ(24,"i",14),core._uU(25),core.ALo(26,"translate"),core.qZA()()()),2&rf){let tmp_2_0;core.xp6(3),core.Oqu(core.lcZ(4,7,"dso-selector.claim.item.head")),core.xp6(7),core.hij(" ",core.lcZ(11,9,"dso-selector.claim.item.body")," "),core.xp6(4),core.Q6J("ngForOf",null==(tmp_2_0=core.lcZ(15,11,ctx.listEntries$))?null:tmp_2_0.payload.page),core.xp6(6),core.Q6J("checked",ctx.checked),core.xp6(1),core.hij(" ",core.lcZ(22,13,"dso-selector.claim.item.not-mine-label")," "),core.xp6(2),core.Q6J("disabled",!ctx.checked),core.xp6(2),core.hij(" ",core.lcZ(26,15,"dso-selector.claim.item.create-from-scratch")," ")}},"ProfileClaimItemModalComponent_Template"),dependencies:[common.sg,listable_object_component_loader_component.p,common.Ov,ngx_translate_core.X$],encapsulation:2});var notifications_service=__webpack_require__(39373),auth_service=__webpack_require__(22410),researcher_profile_data_service=(__webpack_require__(49060),__webpack_require__(10202)),empty_util=__webpack_require__(59501),follow_link_config_model=__webpack_require__(58090),confirmation_modal_component=__webpack_require__(27973),var_directive=__webpack_require__(61562),ngx_ui_switch=__webpack_require__(42450);function ProfilePageResearcherFormComponent_div_0_div_1_Template(rf,ctx){if(1&rf){const _r8=core.EpF();core.TgZ(0,"div")(1,"p"),core._uU(2),core.ALo(3,"translate"),core.qZA(),core.TgZ(4,"p",3)(5,"span",4),core._uU(6),core.ALo(7,"translate"),core.qZA(),core.TgZ(8,"ui-switch",5),core.NdJ("change",__name(function(){core.CHM(_r8);const researcherProfile_r1=core.oxw().ngVar,ctx_r6=core.oxw();return core.KtG(ctx_r6.toggleProfileVisibility(researcherProfile_r1))},"ProfilePageResearcherFormComponent_div_0_div_1_Template_ui_switch_change_8_listener")),core.ALo(9,"translate"),core.ALo(10,"translate"),core.qZA()()()}if(2&rf){const researcherProfile_r1=core.oxw().ngVar;core.xp6(2),core.Oqu(core.lcZ(3,5,"researcher.profile.associated")),core.xp6(4),core.Oqu(core.lcZ(7,7,"researcher.profile.status")),core.xp6(2),core.Q6J("checkedLabel",core.lcZ(9,9,"researcher.profile.public.visibility"))("uncheckedLabel",core.lcZ(10,11,"researcher.profile.private.visibility"))("checked",researcherProfile_r1.visible)}}function ProfilePageResearcherFormComponent_div_0_div_2_Template(rf,ctx){1&rf&&(core.TgZ(0,"div")(1,"p"),core._uU(2),core.ALo(3,"translate"),core.qZA()()),2&rf&&(core.xp6(2),core.Oqu(core.lcZ(3,1,"researcher.profile.not.associated")))}function ProfilePageResearcherFormComponent_div_0_button_3_span_2_Template(rf,ctx){1&rf&&(core.TgZ(0,"span"),core._UZ(1,"i",7),core._uU(2),core.ALo(3,"translate"),core.qZA()),2&rf&&(core.xp6(2),core.hij(" ",core.lcZ(3,1,"researcher.profile.action.processing")," "))}function ProfilePageResearcherFormComponent_div_0_button_3_span_4_Template(rf,ctx){1&rf&&(core.TgZ(0,"span"),core._UZ(1,"i",8),core._uU(2),core.ALo(3,"translate"),core.qZA()),2&rf&&(core.xp6(2),core.hij(" \xa0",core.lcZ(3,1,"researcher.profile.create.new")," "))}function ProfilePageResearcherFormComponent_div_0_button_3_Template(rf,ctx){if(1&rf){const _r13=core.EpF();core.TgZ(0,"button",6),core.NdJ("click",__name(function(){core.CHM(_r13);const ctx_r12=core.oxw(2);return core.KtG(ctx_r12.createProfile())},"ProfilePageResearcherFormComponent_div_0_button_3_Template_button_click_0_listener")),core.ALo(1,"async"),core.YNc(2,ProfilePageResearcherFormComponent_div_0_button_3_span_2_Template,4,3,"span",1),core.ALo(3,"async"),core.YNc(4,ProfilePageResearcherFormComponent_div_0_button_3_span_4_Template,4,3,"span",1),core.ALo(5,"async"),core.qZA()}if(2&rf){const ctx_r4=core.oxw(2);core.Q6J("disabled",core.lcZ(1,3,ctx_r4.isProcessingCreate())),core.xp6(2),core.Q6J("ngIf",core.lcZ(3,5,ctx_r4.isProcessingCreate())),core.xp6(2),core.Q6J("ngIf",!core.lcZ(5,7,ctx_r4.isProcessingCreate()))}}function ProfilePageResearcherFormComponent_div_0_ng_container_4_span_6_Template(rf,ctx){1&rf&&(core.TgZ(0,"span"),core._UZ(1,"i",7),core._uU(2),core.ALo(3,"translate"),core.qZA()),2&rf&&(core.xp6(2),core.hij(" ",core.lcZ(3,1,"researcher.profile.action.processing")," "))}function ProfilePageResearcherFormComponent_div_0_ng_container_4_span_8_Template(rf,ctx){1&rf&&(core.TgZ(0,"span"),core._UZ(1,"i",11),core._uU(2),core.ALo(3,"translate"),core.qZA()),2&rf&&(core.xp6(2),core.hij(" \xa0",core.lcZ(3,1,"researcher.profile.delete")," "))}function ProfilePageResearcherFormComponent_div_0_ng_container_4_Template(rf,ctx){if(1&rf){const _r18=core.EpF();core.ynx(0),core.TgZ(1,"button",6),core.NdJ("click",__name(function(){core.CHM(_r18);const researcherProfile_r1=core.oxw().ngVar,ctx_r16=core.oxw();return core.KtG(ctx_r16.viewProfile(researcherProfile_r1))},"ProfilePageResearcherFormComponent_div_0_ng_container_4_Template_button_click_1_listener")),core._UZ(2,"i",9),core._uU(3),core.ALo(4,"translate"),core.qZA(),core.TgZ(5,"button",10),core.NdJ("click",__name(function(){core.CHM(_r18);const researcherProfile_r1=core.oxw().ngVar,ctx_r19=core.oxw();return core.KtG(ctx_r19.deleteProfile(researcherProfile_r1))},"ProfilePageResearcherFormComponent_div_0_ng_container_4_Template_button_click_5_listener")),core.YNc(6,ProfilePageResearcherFormComponent_div_0_ng_container_4_span_6_Template,4,3,"span",1),core.ALo(7,"async"),core.YNc(8,ProfilePageResearcherFormComponent_div_0_ng_container_4_span_8_Template,4,3,"span",1),core.ALo(9,"async"),core.qZA(),core.BQk()}if(2&rf){const researcherProfile_r1=core.oxw().ngVar,ctx_r5=core.oxw();core.xp6(1),core.Q6J("disabled",!researcherProfile_r1),core.xp6(2),core.hij(" ",core.lcZ(4,5,"researcher.profile.view")," "),core.xp6(2),core.Q6J("disabled",!researcherProfile_r1),core.xp6(1),core.Q6J("ngIf",core.lcZ(7,7,ctx_r5.isProcessingDelete())),core.xp6(2),core.Q6J("ngIf",!core.lcZ(9,9,ctx_r5.isProcessingDelete()))}}function ProfilePageResearcherFormComponent_div_0_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div"),core.YNc(1,ProfilePageResearcherFormComponent_div_0_div_1_Template,11,13,"div",1),core.YNc(2,ProfilePageResearcherFormComponent_div_0_div_2_Template,4,3,"div",1),core.YNc(3,ProfilePageResearcherFormComponent_div_0_button_3_Template,6,9,"button",2),core.YNc(4,ProfilePageResearcherFormComponent_div_0_ng_container_4_Template,10,11,"ng-container",1),core.qZA()),2&rf){const researcherProfile_r1=ctx.ngVar;core.xp6(1),core.Q6J("ngIf",researcherProfile_r1),core.xp6(1),core.Q6J("ngIf",!researcherProfile_r1),core.xp6(1),core.Q6J("ngIf",!researcherProfile_r1),core.xp6(1),core.Q6J("ngIf",researcherProfile_r1)}}__name(ProfilePageResearcherFormComponent_div_0_div_1_Template,"ProfilePageResearcherFormComponent_div_0_div_1_Template"),__name(ProfilePageResearcherFormComponent_div_0_div_2_Template,"ProfilePageResearcherFormComponent_div_0_div_2_Template"),__name(ProfilePageResearcherFormComponent_div_0_button_3_span_2_Template,"ProfilePageResearcherFormComponent_div_0_button_3_span_2_Template"),__name(ProfilePageResearcherFormComponent_div_0_button_3_span_4_Template,"ProfilePageResearcherFormComponent_div_0_button_3_span_4_Template"),__name(ProfilePageResearcherFormComponent_div_0_button_3_Template,"ProfilePageResearcherFormComponent_div_0_button_3_Template"),__name(ProfilePageResearcherFormComponent_div_0_ng_container_4_span_6_Template,"ProfilePageResearcherFormComponent_div_0_ng_container_4_span_6_Template"),__name(ProfilePageResearcherFormComponent_div_0_ng_container_4_span_8_Template,"ProfilePageResearcherFormComponent_div_0_ng_container_4_span_8_Template"),__name(ProfilePageResearcherFormComponent_div_0_ng_container_4_Template,"ProfilePageResearcherFormComponent_div_0_ng_container_4_Template"),__name(ProfilePageResearcherFormComponent_div_0_Template,"ProfilePageResearcherFormComponent_div_0_Template");class ProfilePageResearcherFormComponent{constructor(researcherProfileService,profileClaimService,translationService,notificationService,authService,router2,modalService){this.researcherProfileService=researcherProfileService,this.profileClaimService=profileClaimService,this.translationService=translationService,this.notificationService=notificationService,this.authService=authService,this.router=router2,this.modalService=modalService,this.researcherProfile$=new cjs.BehaviorSubject(null),this.processingDelete$=new cjs.BehaviorSubject(!1),this.processingCreate$=new cjs.BehaviorSubject(!1)}ngOnInit(){this.initResearchProfile()}createProfile(){this.processingCreate$.next(!0),this.authService.getAuthenticatedUserFromStore().pipe((0,operators.qn)(1),(0,operators.wt)(currentUser=>this.profileClaimService.hasProfilesToSuggest(currentUser))).subscribe(hasProfilesToSuggest=>{if(hasProfilesToSuggest){this.processingCreate$.next(!1);const modal=this.modalService.open(ProfileClaimItemModalComponent);modal.componentInstance.dso=this.user,modal.componentInstance.create.pipe((0,operators.qn)(1)).subscribe(()=>{this.createProfileFromScratch()})}else this.createProfileFromScratch()})}viewProfile(researcherProfile){null!=this.researcherProfileItemId&&this.router.navigate(["items",this.researcherProfileItemId])}deleteProfile(researcherProfile){const modalRef=this.modalService.open(confirmation_modal_component.Y);modalRef.componentInstance.headerLabel="confirmation-modal.delete-profile.header",modalRef.componentInstance.infoLabel="confirmation-modal.delete-profile.info",modalRef.componentInstance.cancelLabel="confirmation-modal.delete-profile.cancel",modalRef.componentInstance.confirmLabel="confirmation-modal.delete-profile.confirm",modalRef.componentInstance.brandColor="danger",modalRef.componentInstance.confirmIcon="fas fa-trash",modalRef.componentInstance.response.pipe((0,operators.qn)(1)).subscribe(confirm=>{confirm&&(this.processingDelete$.next(!0),this.researcherProfileService.delete(researcherProfile.id).pipe((0,shared_operators.hC)(),(0,operators.UI)(response=>response.isSuccess)).subscribe(deleted=>{deleted&&(this.researcherProfile$.next(null),this.researcherProfileItemId=null),this.processingDelete$.next(!1)}))})}toggleProfileVisibility(researcherProfile){this.researcherProfileService.setVisibility(researcherProfile,!researcherProfile.visible).pipe((0,shared_operators.hC)()).subscribe(rd=>{rd.hasSucceeded?this.researcherProfile$.next(rd.payload):this.notificationService.error(null,this.translationService.get("researcher.profile.change-visibility.fail"))})}isProcessingDelete(){return this.processingDelete$.asObservable()}isProcessingCreate(){return this.processingCreate$.asObservable()}createProfileFromScratch(){this.processingCreate$.next(!0),this.researcherProfileService.create().pipe((0,shared_operators.hC)()).subscribe(remoteData=>{this.processingCreate$.next(!1),remoteData.isSuccess?(this.initResearchProfile(),this.notificationService.success(null,this.translationService.get("researcher.profile.create.success"))):this.notificationService.error(null,this.translationService.get("researcher.profile.create.fail"))})}initResearchProfile(){this.researcherProfileService.findById(this.user.id,!1,!0,(0,follow_link_config_model.l)("item")).pipe((0,shared_operators.Gp)(),(0,operators.bw)(researcherProfile=>this.researcherProfile$.next(researcherProfile)),(0,operators.zg)(researcherProfile=>this.researcherProfileService.findRelatedItemId(researcherProfile))).subscribe(itemId=>{(0,empty_util.UE)(itemId)&&(this.researcherProfileItemId=itemId)})}}__name(ProfilePageResearcherFormComponent,"ProfilePageResearcherFormComponent"),ProfilePageResearcherFormComponent.\u0275fac=__name(function(t){return new(t||ProfilePageResearcherFormComponent)(core.Y36(researcher_profile_data_service.E),core.Y36(profile_claim_service.n),core.Y36(ngx_translate_core.sK),core.Y36(notifications_service.T),core.Y36(auth_service.e8),core.Y36(router.F0),core.Y36(ng_bootstrap.FF))},"ProfilePageResearcherFormComponent_Factory"),ProfilePageResearcherFormComponent.\u0275cmp=core.Xpm({type:ProfilePageResearcherFormComponent,selectors:[["ds-profile-page-researcher-form"]],inputs:{user:"user"},decls:2,vars:3,consts:[[4,"ngVar"],[4,"ngIf"],["class","btn btn-primary mr-2",3,"disabled","click",4,"ngIf"],[1,"align-items-center","researcher-profile-switch"],[1,"mr-3"],[3,"checkedLabel","uncheckedLabel","checked","change"],[1,"btn","btn-primary","mr-2",3,"disabled","click"],[1,"fas","fa-circle-notch","fa-spin"],[1,"fas","fa-plus"],[1,"fas","fa-info-circle"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-trash-alt"]],template:__name(function(rf,ctx){1&rf&&(core.YNc(0,ProfilePageResearcherFormComponent_div_0_Template,5,4,"div",0),core.ALo(1,"async")),2&rf&&core.Q6J("ngVar",core.lcZ(1,1,ctx.researcherProfile$))},"ProfilePageResearcherFormComponent_Template"),dependencies:[common.O5,var_directive.g,ngx_ui_switch.o,common.Ov,ngx_translate_core.X$],encapsulation:2})},41034:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>ProfilePageSecurityFormComponent});var _angular_core__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(86209),_ng_dynamic_forms_core__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(49417),_shared_empty_util__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(59501),_core_eperson_eperson_data_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(74708),_shared_notifications_notifications_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(39373),rxjs_operators__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(96846),_core_shared_operators__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(53829),_ngx_translate_core__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(4330),_angular_common__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(65159),_angular_forms__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(32189),_shared_alert_alert_component__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(74369),_shared_form_form_component__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(23593);function ProfilePageSecurityFormComponent_ds_form_3_Template(rf,ctx){if(1&rf&&_angular_core__WEBPACK_IMPORTED_MODULE_5__._UZ(0,"ds-form",4),2&rf){const ctx_r0=_angular_core__WEBPACK_IMPORTED_MODULE_5__.oxw();_angular_core__WEBPACK_IMPORTED_MODULE_5__.Q6J("formId",ctx_r0.FORM_PREFIX)("formModel",ctx_r0.formModel)("formGroup",ctx_r0.formGroup)("displaySubmit",!1)("displayCancel",!1)}}function ProfilePageSecurityFormComponent_div_4_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_5__.TgZ(0,"div",5),_angular_core__WEBPACK_IMPORTED_MODULE_5__._uU(1),_angular_core__WEBPACK_IMPORTED_MODULE_5__.ALo(2,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_5__.qZA()),2&rf){const ctx_r1=_angular_core__WEBPACK_IMPORTED_MODULE_5__.oxw();_angular_core__WEBPACK_IMPORTED_MODULE_5__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_5__.Oqu(_angular_core__WEBPACK_IMPORTED_MODULE_5__.lcZ(2,1,ctx_r1.FORM_PREFIX+"error.matching-passwords"))}}function ProfilePageSecurityFormComponent_div_5_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_5__.TgZ(0,"div",6),_angular_core__WEBPACK_IMPORTED_MODULE_5__._uU(1),_angular_core__WEBPACK_IMPORTED_MODULE_5__.ALo(2,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_5__.qZA()),2&rf){const ctx_r2=_angular_core__WEBPACK_IMPORTED_MODULE_5__.oxw();_angular_core__WEBPACK_IMPORTED_MODULE_5__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_5__.Oqu(_angular_core__WEBPACK_IMPORTED_MODULE_5__.lcZ(2,1,ctx_r2.FORM_PREFIX+"error.empty-password"))}}__name(ProfilePageSecurityFormComponent_ds_form_3_Template,"ProfilePageSecurityFormComponent_ds_form_3_Template"),__name(ProfilePageSecurityFormComponent_div_4_Template,"ProfilePageSecurityFormComponent_div_4_Template"),__name(ProfilePageSecurityFormComponent_div_5_Template,"ProfilePageSecurityFormComponent_div_5_Template");class ProfilePageSecurityFormComponent{constructor(formService,translate,epersonService,notificationsService){this.formService=formService,this.translate=translate,this.epersonService=epersonService,this.notificationsService=notificationsService,this.isInvalid=new _angular_core__WEBPACK_IMPORTED_MODULE_5__.vpe,this.passwordValue=new _angular_core__WEBPACK_IMPORTED_MODULE_5__.vpe,this.currentPasswordValue=new _angular_core__WEBPACK_IMPORTED_MODULE_5__.vpe,this.formModel=[new _ng_dynamic_forms_core__WEBPACK_IMPORTED_MODULE_6__.b1u({id:"password",name:"password",inputType:"password"}),new _ng_dynamic_forms_core__WEBPACK_IMPORTED_MODULE_6__.b1u({id:"passwordrepeat",name:"passwordrepeat",inputType:"password"})],this.passwordCanBeEmpty=!0,this.subs=[]}ngOnInit(){"profile.security.form."===this.FORM_PREFIX&&this.formModel.unshift(new _ng_dynamic_forms_core__WEBPACK_IMPORTED_MODULE_6__.b1u({id:"current-password",name:"current-password",inputType:"password",required:!0})),this.passwordCanBeEmpty?this.formGroup=this.formService.createFormGroup(this.formModel,{validators:[this.checkPasswordsEqual]}):this.formGroup=this.formService.createFormGroup(this.formModel,{validators:[this.checkPasswordsEqual,this.checkPasswordEmpty]}),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()}),this.subs.push(this.formGroup.statusChanges.pipe((0,_core_shared_operators__WEBPACK_IMPORTED_MODULE_2__.ig)(300),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_7__.UI)(status=>"VALID"!==status)).subscribe(status=>this.isInvalid.emit(status))),this.subs.push(this.formGroup.valueChanges.pipe((0,_core_shared_operators__WEBPACK_IMPORTED_MODULE_2__.ig)(300)).subscribe(valueChange=>{this.passwordValue.emit(valueChange.password),"profile.security.form."===this.FORM_PREFIX&&this.currentPasswordValue.emit(valueChange["current-password"])}))}updateFieldTranslations(){this.formModel.forEach(fieldModel=>{fieldModel.label=this.translate.instant(this.FORM_PREFIX+"label."+fieldModel.id)})}checkPasswordsEqual(group){return group.get("password").value===group.get("passwordrepeat").value?null:{notSame:!0}}checkPasswordEmpty(group){const pass=group.get("password").value;return(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_8__.xb)(pass)?{emptyPassword:!0}:null}ngOnDestroy(){this.subs.filter(sub=>(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_8__.Uh)(sub)).forEach(sub=>sub.unsubscribe())}}__name(ProfilePageSecurityFormComponent,"ProfilePageSecurityFormComponent"),ProfilePageSecurityFormComponent.\u0275fac=__name(function(t){return new(t||ProfilePageSecurityFormComponent)(_angular_core__WEBPACK_IMPORTED_MODULE_5__.Y36(_ng_dynamic_forms_core__WEBPACK_IMPORTED_MODULE_6__.w1X),_angular_core__WEBPACK_IMPORTED_MODULE_5__.Y36(_ngx_translate_core__WEBPACK_IMPORTED_MODULE_9__.sK),_angular_core__WEBPACK_IMPORTED_MODULE_5__.Y36(_core_eperson_eperson_data_service__WEBPACK_IMPORTED_MODULE_0__.k),_angular_core__WEBPACK_IMPORTED_MODULE_5__.Y36(_shared_notifications_notifications_service__WEBPACK_IMPORTED_MODULE_1__.T))},"ProfilePageSecurityFormComponent_Factory"),ProfilePageSecurityFormComponent.\u0275cmp=_angular_core__WEBPACK_IMPORTED_MODULE_5__.Xpm({type:ProfilePageSecurityFormComponent,selectors:[["ds-profile-page-security-form"]],inputs:{passwordCanBeEmpty:"passwordCanBeEmpty",FORM_PREFIX:"FORM_PREFIX"},outputs:{isInvalid:"isInvalid",passwordValue:"passwordValue",currentPasswordValue:"currentPasswordValue"},decls:6,vars:7,consts:[[1,"mb-4",3,"type"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel",4,"ngIf"],["id","notSame","class","container-fluid text-danger",4,"ngIf"],["id","emptyPassword","class","container-fluid text-danger",4,"ngIf"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel"],["id","notSame",1,"container-fluid","text-danger"],["id","emptyPassword",1,"container-fluid","text-danger"]],template:__name(function(rf,ctx){1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_5__.TgZ(0,"ds-alert",0),_angular_core__WEBPACK_IMPORTED_MODULE_5__._uU(1),_angular_core__WEBPACK_IMPORTED_MODULE_5__.ALo(2,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_5__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_5__.YNc(3,ProfilePageSecurityFormComponent_ds_form_3_Template,1,5,"ds-form",1),_angular_core__WEBPACK_IMPORTED_MODULE_5__.YNc(4,ProfilePageSecurityFormComponent_div_4_Template,3,3,"div",2),_angular_core__WEBPACK_IMPORTED_MODULE_5__.YNc(5,ProfilePageSecurityFormComponent_div_5_Template,3,3,"div",3)),2&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_5__.Q6J("type","alert-info"),_angular_core__WEBPACK_IMPORTED_MODULE_5__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_5__.Oqu(_angular_core__WEBPACK_IMPORTED_MODULE_5__.lcZ(2,5,ctx.FORM_PREFIX+"info")),_angular_core__WEBPACK_IMPORTED_MODULE_5__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_5__.Q6J("ngIf",ctx.formModel),_angular_core__WEBPACK_IMPORTED_MODULE_5__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_5__.Q6J("ngIf",ctx.formGroup.hasError("notSame")),_angular_core__WEBPACK_IMPORTED_MODULE_5__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_5__.Q6J("ngIf",(ctx.formGroup.dirty||ctx.formGroup.touched)&&ctx.formGroup.hasError("emptyPassword")))},"ProfilePageSecurityFormComponent_Template"),dependencies:[_angular_common__WEBPACK_IMPORTED_MODULE_10__.O5,_angular_forms__WEBPACK_IMPORTED_MODULE_11__.JL,_angular_forms__WEBPACK_IMPORTED_MODULE_11__.sg,_shared_alert_alert_component__WEBPACK_IMPORTED_MODULE_3__.w,_shared_form_form_component__WEBPACK_IMPORTED_MODULE_4__.U,_ngx_translate_core__WEBPACK_IMPORTED_MODULE_9__.X$],encapsulation:2})},49670:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ProfilePageComponent:()=>ProfilePageComponent});var rxjs__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(93489),_profile_page_metadata_form_profile_page_metadata_form_component__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(31832),_shared_notifications_notifications_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(39373),rxjs_operators__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(96846),_core_eperson_eperson_data_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(74708),_core_shared_operators__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(53829),_shared_empty_util__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(59501),_shared_utils_follow_link_config_model__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(58090),_core_auth_auth_service__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(22410),_core_data_feature_authorization_authorization_data_service__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(32418),_core_data_feature_authorization_feature_id__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(60676),_core_data_configuration_data_service__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(68259),_core_breadcrumbs_dso_name_service__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(17306),_angular_core__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(86209),_ngx_translate_core__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(4330),_angular_common__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(65159),_shared_utils_var_directive__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(61562),_profile_page_security_form_profile_page_security_form_component__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(41034),_profile_page_researcher_form_profile_page_researcher_form_component__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(79889);function ProfilePageComponent_ng_container_0_div_1_ng_container_1_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_12__.ynx(0),_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(1,"h3",12),_angular_core__WEBPACK_IMPORTED_MODULE_12__._uU(2),_angular_core__WEBPACK_IMPORTED_MODULE_12__.ALo(3,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(4,"div",4)(5,"div",5),_angular_core__WEBPACK_IMPORTED_MODULE_12__._uU(6),_angular_core__WEBPACK_IMPORTED_MODULE_12__.ALo(7,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(8,"div",6)(9,"div",12),_angular_core__WEBPACK_IMPORTED_MODULE_12__._UZ(10,"ds-profile-page-researcher-form",7),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA()()(),_angular_core__WEBPACK_IMPORTED_MODULE_12__.BQk()),2&rf){const user_r1=_angular_core__WEBPACK_IMPORTED_MODULE_12__.oxw(2).ngVar;_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Oqu(_angular_core__WEBPACK_IMPORTED_MODULE_12__.lcZ(3,3,"profile.head")),_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(4),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Oqu(_angular_core__WEBPACK_IMPORTED_MODULE_12__.lcZ(7,5,"profile.card.researcher")),_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(4),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Q6J("user",user_r1)}}function ProfilePageComponent_ng_container_0_div_1_div_9_Template(rf,ctx){if(1&rf){const _r9=_angular_core__WEBPACK_IMPORTED_MODULE_12__.EpF();_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(0,"div",13)(1,"div",5),_angular_core__WEBPACK_IMPORTED_MODULE_12__._uU(2),_angular_core__WEBPACK_IMPORTED_MODULE_12__.ALo(3,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(4,"div",6)(5,"ds-profile-page-security-form",14),_angular_core__WEBPACK_IMPORTED_MODULE_12__.NdJ("isInvalid",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_12__.CHM(_r9);const ctx_r8=_angular_core__WEBPACK_IMPORTED_MODULE_12__.oxw(3);return _angular_core__WEBPACK_IMPORTED_MODULE_12__.KtG(ctx_r8.setInvalid($event))},"ProfilePageComponent_ng_container_0_div_1_div_9_Template_ds_profile_page_security_form_isInvalid_5_listener"))("passwordValue",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_12__.CHM(_r9);const ctx_r10=_angular_core__WEBPACK_IMPORTED_MODULE_12__.oxw(3);return _angular_core__WEBPACK_IMPORTED_MODULE_12__.KtG(ctx_r10.setPasswordValue($event))},"ProfilePageComponent_ng_container_0_div_1_div_9_Template_ds_profile_page_security_form_passwordValue_5_listener"))("currentPasswordValue",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_12__.CHM(_r9);const ctx_r11=_angular_core__WEBPACK_IMPORTED_MODULE_12__.oxw(3);return _angular_core__WEBPACK_IMPORTED_MODULE_12__.KtG(ctx_r11.setCurrentPasswordValue($event))},"ProfilePageComponent_ng_container_0_div_1_div_9_Template_ds_profile_page_security_form_currentPasswordValue_5_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA()()()}2&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Oqu(_angular_core__WEBPACK_IMPORTED_MODULE_12__.lcZ(3,2,"profile.card.security")),_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(3),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Q6J("FORM_PREFIX","profile.security.form."))}function ProfilePageComponent_ng_container_0_div_1_ng_container_16_div_1_li_5_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(0,"li",18),_angular_core__WEBPACK_IMPORTED_MODULE_12__._uU(1),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA()),2&rf){const group_r15=ctx.$implicit,ctx_r14=_angular_core__WEBPACK_IMPORTED_MODULE_12__.oxw(5);_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Oqu(ctx_r14.dsoNameService.getName(group_r15))}}function ProfilePageComponent_ng_container_0_div_1_ng_container_16_div_1_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(0,"div")(1,"h3",15),_angular_core__WEBPACK_IMPORTED_MODULE_12__._uU(2),_angular_core__WEBPACK_IMPORTED_MODULE_12__.ALo(3,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(4,"ul",16),_angular_core__WEBPACK_IMPORTED_MODULE_12__.YNc(5,ProfilePageComponent_ng_container_0_div_1_ng_container_16_div_1_li_5_Template,2,1,"li",17),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA()()),2&rf){const groups_r12=_angular_core__WEBPACK_IMPORTED_MODULE_12__.oxw().ngVar;_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Oqu(_angular_core__WEBPACK_IMPORTED_MODULE_12__.lcZ(3,2,"profile.groups.head")),_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(3),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Q6J("ngForOf",groups_r12)}}function ProfilePageComponent_ng_container_0_div_1_ng_container_16_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_12__.ynx(0),_angular_core__WEBPACK_IMPORTED_MODULE_12__.YNc(1,ProfilePageComponent_ng_container_0_div_1_ng_container_16_div_1_Template,6,4,"div",3),_angular_core__WEBPACK_IMPORTED_MODULE_12__.BQk()),2&rf){const groups_r12=ctx.ngVar;_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Q6J("ngIf",(null==groups_r12?null:groups_r12.length)>0)}}function ProfilePageComponent_ng_container_0_div_1_ng_container_18_div_1_li_5_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(0,"li",18),_angular_core__WEBPACK_IMPORTED_MODULE_12__._uU(1),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA()),2&rf){const specialGroup_r20=ctx.$implicit,ctx_r19=_angular_core__WEBPACK_IMPORTED_MODULE_12__.oxw(5);_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_12__.hij(" ",ctx_r19.dsoNameService.getName(specialGroup_r20)," ")}}function ProfilePageComponent_ng_container_0_div_1_ng_container_18_div_1_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(0,"div",20)(1,"h3",15),_angular_core__WEBPACK_IMPORTED_MODULE_12__._uU(2),_angular_core__WEBPACK_IMPORTED_MODULE_12__.ALo(3,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(4,"ul",16),_angular_core__WEBPACK_IMPORTED_MODULE_12__.YNc(5,ProfilePageComponent_ng_container_0_div_1_ng_container_18_div_1_li_5_Template,2,1,"li",17),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA()()),2&rf){const specialGroups_r17=_angular_core__WEBPACK_IMPORTED_MODULE_12__.oxw().ngVar;_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Oqu(_angular_core__WEBPACK_IMPORTED_MODULE_12__.lcZ(3,2,"profile.special.groups.head")),_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(3),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Q6J("ngForOf",specialGroups_r17)}}function ProfilePageComponent_ng_container_0_div_1_ng_container_18_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_12__.ynx(0),_angular_core__WEBPACK_IMPORTED_MODULE_12__.YNc(1,ProfilePageComponent_ng_container_0_div_1_ng_container_18_div_1_Template,6,4,"div",19),_angular_core__WEBPACK_IMPORTED_MODULE_12__.BQk()),2&rf){const specialGroups_r17=ctx.ngVar;_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Q6J("ngIf",(null==specialGroups_r17?null:specialGroups_r17.length)>0)}}function ProfilePageComponent_ng_container_0_div_1_Template(rf,ctx){if(1&rf){const _r23=_angular_core__WEBPACK_IMPORTED_MODULE_12__.EpF();_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(0,"div",2),_angular_core__WEBPACK_IMPORTED_MODULE_12__.YNc(1,ProfilePageComponent_ng_container_0_div_1_ng_container_1_Template,11,7,"ng-container",3),_angular_core__WEBPACK_IMPORTED_MODULE_12__.ALo(2,"async"),_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(3,"div",4)(4,"div",5),_angular_core__WEBPACK_IMPORTED_MODULE_12__._uU(5),_angular_core__WEBPACK_IMPORTED_MODULE_12__.ALo(6,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(7,"div",6),_angular_core__WEBPACK_IMPORTED_MODULE_12__._UZ(8,"ds-profile-page-metadata-form",7),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA()(),_angular_core__WEBPACK_IMPORTED_MODULE_12__.YNc(9,ProfilePageComponent_ng_container_0_div_1_div_9_Template,6,4,"div",8),_angular_core__WEBPACK_IMPORTED_MODULE_12__.ALo(10,"async"),_angular_core__WEBPACK_IMPORTED_MODULE_12__.TgZ(11,"div",9)(12,"button",10),_angular_core__WEBPACK_IMPORTED_MODULE_12__.NdJ("click",__name(function(){_angular_core__WEBPACK_IMPORTED_MODULE_12__.CHM(_r23);const ctx_r22=_angular_core__WEBPACK_IMPORTED_MODULE_12__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_12__.KtG(ctx_r22.updateProfile())},"ProfilePageComponent_ng_container_0_div_1_Template_button_click_12_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_12__._UZ(13,"i",11),_angular_core__WEBPACK_IMPORTED_MODULE_12__._uU(14),_angular_core__WEBPACK_IMPORTED_MODULE_12__.ALo(15,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA()(),_angular_core__WEBPACK_IMPORTED_MODULE_12__.YNc(16,ProfilePageComponent_ng_container_0_div_1_ng_container_16_Template,2,1,"ng-container",0),_angular_core__WEBPACK_IMPORTED_MODULE_12__.ALo(17,"async"),_angular_core__WEBPACK_IMPORTED_MODULE_12__.YNc(18,ProfilePageComponent_ng_container_0_div_1_ng_container_18_Template,2,1,"ng-container",0),_angular_core__WEBPACK_IMPORTED_MODULE_12__.ALo(19,"async"),_angular_core__WEBPACK_IMPORTED_MODULE_12__.qZA()}if(2&rf){const user_r1=_angular_core__WEBPACK_IMPORTED_MODULE_12__.oxw().ngVar,ctx_r2=_angular_core__WEBPACK_IMPORTED_MODULE_12__.oxw();let tmp_5_0,tmp_6_0;_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Q6J("ngIf",_angular_core__WEBPACK_IMPORTED_MODULE_12__.lcZ(2,7,ctx_r2.isResearcherProfileEnabled())),_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(4),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Oqu(_angular_core__WEBPACK_IMPORTED_MODULE_12__.lcZ(6,9,"profile.card.identify")),_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(3),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Q6J("user",user_r1),_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Q6J("ngIf",_angular_core__WEBPACK_IMPORTED_MODULE_12__.lcZ(10,11,ctx_r2.canChangePassword$)),_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(5),_angular_core__WEBPACK_IMPORTED_MODULE_12__.hij(" ",_angular_core__WEBPACK_IMPORTED_MODULE_12__.lcZ(15,13,"profile.form.submit"),""),_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Q6J("ngVar",null==(tmp_5_0=_angular_core__WEBPACK_IMPORTED_MODULE_12__.lcZ(17,15,ctx_r2.groupsRD$))||null==tmp_5_0.payload?null:tmp_5_0.payload.page),_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Q6J("ngVar",null==(tmp_6_0=_angular_core__WEBPACK_IMPORTED_MODULE_12__.lcZ(19,17,ctx_r2.specialGroupsRD$))||null==tmp_6_0.payload?null:tmp_6_0.payload.page)}}function ProfilePageComponent_ng_container_0_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_12__.ynx(0),_angular_core__WEBPACK_IMPORTED_MODULE_12__.YNc(1,ProfilePageComponent_ng_container_0_div_1_Template,20,19,"div",1),_angular_core__WEBPACK_IMPORTED_MODULE_12__.BQk()),2&rf){const user_r1=ctx.ngVar;_angular_core__WEBPACK_IMPORTED_MODULE_12__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Q6J("ngIf",user_r1)}}__name(ProfilePageComponent_ng_container_0_div_1_ng_container_1_Template,"ProfilePageComponent_ng_container_0_div_1_ng_container_1_Template"),__name(ProfilePageComponent_ng_container_0_div_1_div_9_Template,"ProfilePageComponent_ng_container_0_div_1_div_9_Template"),__name(ProfilePageComponent_ng_container_0_div_1_ng_container_16_div_1_li_5_Template,"ProfilePageComponent_ng_container_0_div_1_ng_container_16_div_1_li_5_Template"),__name(ProfilePageComponent_ng_container_0_div_1_ng_container_16_div_1_Template,"ProfilePageComponent_ng_container_0_div_1_ng_container_16_div_1_Template"),__name(ProfilePageComponent_ng_container_0_div_1_ng_container_16_Template,"ProfilePageComponent_ng_container_0_div_1_ng_container_16_Template"),__name(ProfilePageComponent_ng_container_0_div_1_ng_container_18_div_1_li_5_Template,"ProfilePageComponent_ng_container_0_div_1_ng_container_18_div_1_li_5_Template"),__name(ProfilePageComponent_ng_container_0_div_1_ng_container_18_div_1_Template,"ProfilePageComponent_ng_container_0_div_1_ng_container_18_div_1_Template"),__name(ProfilePageComponent_ng_container_0_div_1_ng_container_18_Template,"ProfilePageComponent_ng_container_0_div_1_ng_container_18_Template"),__name(ProfilePageComponent_ng_container_0_div_1_Template,"ProfilePageComponent_ng_container_0_div_1_Template"),__name(ProfilePageComponent_ng_container_0_Template,"ProfilePageComponent_ng_container_0_Template");class ProfilePageComponent{constructor(authService,notificationsService,translate,epersonService,authorizationService,configurationService,dsoNameService){this.authService=authService,this.notificationsService=notificationsService,this.translate=translate,this.epersonService=epersonService,this.authorizationService=authorizationService,this.configurationService=configurationService,this.dsoNameService=dsoNameService,this.NOTIFICATIONS_PREFIX="profile.notifications.",this.PASSWORD_NOTIFICATIONS_PREFIX="profile.security.form.notifications.",this.isResearcherProfileEnabled$=new rxjs__WEBPACK_IMPORTED_MODULE_13__.BehaviorSubject(!1)}ngOnInit(){this.user$=this.authService.getAuthenticatedUserFromStore().pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_14__.hX)(user=>(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_15__.Uh)(user.id)),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_14__.wt)(user=>this.epersonService.findById(user.id,!0,!0,(0,_shared_utils_follow_link_config_model__WEBPACK_IMPORTED_MODULE_16__.l)("groups"))),(0,_core_shared_operators__WEBPACK_IMPORTED_MODULE_3__.g1)(),(0,_core_shared_operators__WEBPACK_IMPORTED_MODULE_3__.xe)(),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_14__.bw)(user=>this.currentUser=user)),this.groupsRD$=this.user$.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_14__.wt)(user=>user.groups)),this.canChangePassword$=this.user$.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_14__.wt)(user=>this.authorizationService.isAuthorized(_core_data_feature_authorization_feature_id__WEBPACK_IMPORTED_MODULE_6__.i.CanChangePassword,user._links.self.href))),this.specialGroupsRD$=this.authService.getSpecialGroupsFromAuthStatus(),this.configurationService.findByPropertyName("researcher-profile.entity-type").pipe((0,_core_shared_operators__WEBPACK_IMPORTED_MODULE_3__.hC)()).subscribe(configRD=>{this.isResearcherProfileEnabled$.next(configRD.hasSucceeded&&configRD.payload.values.length>0)})}updateProfile(){const metadataChanged=this.metadataForm.updateProfile(),securityChanged=this.updateSecurity();!metadataChanged&&!securityChanged&&this.notificationsService.warning(this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.content"))}setInvalid($event){this.invalidSecurity=$event}updateSecurity(){const passEntered=(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_15__.UE)(this.password);if(this.invalidSecurity&&this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.general")),!this.invalidSecurity&&passEntered){const operations=[{op:"add",path:"/password",value:{new_password:this.password,current_password:this.currentPassword}}];this.epersonService.patch(this.currentUser,operations).pipe((0,_core_shared_operators__WEBPACK_IMPORTED_MODULE_3__.hC)()).subscribe(response=>{response.hasSucceeded?this.notificationsService.success(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.title"),this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.content")):this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.title"),this.getPasswordErrorMessage(response))})}return passEntered}setPasswordValue($event){this.password=$event}setCurrentPasswordValue($event){this.currentPassword=$event}submit(){this.updateProfile()}isResearcherProfileEnabled(){return this.isResearcherProfileEnabled$.asObservable()}getPasswordErrorMessage(response){return response.hasFailed&&(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_15__.UE)(response.errorMessage)?this.translate.instant(response.errorMessage):this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.change-failed")}}__name(ProfilePageComponent,"ProfilePageComponent"),ProfilePageComponent.\u0275fac=__name(function(t){return new(t||ProfilePageComponent)(_angular_core__WEBPACK_IMPORTED_MODULE_12__.Y36(_core_auth_auth_service__WEBPACK_IMPORTED_MODULE_4__.e8),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Y36(_shared_notifications_notifications_service__WEBPACK_IMPORTED_MODULE_1__.T),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Y36(_ngx_translate_core__WEBPACK_IMPORTED_MODULE_17__.sK),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Y36(_core_eperson_eperson_data_service__WEBPACK_IMPORTED_MODULE_2__.k),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Y36(_core_data_feature_authorization_authorization_data_service__WEBPACK_IMPORTED_MODULE_5__._),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Y36(_core_data_configuration_data_service__WEBPACK_IMPORTED_MODULE_7__.i),_angular_core__WEBPACK_IMPORTED_MODULE_12__.Y36(_core_breadcrumbs_dso_name_service__WEBPACK_IMPORTED_MODULE_8__._))},"ProfilePageComponent_Factory"),ProfilePageComponent.\u0275cmp=_angular_core__WEBPACK_IMPORTED_MODULE_12__.Xpm({type:ProfilePageComponent,selectors:[["ds-profile-page"]],viewQuery:__name(function(rf,ctx){if(1&rf&&_angular_core__WEBPACK_IMPORTED_MODULE_12__.Gf(_profile_page_metadata_form_profile_page_metadata_form_component__WEBPACK_IMPORTED_MODULE_0__.u,5),2&rf){let _t;_angular_core__WEBPACK_IMPORTED_MODULE_12__.iGM(_t=_angular_core__WEBPACK_IMPORTED_MODULE_12__.CRH())&&(ctx.metadataForm=_t.first)}},"ProfilePageComponent_Query"),decls:2,vars:3,consts:[[4,"ngVar"],["class","container",4,"ngIf"],[1,"container"],[4,"ngIf"],[1,"card","mb-4"],[1,"card-header"],[1,"card-body"],[3,"user"],["class","card mb-4 security-section",4,"ngIf"],[1,"col-12","text-right","pr-0"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-edit"],[1,"mb-4"],[1,"card","mb-4","security-section"],[3,"FORM_PREFIX","isInvalid","passwordValue","currentPasswordValue"],[1,"mt-4"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["data-test","specialGroups",4,"ngIf"],["data-test","specialGroups"]],template:__name(function(rf,ctx){1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_12__.YNc(0,ProfilePageComponent_ng_container_0_Template,2,1,"ng-container",0),_angular_core__WEBPACK_IMPORTED_MODULE_12__.ALo(1,"async")),2&rf&&_angular_core__WEBPACK_IMPORTED_MODULE_12__.Q6J("ngVar",_angular_core__WEBPACK_IMPORTED_MODULE_12__.lcZ(1,1,ctx.user$))},"ProfilePageComponent_Template"),dependencies:[_angular_common__WEBPACK_IMPORTED_MODULE_18__.sg,_angular_common__WEBPACK_IMPORTED_MODULE_18__.O5,_shared_utils_var_directive__WEBPACK_IMPORTED_MODULE_9__.g,_profile_page_metadata_form_profile_page_metadata_form_component__WEBPACK_IMPORTED_MODULE_0__.u,_profile_page_security_form_profile_page_security_form_component__WEBPACK_IMPORTED_MODULE_10__.V,_profile_page_researcher_form_profile_page_researcher_form_component__WEBPACK_IMPORTED_MODULE_11__.V,_angular_common__WEBPACK_IMPORTED_MODULE_18__.Ov,_ngx_translate_core__WEBPACK_IMPORTED_MODULE_17__.X$]})}};